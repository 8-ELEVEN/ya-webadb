(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[533],{8640:function(e,t,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/scrcpy",function(){return r(2022)}])},2022:function(e,t,r){"use strict";let i,n,o;r.r(t),r.d(t,{default:function(){return tc}});var s,a,l,c,d,h,p,u,g,w,v,m,y,f,b,S,P,x,D,k,C,z,M=r(4471),E=r(6259),L=r(6979),j=r(3721),V=r(2197),T=r(3785),I=r(9418),O=r(6176),U=r(1246),N=r(5061),_=r(3499),H=r(3370),R=r(4678),F=r(7893),B=r(4551),A=r(5034),W=function(e){var t=e.className,r=H.useState(function(){return(0,F.z)()})[0],i=e.id,n=void 0===i?r:i,o=H.useRef({hostId:n,rootRef:H.useRef(null),notifyLayersChanged:function(){}});return H.useImperativeHandle(e.componentRef,function(){return o.current}),H.useEffect(function(){(0,A._Y)(n,o.current),(0,A.EQ)(n)},[]),(0,R.k)(function(){(0,A.nw)(n,o.current),(0,A.EQ)(n)}),H.createElement("div",(0,_.pi)({},e,{className:(0,B.i)("ms-LayerHost",t),ref:o.current.rootRef}))},G=r(1292),K=r(3277),J=r(8749),Y=r(4373),X=r(7609),q=r(6323),Z=r(6779),$=r(6609),Q=r.n($),ee=r(7417),et=r(2469),er=r(6789),ei=r(6261);class en{adb;options;constructor(e,t){this.adb=e,this.options=t}initialize(){}dispose(){}}class eo extends en{connect(){return this.adb.createSocket("localabstract:scrcpy")}async connectAndRetry(){for(let e=0;e<100;e+=1)try{return await this.connect()}catch(t){await (0,er.gw)(100)}throw Error("Can't connect to server after 100 retries")}async connectVideoStream(){let{readable:e}=await this.connectAndRetry();if(this.options.sendDummyByte){let t=e.getReader(),{done:r,value:i}=await t.read();if(r||1!==i.byteLength||0!==i[0])throw Error("Unexpected response from server");t.releaseLock()}return e}async getStreams(){let e;let t=await this.connectVideoStream();if(this.options.control&&(e=await this.connectAndRetry()),this.options.sendDeviceMeta){let r=t.getReader(),{done:i,value:n}=await r.read();if(i||68!==n.byteLength)throw Error("Unexpected response from server");r.releaseLock()}return[t,e]}}class es extends en{streams;address;async initialize(){await this.adb.reverse.remove("localabstract:scrcpy").catch(e=>{});let e=new ei.GJ;this.streams=e.readable.getReader();let t=e.writable.getWriter();this.address=await this.adb.reverse.add("localabstract:scrcpy","tcp:27183",e=>(t.write(e),!0))}async accept(){return(await this.streams.read()).value}async getStreams(){let e;let{readable:t}=await this.accept();if(this.options.control&&(e=await this.accept()),this.options.sendDeviceMeta){let r=t.getReader(),{done:i,value:n}=await r.read();if(i||68!==n.byteLength)throw Error("Unexpected response from server");r.releaseLock()}return[t,e]}dispose(){this.adb.reverse.remove(this.address).catch(e=>{})}}class ea{raw;get value(){return this.raw.value}set value(e){this.raw.value=e}constructor(e){this.raw=e}getDefaultValue(){return this.raw.getDefaultValue()}formatServerArguments(){return this.raw.formatServerArguments()}getOutputEncoderNameRegex(){return this.raw.getOutputEncoderNameRegex()}createVideoStreamTransformer(){return this.raw.createVideoStreamTransformer()}getControlMessageTypes(){return this.raw.getControlMessageTypes()}serializeBackOrScreenOnControlMessage(e){return this.raw.serializeBackOrScreenOnControlMessage(e)}getScrollController(){return this.raw.getScrollController()}}class el extends ea{createConnection(e){let t={control:!0,sendDummyByte:!0,sendDeviceMeta:!0};return this.value.tunnelForward?new eo(e,t):new es(e,t)}}class ec extends el{createConnection(e){let t={...this.getDefaultValue(),...this.value};return this.value.tunnelForward?new eo(e,t):new es(e,t)}}var ed=r(9229);function eh(e,t,r){return e<t?t:e>r?r:e}(s=m=m||(m={}))[s.InjectKeyCode=0]="InjectKeyCode",s[s.InjectText=1]="InjectText",s[s.InjectTouch=2]="InjectTouch",s[s.InjectScroll=3]="InjectScroll",s[s.BackOrScreenOn=4]="BackOrScreenOn",s[s.ExpandNotificationPanel=5]="ExpandNotificationPanel",s[s.ExpandSettingPanel=6]="ExpandSettingPanel",s[s.CollapseNotificationPanel=7]="CollapseNotificationPanel",s[s.GetClipboard=8]="GetClipboard",s[s.SetClipboard=9]="SetClipboard",s[s.SetScreenPowerMode=10]="SetScreenPowerMode",s[s.RotateDevice=11]="RotateDevice",(a=y=y||(y={}))[a.Down=0]="Down",a[a.Up=1]="Up",a[a.Move=2]="Move",a[a.Cancel=3]="Cancel",a[a.Outside=4]="Outside",a[a.PointerDown=5]="PointerDown",a[a.PointerUp=6]="PointerUp",a[a.HoverMove=7]="HoverMove",a[a.Scroll=8]="Scroll",a[a.HoverEnter=9]="HoverEnter",a[a.HoverExit=10]="HoverExit",a[a.ButtonPress=11]="ButtonPress",a[a.ButtonRelease=12]="ButtonRelease",(l=f=f||(f={})).Mouse=BigInt(-1),l.Finger=BigInt(-2),l.VirtualMouse=BigInt(-3),l.VirtualFinger=BigInt(-4);let ep=new ed.Pl({size:2,signed:!1,deserialize(e,t){let r=ed.ek.Uint16.deserialize(e,t);return r/65535},serialize(e,t,r,i){r=65535*eh(r,0,1),ed.ek.Uint16.serialize(e,t,r,i)}}),eu=new ed.ZP().uint8("type",m.InjectTouch).uint8("action",(0,ed.W$)()).uint64("pointerId").uint32("pointerX").uint32("pointerY").uint16("screenWidth").uint16("screenHeight").field("pressure",ep).uint32("buttons");class eg{lastHoverMessage;process(e){let t=[];return this.lastHoverMessage&&this.lastHoverMessage.pointerId!==e.pointerId&&(t.push({...this.lastHoverMessage,action:y.Up}),this.lastHoverMessage=void 0),e.action===y.HoverMove&&(this.lastHoverMessage=e),e.type=m.InjectTouch,t.push(e),t}}(c=b=b||(b={}))[c.Down=0]="Down",c[c.Up=1]="Up",(d=S=S||(S={}))[d.Home=3]="Home",d[d.Back=4]="Back",d[d.DPadUp=19]="DPadUp",d[d.DPadDown=20]="DPadDown",d[d.DPadLeft=21]="DPadLeft",d[d.DPadRight=22]="DPadRight",d[d.VolumeUp=24]="VolumeUp",d[d.VolumeDown=25]="VolumeDown",d[d.A=29]="A",d[d.B=30]="B",d[d.C=31]="C",d[d.D=32]="D",d[d.E=33]="E",d[d.F=34]="F",d[d.G=35]="G",d[d.H=36]="H",d[d.I=37]="I",d[d.J=38]="J",d[d.K=39]="K",d[d.L=40]="L",d[d.M=41]="M",d[d.N=42]="N",d[d.O=43]="O",d[d.P=44]="P",d[d.Q=45]="Q",d[d.R=46]="R",d[d.S=47]="S",d[d.T=48]="T",d[d.U=49]="U",d[d.V=50]="V",d[d.W=51]="W",d[d.X=52]="X",d[d.Y=53]="Y",d[d.Z=54]="Z",d[d.Tab=61]="Tab",d[d.Space=62]="Space",d[d.Enter=66]="Enter",d[d.Delete=67]="Delete",d[d.Escape=111]="Escape",d[d.ForwardDelete=112]="ForwardDelete",d[d.MoveHome=122]="MoveHome",d[d.MoveEnd=123]="MoveEnd",d[d.VolumeMute=164]="VolumeMute",d[d.AppSwitch=187]="AppSwitch";let ew=new ed.ZP().uint8("type",m.InjectKeyCode).uint8("action",(0,ed.W$)()).uint32("keyCode").uint32("repeat").uint32("metaState"),ev=new ed.ZP().uint8("type",m.InjectText).uint32("length").string("text",{lengthField:"length"}),em=new ed.ZP().uint8("type",m.RotateDevice);(h=P=P||(P={}))[h.Off=0]="Off",h[h.Normal=2]="Normal";let ey=new ed.ZP().uint8("type",m.SetScreenPowerMode).uint8("mode",(0,ed.W$)());class ef{options;types;writer;scrollController;constructor(e,t){this.writer=e.getWriter(),this.options=t,this.types=t.getControlMessageTypes(),this.scrollController=t.getScrollController()}getTypeValue(e){let t=this.types.indexOf(e);if(-1===t)throw Error("Not supported");return t}injectKeyCode(e){return this.writer.write(ew.serialize({...e,type:this.getTypeValue(m.InjectKeyCode)}))}injectText(e){return this.writer.write(ev.serialize({text:e,type:this.getTypeValue(m.InjectText)}))}injectTouch(e){return this.writer.write(eu.serialize({...e,type:this.getTypeValue(m.InjectTouch)}))}injectScroll(e){e.type=this.getTypeValue(m.InjectScroll);let t=this.scrollController.serializeScrollMessage(e);if(t)return this.writer.write(t)}async backOrScreenOn(e){let t=this.options.serializeBackOrScreenOnControlMessage({action:e,type:this.getTypeValue(m.BackOrScreenOn)});if(t)return await this.writer.write(t)}setScreenPowerMode(e){return this.writer.write(ey.serialize({mode:e,type:this.getTypeValue(m.SetScreenPowerMode)}))}rotateDevice(){return this.writer.write(em.serialize({type:this.getTypeValue(m.RotateDevice)}))}close(){return this.writer.close()}}(p=x=x||(x={}))[p.Clipboard=0]="Clipboard",p[p.AckClipboard=1]="AckClipboard";let eb=new ed.ZP().uint32("length").string("content",{lengthField:"length"}).extra({type:x.Clipboard});class eS extends ei.pC{constructor(){super(async e=>{let t=await e.read(1);if(0===t[0])return await eb.deserialize(e);throw Error("unknown control message type")})}}let eP={repeatPreviousFrameAfter:"long",maxPtsGapToEncoder:"long"};class ex{value;constructor(e){this.value=e}toOptionValue(){let e=Object.entries(this.value).filter(([,e])=>void 0!==e);if(0!==e.length)return e.map(([e,t])=>{let r=eP[e];return`${e.replace(/([A-Z])/g,"-$1").toLowerCase()}${r?`:${r}`:""}=${t}`}).join(",")}}let eD="/data/local/tmp/scrcpy-server.jar";function ek(e,t){var r;return"object"==typeof(r=e)&&null!==r&&"toOptionValue"in r&&"function"==typeof r.toOptionValue&&(e=e.toOptionValue()),void 0===e?t:String(e)}class eC{buffer;bytePosition=0;bitPosition=0;constructor(e){this.buffer=e}read(e){let t=0;for(let r=0;r<e;r+=1)t=t<<1|this.next();return t}next(){let e=this.buffer[this.bytePosition]>>7-this.bitPosition&1;return this.bitPosition+=1,8===this.bitPosition&&(this.bytePosition+=1,this.bitPosition=0),e}decodeExponentialGolombNumber(){let e=0;for(;0===this.next();)e+=1;return 0===e?0:(1<<e|this.read(e))-1}}let ez=new ed.ZP().uint8("type",m.InjectScroll).uint32("pointerX").uint32("pointerY").uint16("screenWidth").uint16("screenHeight").int32("scrollX").int32("scrollY");class eM{accumulatedX=0;accumulatedY=0;processMessage(e){this.accumulatedX+=e.scrollX,this.accumulatedY+=e.scrollY;let t=0,r=0;if(this.accumulatedX>=1?(t=1,this.accumulatedX=0):this.accumulatedX<=-1&&(t=-1,this.accumulatedX=0),this.accumulatedY>=1?(r=1,this.accumulatedY=0):this.accumulatedY<=-1&&(r=-1,this.accumulatedY=0),0!==t||0!==r)return e.scrollX=t,e.scrollY=r,e}serializeScrollMessage(e){let t=this.processMessage(e);if(t)return ez.serialize(t)}}(u=D=D||(D={})).Verbose="verbose",u.Debug="debug",u.Info="info",u.Warn="warn",u.Error="error",(g=k=k||(k={}))[g.Initial=-2]="Initial",g[g.Unlocked=-1]="Unlocked",g[g.Portrait=0]="Portrait",g[g.Landscape=1]="Landscape",g[g.PortraitFlipped=2]="PortraitFlipped",g[g.LandscapeFlipped=3]="LandscapeFlipped";let eE=new ed.ZP().uint64("pts").uint32("size").uint8Array("data",{lengthField:"size"}),eL=BigInt(1)<<BigInt(63),ej=new ed.ZP().uint8("type",m.BackOrScreenOn);class eV{value;constructor(e){new.target===eV&&e.logLevel===D.Verbose&&(e.logLevel=D.Debug),new.target===eV&&e.lockVideoOrientation===k.Initial&&(e.lockVideoOrientation=k.Unlocked),this.value=e}getArgumentOrder(){return["logLevel","maxSize","bitRate","maxFps","lockVideoOrientation","tunnelForward","crop","sendFrameMeta","control","displayId","showTouches","stayAwake","codecOptions","encoderName"]}getDefaultValue(){return{logLevel:D.Debug,maxSize:0,bitRate:8e6,maxFps:0,lockVideoOrientation:k.Unlocked,tunnelForward:!1,crop:"-",sendFrameMeta:!0,control:!0,displayId:0,showTouches:!1,stayAwake:!1,codecOptions:new ex({}),encoderName:"-"}}formatServerArguments(){let e=this.getDefaultValue();return this.getArgumentOrder().map(t=>ek(this.value[t]||e[t],"-"))}getOutputEncoderNameRegex(){return/\s+scrcpy --encoder-name '(.*?)'/}createVideoStreamTransformer(){let e;if(!1===this.value.sendFrameMeta)return new ei.GJ({transform(e,t){t.enqueue({type:"frame",data:e})}});let t=new ei.gL(eE);return{writable:t.writable,readable:t.readable.pipeThrough(new ei.GJ({transform(t,r){let i;if(t.pts===eL){let{sequenceParameterSet:n,pictureParameterSet:o}=function(e){let t,r;for(let i of function*(e){let t=-1,r=0,i=0,n=!1;for(let o of e){if(e[r]=o,r+=1,n){if(o>3)throw Error("Invalid data");n=!1;continue}if(0==o){i+=1;continue}let s=i;if(i=0,-1===t){if(s>=2&&1===o){r=0,t=0;continue}throw Error("Invalid data")}if(!(s<2)){if(1===o){yield e.subarray(t,r-=s+1),t=r;continue}if(s>2)throw Error("Invalid data");switch(o){case 2:throw Error("Invalid data");case 3:r-=1,n=!0}}}if(n||0!==i)throw Error("Invalid data");yield e.subarray(t,r)}(e)){let n=31&i[0];switch(n){case 7:if(t=i,r)return{sequenceParameterSet:t,pictureParameterSet:r};break;case 8:if(r=i,t)return{sequenceParameterSet:t,pictureParameterSet:r}}}throw Error("Invalid data")}(t.data.slice()),{profile_idc:s,constraint_set:a,level_idc:l,pic_width_in_mbs_minus1:c,pic_height_in_map_units_minus1:d,frame_mbs_only_flag:h,frame_crop_left_offset:p,frame_crop_right_offset:u,frame_crop_top_offset:g,frame_crop_bottom_offset:w}=function(e){let t,r,i,n;let o=new eC(e);if(0!==o.next())throw Error("Invalid data");let s=o.read(2),a=o.read(5);if(7!==a||0===s)throw Error("Invalid data");let l=o.read(8),c=o.read(8),d=new eC(new Uint8Array([c])),h=!!d.next(),p=!!d.next(),u=!!d.next(),g=!!d.next(),w=!!d.next(),v=!!d.next();if(0!==d.read(2))throw Error("Invalid data");let m=o.read(8),y=o.decodeExponentialGolombNumber();if(100===l||110===l||122===l||244===l||44===l||83===l||86===l||118===l||128===l||138===l||139===l||134===l){let f=o.decodeExponentialGolombNumber();3===f&&o.next(),o.decodeExponentialGolombNumber(),o.decodeExponentialGolombNumber(),o.next();let b=!!o.next();if(b){let S=[];for(let P=0;P<(3!==f?8:12);P+=1)S[P]=!!o.next(),S[P]}}o.decodeExponentialGolombNumber();let x=o.decodeExponentialGolombNumber();if(0===x)o.decodeExponentialGolombNumber();else if(1===x){o.next(),o.decodeExponentialGolombNumber(),o.decodeExponentialGolombNumber();let D=o.decodeExponentialGolombNumber(),k=[];for(let C=0;C<D;C+=1)k[C]=o.decodeExponentialGolombNumber()}o.decodeExponentialGolombNumber(),o.next();let z=o.decodeExponentialGolombNumber(),M=o.decodeExponentialGolombNumber(),E=o.next();E||o.next(),o.next();let L=!!o.next();return L?(t=o.decodeExponentialGolombNumber(),r=o.decodeExponentialGolombNumber(),i=o.decodeExponentialGolombNumber(),n=o.decodeExponentialGolombNumber()):(t=0,r=0,i=0,n=0),o.next(),{profile_idc:l,constraint_set:c,constraint_set0_flag:h,constraint_set1_flag:p,constraint_set2_flag:u,constraint_set3_flag:g,constraint_set4_flag:w,constraint_set5_flag:v,level_idc:m,seq_parameter_set_id:y,pic_width_in_mbs_minus1:z,pic_height_in_map_units_minus1:M,frame_mbs_only_flag:E,frame_cropping_flag:L,frame_crop_left_offset:t,frame_crop_right_offset:r,frame_crop_top_offset:i,frame_crop_bottom_offset:n}}(n),v=(c+1)*16,m=(d+1)*(2-h)*16,y=2*p,f=2*u,b=2*g,S=2*w;e=t.data,r.enqueue({type:"configuration",pictureParameterSet:o,sequenceParameterSet:n,data:{profileIndex:s,constraintSet:a,levelIndex:l,encodedWidth:v,encodedHeight:m,cropLeft:y,cropRight:f,cropTop:b,cropBottom:S,croppedWidth:v-y-f,croppedHeight:m-b-S}});return}e?((i=new Uint8Array(e.byteLength+t.data.byteLength)).set(e),i.set(t.data,e.byteLength),e=void 0):i=t.data,r.enqueue({type:"frame",pts:t.pts,data:i})}}))}}getControlMessageTypes(){return[m.InjectKeyCode,m.InjectText,m.InjectTouch,m.InjectScroll,m.BackOrScreenOn,m.ExpandNotificationPanel,m.CollapseNotificationPanel,m.GetClipboard,m.SetClipboard,m.SetScreenPowerMode,m.RotateDevice]}serializeBackOrScreenOnControlMessage(e){if(e.action===b.Down)return ej.serialize(e)}getScrollController(){return new eM}}let eT=new ed.ZP().fields(ej).uint8("action",(0,ed.W$)());class eI extends eV{constructor(e){super(e)}getArgumentOrder(){return super.getArgumentOrder().concat(["powerOffOnClose"])}getDefaultValue(){return{...super.getDefaultValue(),powerOffOnClose:!1}}getOutputEncoderNameRegex(){return/\s+scrcpy --encoder '(.*?)'/}getControlMessageTypes(){let e=super.getControlMessageTypes();return e.splice(6,0,m.ExpandSettingPanel),e}serializeBackOrScreenOnControlMessage(e){return eT.serialize(e)}}class eO extends eI{constructor(e){super(e)}getDefaultValue(){return{...super.getDefaultValue(),clipboardAutosync:!0}}formatServerArguments(){return Object.entries(this.value).map(([e,t])=>[e,ek(t,void 0)]).filter(e=>void 0!==e[1]).map(([e,t])=>`${e.replace(/([A-Z])/g,"_$1").toLowerCase()}=${t}`)}}let eU=new ed.ZP().fields(ez).int32("buttons");class eN extends eM{serializeScrollMessage(e){let t=this.processMessage(e);if(t)return eU.serialize(t)}}class e_ extends eO{constructor(e){e.rawVideoStream&&(e.sendDeviceMeta=!1,e.sendFrameMeta=!1,e.sendDummyByte=!1),super(e)}getDefaultValue(){return{...super.getDefaultValue(),downsizeOnError:!0,sendDeviceMeta:!0,sendDummyByte:!0,rawVideoStream:!1}}getScrollController(){return new eN}}let eH=BigInt(1)<<BigInt(62);class eR extends e_{constructor(e){super(e)}getDefaultValue(){return{...super.getDefaultValue(),cleanup:!0}}createVideoStreamTransformer(){let e=super.createVideoStreamTransformer();return{writable:e.writable,readable:e.readable.pipeThrough(new ei.GJ({transform(e,t){if("frame"!==e.type){t.enqueue(e);return}void 0!==e.pts&&e.pts&eH&&(e.keyframe=!0,e.pts&=~eH),t.enqueue(e)}}))}}}class eF extends eR{constructor(e){super(e)}getDefaultValue(){return{...super.getDefaultValue(),powerOn:!0}}}let eB=new ed.Pl({size:2,signed:!0,deserialize(e,t){let r=ed.ek.Int16.deserialize(e,t);return r/32767},serialize(e,t,r,i){r=32767*eh(r,-1,1),ed.ek.Int16.serialize(e,t,r,i)}}),eA=new ed.ZP().uint8("type",m.InjectScroll).uint32("pointerX").uint32("pointerY").uint16("screenWidth").uint16("screenHeight").field("scrollX",eB).field("scrollY",eB).int32("buttons");class eW{serializeScrollMessage(e){return eA.serialize(e)}}class eG extends eF{getScrollController(){return new eW}}class eK extends ei.Pz{array;index=0;constructor(e){super({start:async()=>{await Promise.resolve(),this.array=e},pull:e=>{this.index<this.array.length?(e.enqueue(this.array[this.index]),this.index+=1):e.close()}})}}class eJ extends ei.Pz{streams;index=0;reader;constructor(...e){super({start:async t=>{await Promise.resolve(),this.streams=e,this.advance(t)},pull:async e=>{let t=await this.reader.read();if(!t.done){e.enqueue(t.value);return}this.advance(e)}})}advance(e){this.index<this.streams.length?(this.reader=this.streams[this.index].getReader(),this.index+=1):e.close()}}class eY extends Error{output;constructor(e){super("scrcpy server exited prematurely"),this.output=e}}class eX{static pushServer(e,t=eD){let r;return new ei.BF({start:async()=>(r=await e.sync()).write(t),async close(){await r.dispose()}})}static async start(e,t,r,i){let n;let o=i.createConnection(e);try{await o.initialize(),n=await e.subprocess.spawn([`CLASSPATH=${t}`,"app_process","/","com.genymobile.scrcpy.Server",r,...i.formatServerArguments()],{protocols:[ee.vf]});let s=n.stdout.pipeThrough(new ei.xU).pipeThrough(new ei.Jb("\n")),a=[],l=new ei.HS,c=s.pipeTo(new ei.Vj({write(e){a.push(e)}}),{signal:l.signal,preventCancel:!0}).catch(e=>{}),d=await Promise.race([n.exit,o.getStreams()]);if("number"==typeof d)throw new eY(a);l.abort(),await c;let[h,p]=d;return new eX(i,n,new eJ(new eK(a),s),h,p)}catch(u){throw await n?.kill(),u}finally{o.dispose()}}static async getEncoders(e,t,r,i){Object.assign(i.value,{encoderName:"_",control:!1,sendDeviceMeta:!1,sendDummyByte:!1});let n=await eX.start(e,t,r,i),o=i.getOutputEncoderNameRegex(),s=[];return await n.stdout.pipeTo(new ei.Vj({write(e){let t=e.match(o);t&&s.push(t[1])}})),s}static async getDisplays(e,t,r,i){Object.assign(i.value,{displayId:-1,control:!1,sendDeviceMeta:!1,sendDummyByte:!1});try{await eX.start(e,t,r,i)}catch(l){if(l instanceof eY){let n=/\s+scrcpy --display (\d+)/,o=[];for(let s of l.output){let a=s.match(n);a&&o.push(Number.parseInt(a[1],10))}return o}}throw Error("failed to get displays")}process;_stdout;get stdout(){return this._stdout}get exit(){return this.process.exit}_screenWidth;get screenWidth(){return this._screenWidth}_screenHeight;get screenHeight(){return this._screenHeight}_videoStream;get videoStream(){return this._videoStream}_controlMessageSerializer;get controlMessageSerializer(){return this._controlMessageSerializer}_deviceMessageStream;get deviceMessageStream(){return this._deviceMessageStream}constructor(e,t,r,i,n){this.process=t,this._stdout=r,this._videoStream=i.pipeThrough(e.createVideoStreamTransformer()).pipeThrough(new ei.N7(e=>{"configuration"===e.type&&(this._screenWidth=e.data.croppedWidth,this._screenHeight=e.data.croppedHeight)})),n&&(this._controlMessageSerializer=new ef(n.writable,e),this._deviceMessageStream=n.readable.pipeThrough(new eS))}async close(){await this.process.kill()}}(w=C=C||(C={}))[w.Baseline=1]="Baseline",w[w.Main=2]="Main",w[w.Extended=4]="Extended",w[w.High=8]="High",w[w.High10=16]="High10",w[w.High422=32]="High422",w[w.High444=64]="High444",w[w.ConstrainedBaseline=65536]="ConstrainedBaseline",w[w.ConstrainedHigh=524288]="ConstrainedHigh",(v=z=z||(z={}))[v.Level1=1]="Level1",v[v.Level1b=2]="Level1b",v[v.Level11=4]="Level11",v[v.Level12=8]="Level12",v[v.Level13=16]="Level13",v[v.Level2=32]="Level2",v[v.Level21=64]="Level21",v[v.Level22=128]="Level22",v[v.Level3=256]="Level3",v[v.Level31=512]="Level31",v[v.Level32=1024]="Level32",v[v.Level4=2048]="Level4",v[v.Level41=4096]="Level41",v[v.Level42=8192]="Level42",v[v.Level5=16384]="Level5",v[v.Level51=32768]="Level51",v[v.Level52=65536]="Level52",v[v.Level6=131072]="Level6",v[v.Level61=262144]="Level61",v[v.Level62=524288]="Level62";let eq=!1,eZ=[],e$=0,eQ=new Map;class e0 extends et.Xn{streamId;pictureReadyEvent=new et.vp;get onPictureReady(){return this.pictureReadyEvent.event}constructor(e){var t;super(),this.streamId=e,this.addDisposable((t=this.handlePictureReady,eQ.set(e,t),{dispose(){eQ.delete(e)}}))}handlePictureReady=e=>{this.pictureReadyEvent.fire(e)};feed(e){i.postMessage({type:"decode",data:e,offset:0,length:e.byteLength,renderStateId:this.streamId},[e])}dispose(){super.dispose(),i.postMessage({type:"release",renderStateId:this.streamId})}}function e1(){return n||(n=Promise.all([r.e(118).then(r.t.bind(r,6118,19)),r.e(337).then(r.t.bind(r,6337,19))]).then(([e,{default:t}])=>({YuvBuffer:e,YuvCanvas:t}))),n}class e2{maxProfile=C.Baseline;maxLevel=z.Level4;_renderer;get renderer(){return this._renderer}_frameRendered=0;get frameRendered(){return this._frameRendered}_writable;get writable(){return this._writable}_yuvCanvas;_initializer;constructor(){e1(),this._renderer=document.createElement("canvas"),this._writable=new ei.Vj({write:async e=>{switch(e.type){case"configuration":this.configure(e.data);break;case"frame":{if(!this._initializer)throw Error("Decoder not configured");let t=await this._initializer.promise;t.feed(e.data.slice().buffer)}}}})}async configure(e){this.dispose(),this._initializer=new er.hP;let{YuvBuffer:t,YuvCanvas:n}=await e1();this._yuvCanvas||(this._yuvCanvas=n.attach(this._renderer));let{encodedWidth:o,encodedHeight:s}=e,a=o/2,l=s/2;this._renderer.width=e.croppedWidth,this._renderer.height=e.croppedHeight;let c=t.format({width:o,height:s,chromaWidth:a,chromaHeight:l,cropLeft:e.cropLeft,cropTop:e.cropTop,cropWidth:e.croppedWidth,cropHeight:e.croppedHeight,displayWidth:e.croppedWidth,displayHeight:e.croppedHeight}),d=await function(){if(i||(i=new Worker(r.tu(new URL(r.p+r.u(292),r.b)))).addEventListener("message",({data:e})=>{switch(e.type){case"decoderReady":for(let t of(eq=!0,eZ))t.resolve(new e0(e$)),e$+=1;eZ.length=0;break;case"pictureReady":eQ.get(e.renderStateId)?.(e)}}),!eq){let e=new er.hP;return eZ.push(e),e.promise}let t=new e0(e$);return e$+=1,Promise.resolve(t)}();this._initializer.resolve(d);let h=o*s,p=h+a*l;d.onPictureReady(({data:e})=>{this._frameRendered+=1;let r=new Uint8Array(e),i=t.frame(c,t.lumaPlane(c,r,o,0),t.chromaPlane(c,r,a,h),t.chromaPlane(c,r,a,p));this._yuvCanvas.drawFrame(i)})}dispose(){this._initializer?.promise.then(e=>e.dispose()).catch(e=>{}),this._initializer=void 0}}function e3(e){return e.toString(16).padStart(2,"0").toUpperCase()}class e6{maxProfile=void 0;maxLevel=void 0;_writable;get writable(){return this._writable}_renderer;get renderer(){return this._renderer}_frameRendered=0;get frameRendered(){return this._frameRendered}context;decoder;lastFrame;animationFrame=0;constructor(){this._renderer=document.createElement("canvas"),this.context=this._renderer.getContext("2d"),this.decoder=new VideoDecoder({output:e=>{this.lastFrame&&this.lastFrame.close(),this.lastFrame=e,this.animationFrame||this.render()},error(e){}}),this._writable=new ei.Vj({write:e=>{switch(e.type){case"configuration":this.configure(e.data);break;case"frame":this.decoder.decode(new EncodedVideoChunk({type:!1===e.keyframe?"delta":"key",timestamp:0,data:e.data}))}}})}render=()=>{this.lastFrame&&(this._frameRendered+=1,this.context.drawImage(this.lastFrame,0,0),this.lastFrame.close(),this.lastFrame=void 0),this.animationFrame=requestAnimationFrame(this.render)};configure(e){let{profileIndex:t,constraintSet:r,levelIndex:i}=e;this._renderer.width=e.croppedWidth,this._renderer.height=e.croppedHeight;let n=`avc1.${[t,r,i].map(e3).join("")}`;this.decoder.configure({codec:n,optimizeForLatency:!0})}dispose(){cancelAnimationFrame(this.animationFrame),this.decoder.close()}}var e4="1.25",e8=r(6803),e7=r(6328),e5=r(9367);let e9=new r.U(r(4439));class te{get downloaded(){return this._downloaded}get total(){return this._total}get onProgress(){return this.progressEvent.event}async fetch(e){var t;let r=await window.fetch(e);this._total=Number.parseInt(null!==(t=r.headers.get("Content-Length"))&&void 0!==t?t:"0",10),this.progressEvent.fire([this._downloaded,this._total]);let i=r.body.getReader(),n=[];for(;;){let o=await i.read();if(o.done)break;n.push(o.value),this._downloaded+=o.value.byteLength,this.progressEvent.fire([this._downloaded,this._total])}this._total=n.reduce((e,t)=>e+t.byteLength,0);let s=new Uint8Array(this._total),a=0;for(let l of n)s.set(l,a),a+=l.byteLength;return s}constructor(e){this._downloaded=0,this._total=0,this.progressEvent=new et.vp,this.promise=this.fetch(e)}}function tt(e){return o||(o=new te(e9)).promise.catch(e=>{o=void 0}),e&&(o.onProgress(e),e([o.downloaded,o.total])),o.promise}let tr=(0,X.Z)({labelRight:{marginLeft:"4px"},video:{transformOrigin:"center center",touchAction:"none"}}),ti=(0,Z.Pi)(function(e){let{definition:t,settings:r,onChange:i}=e,n=tr(),o=(0,M.jsxs)(E.K,{horizontal:!0,verticalAlign:"center",children:[(0,M.jsx)("span",{children:t.label}),!!t.description&&(0,M.jsx)(L.G,{content:t.description,children:(0,M.jsx)(j.J,{className:n.labelRight,iconName:e5.PJ.Info})}),t.labelExtra]});switch(t.type){case"text":return(0,M.jsx)(V.n,{label:o,placeholder:t.placeholder,value:r[t.key],onChange:(e,r)=>i(t.key,r)});case"dropdown":return(0,M.jsx)(T.L,{label:o,options:t.options,placeholder:t.placeholder,selectedKey:r[t.key],onChange:(e,r)=>i(t.key,r.key)});case"toggle":return(0,M.jsx)(I.Z,{label:o,checked:r[t.key],onChange:(e,r)=>i(t.key,r)});case"number":return(0,M.jsx)(O.k,{label:t.label,labelPosition:U.L.top,min:t.min,max:t.max,step:t.step,value:r[t.key].toString(),onChange:(e,r)=>i(t.key,Number.parseInt(r,10))})}}),tn={Enter:S.Enter,Escape:S.Escape,Backspace:S.Delete,Tab:S.Tab,Delete:S.ForwardDelete,Home:S.MoveHome,End:S.MoveEnd,Space:S.Space,ArrowUp:S.DPadUp,ArrowDown:S.DPadDown,ArrowLeft:S.DPadLeft,ArrowRight:S.DPadRight},to=new class{get rotatedWidth(){return 1&to.rotate?to.height:to.width}get rotatedHeight(){return 1&to.rotate?to.width:to.height}async pushServer(){let e=await tt();await new ei.Pz({start(t){t.enqueue(e),t.close()}}).pipeTo(eX.pushServer(e7.q.device))}get commandBarItems(){let e=[];return this.running?e.push({key:"stop",iconProps:{iconName:e5.PJ.Stop},text:"Stop",onClick:this.stop}):e.push({key:"start",disabled:!e7.q.device,iconProps:{iconName:e5.PJ.Play},text:"Start",onClick:this.start}),e.push({key:"fullscreen",disabled:!this.running,iconProps:{iconName:e5.PJ.FullScreenMaximize},iconOnly:!0,text:"Fullscreen",onClick:()=>{var e;null===(e=this.deviceView)||void 0===e||e.enterFullscreen()}}),e.push({key:"volumeUp",disabled:!this.running,iconProps:{iconName:e5.PJ.Speaker2},iconOnly:!0,text:"Volume Up",onClick:async()=>{var e,t;await (null===(e=this.client)||void 0===e?void 0:e.controlMessageSerializer.injectKeyCode({action:b.Down,keyCode:S.VolumeUp,repeat:0,metaState:0})),await (null===(t=this.client)||void 0===t?void 0:t.controlMessageSerializer.injectKeyCode({action:b.Up,keyCode:S.VolumeUp,repeat:0,metaState:0}))}},{key:"volumeDown",disabled:!this.running,iconProps:{iconName:e5.PJ.Speaker1},iconOnly:!0,text:"Volume Down",onClick:async()=>{var e,t;await (null===(e=this.client)||void 0===e?void 0:e.controlMessageSerializer.injectKeyCode({action:b.Down,keyCode:S.VolumeDown,repeat:0,metaState:0})),await (null===(t=this.client)||void 0===t?void 0:t.controlMessageSerializer.injectKeyCode({action:b.Up,keyCode:S.VolumeDown,repeat:0,metaState:0}))}},{key:"volumeMute",disabled:!this.running,iconProps:{iconName:e5.PJ.SpeakerOff},iconOnly:!0,text:"Toggle Mute",onClick:async()=>{var e,t;await (null===(e=this.client)||void 0===e?void 0:e.controlMessageSerializer.injectKeyCode({action:b.Down,keyCode:S.VolumeMute,repeat:0,metaState:0})),await (null===(t=this.client)||void 0===t?void 0:t.controlMessageSerializer.injectKeyCode({action:b.Up,keyCode:S.VolumeMute,repeat:0,metaState:0}))}}),e.push({key:"rotateDevice",disabled:!this.running,iconProps:{iconName:e5.PJ.Orientation},iconOnly:!0,text:"Rotate Device",onClick:()=>{this.client.controlMessageSerializer.rotateDevice()}},{key:"rotateVideoLeft",disabled:!this.running,iconProps:{iconName:e5.PJ.RotateLeft},iconOnly:!0,text:"Rotate Video Left",onClick:(0,q.aD)(()=>{this.rotate-=1,this.rotate<0&&(this.rotate=3)})},{key:"rotateVideoRight",disabled:!this.running,iconProps:{iconName:e5.PJ.RotateRight},iconOnly:!0,text:"Rotate Video Right",onClick:(0,q.aD)(()=>{this.rotate=this.rotate+1&3})}),e.push({key:"turnScreenOff",disabled:!this.running,iconProps:{iconName:e5.PJ.Lightbulb},iconOnly:!0,text:"Turn Screen Off",onClick:()=>{this.client.controlMessageSerializer.setScreenPowerMode(P.Off)}},{key:"turnScreenOn",disabled:!this.running,iconProps:{iconName:e5.PJ.LightbulbFilament},iconOnly:!0,text:"Turn Screen On",onClick:()=>{this.client.controlMessageSerializer.setScreenPowerMode(P.Normal)}}),this.running&&e.push({key:"fps",text:"FPS: ".concat(this.fps),disabled:!0}),e}get commandBarFarItems(){return[{key:"NavigationBar",iconProps:{iconName:e5.PJ.PanelBottom},checked:this.navigationBarVisible,text:"Navigation Bar",iconOnly:!0,onClick:(0,q.aD)(()=>{this.navigationBarVisible=!this.navigationBarVisible})},{key:"Log",iconProps:{iconName:e5.PJ.TextGrammarError},checked:this.logVisible,text:"Log",iconOnly:!0,onClick:(0,q.aD)(()=>{this.logVisible=!this.logVisible})},{key:"Settings",iconProps:{iconName:e5.PJ.Settings},checked:this.settingsVisible,text:"Settings",iconOnly:!0,onClick:(0,q.aD)(()=>{this.settingsVisible=!this.settingsVisible})},{key:"DemoMode",iconProps:{iconName:e5.PJ.Wand},checked:this.demoModeVisible,text:"Demo Mode",iconOnly:!0,onClick:(0,q.aD)(()=>{this.demoModeVisible=!this.demoModeVisible})},{key:"info",iconProps:{iconName:e5.PJ.Info},iconOnly:!0,tooltipHostProps:{content:(0,M.jsxs)(M.Fragment,{children:[(0,M.jsxs)("p",{children:[(0,M.jsx)(e8.dL,{href:"https://github.com/Genymobile/scrcpy",spaceAfter:!0,children:"Scrcpy"}),"developed by Genymobile can display the screen with low latency (1~2 frames) and control the device, all without root access."]}),(0,M.jsx)("p",{children:"This is a TypeScript implementation of the client part. Paired with official pre-built server binary."})]}),calloutProps:{calloutMaxWidth:300}}}]}get settingDefinitions(){let e=[];return e.push({key:"powerOn",type:"toggle",label:"Turn device on when starting"},{key:"turnScreenOff",type:"toggle",label:"Turn screen off when starting"},{key:"stayAwake",type:"toggle",label:"Stay awake (if plugged in)"},{key:"powerOffOnClose",type:"toggle",label:"Turn device off when exiting"}),e.push({key:"displayId",type:"dropdown",label:"Display",placeholder:"Press refresh to update available displays",labelExtra:(0,M.jsx)(N.h,{iconProps:{iconName:e5.PJ.ArrowClockwise},disabled:!e7.q.device,text:"Refresh",onClick:this.updateDisplays}),options:this.displays.map(e=>({key:e,text:e.toString()}))}),e.push({key:"crop",type:"text",label:"Crop",placeholder:"W:H:X:Y"}),e.push({key:"maxSize",type:"number",label:"Max Resolution (longer side, 0 = unlimited)",min:0,max:2560,step:50}),e.push({key:"bitRate",type:"number",label:"Max Bit Rate",min:100,max:1e8,step:100}),e.push({key:"lockVideoOrientation",type:"dropdown",label:"Lock Video Orientation",options:[{key:k.Unlocked,text:"Unlocked"},{key:k.Initial,text:"Current"},{key:k.Portrait,text:"Portrait"},{key:k.Landscape,text:"Landscape"},{key:k.PortraitFlipped,text:"Portrait (Flipped)"},{key:k.LandscapeFlipped,text:"Landscape (Flipped)"}]}),e.push({key:"encoderName",type:"dropdown",label:"Encoder",placeholder:"Press refresh to update available encoders",labelExtra:(0,M.jsx)(N.h,{iconProps:{iconName:e5.PJ.ArrowClockwise},disabled:!e7.q.device,text:"Refresh",onClick:this.updateEncoders}),options:this.encoders.map(e=>({key:e,text:e}))}),this.decoders.length>1&&e.push({key:"decoder",type:"dropdown",label:"Decoder",options:this.decoders.map(e=>({key:e.key,text:e.name,data:e}))}),e.push({key:"ignoreDecoderCodecArgs",type:"toggle",label:"Ignore decoder's codec arguments",description:"Some decoders don't support all H.264 profile/levels, so they request the device to encode at their highest-supported codec. However, some super old devices may not support that codec so their encoders will fail to start. Use this option to let device choose the codec to be used."}),e.push({key:"tunnelForward",type:"toggle",label:"Use forward connection",description:"Android before version 9 has a bug that prevents reverse tunneling when using ADB over WiFi."}),e}async stop(){var e;await (null===(e=this.client)||void 0===e?void 0:e.close()),this.dispose()}dispose(){var e;null===(e=this.decoder)||void 0===e||e.dispose(),this.decoder=void 0,this.fps=0,clearTimeout(this.fpsCounterIntervalId),this.client=void 0,this.running=!1}handleDeviceViewRef(e){this.deviceView=e}handleRendererContainerRef(e){var t;this.rendererContainer=e,null===(t=this.rendererContainer)||void 0===t||t.addEventListener("wheel",this.handleWheel,{passive:!1})}calculatePointerPosition(e,t){let r=this.rendererContainer.getBoundingClientRect(),i=eh((e-r.x)/r.width,0,1),n=eh((t-r.y)/r.height,0,1);switch(1&this.rotate&&([i,n]=[n,i]),this.rotate){case 1:n=1-n;break;case 2:i=1-i,n=1-n;break;case 3:i=1-i}return{x:i*this.width,y:n*this.height}}constructor(){this.running=!1,this.deviceView=null,this.rendererContainer=null,this.logVisible=!1,this.log=[],this.settingsVisible=!1,this.demoModeVisible=!1,this.navigationBarVisible=!0,this.width=0,this.height=0,this.rotate=0,this.client=void 0,this.hoverHelper=void 0,this.encoders=[],this.updateEncoders=async()=>{try{await this.pushServer();let e=await eX.getEncoders(e7.q.device,eD,e4,new ec(new eG({logLevel:D.Debug,tunnelForward:this.settings.tunnelForward})));(0,q.z)(()=>{this.encoders=e,this.settings.encoderName&&this.encoders.includes(this.settings.encoderName)||(this.settings.encoderName=this.encoders[0])})}catch(t){e7.q.showErrorDialog(t)}},this.decoders=[{key:"tinyh264",name:"TinyH264 (Software)",Constructor:e2}],this.decoder=void 0,this.fpsCounterIntervalId=void 0,this.fps=0,this.displays=[],this.updateDisplays=async()=>{try{await this.pushServer();let e=await eX.getDisplays(e7.q.device,eD,e4,new ec(new eG({logLevel:D.Debug,tunnelForward:this.settings.tunnelForward})));(0,q.z)(()=>{this.displays=e,this.settings.displayId&&this.displays.includes(this.settings.displayId)||(this.settings.displayId=this.displays[0])})}catch(t){e7.q.showErrorDialog(t)}},this.connecting=!1,this.serverTotalSize=0,this.serverDownloadedSize=0,this.debouncedServerDownloadedSize=0,this.serverDownloadSpeed=0,this.serverUploadedSize=0,this.debouncedServerUploadedSize=0,this.serverUploadSpeed=0,this.settings={maxSize:1080,bitRate:4e6,lockVideoOrientation:k.Unlocked,displayId:0,crop:"",powerOn:!0},this.start=async()=>{if(e7.q.device)try{var e;let t;if(!this.settings.decoder)throw Error("No available decoder");(0,q.z)(()=>{this.serverTotalSize=0,this.serverDownloadedSize=0,this.debouncedServerDownloadedSize=0,this.serverUploadedSize=0,this.debouncedServerUploadedSize=0,this.connecting=!0});let r=setInterval((0,q.aD)(()=>{this.serverDownloadSpeed=this.serverDownloadedSize-this.debouncedServerDownloadedSize,this.debouncedServerDownloadedSize=this.serverDownloadedSize}),1e3);try{t=await tt((0,q.aD)(e=>{let[t,r]=e;this.serverDownloadedSize=t,this.serverTotalSize=r})),(0,q.z)(()=>{this.serverDownloadSpeed=this.serverDownloadedSize-this.debouncedServerDownloadedSize,this.debouncedServerDownloadedSize=this.serverDownloadedSize})}finally{clearInterval(r)}r=setInterval((0,q.aD)(()=>{this.serverUploadSpeed=this.serverUploadedSize-this.debouncedServerUploadedSize,this.debouncedServerUploadedSize=this.serverUploadedSize}),1e3);try{await new ei.Pz({start(e){e.enqueue(t),e.close()}}).pipeThrough(new ei.Cc(ee.j4)).pipeThrough(new e5.hK((0,q.aD)(e=>{this.serverUploadedSize=e}))).pipeTo(eX.pushServer(e7.q.device)),(0,q.z)(()=>{this.serverUploadSpeed=this.serverUploadedSize-this.debouncedServerUploadedSize,this.debouncedServerUploadedSize=this.serverUploadedSize})}finally{clearInterval(r)}let i=null!==(e=this.decoders.find(e=>e.key===this.settings.decoder))&&void 0!==e?e:this.decoders[0],n=new i.Constructor;(0,q.z)(()=>{this.decoder=n;let e=0;this.fpsCounterIntervalId=setInterval((0,q.aD)(()=>{this.fps=n.frameRendered-e,e=n.frameRendered}),1e3)});let o=new ec(new eG({logLevel:D.Debug,...this.settings,sendDeviceMeta:!1,sendDummyByte:!1,codecOptions:this.settings.ignoreDecoderCodecArgs?void 0:new ex({profile:n.maxProfile,level:n.maxLevel})}));(0,q.z)(()=>{this.log=[],this.log.push("[client] Server version: ".concat(e4)),this.log.push("[client] Server arguments: ".concat(o.formatServerArguments().join(" ")))});let s=await eX.start(e7.q.device,eD,e4,o);s.stdout.pipeTo(new ei.Vj({write:(0,q.aD)(e=>{this.log.push(e)})})),s.videoStream.pipeThrough(new ei.N7((0,q.aD)(e=>{if("configuration"===e.type){let{croppedWidth:t,croppedHeight:r}=e.data;this.log.push("[client] Video size changed: ".concat(t,"x").concat(r)),this.width=t,this.height=r}}))).pipeTo(n.writable).catch(()=>{}),s.exit.then(this.dispose),s.deviceMessageStream.pipeTo(new ei.Vj({write(e){e.type===x.Clipboard&&window.navigator.clipboard.writeText(e.content)}})).catch(()=>{}),this.settings.turnScreenOff&&await s.controlMessageSerializer.setScreenPowerMode(P.Off),(0,q.z)(()=>{this.client=s,this.hoverHelper=new eg,this.running=!0})}catch(a){e7.q.showErrorDialog(a)}finally{(0,q.z)(()=>{this.connecting=!1})}},this.handleBackPointerDown=e=>{this.client&&0===e.button&&(e.currentTarget.setPointerCapture(e.pointerId),this.client.controlMessageSerializer.backOrScreenOn(b.Down))},this.handleBackPointerUp=e=>{this.client&&0===e.button&&this.client.controlMessageSerializer.backOrScreenOn(b.Up)},this.handleHomePointerDown=e=>{this.client&&0===e.button&&(e.currentTarget.setPointerCapture(e.pointerId),this.client.controlMessageSerializer.injectKeyCode({action:b.Down,keyCode:S.Home,repeat:0,metaState:0}))},this.handleHomePointerUp=e=>{this.client&&0===e.button&&this.client.controlMessageSerializer.injectKeyCode({action:b.Up,keyCode:S.Home,repeat:0,metaState:0})},this.handleAppSwitchPointerDown=async e=>{this.client&&0===e.button&&(e.currentTarget.setPointerCapture(e.pointerId),this.client.controlMessageSerializer.injectKeyCode({action:b.Down,keyCode:S.AppSwitch,repeat:0,metaState:0}))},this.handleAppSwitchPointerUp=async e=>{this.client&&0===e.button&&this.client.controlMessageSerializer.injectKeyCode({action:b.Up,keyCode:S.AppSwitch,repeat:0,metaState:0})},this.injectTouch=(e,t)=>{let r;if(!this.client)return;let{pointerType:i}=t;r="mouse"===i?f.Finger:BigInt(t.pointerId);let{x:n,y:o}=this.calculatePointerPosition(t.clientX,t.clientY),s=this.hoverHelper.process({action:e,pointerId:r,screenWidth:this.client.screenWidth,screenHeight:this.client.screenHeight,pointerX:n,pointerY:o,pressure:t.pressure,buttons:t.buttons});for(let a of s)this.client.controlMessageSerializer.injectTouch(a)},this.handlePointerDown=e=>{this.rendererContainer.focus(),e.preventDefault(),e.stopPropagation(),e.currentTarget.setPointerCapture(e.pointerId),this.injectTouch(y.Down,e)},this.handlePointerMove=e=>{this.client&&(e.preventDefault(),e.stopPropagation(),this.injectTouch(0===e.buttons?y.HoverMove:y.Move,e))},this.handlePointerUp=e=>{e.preventDefault(),e.stopPropagation(),this.injectTouch(y.Up,e)},this.handlePointerLeave=e=>{e.preventDefault(),e.stopPropagation(),this.injectTouch(y.HoverExit,e),this.injectTouch(y.Up,e)},this.handleWheel=e=>{if(!this.client)return;e.preventDefault(),e.stopPropagation();let{x:t,y:r}=this.calculatePointerPosition(e.clientX,e.clientY);this.client.controlMessageSerializer.injectScroll({screenWidth:this.client.screenWidth,screenHeight:this.client.screenHeight,pointerX:t,pointerY:r,scrollX:-e.deltaX/100,scrollY:-e.deltaY/100,buttons:0})},this.handleContextMenu=e=>{e.preventDefault()},this.handleKeyDown=async e=>{if(!this.client)return;let{key:t,code:r}=e;if(t.match(/^[!-`{-~]$/i)){this.client.controlMessageSerializer.injectText(t);return}let i=tn[r];i&&(e.preventDefault(),e.stopPropagation(),this.client.controlMessageSerializer.injectKeyCode({action:b.Down,keyCode:i,metaState:0,repeat:0}),this.client.controlMessageSerializer.injectKeyCode({action:b.Up,keyCode:i,metaState:0,repeat:0}))},(0,q.ky)(this,{decoders:q.LO.shallow,settings:q.LO.deep,start:!1,stop:q.aD.bound,dispose:q.aD.bound,handleDeviceViewRef:q.aD.bound,handleRendererContainerRef:q.aD.bound,handleBackPointerDown:!1,handleBackPointerUp:!1,handleHomePointerDown:!1,handleHomePointerUp:!1,handleAppSwitchPointerDown:!1,handleAppSwitchPointerUp:!1,calculatePointerPosition:!1,injectTouch:!1,handlePointerDown:!1,handlePointerMove:!1,handlePointerUp:!1,handlePointerLeave:!1,handleWheel:!1,handleContextMenu:!1,handleKeyDown:!1}),(0,q.EH)(()=>{e7.q.device?(0,q.z)(()=>{this.encoders=[],this.settings.encoderName=void 0,this.displays=[],this.settings.displayId=void 0}):this.dispose()}),(0,q.EH)(()=>{if(this.rendererContainer&&this.decoder){for(;this.rendererContainer.firstChild;)this.rendererContainer.firstChild.remove();this.rendererContainer.appendChild(this.decoder.renderer)}}),(0,q.EH)(()=>{this.settings.decoder=this.decoders[0].key})}},ts=(0,Z.Pi)(()=>{let e=(0,Y.M)("layerHost"),[t,r]=(0,H.useState)(!1);return((0,H.useEffect)(()=>{r(!0)},[]),t)?(0,M.jsxs)(M.Fragment,{children:[(0,M.jsx)(W,{id:e,style:{position:"absolute",top:0,bottom:0,left:0,right:0,margin:0,pointerEvents:"none"}}),(0,M.jsx)(G.V,{hidden:!to.connecting,modalProps:{layerProps:{hostId:e}},dialogContentProps:{title:"Connecting..."},children:(0,M.jsxs)(E.K,{tokens:e5.WT,children:[(0,M.jsx)(K.Y,{label:"1. Downloading scrcpy server...",percentComplete:to.serverTotalSize?to.serverDownloadedSize/to.serverTotalSize:void 0,description:(0,e5.CY)(to.debouncedServerDownloadedSize,to.serverTotalSize,to.serverDownloadSpeed)}),(0,M.jsx)(K.Y,{label:"2. Pushing scrcpy server to device...",progressHidden:0===to.serverTotalSize||to.serverDownloadedSize!==to.serverTotalSize,percentComplete:to.serverUploadedSize/to.serverTotalSize,description:(0,e5.CY)(to.debouncedServerUploadedSize,to.serverTotalSize,to.serverUploadSpeed)}),(0,M.jsx)(K.Y,{label:"3. Starting scrcpy server on device...",progressHidden:0===to.serverTotalSize||to.serverUploadedSize!==to.serverTotalSize})]})})]}):null}),ta=(0,Z.Pi)(function(e){let{className:t,style:r,children:i}=e;return to.navigationBarVisible?(0,M.jsxs)(E.K,{className:t,verticalFill:!0,horizontalAlign:"center",style:{height:"40px",background:"#999",...r},children:[i,(0,M.jsxs)(E.K,{verticalFill:!0,horizontal:!0,style:{width:"100%",maxWidth:300},horizontalAlign:"space-evenly",verticalAlign:"center",children:[(0,M.jsx)(N.h,{iconProps:{iconName:e5.PJ.Play},style:{transform:"rotate(180deg)",color:"white"},onPointerDown:to.handleBackPointerDown,onPointerUp:to.handleBackPointerUp}),(0,M.jsx)(N.h,{iconProps:{iconName:e5.PJ.Circle},style:{color:"white"},onPointerDown:to.handleHomePointerDown,onPointerUp:to.handleHomePointerUp}),(0,M.jsx)(N.h,{iconProps:{iconName:e5.PJ.Stop},style:{color:"white"},onPointerDown:to.handleAppSwitchPointerDown,onPointerUp:to.handleAppSwitchPointerUp})]})]}):(0,M.jsx)("div",{className:t,style:r,children:i})}),tl=()=>{let e=tr();return(0,H.useEffect)(()=>{1===to.decoders.length&&"function"==typeof window.VideoDecoder&&(0,q.z)(()=>{to.decoders.unshift({key:"webcodecs",name:"WebCodecs",Constructor:e6})})},[]),(0,M.jsxs)(E.K,{...e5.LE,children:[(0,M.jsx)(Q(),{children:(0,M.jsx)("title",{children:"Scrcpy - Android Web Toolbox"})}),(0,M.jsx)(J.X,{items:to.commandBarItems,farItems:to.commandBarFarItems}),(0,M.jsxs)(E.K,{horizontal:!0,grow:!0,styles:{root:{height:0}},children:[(0,M.jsx)(e8.wM,{ref:to.handleDeviceViewRef,width:to.rotatedWidth,height:to.rotatedHeight,BottomElement:ta,children:(0,M.jsx)("div",{ref:to.handleRendererContainerRef,tabIndex:-1,className:e.video,style:{width:to.width,height:to.height,transform:"translate(".concat((to.rotatedWidth-to.width)/2,"px, ").concat((to.rotatedHeight-to.height)/2,"px) rotate(").concat(90*to.rotate,"deg)")},onPointerDown:to.handlePointerDown,onPointerMove:to.handlePointerMove,onPointerUp:to.handlePointerUp,onPointerCancel:to.handlePointerUp,onPointerLeave:to.handlePointerLeave,onKeyDown:to.handleKeyDown,onContextMenu:to.handleContextMenu})}),(0,M.jsx)("div",{style:{padding:12,overflow:"hidden auto",display:to.logVisible?"block":"none",width:500,fontFamily:"monospace",overflowY:"auto",whiteSpace:"pre-wrap",wordWrap:"break-word"},children:to.log.map((e,t)=>(0,M.jsx)("div",{children:e},t))}),(0,M.jsxs)("div",{style:{padding:12,overflow:"hidden auto",display:to.settingsVisible?"block":"none",width:300},children:[(0,M.jsx)("div",{children:"Changes will take effect on next connection"}),to.settingDefinitions.map(e=>(0,M.jsx)(ti,{definition:e,settings:to.settings,onChange:(0,q.aD)((e,t)=>to.settings[e]=t)},e.key))]}),(0,M.jsx)(e8.bq,{style:{display:to.demoModeVisible?"block":"none"}}),(0,M.jsx)(ts,{})]})]})};var tc=(0,Z.Pi)(tl)},4439:function(e,t,r){"use strict";e.exports=r.p+"static/chunks/scrcpy-server.50786887a0e88460"}},function(e){e.O(0,[197,774,888,179],function(){return e(e.s=8640)}),_N_E=e.O()}]);
//# sourceMappingURL=scrcpy-4be67dddd427e863.js.map