(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[533],{7934:function(e,t,i){(window.__NEXT_P=window.__NEXT_P||[]).push(["/scrcpy",function(){return i(5287)}])},7603:function(e,t,i){"use strict";i.d(t,{X:function(){return o}});var r=i(4471),n=i(3370);function o(){let[e,t]=(0,n.useState)(null);return(0,n.useEffect)(()=>{if(!e)return;let t=e.parentElement,i=t.style.flexGrow;return t.style.flexGrow="1",()=>{t.style.flexGrow=i}},[e]),(0,r.jsx)("div",{ref:t})}},5287:function(e,t,i){"use strict";let r,n,o;i.r(t),i.d(t,{default:function(){return ij}});var a,s,l,d,c,u,h,p,m,g,f,v,y,b,w,S,x,L,_,k,E,C,P,D,M,N,A,T,z,O,R,F,I,U,H,j,V,K,G,B,W=i(4471),Y=i(9207),Z=i(3223),J=i(9028),X=i(7561),q=i(2066),$=i(1252),Q=i(4490),ee=i(1694),et=i(9674),ei=i(1831);function*er(e){let t=-1,i=0,r=!1;for(let n=0;n<e.length;n+=1){let o=e[n];if(r){if(o>3)throw Error("Invalid data");r=!1;continue}if(0===o){i+=1;continue}let a=i;if(i=0,-1===t){if(a>=2&&1===o){t=n+1;continue}throw Error("Invalid data")}if(!(a<2)){if(1===o){yield e.subarray(t,n-a),t=n+1;continue}if(a>2)throw Error("Invalid data");switch(o){case 2:throw Error("Invalid data");case 3:r=!0}}}if(r)throw Error("Invalid data");yield e.subarray(t,e.length)}(a=E=E||(E={}))[a.Main8=1]="Main8",a[a.Main10=2]="Main10",a[a.Main10Hdr10=4096]="Main10Hdr10",a[a.Main10Hdr10Plus=8192]="Main10Hdr10Plus",(s=C=C||(C={}))[s.Level2=1]="Level2",s[s.Level21=2]="Level21",s[s.Level22=4]="Level22",s[s.Level23=8]="Level23",s[s.Level3=16]="Level3",s[s.Level31=32]="Level31",s[s.Level32=64]="Level32",s[s.Level33=128]="Level33",s[s.Level4=256]="Level4",s[s.Level41=512]="Level41",s[s.Level42=1024]="Level42",s[s.Level43=2048]="Level43",s[s.Level5=4096]="Level5",s[s.Level51=8192]="Level51",s[s.Level52=16384]="Level52",s[s.Level53=32768]="Level53",s[s.Level6=65536]="Level6",s[s.Level61=131072]="Level61",s[s.Level62=262144]="Level62",s[s.Level63=524288]="Level63",s[s.Level7=1048576]="Level7",s[s.Level71=2097152]="Level71",s[s.Level72=4194304]="Level72",s[s.Level73=8388608]="Level73";class en{_nalu;_byteLength;_stopBitIndex;_zeroCount=0;_bytePosition=-1;_bitPosition=-1;_byte=0;get byteLength(){return this._byteLength}get stopBitIndex(){return this._stopBitIndex}get bytePosition(){return this._bytePosition}get bitPosition(){return this._bitPosition}get ended(){return this._bytePosition===this._byteLength&&this._bitPosition===this._stopBitIndex}constructor(e){this._nalu=e;for(let t=e.length-1;t>=0;t-=1){if(0===this._nalu[t])continue;let i=e[t];for(let e=0;e<8;e+=1)if((i>>e&1)==1){this._byteLength=t,this._stopBitIndex=e,this.readByte();return}}throw Error("End bit not found")}readByte(){if(this._byte=this._nalu[this._bytePosition],2===this._zeroCount&&3===this._byte){this._zeroCount=0,this._bytePosition+=1,this.readByte();return}0===this._byte?this._zeroCount+=1:this._zeroCount=0}next(){if(-1===this._bitPosition&&(this._bitPosition=7,this._bytePosition+=1,this.readByte()),this._bytePosition===this._byteLength&&this._bitPosition===this._stopBitIndex)throw Error("Bit index out of bounds");let e=this._byte>>this._bitPosition&1;return this._bitPosition-=1,e}read(e){if(e>32)throw Error("Read length too large");let t=0;for(let i=0;i<e;i+=1)t=t<<1|this.next();return t}skip(e){for(let t=0;t<e;t+=1)this.next()}decodeExponentialGolombNumber(){let e=0;for(;0===this.next();)e+=1;return 0===e?0:(1<<e|this.read(e))-1}peek(e){let{_zeroCount:t,_bytePosition:i,_bitPosition:r,_byte:n}=this,o=this.read(e);return Object.assign(this,{_zeroCount:t,_bytePosition:i,_bitPosition:r,_byte:n}),o}readBytes(e){let t=new Uint8Array(e);for(let i=0;i<e;i+=1)t[i]=this.read(8);return t}peekBytes(e){let{_zeroCount:t,_bytePosition:i,_bitPosition:r,_byte:n}=this,o=this.readBytes(e);return Object.assign(this,{_zeroCount:t,_bytePosition:i,_bitPosition:r,_byte:n}),o}}function eo(e){let t,i;for(let r of er(e)){let e=31&r[0];switch(e){case 7:if(t=r,i)return{sequenceParameterSet:t,pictureParameterSet:i};break;case 8:if(i=r,t)return{sequenceParameterSet:t,pictureParameterSet:i}}}throw Error("Invalid data")}function ea(e){let{sequenceParameterSet:t,pictureParameterSet:i}=eo(e),{profile_idc:r,constraint_set:n,level_idc:o,pic_width_in_mbs_minus1:a,pic_height_in_map_units_minus1:s,frame_mbs_only_flag:l,frame_crop_left_offset:d,frame_crop_right_offset:c,frame_crop_top_offset:u,frame_crop_bottom_offset:h}=function(e){let t,i,r,n;let o=new en(e);if(0!==o.next())throw Error("Invalid data");let a=o.read(2),s=o.read(5);if(7!==s||0===a)throw Error("Invalid data");let l=o.read(8),d=o.peek(8),c=!!o.next(),u=!!o.next(),h=!!o.next(),p=!!o.next(),m=!!o.next(),g=!!o.next();if(0!==o.read(2))throw Error("Invalid data");let f=o.read(8),v=o.decodeExponentialGolombNumber();if(100===l||110===l||122===l||244===l||44===l||83===l||86===l||118===l||128===l||138===l||139===l||134===l){let e=o.decodeExponentialGolombNumber();3===e&&o.next(),o.decodeExponentialGolombNumber(),o.decodeExponentialGolombNumber(),o.next();let t=!!o.next();if(t){let t=[];for(let i=0;i<(3!==e?8:12);i+=1)t[i]=!!o.next(),t[i]}}o.decodeExponentialGolombNumber();let y=o.decodeExponentialGolombNumber();if(0===y)o.decodeExponentialGolombNumber();else if(1===y){o.next(),o.decodeExponentialGolombNumber(),o.decodeExponentialGolombNumber();let e=o.decodeExponentialGolombNumber(),t=[];for(let i=0;i<e;i+=1)t[i]=o.decodeExponentialGolombNumber()}o.decodeExponentialGolombNumber(),o.next();let b=o.decodeExponentialGolombNumber(),w=o.decodeExponentialGolombNumber(),S=o.next();S||o.next(),o.next();let x=!!o.next();return x?(t=o.decodeExponentialGolombNumber(),i=o.decodeExponentialGolombNumber(),r=o.decodeExponentialGolombNumber(),n=o.decodeExponentialGolombNumber()):(t=0,i=0,r=0,n=0),o.next(),{profile_idc:l,constraint_set:d,constraint_set0_flag:c,constraint_set1_flag:u,constraint_set2_flag:h,constraint_set3_flag:p,constraint_set4_flag:m,constraint_set5_flag:g,level_idc:f,seq_parameter_set_id:v,pic_width_in_mbs_minus1:b,pic_height_in_map_units_minus1:w,frame_mbs_only_flag:S,frame_cropping_flag:x,frame_crop_left_offset:t,frame_crop_right_offset:i,frame_crop_top_offset:r,frame_crop_bottom_offset:n}}(t),p=(a+1)*16,m=(s+1)*(2-l)*16,g=2*d,f=2*c,v=2*u,y=2*h;return{pictureParameterSet:i,sequenceParameterSet:t,profileIndex:r,constraintSet:n,levelIndex:o,encodedWidth:p,encodedHeight:m,cropLeft:g,cropRight:f,cropTop:v,cropBottom:y,croppedWidth:p-g-f,croppedHeight:m-v-y}}function es(e){let t,i,r,n,o,a,s,l;let d=new en(e),c=d.read(4),u=!!d.next(),h=!!d.next(),p=d.read(6),m=d.read(3),g=!!d.next();d.skip(16);let f=ec(d,!0,m),v=!!d.next(),y=[],b=[],w=[];for(let e=v?0:m;e<=m;e+=1)y[e]=d.decodeExponentialGolombNumber(),b[e]=d.decodeExponentialGolombNumber(),w[e]=d.decodeExponentialGolombNumber();let S=d.read(6),x=d.decodeExponentialGolombNumber(),L=[];for(let e=1;e<=x;e+=1){L[e]=[];for(let t=0;t<=S;t+=1)L[e][t]=!!d.next()}let _=!!d.next();if(_){t=d.read(32),i=d.read(32),(r=!!d.next())&&(n=d.decodeExponentialGolombNumber()),o=d.decodeExponentialGolombNumber(),a=[],s=[!0],l=[];for(let e=0;e<o;e+=1)a[e]=d.decodeExponentialGolombNumber(),e>0&&(s[e]=!!d.next()),l[e]=function(e,t,i){let r,n,o,a,s,l,d,c,u,h,p,m,g;t&&(r=!!e.next(),n=!!e.next(),(r||n)&&((o=!!e.next())&&(a=e.read(8),s=e.read(5),l=!!e.next(),d=e.read(5)),c=e.read(4),u=e.read(4),o&&(h=e.read(4)),p=e.read(5),m=e.read(5),g=e.read(5)));let f=[],v=[],y=[],b=[],w=[],S=[],x=[];for(let t=0;t<=i;t+=1){var L,_;f[t]=!!e.next(),f[t]||(v[t]=!!e.next()),v[t]?y[t]=e.decodeExponentialGolombNumber():b[t]=!!e.next(),b[t]||(w[t]=e.decodeExponentialGolombNumber()),r&&(S[t]=eu(e,t,(L=w[t])+1)),n&&(x[t]=eu(e,t,(_=w[t])+1))}return{nal_hrd_parameters_present_flag:r,vcl_hrd_parameters_present_flag:n,sub_pic_hrd_params_present_flag:o,tick_divisor_minus2:a,du_cpb_removal_delay_increment_length_minus1:s,sub_pic_cpb_params_in_pic_timing_sei_flag:l,dpb_output_delay_du_length_minus1:d,bit_rate_scale:c,cpb_size_scale:u,cpb_size_du_scale:h,initial_cpb_removal_delay_length_minus1:p,au_cpb_removal_delay_length_minus1:m,dpb_output_delay_length_minus1:g,fixed_pic_rate_general_flag:f,fixed_pic_rate_within_cvs_flag:v,elemental_duration_in_tc_minus1:y,low_delay_hrd_flag:b,cpb_cnt_minus1:w,nalHrdParameters:S,vclHrdParameters:x}}(d,s[e],m)}let k=!!d.next();return{vps_video_parameter_set_id:c,vps_base_layer_internal_flag:u,vps_base_layer_available_flag:h,vps_max_layers_minus1:p,vps_max_sub_layers_minus1:m,vps_temporal_id_nesting_flag:g,profileTierLevel:f,vps_sub_layer_ordering_info_present_flag:v,vps_max_dec_pic_buffering_minus1:y,vps_max_num_reorder_pics:b,vps_max_latency_increase_plus1:w,vps_max_layer_id:S,vps_num_layer_sets_minus1:x,layer_id_included_flag:L,vps_timing_info_present_flag:_,vps_num_units_in_tick:t,vps_time_scale:i,vps_poc_proportional_to_timing_flag:r,vps_num_ticks_poc_diff_one_minus1:n,vps_num_hrd_parameters:o,hrd_layer_set_idx:a,cprms_present_flag:s,hrdParameters:l,vps_extension_flag:k}}function el(e){let t,i,r,n,o,a,s,l,d,c,u,h,p,m,g,f,v,y,b,w,S,x,L,_,k,E,C;let P=new en(e),D=P.read(4),M=P.read(3),N=!!P.next(),A=ec(P,!0,M),T=P.decodeExponentialGolombNumber(),z=P.decodeExponentialGolombNumber();3===z&&(t=!!P.next());let O=P.decodeExponentialGolombNumber(),R=P.decodeExponentialGolombNumber(),F=!!P.next();F&&(i=P.decodeExponentialGolombNumber(),r=P.decodeExponentialGolombNumber(),n=P.decodeExponentialGolombNumber(),o=P.decodeExponentialGolombNumber());let I=P.decodeExponentialGolombNumber(),U=P.decodeExponentialGolombNumber(),H=P.decodeExponentialGolombNumber(),j=!!P.next();for(let e=j?0:M;e<=M;e+=1){a=[],s=[],l=[];for(let e=0;e<=M;e+=1)a[e]=P.decodeExponentialGolombNumber(),s[e]=P.decodeExponentialGolombNumber(),l[e]=P.decodeExponentialGolombNumber()}let V=P.decodeExponentialGolombNumber(),K=P.decodeExponentialGolombNumber(),G=P.decodeExponentialGolombNumber(),B=P.decodeExponentialGolombNumber(),W=P.decodeExponentialGolombNumber(),Y=P.decodeExponentialGolombNumber(),Z=!!P.next();Z&&(d=!!P.next())&&(c=function(e){let t=[];for(let i=0;i<4;i+=1){t[i]=[];for(let r=0;r<6;r+=3===i?3:1){let n=!!e.next();if(n){let n=8,o=Math.min(64,1<<4+(i<<1));if(i>1){let t=e.decodeExponentialGolombNumber();n=t+8}t[i][r]=[];for(let a=0;a<o;a+=1){let o=e.decodeExponentialGolombNumber();n=(n+o+256)%256,t[i][r][a]=n}}else e.decodeExponentialGolombNumber()}}return t}(P));let J=!!P.next(),X=!!P.next(),q=!!P.next();q&&(u=P.read(4),h=P.read(4),p=P.read(4),m=P.read(4),g=!!P.next());let $=P.decodeExponentialGolombNumber(),Q=[];for(let e=0;e<$;e+=1)Q[e]=function(e,t,i,r){let n=!1;0!==t&&(n=!!e.next());let o=0,a=!1,s=0,l=[],d=[],c=0,u=0,h=[],p=[],m=[],g=[];if(n){t===i&&(o=e.decodeExponentialGolombNumber()),a=!!e.next(),s=e.decodeExponentialGolombNumber();let n=t-(o+1),f=r[n],v=f.num_negative_pics+f.num_positive_pics;for(let t=0;t<=v;t+=1)l[t]=!!e.next(),l[t]?d[t]=!0:d[t]=!!e.next();let y=(1-2*Number(a))*(s+1),b=[],w=[],S=[],x=[],L=0;for(let e=0;e<f.num_negative_pics;e+=1)L-=f.delta_poc_s0_minus1[e]+1,b[e]=L;L=0;for(let e=0;e<f.num_positive_pics;e+=1)L+=f.delta_poc_s1_minus1[e]+1,w[e]=L;let _=0;if(f.num_positive_pics>0)for(let e=f.num_positive_pics-1;e>=0;e-=1)(L=w[e]+y)<0&&d[f.num_negative_pics+e]&&(S[_]=L,p[_]=l[f.num_negative_pics+e],_+=1);y<0&&d[v]&&(S[_]=y,p[_]=l[v],_+=1);for(let e=0;e<f.num_negative_pics;e+=1)(L=b[e]+y)<0&&d[e]&&(S[_]=L,p[_]=l[e],_+=1);c=_;let k=0;for(_=0;_<c;_+=1){let e=S[_];h[_]=-(e-k-1),k=e}if(_=0,f.num_negative_pics>0)for(let e=f.num_negative_pics-1;e>=0;e-=1)(L=b[e]+y)>0&&d[e]&&(x[_]=L,g[_]=l[e],_+=1);y>0&&d[v]&&(x[_]=y,g[_]=l[v],_+=1);for(let e=0;e<f.num_positive_pics;e+=1)(L=w[e]+y)>0&&d[f.num_negative_pics+e]&&(x[_]=L,g[_]=l[f.num_negative_pics+e],_+=1);for(u=_,k=0,_=0;_<u;_+=1){let e=x[_];m[_]=e-k-1,k=e}}else{c=e.decodeExponentialGolombNumber(),u=e.decodeExponentialGolombNumber();for(let t=0;t<c;t+=1)h[t]=e.decodeExponentialGolombNumber(),p[t]=!!e.next();for(let t=0;t<u;t+=1)m[t]=e.decodeExponentialGolombNumber(),g[t]=!!e.next()}return{stRpsIdx:t,num_short_term_ref_pic_sets:i,inter_ref_pic_set_prediction_flag:n,delta_idx_minus1:o,delta_rps_sign:a,abs_delta_rps_minus1:s,used_by_curr_pic_flag:l,use_delta_flag:d,num_negative_pics:c,num_positive_pics:u,delta_poc_s0_minus1:h,used_by_curr_pic_s0_flag:p,delta_poc_s1_minus1:m,used_by_curr_pic_s1_flag:g}}(P,e,$,Q);let ee=!!P.next();if(ee){f=P.decodeExponentialGolombNumber(),v=[],y=[];for(let e=0;e<f;e+=1)v[e]=P.read(H+4),y[e]=!!P.next()}let et=!!P.next(),ei=!!P.next(),er=!!P.next();er&&(b=function(e){let t,i,r,n,o,a,s,l,d,c,u,h,p,m,g,f,v,y,b,w,S,x,L,_,k,E,C,P,D;let M=!!e.next();M&&255===(t=e.read(8))&&(i=e.read(16),r=e.read(16));let N=!!e.next();N&&(n=!!e.next());let A=!!e.next();A&&(o=e.read(3),a=!!e.next(),(s=!!e.next())&&(l=e.read(8),d=e.read(8),c=e.read(8)));let T=!!e.next();T&&(u=e.decodeExponentialGolombNumber(),h=e.decodeExponentialGolombNumber());let z=!!e.next(),O=!!e.next(),R=!!e.next(),F=!!e.next();F&&(p=e.decodeExponentialGolombNumber(),m=e.decodeExponentialGolombNumber(),g=e.decodeExponentialGolombNumber(),f=e.decodeExponentialGolombNumber());let I=!!e.next();if(I&&(v=e.read(32),y=e.read(32),(b=!!e.next())&&(w=e.decodeExponentialGolombNumber()),S=!!e.next()))throw Error("Not implemented");let U=!!e.next();return U&&(x=!!e.next(),L=!!e.next(),_=!!e.next(),k=e.decodeExponentialGolombNumber(),E=e.decodeExponentialGolombNumber(),C=e.decodeExponentialGolombNumber(),P=e.decodeExponentialGolombNumber(),D=e.decodeExponentialGolombNumber()),{aspect_ratio_info_present_flag:M,aspect_ratio_idc:t,sar_width:i,sar_height:r,overscan_info_present_flag:N,overscan_appropriate_flag:n,video_signal_type_present_flag:A,video_format:o,video_full_range_flag:a,colour_description_present_flag:s,colour_primaries:l,transfer_characteristics:d,matrix_coeffs:c,chroma_loc_info_present_flag:T,chroma_sample_loc_type_top_field:u,chroma_sample_loc_type_bottom_field:h,neutral_chroma_indication_flag:z,field_seq_flag:O,frame_field_info_present_flag:R,default_display_window_flag:F,def_disp_win_left_offset:p,def_disp_win_right_offset:m,def_disp_win_top_offset:g,def_disp_win_bottom_offset:f,vui_timing_info_present_flag:I,vui_num_units_in_tick:v,vui_time_scale:y,vui_poc_proportional_to_timing_flag:b,vui_num_ticks_poc_diff_one_minus1:w,vui_hrd_parameters_present_flag:S,bitstream_restriction_flag:U,tiles_fixed_structure_flag:x,motion_vectors_over_pic_boundaries_flag:L,restricted_ref_pic_lists_flag:_,min_spatial_segmentation_idc:k,max_bytes_per_pic_denom:E,max_bits_per_min_cu_denom:C,log2_max_mv_length_horizontal:P,log2_max_mv_length_vertical:D}}(P));let eo=!!P.next();if(eo&&(w=!!P.next(),S=!!P.next(),x=!!P.next(),L=!!P.next(),_=P.read(4)),w||(S&&(k=function(e){let t=!!e.next();return{inter_view_mv_vert_constraint_flag:t}}(P)),x&&(E=function(e){let t=[],i=[];t[0]=!!e.next(),i[0]=!!e.next();let r=e.decodeExponentialGolombNumber(),n=!!e.next(),o=!!e.next(),a=!!e.next(),s=!!e.next();t[1]=!!e.next(),i[1]=!!e.next();let l=!!e.next(),d=e.decodeExponentialGolombNumber(),c=!!e.next(),u=!!e.next(),h=!!e.next(),p=!!e.next(),m=!!e.next();return{iv_di_mc_enabled_flag:t,iv_mv_scal_enabled_flag:i,log2_ivmc_sub_pb_size_minus3:r,iv_res_pred_enabled_flag:n,depth_ref_enabled_flag:o,vsp_mc_enabled_flag:a,dbbp_enabled_flag:s,tex_mc_enabled_flag:l,log2_texmc_sub_pb_size_minus3:d,intra_contour_enabled_flag:c,intra_dc_only_wedge_enabled_flag:u,cqt_cu_part_pred_enabled_flag:h,inter_dc_only_enabled_flag:p,skip_intra_enabled_flag:m}}(P)),L))throw Error("Not implemented");if(_){C=[];let e=0;for(;!P.ended;)C[e]=!!P.next(),e+=1}return{sps_video_parameter_set_id:D,sps_max_sub_layers_minus1:M,sps_temporal_id_nesting_flag:N,profileTierLevel:A,sps_seq_parameter_set_id:T,chroma_format_idc:z,separate_colour_plane_flag:t,pic_width_in_luma_samples:O,pic_height_in_luma_samples:R,conformance_window_flag:F,conf_win_left_offset:i,conf_win_right_offset:r,conf_win_top_offset:n,conf_win_bottom_offset:o,bit_depth_luma_minus8:I,bit_depth_chroma_minus8:U,log2_max_pic_order_cnt_lsb_minus4:H,sps_sub_layer_ordering_info_present_flag:j,sps_max_dec_pic_buffering_minus1:a,sps_max_num_reorder_pics:s,sps_max_latency_increase_plus1:l,log2_min_luma_coding_block_size_minus3:V,log2_diff_max_min_luma_coding_block_size:K,log2_min_luma_transform_block_size_minus2:G,log2_diff_max_min_luma_transform_block_size:B,max_transform_hierarchy_depth_inter:W,max_transform_hierarchy_depth_intra:Y,scaling_list_enabled_flag:Z,sps_scaling_list_data_present_flag:d,scalingListData:c,amp_enabled_flag:J,sample_adaptive_offset_enabled_flag:X,pcm_enabled_flag:q,pcm_sample_bit_depth_luma_minus1:u,pcm_sample_bit_depth_chroma_minus1:h,log2_min_pcm_luma_coding_block_size_minus3:p,log2_diff_max_min_pcm_luma_coding_block_size:m,pcm_loop_filter_disabled_flag:g,num_short_term_ref_pic_sets:$,shortTermRefPicSets:Q,long_term_ref_pics_present_flag:ee,num_long_term_ref_pics_sps:f,lt_ref_pic_poc_lsb_sps:v,used_by_curr_pic_lt_sps_flag:y,sps_temporal_mvp_enabled_flag:et,strong_intra_smoothing_enabled_flag:ei,vui_parameters_present_flag:er,vuiParameters:b,sps_extension_present_flag:eo,sps_range_extension_flag:w,sps_multilayer_extension_flag:S,sps_3d_extension_flag:x,sps_scc_extension_flag:L,sps_extension_4bits:_,spsMultilayerExtension:k,sps3dExtension:E,sps_extension_data_flag:C}}function ed(e){let t,i,r,n,o,a,s,l,d,c,u;let h=e.read(2),p=!!e.next(),m=e.read(5),g=e.peekBytes(4),f=[];for(let t=0;t<32;t+=1)f[t]=!!e.next();let v=e.peekBytes(6),y=!!e.next(),b=!!e.next(),w=!!e.next(),S=!!e.next();return 4===m||f[4]||5===m||f[5]||6===m||f[6]||7===m||f[7]||8===m||f[8]||9===m||f[9]||10===m||f[10]||11===m||f[11]?(t=!!e.next(),i=!!e.next(),r=!!e.next(),n=!!e.next(),o=!!e.next(),a=!!e.next(),s=!!e.next(),l=!!e.next(),d=!!e.next(),5===m||f[5]||9===m||f[9]||10===m||f[10]||11===m||f[11]?(c=!!e.next(),e.skip(33)):e.skip(34)):2===m||f[2]?(e.skip(7),l=!!e.next(),e.skip(35)):e.skip(43),1===m||f[1]||2===m||f[2]||3===m||f[3]||4===m||f[4]||5===m||f[5]||9===m||f[9]||11===m||f[11]?u=!!e.next():e.skip(1),{profile_space:h,tier_flag:p,profile_idc:m,profileCompatibilitySet:g,profile_compatibility_flag:f,constraintSet:v,progressive_source_flag:y,interlaced_source_flag:b,non_packed_constraint_flag:w,frame_only_constraint_flag:S,max_12bit_constraint_flag:t,max_10bit_constraint_flag:i,max_8bit_constraint_flag:r,max_422chroma_constraint_flag:n,max_420chroma_constraint_flag:o,max_monochrome_constraint_flag:a,intra_constraint_flag:s,one_picture_only_constraint_flag:l,lower_bit_rate_constraint_flag:d,max_14bit_constraint_flag:c,inbld_flag:u}}function ec(e,t,i){let r;t&&(r=ed(e));let n=e.read(8),o=[],a=[];for(let t=0;t<i;t+=1)o[t]=!!e.next(),a[t]=!!e.next();if(i>0)for(let t=i;t<8;t+=1)e.read(2);let s=[],l=[];for(let t=0;t<i;t+=1)o[t]&&(s[t]=ed(e)),a[t]&&(l[t]=e.read(8));return{generalProfileTier:r,general_level_idc:n,sub_layer_profile_present_flag:o,sub_layer_level_present_flag:a,subLayerProfileTier:s,sub_layer_level_idc:l}}function eu(e,t,i){let r=[],n=[],o=[];for(let a=0;a<i;a+=1)r[a]=e.decodeExponentialGolombNumber(),n[a]=e.decodeExponentialGolombNumber(),t>0&&(o[a]=!!e.next());return{bit_rate_value_minus1:r,cpb_size_value_minus1:n,cpb_size_du_value_minus1:[],bit_rate_du_value_minus1:[],cbr_flag:o}}function eh(e){let t,i,r;let n=0;for(let o of er(e)){let e=function(e){let t=new en(e);if(0!==t.next())throw Error("Invalid NALU header");let i=t.read(6),r=t.read(6),n=t.read(3);return{nal_unit_type:i,nuh_layer_id:r,nuh_temporal_id_plus1:n}}(o),a={...e,data:o,rbsp:o.subarray(2)};switch(e.nal_unit_type){case 32:t=a;break;case 33:i=a;break;case 34:r=a;break;default:continue}if(3===(n+=1))return{videoParameterSet:t,sequenceParameterSet:i,pictureParameterSet:r}}throw Error("Invalid data")}function ep(e){let{videoParameterSet:t,sequenceParameterSet:i,pictureParameterSet:r}=eh(e),{profileTierLevel:{generalProfileTier:{profile_space:n,tier_flag:o,profile_idc:a,profileCompatibilitySet:s,constraintSet:l},general_level_idc:d}}=es(t.rbsp),{chroma_format_idc:c,pic_width_in_luma_samples:u,pic_height_in_luma_samples:h,conf_win_left_offset:p=0,conf_win_right_offset:m=0,conf_win_top_offset:g=0,conf_win_bottom_offset:f=0}=el(i.rbsp),v=function(e){switch(e){case 0:case 3:return 1;case 1:case 2:return 2;default:throw Error("Invalid chroma_format_idc")}}(c),y=function(e){switch(e){case 0:case 2:case 3:return 1;case 1:return 2;default:throw Error("Invalid chroma_format_idc")}}(c);return{videoParameterSet:t,sequenceParameterSet:i,pictureParameterSet:r,generalProfileSpace:n,generalProfileIndex:a,generalProfileCompatibilitySet:s,generalTierFlag:o,generalLevelIndex:d,generalConstraintSet:l,encodedWidth:u,encodedHeight:h,cropLeft:p,cropRight:m,cropTop:g,cropBottom:f,croppedWidth:u-v*(p+m),croppedHeight:h-y*(g+f)}}(l=P=P||(P={}))[l.Baseline=1]="Baseline",l[l.Main=2]="Main",l[l.Extended=4]="Extended",l[l.High=8]="High",l[l.High10=16]="High10",l[l.High422=32]="High422",l[l.High444=64]="High444",l[l.ConstrainedBaseline=65536]="ConstrainedBaseline",l[l.ConstrainedHigh=524288]="ConstrainedHigh",(d=D=D||(D={}))[d.Level1=1]="Level1",d[d.Level1b=2]="Level1b",d[d.Level11=4]="Level11",d[d.Level12=8]="Level12",d[d.Level13=16]="Level13",d[d.Level2=32]="Level2",d[d.Level21=64]="Level21",d[d.Level22=128]="Level22",d[d.Level3=256]="Level3",d[d.Level31=512]="Level31",d[d.Level32=1024]="Level32",d[d.Level4=2048]="Level4",d[d.Level41=4096]="Level41",d[d.Level42=8192]="Level42",d[d.Level5=16384]="Level5",d[d.Level51=32768]="Level51",d[d.Level52=65536]="Level52",d[d.Level6=131072]="Level6",d[d.Level61=262144]="Level61",d[d.Level62=524288]="Level62",(c=M=M||(M={}))[c.Main=1]="Main",c[c.Main10=2]="Main10",c[c.MainStill=4]="MainStill",c[c.Main10Hdr10=4096]="Main10Hdr10",c[c.Main10Hdr10Plus=8192]="Main10Hdr10Plus",(u=N=N||(N={}))[u.MainTierLevel1=1]="MainTierLevel1",u[u.HighTierLevel1=2]="HighTierLevel1",u[u.MainTierLevel2=4]="MainTierLevel2",u[u.HighTierLevel2=8]="HighTierLevel2",u[u.MainTierLevel21=16]="MainTierLevel21",u[u.HighTierLevel21=32]="HighTierLevel21",u[u.MainTierLevel3=64]="MainTierLevel3",u[u.HighTierLevel3=128]="HighTierLevel3",u[u.MainTierLevel31=256]="MainTierLevel31",u[u.HighTierLevel31=512]="HighTierLevel31",u[u.MainTierLevel4=1024]="MainTierLevel4",u[u.HighTierLevel4=2048]="HighTierLevel4",u[u.MainTierLevel41=4096]="MainTierLevel41",u[u.HighTierLevel41=8192]="HighTierLevel41",u[u.MainTierLevel5=16384]="MainTierLevel5",u[u.HighTierLevel5=32768]="HighTierLevel5",u[u.MainTierLevel51=65536]="MainTierLevel51",u[u.HighTierLevel51=131072]="HighTierLevel51",u[u.MainTierLevel52=262144]="MainTierLevel52",u[u.HighTierLevel52=524288]="HighTierLevel52",u[u.MainTierLevel6=1048576]="MainTierLevel6",u[u.HighTierLevel6=2097152]="HighTierLevel6",u[u.MainTierLevel61=4194304]="MainTierLevel61",u[u.HighTierLevel61=8388608]="HighTierLevel61",u[u.MainTierLevel62=16777216]="MainTierLevel62",u[u.HighTierLevel62=33554432]="HighTierLevel62";var em=i(2974);let eg=new em.AU().uint8("type");(h=A=A||(A={}))[h.Down=0]="Down",h[h.Up=1]="Up",h[h.Move=2]="Move",h[h.Cancel=3]="Cancel",h[h.Outside=4]="Outside",h[h.PointerDown=5]="PointerDown",h[h.PointerUp=6]="PointerUp",h[h.HoverMove=7]="HoverMove",h[h.Scroll=8]="Scroll",h[h.HoverEnter=9]="HoverEnter",h[h.HoverExit=10]="HoverExit",h[h.ButtonPress=11]="ButtonPress",h[h.ButtonRelease=12]="ButtonRelease",(p=T=T||(T={}))[p.Primary=1]="Primary",p[p.Secondary=2]="Secondary",p[p.Tertiary=4]="Tertiary",p[p.Back=8]="Back",p[p.Forward=16]="Forward",p[p.StylusPrimary=32]="StylusPrimary",p[p.StylusSecondary=64]="StylusSecondary",(m=z=z||(z={})).Mouse=-1n,m.Finger=-2n,m.VirtualMouse=-3n,m.VirtualFinger=-4n,(g=O=O||(O={}))[g.InjectKeyCode=0]="InjectKeyCode",g[g.InjectText=1]="InjectText",g[g.InjectTouch=2]="InjectTouch",g[g.InjectScroll=3]="InjectScroll",g[g.BackOrScreenOn=4]="BackOrScreenOn",g[g.ExpandNotificationPanel=5]="ExpandNotificationPanel",g[g.ExpandSettingPanel=6]="ExpandSettingPanel",g[g.CollapseNotificationPanel=7]="CollapseNotificationPanel",g[g.GetClipboard=8]="GetClipboard",g[g.SetClipboard=9]="SetClipboard",g[g.SetScreenPowerMode=10]="SetScreenPowerMode",g[g.RotateDevice=11]="RotateDevice";class ef{types;constructor(e){this.types=e.controlMessageTypes}get(e){let t=this.types.indexOf(e);if(-1===t)throw Error("Not supported");return t}fillMessageType(e,t){return e.type=this.get(t),e}}class ev{lastHoverMessage;process(e){let t=[];return this.lastHoverMessage&&this.lastHoverMessage.pointerId!==e.pointerId&&(t.push({...this.lastHoverMessage,action:A.Up}),this.lastHoverMessage=void 0),e.action===A.HoverMove&&(this.lastHoverMessage=e),e.type=O.InjectTouch,t.push(e),t}}(f=R=R||(R={}))[f.Down=0]="Down",f[f.Up=1]="Up",(v=F=F||(F={}))[v.AltOn=2]="AltOn",v[v.AltLeftOn=16]="AltLeftOn",v[v.AltRightOn=32]="AltRightOn",v[v.ShiftOn=1]="ShiftOn",v[v.ShiftLeftOn=64]="ShiftLeftOn",v[v.ShiftRightOn=128]="ShiftRightOn",v[v.CtrlOn=4096]="CtrlOn",v[v.CtrlLeftOn=8192]="CtrlLeftOn",v[v.CtrlRightOn=16384]="CtrlRightOn",v[v.MetaOn=65536]="MetaOn",v[v.MetaLeftOn=131072]="MetaLeftOn",v[v.MetaRightOn=262144]="MetaRightOn",v[v.CapsLockOn=1048576]="CapsLockOn",v[v.NumLockOn=2097152]="NumLockOn",v[v.ScrollLockOn=4194304]="ScrollLockOn",(y=I=I||(I={}))[y.AndroidHome=3]="AndroidHome",y[y.AndroidBack=4]="AndroidBack",y[y.AndroidCall=5]="AndroidCall",y[y.AndroidEndCall=6]="AndroidEndCall",y[y.Digit0=7]="Digit0",y[y.Digit1=8]="Digit1",y[y.Digit2=9]="Digit2",y[y.Digit3=10]="Digit3",y[y.Digit4=11]="Digit4",y[y.Digit5=12]="Digit5",y[y.Digit6=13]="Digit6",y[y.Digit7=14]="Digit7",y[y.Digit8=15]="Digit8",y[y.Digit9=16]="Digit9",y[y.Star=17]="Star",y[y.Pound=18]="Pound",y[y.ArrowUp=19]="ArrowUp",y[y.ArrowDown=20]="ArrowDown",y[y.ArrowLeft=21]="ArrowLeft",y[y.ArrowRight=22]="ArrowRight",y[y.AndroidDPadCenter=23]="AndroidDPadCenter",y[y.VolumeUp=24]="VolumeUp",y[y.VolumeDown=25]="VolumeDown",y[y.Power=26]="Power",y[y.AndroidCamera=27]="AndroidCamera",y[y.Clear=28]="Clear",y[y.KeyA=29]="KeyA",y[y.KeyB=30]="KeyB",y[y.KeyC=31]="KeyC",y[y.KeyD=32]="KeyD",y[y.KeyE=33]="KeyE",y[y.KeyF=34]="KeyF",y[y.KeyG=35]="KeyG",y[y.KeyH=36]="KeyH",y[y.KeyI=37]="KeyI",y[y.KeyJ=38]="KeyJ",y[y.KeyK=39]="KeyK",y[y.KeyL=40]="KeyL",y[y.KeyM=41]="KeyM",y[y.KeyN=42]="KeyN",y[y.KeyO=43]="KeyO",y[y.KeyP=44]="KeyP",y[y.KeyQ=45]="KeyQ",y[y.KeyR=46]="KeyR",y[y.KeyS=47]="KeyS",y[y.KeyT=48]="KeyT",y[y.KeyU=49]="KeyU",y[y.KeyV=50]="KeyV",y[y.KeyW=51]="KeyW",y[y.KeyX=52]="KeyX",y[y.KeyY=53]="KeyY",y[y.KeyZ=54]="KeyZ",y[y.Comma=55]="Comma",y[y.Period=56]="Period",y[y.AltLeft=57]="AltLeft",y[y.AltRight=58]="AltRight",y[y.ShiftLeft=59]="ShiftLeft",y[y.ShiftRight=60]="ShiftRight",y[y.Tab=61]="Tab",y[y.Space=62]="Space",y[y.AndroidSymbol=63]="AndroidSymbol",y[y.AndroidExplorer=64]="AndroidExplorer",y[y.AndroidEnvelope=65]="AndroidEnvelope",y[y.Enter=66]="Enter",y[y.Backspace=67]="Backspace",y[y.Backquote=68]="Backquote",y[y.Minus=69]="Minus",y[y.Equal=70]="Equal",y[y.BracketLeft=71]="BracketLeft",y[y.BracketRight=72]="BracketRight",y[y.Backslash=73]="Backslash",y[y.Semicolon=74]="Semicolon",y[y.Quote=75]="Quote",y[y.Slash=76]="Slash",y[y.At=77]="At",y[y.AndroidNum=78]="AndroidNum",y[y.AndroidHeadsetHook=79]="AndroidHeadsetHook",y[y.AndroidFocus=80]="AndroidFocus",y[y.Plus=81]="Plus",y[y.ContextMenu=82]="ContextMenu",y[y.AndroidNotification=83]="AndroidNotification",y[y.AndroidSearch=84]="AndroidSearch",y[y.PageUp=92]="PageUp",y[y.PageDown=93]="PageDown",y[y.Escape=111]="Escape",y[y.Delete=112]="Delete",y[y.ControlLeft=113]="ControlLeft",y[y.ControlRight=114]="ControlRight",y[y.CapsLock=115]="CapsLock",y[y.ScrollLock=116]="ScrollLock",y[y.MetaLeft=117]="MetaLeft",y[y.MetaRight=118]="MetaRight",y[y.AndroidFunction=119]="AndroidFunction",y[y.PrintScreen=120]="PrintScreen",y[y.Pause=121]="Pause",y[y.Home=122]="Home",y[y.End=123]="End",y[y.Insert=124]="Insert",y[y.AndroidForward=125]="AndroidForward",y[y.F1=131]="F1",y[y.F2=132]="F2",y[y.F3=133]="F3",y[y.F4=134]="F4",y[y.F5=135]="F5",y[y.F6=136]="F6",y[y.F7=137]="F7",y[y.F8=138]="F8",y[y.F9=139]="F9",y[y.F10=140]="F10",y[y.F11=141]="F11",y[y.F12=142]="F12",y[y.NumLock=143]="NumLock",y[y.Numpad0=144]="Numpad0",y[y.Numpad1=145]="Numpad1",y[y.Numpad2=146]="Numpad2",y[y.Numpad3=147]="Numpad3",y[y.Numpad4=148]="Numpad4",y[y.Numpad5=149]="Numpad5",y[y.Numpad6=150]="Numpad6",y[y.Numpad7=151]="Numpad7",y[y.Numpad8=152]="Numpad8",y[y.Numpad9=153]="Numpad9",y[y.NumpadDivide=154]="NumpadDivide",y[y.NumpadMultiply=155]="NumpadMultiply",y[y.NumpadSubtract=156]="NumpadSubtract",y[y.NumpadAdd=157]="NumpadAdd",y[y.NumpadDecimal=158]="NumpadDecimal",y[y.NumpadComma=159]="NumpadComma",y[y.NumpadEnter=160]="NumpadEnter",y[y.NumpadEquals=161]="NumpadEquals",y[y.NumpadLeftParen=162]="NumpadLeftParen",y[y.NumpadRightParen=163]="NumpadRightParen",y[y.VolumeMute=164]="VolumeMute",y[y.AndroidAppSwitch=187]="AndroidAppSwitch",y[y.AndroidCut=277]="AndroidCut",y[y.AndroidCopy=278]="AndroidCopy",y[y.AndroidPaste=279]="AndroidPaste";let ey=new em.ZP().uint8("type").uint8("action",(0,em.W$)()).uint32("keyCode").uint32("repeat").uint32("metaState"),eb=new em.ZP().uint8("type").uint32("length").string("text",{lengthField:"length"});(b=U=U||(U={}))[b.Off=0]="Off",b[b.Normal=2]="Normal";let ew=new em.ZP().uint8("type").uint8("mode",(0,em.W$)());class eS{_options;_typeValues;_scrollController;constructor(e){this._options=e,this._typeValues=new ef(e),this._scrollController=e.createScrollController()}injectKeyCode(e){return ey.serialize(this._typeValues.fillMessageType(e,O.InjectKeyCode))}injectText(e){return eb.serialize({text:e,type:this._typeValues.get(O.InjectText)})}injectTouch(e){return this._options.serializeInjectTouchControlMessage(this._typeValues.fillMessageType(e,O.InjectTouch))}injectScroll(e){return this._scrollController.serializeScrollMessage(this._typeValues.fillMessageType(e,O.InjectScroll))}backOrScreenOn(e){return this._options.serializeBackOrScreenOnControlMessage({action:e,type:this._typeValues.get(O.BackOrScreenOn)})}setScreenPowerMode(e){return ew.serialize({mode:e,type:this._typeValues.get(O.SetScreenPowerMode)})}rotateDevice(){return eg.serialize({type:this._typeValues.get(O.RotateDevice)})}}var ex=i(7104);class eL{_writer;_serializer;constructor(e,t){this._writer=e,this._serializer=new eS(t)}async write(e){return await ex.s5.write(this._writer,e)}injectKeyCode(e){return this.write(this._serializer.injectKeyCode(e))}injectText(e){return this.write(this._serializer.injectText(e))}injectTouch(e){return this.write(this._serializer.injectTouch(e))}async injectScroll(e){let t=this._serializer.injectScroll(e);t&&await this.write(t)}async backOrScreenOn(e){let t=this._serializer.backOrScreenOn(e);t&&await this.write(t)}setScreenPowerMode(e){return this.write(this._serializer.setScreenPowerMode(e))}rotateDevice(){return this.write(this._serializer.rotateDevice())}releaseLock(){this._writer.releaseLock()}close(){return this._writer.close()}}(w=H=H||(H={}))[w.Clipboard=0]="Clipboard",w[w.AckClipboard=1]="AckClipboard";let e_=new em.ZP().uint64("sequence").extra({type:H.AckClipboard}),ek=new em.ZP().uint32("length").string("content",{lengthField:"length"}).extra({type:H.Clipboard});class eE extends ex.pC{constructor(){super(async e=>{let t=await e.readExactly(1);switch(t[0]){case H.Clipboard:return await ek.deserialize(e);case H.AckClipboard:return await e_.deserialize(e);default:throw Error("Unsupported control message type")}})}}let eC={repeatPreviousFrameAfter:"long",maxPtsGapToEncoder:"long"};class eP{value;constructor(e={}){this.value=e}toOptionValue(){let e=Object.entries(this.value).filter(([,e])=>void 0!==e);if(0!==e.length)return e.map(([e,t])=>{let i=eC[e];return`${e.replace(/([A-Z])/g,"-$1").toLowerCase()}${i?`:${i}`:""}=${t}`}).join(",")}}function eD(e,t,i){return e<t?t:e>i?i:e}let eM=new em.Pl({size:2,signed:!1,deserialize(e,t){let i=em.ek.Uint16.deserialize(e,t);return 65535===i?1:i/65536},serialize(e,t,i,r){i=1===(i=eD(i,-1,1))?65535:65536*i,em.ek.Uint16.serialize(e,t,i,r)}});(S=j=j||(j={})).Debug="debug",S.Info="info",S.Warn="warn",S.Error="error",(x=V=V||(V={}))[x.Unlocked=-1]="Unlocked",x[x.Portrait=0]="Portrait",x[x.Landscape=1]="Landscape",x[x.PortraitFlipped=2]="PortraitFlipped",x[x.LandscapeFlipped=3]="LandscapeFlipped";let eN=[O.InjectKeyCode,O.InjectText,O.InjectTouch,O.InjectScroll,O.BackOrScreenOn,O.ExpandNotificationPanel,O.CollapseNotificationPanel,O.GetClipboard,O.SetClipboard,O.SetScreenPowerMode,O.RotateDevice],eA=new em.ZP().uint64("pts").uint32("size").uint8Array("data",{lengthField:"size"}),eT=1n<<63n,ez=new em.ZP().uint8("type").uint8("action",(0,em.W$)()).uint64("pointerId").uint32("pointerX").uint32("pointerY").uint16("screenWidth").uint16("screenHeight").field("pressure",eM).uint32("buttons"),eO=new em.ZP().uint8("type").uint32("length").string("content",{lengthField:"length"});(L=K=K||(K={}))[L.H264=1748121140]="H264",L[L.H265=1748121141]="H265",L[L.AV1=6387249]="AV1";class eR{static OPUS=new eR("opus",1869641075,"audio/opus","opus");static AAC=new eR("aac",6381923,"audio/aac","mp4a.66");static RAW=new eR("raw",7496055,"audio/raw","1");optionValue;metadataValue;mimeType;webCodecId;constructor(e,t,i,r){this.optionValue=e,this.metadataValue=t,this.mimeType=i,this.webCodecId=r}toOptionValue(){return this.optionValue}}let eF="/data/local/tmp/scrcpy-server.jar";function eI(e,t){var i;return"object"==typeof(i=e)&&null!==i&&"toOptionValue"in i&&"function"==typeof i.toOptionValue&&(e=e.toOptionValue()),void 0===e?t:String(e)}class eU{_base;get controlMessageTypes(){return this._base.controlMessageTypes}value;constructor(e,t){this._base=e,this.value=t}setListEncoders(){this._base.setListEncoders()}setListDisplays(){this._base.setListDisplays()}parseEncoder(e){return this._base.parseEncoder(e)}parseDisplay(e){return this._base.parseDisplay(e)}parseVideoStreamMetadata(e){return this._base.parseVideoStreamMetadata(e)}parseAudioStreamMetadata(e){return this._base.parseAudioStreamMetadata(e)}createMediaStreamTransformer(){return this._base.createMediaStreamTransformer()}serializeInjectTouchControlMessage(e){return this._base.serializeInjectTouchControlMessage(e)}serializeBackOrScreenOnControlMessage(e){return this._base.serializeBackOrScreenOnControlMessage(e)}serializeSetClipboardControlMessage(e){return this._base.serializeSetClipboardControlMessage(e)}createScrollController(){return this._base.createScrollController()}}let eH=new em.ZP().uint8("type").uint32("pointerX").uint32("pointerY").uint16("screenWidth").uint16("screenHeight").int32("scrollX").int32("scrollY");class ej{accumulatedX=0;accumulatedY=0;processMessage(e){this.accumulatedX+=e.scrollX,this.accumulatedY+=e.scrollY;let t=0,i=0;if(this.accumulatedX>=1?(t=1,this.accumulatedX=0):this.accumulatedX<=-1&&(t=-1,this.accumulatedX=0),this.accumulatedY>=1?(i=1,this.accumulatedY=0):this.accumulatedY<=-1&&(i=-1,this.accumulatedY=0),0!==t||0!==i)return e.scrollX=t,e.scrollY=i,e}serializeScrollMessage(e){let t=this.processMessage(e);if(t)return eH.serialize(t)}}class eV{static DEFAULTS={logLevel:j.Debug,maxSize:0,bitRate:8e6,maxFps:0,lockVideoOrientation:V.Unlocked,tunnelForward:!1,crop:void 0,sendFrameMeta:!0,control:!0,displayId:0,showTouches:!1,stayAwake:!1,codecOptions:new eP};static SERIALIZE_ORDER=["logLevel","maxSize","bitRate","maxFps","lockVideoOrientation","tunnelForward","crop","sendFrameMeta","control","displayId","showTouches","stayAwake","codecOptions"];static serialize(e,t){return t.map(t=>eI(e[t],"-"))}static async parseCString(e,t){let i=(0,em.FO)(await e.readExactly(t));return i.substring(0,i.indexOf("\x00"))}static async parseUint16BE(e){let t=await e.readExactly(em.ek.Uint16.size);return em.ek.Uint16.deserialize(t,!1)}static async parseUint32BE(e){let t=await e.readExactly(em.ek.Uint32.size);return em.ek.Uint32.deserialize(t,!1)}value;defaults=eV.DEFAULTS;controlMessageTypes=eN;constructor(e){this.value={...eV.DEFAULTS,...e}}serialize(){return eV.serialize(this.value,eV.SERIALIZE_ORDER)}setListEncoders(){throw Error("Not supported")}setListDisplays(){this.value.displayId=-1}parseEncoder(){throw Error("Not supported")}parseDisplay(e){let t=e.match(/\s+scrcpy --display (\d+)/);if(t)return{id:Number.parseInt(t[1],10)}}parseVideoStreamMetadata(e){return(async()=>{let t=new ex.h0(e),i={codec:K.H264};return i.deviceName=await eV.parseCString(t,64),i.width=await eV.parseUint16BE(t),i.height=await eV.parseUint16BE(t),{stream:t.release(),metadata:i}})()}parseAudioStreamMetadata(){throw Error("Not supported")}createMediaStreamTransformer(){if(!this.value.sendFrameMeta)return new ex.GJ({transform(e,t){t.enqueue({type:"data",data:e})}});let e=new ex.gL(eA);return{writable:e.writable,readable:e.readable.pipeThrough(new ex.GJ({transform(e,t){if(e.pts===eT){t.enqueue({type:"configuration",data:e.data});return}t.enqueue({type:"data",pts:e.pts,data:e.data})}}))}}serializeInjectTouchControlMessage(e){return ez.serialize(e)}serializeBackOrScreenOnControlMessage(e){if(e.action===R.Down)return eg.serialize(e)}serializeSetClipboardControlMessage(e){return eO.serialize(e)}createScrollController(){return new ej}}class eK extends eU{static DEFAULTS={...eV.DEFAULTS,encoderName:void 0};static SERIALIZE_ORDER=[...eV.SERIALIZE_ORDER,"encoderName"];static parseEncoder(e,t){let i=e.match(t);if(i)return{type:"video",name:i[1]}}get defaults(){return eK.DEFAULTS}constructor(e){super(new eV(e),{...eK.DEFAULTS,...e})}serialize(){return eV.serialize(this.value,eK.SERIALIZE_ORDER)}setListEncoders(){this.value.encoderName="_"}parseEncoder(e){return eK.parseEncoder(e,/\s+scrcpy --encoder-name '(.*?)'/)}}(_=G=G||(G={})).Verbose="verbose",_.Debug="debug",_.Info="info",_.Warn="warn",_.Error="error",(k=B=B||(B={}))[k.Initial=-2]="Initial",k[k.Unlocked=-1]="Unlocked",k[k.Portrait=0]="Portrait",k[k.Landscape=1]="Landscape",k[k.PortraitFlipped=2]="PortraitFlipped",k[k.LandscapeFlipped=3]="LandscapeFlipped";let eG=new em.ZP().fields(eg).uint8("action",(0,em.W$)()),eB=eN.slice();eB.splice(6,0,O.ExpandSettingPanel);let eW={[G.Verbose]:j.Debug,[G.Debug]:j.Debug,[G.Info]:j.Info,[G.Warn]:j.Warn,[G.Error]:j.Error},eY={[B.Initial]:V.Unlocked,[B.Unlocked]:V.Unlocked,[B.Portrait]:V.Portrait,[B.Landscape]:V.Landscape,[B.PortraitFlipped]:V.PortraitFlipped,[B.LandscapeFlipped]:V.LandscapeFlipped};class eZ extends eU{static DEFAULTS={...eK.DEFAULTS,logLevel:G.Debug,lockVideoOrientation:B.Unlocked,powerOffOnClose:!1};static SERIALIZE_ORDER=[...eK.SERIALIZE_ORDER,"powerOffOnClose"];get defaults(){return eZ.DEFAULTS}get controlMessageTypes(){return eB}constructor(e){let t={...eZ.DEFAULTS,...e};super(new eK({...e,logLevel:eW[t.logLevel],lockVideoOrientation:eY[t.lockVideoOrientation]}),t)}serialize(){return eV.serialize(this.value,eZ.SERIALIZE_ORDER)}parseEncoder(e){return eK.parseEncoder(e,/\s+scrcpy --encoder '(.*?)'/)}serializeBackOrScreenOnControlMessage(e){return eG.serialize(e)}}let eJ=new em.ZP().uint8("type").uint64("sequence").int8("paste",(0,em.W$)()).uint32("length").string("content",{lengthField:"length"});class eX extends eU{static DEFAULTS={...eZ.DEFAULTS,clipboardAutosync:!0};static serialize(e,t){let i=[];for(let[r,n]of Object.entries(e)){let e=eI(n,void 0);if(!e)continue;let o=eI(t[r],void 0);e!=o&&i.push(`${r.replace(/([A-Z])/g,"_$1").toLowerCase()}=${e}`)}return i}get defaults(){return eX.DEFAULTS}constructor(e){super(new eZ(e),{...eX.DEFAULTS,...e})}serialize(){return eX.serialize(this.value,this.defaults)}serializeSetClipboardControlMessage(e){return eJ.serialize(e)}}let eq=new em.ZP().fields(eH).int32("buttons");class e$ extends ej{serializeScrollMessage(e){let t=this.processMessage(e);if(t)return eq.serialize(t)}}class eQ extends eU{static DEFAULTS={...eX.DEFAULTS,downsizeOnError:!0,sendDeviceMeta:!0,sendDummyByte:!0};get defaults(){return eQ.DEFAULTS}constructor(e){super(new eX(e),{...eQ.DEFAULTS,...e})}parseVideoStreamMetadata(e){return this.value.sendDeviceMeta?this._base.parseVideoStreamMetadata(e):{stream:e,metadata:{codec:K.H264}}}serialize(){return eX.serialize(this.value,this.defaults)}createScrollController(){return new e$}}let e0=1n<<62n;class e1 extends eU{static DEFAULTS={...eQ.DEFAULTS,cleanup:!0};get defaults(){return e1.DEFAULTS}constructor(e){super(new eQ(e),{...e1.DEFAULTS,...e})}serialize(){return eX.serialize(this.value,this.defaults)}createMediaStreamTransformer(){let e=this._base.createMediaStreamTransformer();return{writable:e.writable,readable:e.readable.pipeThrough(new ex.GJ({transform(e,t){if("data"!==e.type){t.enqueue(e);return}void 0!==e.pts&&e.pts&e0&&(e.keyframe=!0,e.pts&=~e0),t.enqueue(e)}}))}}}class e2 extends eU{static DEFAULTS={...e1.DEFAULTS,powerOn:!0};get defaults(){return e2.DEFAULTS}constructor(e){super(new e1(e),{...e2.DEFAULTS,...e})}serialize(){return eX.serialize(this.value,this.defaults)}}let e3=new em.Pl({size:2,signed:!0,deserialize(e,t){let i=em.ek.Int16.deserialize(e,t);return 32767===i?1:i/32768},serialize(e,t,i,r){i=1===(i=eD(i,-1,1))?32767:32768*i,em.ek.Int16.serialize(e,t,i,r)}}),e6=new em.ZP().uint8("type",O.InjectScroll).uint32("pointerX").uint32("pointerY").uint16("screenWidth").uint16("screenHeight").field("scrollX",e3).field("scrollY",e3).int32("buttons");class e4{serializeScrollMessage(e){return e6.serialize(e)}}class e5 extends eU{get defaults(){return e2.DEFAULTS}constructor(e){super(new e2(e),{...e2.DEFAULTS,...e})}serialize(){return eX.serialize(this.value,this.defaults)}createScrollController(){return new e4}}let e8=new em.ZP().uint8("type").uint8("action",(0,em.W$)()).uint64("pointerId").uint32("pointerX").uint32("pointerY").uint16("screenWidth").uint16("screenHeight").field("pressure",eM).uint32("actionButton").uint32("buttons");class e7{static NONE=new e7(-1);static random(){return new e7(2147483648*Math.random()|0)}value;constructor(e){this.value=e}toOptionValue(){if(!(this.value<0))return this.value.toString(16)}}class e9 extends eU{static DEFAULTS={...function(e,t){let i={};for(let r in e)t.includes(r)||(i[r]=e[r]);return i}(e2.DEFAULTS,["bitRate","codecOptions","encoderName"]),scid:e7.NONE,videoCodec:"h264",videoBitRate:8e6,videoCodecOptions:new eP,videoEncoder:"",audio:!0,audioCodec:"opus",audioBitRate:128e3,audioCodecOptions:new eP,audioEncoder:"",listEncoders:!1,listDisplays:!1,sendCodecMeta:!0};get defaults(){return e9.DEFAULTS}constructor(e){super(new e5(e),{...e9.DEFAULTS,...e})}serialize(){return eX.serialize(this.value,this.defaults)}setListEncoders(){this.value.listEncoders=!0}setListDisplays(){this.value.listDisplays=!0}parseEncoder(e){let t=e.match(/\s+--video-codec=(.*)\s+--video-encoder='(.*)'/);return t?{type:"video",codec:t[1],name:t[2]}:(t=e.match(/\s+--audio-codec=(.*)\s+--audio-encoder='(.*)'/))?{type:"audio",codec:t[1],name:t[2]}:void 0}parseDisplay(e){let t=e.match(/\s+--display=(\d+)\s+\((.*?)\)/);if(t){let e={id:Number.parseInt(t[1],10)};return"size unknown"!==t[2]&&(e.resolution=t[2]),e}}parseVideoStreamMetadata(e){let{sendDeviceMeta:t,sendCodecMeta:i}=this.value;if(!t&&!i){let t;switch(this.value.videoCodec){case"h264":t=K.H264;break;case"h265":t=K.H265;break;case"av1":t=K.AV1}return{stream:e,metadata:{codec:t}}}return(async()=>{let r,n,o,a;let s=new ex.h0(e);if(t&&(r=await eV.parseCString(s,64)),i)n=await eV.parseUint32BE(s),o=await eV.parseUint32BE(s),a=await eV.parseUint32BE(s);else switch(this.value.videoCodec){case"h264":n=K.H264;break;case"h265":n=K.H265;break;case"av1":n=K.AV1}return{stream:s.release(),metadata:{deviceName:r,codec:n,width:o,height:a}}})()}parseAudioStreamMetadata(e){return(async()=>{let t;let i=new ex.h0(e),r=await i.readExactly(em.ek.Uint32.size),n=em.ek.Uint32.deserialize(r,!1);switch(n){case 0:return{type:"disabled"};case 1:return{type:"errored"}}if(this.value.sendCodecMeta){let e;switch(n){case eR.OPUS.metadataValue:e=eR.OPUS;break;case eR.AAC.metadataValue:e=eR.AAC;break;case eR.RAW.metadataValue:e=eR.RAW;break;default:throw Error(`Unknown audio codec metadata value: ${n}`)}return{type:"success",codec:e,stream:i.release()}}switch(this.value.audioCodec){case"opus":t=eR.OPUS;break;case"aac":t=eR.AAC;break;case"raw":t=eR.RAW}return{type:"success",codec:t,stream:new ex.Oi(async e=>{await e.enqueue(r);let t=i.release(),n=t.getReader();for(;;){let{done:t,value:i}=await n.read();if(t)break;await e.enqueue(i)}})}})()}serializeInjectTouchControlMessage(e){return e8.serialize(e)}}let te=G,tt=B;class ti extends e9{}function tr(e){return e.toString(16).padStart(2,"0").toUpperCase()}function tn(e,t){return e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24}class to{static capabilities={h264:{},h265:{}};_codec;get codec(){return this._codec}_writable;get writable(){return this._writable}_renderer;get renderer(){return this._renderer}_frameRendered=0;get frameRendered(){return this._frameRendered}_frameSkipped=0;get frameSkipped(){return this._frameSkipped}context;decoder;_config;currentFrameRendered=!1;animationFrameId=0;constructor(e){this._codec=e,this._renderer=document.createElement("canvas"),this.context=this._renderer.getContext("2d"),this.decoder=new VideoDecoder({output:e=>{this.currentFrameRendered?this._frameSkipped+=1:(this.currentFrameRendered=!0,this._frameRendered+=1),this.context.drawImage(e,0,0),e.close()},error(e){}}),this._writable=new ex.Vj({write:e=>{switch(e.type){case"configuration":this.configure(e.data);break;case"data":this.decode(e)}}}),this.onFramePresented()}onFramePresented=()=>{this.currentFrameRendered=!1,this.animationFrameId=requestAnimationFrame(this.onFramePresented)};configure(e){switch(this._codec){case K.H264:{let{profileIndex:t,constraintSet:i,levelIndex:r,croppedWidth:n,croppedHeight:o}=ea(e);this._renderer.width=n,this._renderer.height=o;let a=`avc1.${[t,i,r].map(tr).join("")}`;this.decoder.configure({codec:a,optimizeForLatency:!0});break}case K.H265:{let{generalProfileSpace:t,generalProfileIndex:i,generalProfileCompatibilitySet:r,generalTierFlag:n,generalLevelIndex:o,generalConstraintSet:a,croppedWidth:s,croppedHeight:l}=ep(e);this._renderer.width=s,this._renderer.height=l;let d=["hev1",["","A","B","C"][t]+i.toString(),tn(r,0).toString(16),(n?"H":"L")+o.toString(),tn(a,0).toString(16).toUpperCase(),tn(a,4).toString(16).toUpperCase()].join(".");console.log("codec",d),this.decoder.configure({codec:d,optimizeForLatency:!0})}}this._config=e}decode(e){let t;void 0!==this._config?((t=new Uint8Array(this._config.byteLength+e.data.byteLength)).set(this._config,0),t.set(e.data,this._config.byteLength),this._config=void 0):t=e.data,this.decoder.decode(new EncodedVideoChunk({type:!1===e.keyframe?"delta":"key",timestamp:0,data:t}))}dispose(){cancelAnimationFrame(this.animationFrameId),"closed"!==this.decoder.state&&this.decoder.close()}}var ta=i(2153),ts=i(1504),tl=i(1330),td=i.n(tl),tc=i(3370),tu=i(4532),th=i(6235),tp=i(7161),tm=i(1742),tg=i(7603),tf=i(343),tv=i.n(tf);let ty={[K.H264]:"V_MPEG4/ISO/AVC",[K.H265]:"V_MPEGH/ISO/HEVC",[K.AV1]:"V_AV1"},tb={[eR.RAW.mimeType]:"A_PCM/INT/LIT",[eR.AAC.mimeType]:"A_AAC",[eR.OPUS.mimeType]:"A_OPUS"};class tw{addVideoChunk(e){-1===this._firstTimestamp&&(this._firstTimestamp=Number(e.pts));let t=function(e){let t=[],i=0;for(let r of er(e))t.push(r),i+=r.byteLength+4;let r=new Uint8Array(i),n=0;for(let e of t)r[n]=e.byteLength>>24,r[n+1]=e.byteLength>>16,r[n+2]=e.byteLength>>8,r[n+3]=255&e.byteLength,r.set(e,n+4),n+=4+e.byteLength;return r}(e.data);this.muxer.addVideoChunkRaw(t,e.keyframe?"key":"delta",Number(e.pts)-this._firstTimestamp,this.configurationWritten?void 0:{decoderConfig:{codec:"",description:this.videoCodecDescription}}),this.configurationWritten=!0}addVideoPacket(e){if(!this.videoMetadata)throw Error("videoMetadata must be set");try{if("configuration"===e.type){switch(this.videoMetadata.codec){case K.H264:{let{sequenceParameterSet:t,pictureParameterSet:i}=eo(e.data);this.videoCodecDescription=function(e,t){let i=new Uint8Array(11+e.byteLength+t.byteLength);return i[0]=1,i[1]=e[1],i[2]=e[2],i[3]=e[3],i[4]=255,i[5]=225,i[6]=e.byteLength>>8,i[7]=255&e.byteLength,i.set(e,8),i[8+e.byteLength]=1,i[9+e.byteLength]=t.byteLength>>8,i[10+e.byteLength]=255&t.byteLength,i.set(t,11+e.byteLength),i}(t,i),this.configurationWritten=!1;break}case K.H265:{let{videoParameterSet:t,sequenceParameterSet:i,pictureParameterSet:r}=eh(e.data);this.videoCodecDescription=function(e,t,i){let{profileTierLevel:{generalProfileTier:{profile_space:r,tier_flag:n,profile_idc:o,profileCompatibilitySet:a,constraintSet:s},general_level_idc:l},vps_max_layers_minus1:d,vps_temporal_id_nesting_flag:c}=es(e.rbsp),{chroma_format_idc:u,bit_depth_luma_minus8:h,bit_depth_chroma_minus8:p,vuiParameters:{min_spatial_segmentation_idc:m=0}={}}=el(t.rbsp),g=new Uint8Array(38+e.data.length+t.data.length+i.data.length);g[0]=1,g[1]=r<<6|Number(n)<<5|o,g[2]=a[0],g[3]=a[1],g[4]=a[2],g[5]=a[3],g[6]=s[0],g[7]=s[1],g[8]=s[2],g[9]=s[3],g[10]=s[4],g[11]=s[5],g[12]=l,g[13]=240|m>>8,g[14]=m,g[15]=252,g[16]=252|u,g[17]=248|h,g[18]=248|p,g[19]=0,g[20]=0,g[21]=d+1<<3|Number(c)<<2|3,g[22]=3;let f=23;for(let r of[e,t,i])g[f]=r.nal_unit_type,g[f+=1]=0,g[f+=1]=1,g[f+=1]=r.data.length>>8,g[f+=1]=r.data.length,f+=1,g.set(r.data,f),f+=r.data.length;return g}(t,i,r),this.configurationWritten=!1}}return}if(!0===e.keyframe&&(this._packetsFromLastKeyframe.length=0),this._packetsFromLastKeyframe.push({type:"video",packet:e}),!this.muxer)return;this.addVideoChunk(e)}catch(e){console.error(e)}}addAudioChunk(e){if(-1===this._firstTimestamp)return;let t=Number(e.pts)-this._firstTimestamp;!(t<0)&&this.muxer&&this.muxer.addAudioChunkRaw(e.data,"key",t)}addAudioPacket(e){this._packetsFromLastKeyframe.push({type:"audio",packet:e}),this.addAudioChunk(e)}start(){var e,t;if(!this.videoMetadata)throw Error("videoMetadata must be set");this.running=!0;let i={target:"buffer",type:"matroska",firstTimestampBehavior:"permissive",video:{codec:ty[this.videoMetadata.codec],width:null!==(e=this.videoMetadata.width)&&void 0!==e?e:0,height:null!==(t=this.videoMetadata.height)&&void 0!==t?t:0}};if(this.audioCodec&&(i.audio={codec:tb[this.audioCodec.mimeType],sampleRate:48e3,numberOfChannels:2,bitDepth:this.audioCodec===eR.RAW?16:void 0}),this.muxer=new(tv())(i),this._packetsFromLastKeyframe.length>0)for(let{type:e,packet:t}of this._packetsFromLastKeyframe)"video"===e?this.addVideoChunk(t):this.addAudioChunk(t)}stop(){if(!this.muxer)return;let e=this.muxer.finalize(),t=new Date,i=(0,tm.yH)("Recording ".concat(t.getFullYear(),"-").concat((t.getMonth()+1).toString().padStart(2,"0"),"-").concat(t.getDate().toString().padStart(2,"0")," ").concat(t.getHours().toString().padStart(2,"0"),"-").concat(t.getMinutes().toString().padStart(2,"0"),"-").concat(t.getSeconds().toString().padStart(2,"0"),".mkv")),r=i.getWriter();r.write(new Uint8Array(e)),r.close(),this.muxer=void 0,this.configurationWritten=!1,this.running=!1}constructor(){this.running=!1,this.configurationWritten=!1,this._firstTimestamp=-1,this._packetsFromLastKeyframe=[]}}let tS=(0,ta.ky)({recorder:new tw,recording:!1,intervalId:-1,hours:0,minutes:0,seconds:0});(0,ta.U5)(()=>tS.recording,e=>{e?tS.intervalId=window.setInterval((0,ta.aD)(()=>{tS.seconds+=1,tS.seconds>=60&&(tS.seconds=0,tS.minutes+=1),tS.minutes>=60&&(tS.minutes=0,tS.hours+=1)}),1e3):(window.clearInterval(tS.intervalId),tS.intervalId=-1,tS.hours=0,tS.minutes=0,tS.seconds=0)});var tx=i(228),tL=i(6609);let t_=()=>{};class tk extends Error{output;constructor(e){super("scrcpy server exited prematurely"),this.output=e}}class tE{static async pushServer(e,t,i=eF){let r=await e.sync();try{await r.write({filename:i,file:t})}finally{await r.dispose()}}static async start(e,t,i,r){let n,o;try{try{n=r.createConnection(e),await n.initialize()}catch(t){if(t instanceof tx.Pg)r.tunnelForwardOverride=!0,n=r.createConnection(e),await n.initialize();else throw n=void 0,t}o=await e.subprocess.spawn([`CLASSPATH=${t}`,"app_process","/","com.genymobile.scrcpy.Server",i,...r.serialize()],{protocols:[tx.vf]});let a=o.stdout.pipeThrough(new ex.xU).pipeThrough(new ex.Jb("\n")),s=[],l=new ex.HS,d=a.pipeTo(new ex.Vj({write(e){s.push(e)}}),{signal:l.signal,preventCancel:!0}).catch(t_),c=await Promise.race([o.exit.then(()=>{throw new tk(s)}),n.getStreams()]);return l.abort(),await d,new tE({options:r,process:o,stdout:function(...e){return new ex.Oi(async t=>{for(let i of e)await i.pipeTo(new ex.Vj({async write(e){await t.enqueue(e)}}))})}(new ex.Oi(async e=>{for(let t of s)await e.enqueue(t)}),a),videoStream:c.video,audioStream:c.audio,controlStream:c.control})}catch(e){throw await o?.kill(),e}finally{n?.dispose()}}static async getEncoders(e,t,i,r){return r.setListEncoders(),await r.getEncoders(e,t,i)}static async getDisplays(e,t,i,r){return r.setListDisplays(),await r.getDisplays(e,t,i)}_options;_process;_stdout;get stdout(){return this._stdout}get exit(){return this._process.exit}_screenWidth;get screenWidth(){return this._screenWidth}_screenHeight;get screenHeight(){return this._screenHeight}_videoStream;get videoStream(){return this._videoStream}_audioStream;get audioStream(){return this._audioStream}_controlMessageWriter;get controlMessageWriter(){return this._controlMessageWriter}_deviceMessageStream;get deviceMessageStream(){return this._deviceMessageStream}constructor({options:e,process:t,stdout:i,videoStream:r,audioStream:n,controlStream:o}){this._options=e,this._process=t,this._stdout=i,this._videoStream=this.createVideoStream(r),this._audioStream=n?this.createAudioStream(n):void 0,o&&(this._controlMessageWriter=new eL(o.writable.getWriter(),e),this._deviceMessageStream=o.readable.pipeThrough(new eE))}async createVideoStream(e){let{stream:t,metadata:i}=await this._options.parseVideoStreamMetadata(e);return{stream:t.pipeThrough(this._options.createMediaStreamTransformer()).pipeThrough(new ex.N7(e=>{if("configuration"===e.type)switch(i.codec){case K.H264:{let{croppedWidth:t,croppedHeight:i}=ea(e.data);this._screenWidth=t,this._screenHeight=i;break}case K.H265:{let{croppedWidth:t,croppedHeight:i}=ep(e.data);this._screenWidth=t,this._screenHeight=i}}})),metadata:i}}async createAudioStream(e){let t=await this._options.parseAudioStreamMetadata(e);switch(t.type){case"disabled":case"errored":return t;case"success":return{...t,stream:t.stream.pipeThrough(this._options.createMediaStreamTransformer())};default:throw Error(`Unexpected audio metadata type ${t.type}`)}}async close(){await this._process.kill()}}var tC=i(6789);let tP=()=>{};class tD{adb;options;socketName;constructor(e,t){this.adb=e,this.options=t,this.socketName=this.getSocketName()}initialize(){}getSocketName(){let e="localabstract:scrcpy";return void 0!==this.options.scid&&this.options.scid>=0&&(e+="_"+this.options.scid.toString(16).padStart(8,"0")),e}dispose(){}}class tM extends tD{_disposed=!1;connect(){return this.adb.createSocket("localabstract:scrcpy")}async connectAndRetry(){for(let e=0;!this._disposed&&e<100;e+=1)try{return await this.connect()}catch(e){await (0,tC.gw)(100)}throw Error("Can't connect to server after 100 retries")}async connectVideoStream(){let{readable:e}=await this.connectAndRetry();if(this.options.sendDummyByte){let t=new ex.h0(e);return await t.readExactly(1),t.release()}return e}async getStreams(){let e=await this.connectVideoStream(),t=this.options.audio?(await this.connectAndRetry()).readable:void 0,i=this.options.control?await this.connectAndRetry():void 0;return{video:e,audio:t,control:i}}dispose(){super.dispose(),this._disposed=!0}}class tN extends tD{streams;address;async initialize(){try{await this.adb.reverse.remove(this.socketName)}catch(e){if(e instanceof tx.Pg)throw e}let e=new ex.GJ;this.streams=e.readable.getReader();let t=e.writable.getWriter();this.address=await this.adb.reverse.add(this.socketName,this.socketName,e=>(t.write(e),!0))}async accept(){return(await this.streams.read()).value}async getStreams(){let{readable:e}=await this.accept(),t=this.options.audio?(await this.accept()).readable:void 0,i=this.options.control?await this.accept():void 0;return{video:e,audio:t,control:i}}dispose(){this.adb.reverse.remove(this.address).catch(tP)}}class tA extends eU{get defaults(){return this._base.defaults}tunnelForwardOverride=!1;constructor(e){super(e,e.value)}serialize(){return this._base.serialize()}}class tT extends tA{static createConnection(e,t,i){return i?new tM(e,t):new tN(e,t)}static async getEncoders(e,t,i,r){let n=await tE.start(e,t,i,r),o=[];return await n.stdout.pipeTo(new ex.Vj({write:e=>{let t=r.parseEncoder(e);t&&o.push(t)}})),o}static async getDisplays(e,t,i,r){try{let n=await tE.start(e,t,i,r);await n.close()}catch(e){if(e instanceof tk){let t=[];for(let i of e.output){let e=r.parseDisplay(i);e&&t.push(e)}return t}}throw Error("failed to get displays")}getEncoders(e,t,i){return tT.getEncoders(e,t,i,this)}getDisplays(e,t,i){return tT.getDisplays(e,t,i,this)}createConnection(e){return tT.createConnection(e,{scid:-1,control:!0,sendDummyByte:!0,audio:!1},this.tunnelForwardOverride||this.value.tunnelForward)}}class tz extends tA{async getEncoders(e,t,i){try{let r=await tE.start(e,t,i,this);await r.close()}catch(e){if(e instanceof tk){let t=[];for(let i of e.output){let e=this.parseEncoder(i);e&&t.push(e)}return t}}throw Error("Unexpected error")}getDisplays(e,t,i){return tT.getDisplays(e,t,i,this)}createConnection(e){return tT.createConnection(e,{scid:this.value.scid.value,control:this.value.control,sendDummyByte:this.value.sendDummyByte,audio:this.value.audio},this.tunnelForwardOverride||this.value.tunnelForward)}}class tO extends tz{}class tR{_context;_worklet;_buffer=[];constructor(e){this._context=new AudioContext({latencyHint:"interactive",sampleRate:e})}feed(e){if(void 0===this._worklet){this._buffer.push(e);return}this.feedCore(this._worklet,e)}async start(){for(let e of(await this._context.audioWorklet.addModule(new i.U(i(756))),this._worklet=new AudioWorkletNode(this._context,this.sourceName,{numberOfInputs:0,numberOfOutputs:1,outputChannelCount:[2]}),this._worklet.connect(this._context.destination),this._buffer))this.feedCore(this._worklet,e);this._buffer.length=0}async stop(){this._worklet?.disconnect(),this._worklet=void 0,await this._context.close()}}class tF extends tR{sourceName="int16-source-processor";feedCore(e,t){(0!==t.byteOffset||t.byteLength!==t.buffer.byteLength)&&(t=t.slice());let{buffer:i}=t;e.port.postMessage([i],[i])}}class tI extends tR{sourceName="float32-source-processor";feedCore(e,t){(0!==t.byteOffset||t.byteLength!==t.buffer.byteLength)&&(t=t.slice());let{buffer:i}=t;e.port.postMessage([i],[i])}}class tU extends tR{sourceName="float32-planer-source-processor";feedCore(e,t){let i=t.map(e=>((0!==e.byteOffset||e.byteLength!==e.buffer.byteLength)&&(e=e.slice()),e.buffer));e.port.postMessage(i,i)}}var tH=i(7767);class tj extends ex.GJ{constructor(e){let t;super({start(e){t=new AudioDecoder({error(t){console.log("audio decoder error: ",t),e.error(t)},output(t){e.enqueue(Array.from({length:2},(e,i)=>{let r={format:"f32-planar",planeIndex:i},n=new Float32Array(t.allocationSize(r)/Float32Array.BYTES_PER_ELEMENT);return t.copyTo(n,r),n}))}})},transform(i){switch(i.type){case"configuration":t.configure({...e,description:i.data});break;case"data":t.decode(new EncodedAudioChunk({data:i.data,type:"key",timestamp:0}))}},async flush(){await t.flush()}})}}class tV extends ex.GJ{constructor(e){let t;super({start(i){(t=new AudioDecoder({error(e){console.log("audio decoder error: ",e),i.error(e)},output(e){let t={format:"f32",planeIndex:0},r=new Float32Array(e.allocationSize(t)/Float32Array.BYTES_PER_ELEMENT);e.copyTo(r,t),i.enqueue(r)}})).configure(e)},transform(e){switch(e.type){case"configuration":break;case"data":if(0===e.data.length)break;t.decode(new EncodedAudioChunk({type:"key",timestamp:0,data:e.data}))}},async flush(){await t.flush()}})}}var tK=i(2469);let tG=new i.U(i(4439));class tB{get downloaded(){return this._downloaded}get total(){return this._total}get onProgress(){return this.progressEvent.event}async fetch(e){var t;let i=await window.fetch(e);this._total=Number.parseInt(null!==(t=i.headers.get("Content-Length"))&&void 0!==t?t:"0",10),this.progressEvent.fire([this._downloaded,this._total]);let r=i.body.getReader(),n=[];for(;;){let e=await r.read();if(e.done)break;n.push(e.value),this._downloaded+=e.value.byteLength,this.progressEvent.fire([this._downloaded,this._total])}this._total=n.reduce((e,t)=>e+t.byteLength,0);let o=new Uint8Array(this._total),a=0;for(let e of n)o.set(e,a),a+=e.byteLength;return o}constructor(e){this._downloaded=0,this._total=0,this.progressEvent=new tK.vp,this.promise=this.fetch(e)}}function tW(e){return r||(r=new tB(tG)).promise.catch(e=>{r=void 0}),e&&(r.onProgress(e),e([r.downloaded,r.total])),r.promise}var tY=i(9341);class tZ{setModifier(e,t){switch(e){case I.ControlLeft:this._controlLeft=t;break;case I.ControlRight:this._controlRight=t;break;case I.ShiftLeft:this._shiftLeft=t;break;case I.ShiftRight:this._shiftRight=t;break;case I.AltLeft:this._altLeft=t;break;case I.AltRight:this._altRight=t;break;case I.MetaLeft:this._metaLeft=t;break;case I.MetaRight:this._metaRight=t;break;case I.CapsLock:t&&(this._capsLock=!this._capsLock);break;case I.NumLock:t&&(this._numLock=!this._numLock)}}getMetaState(){let e=0;return this._altLeft&&(e|=F.AltOn|F.AltLeftOn),this._altRight&&(e|=F.AltOn|F.AltRightOn),this._shiftLeft&&(e|=F.ShiftOn|F.ShiftLeftOn),this._shiftRight&&(e|=F.ShiftOn|F.ShiftRightOn),this._controlLeft&&(e|=F.CtrlOn|F.CtrlLeftOn),this._controlRight&&(e|=F.CtrlOn|F.CtrlRightOn),this._metaLeft&&(e|=F.MetaOn|F.MetaLeftOn),this._metaRight&&(e|=F.MetaOn|F.MetaRightOn),this._capsLock&&(e|=F.CapsLockOn),this._numLock&&(e|=F.NumLockOn),e}async down(e){var t;let i=I[e];i&&(this.setModifier(i,!0),this._keys.add(i),await (null===(t=this.client.controlMessageWriter)||void 0===t?void 0:t.injectKeyCode({action:R.Down,keyCode:i,metaState:this.getMetaState(),repeat:0})))}async up(e){var t;let i=I[e];i&&(this.setModifier(i,!1),this._keys.delete(i),await (null===(t=this.client.controlMessageWriter)||void 0===t?void 0:t.injectKeyCode({action:R.Up,keyCode:i,metaState:this.getMetaState(),repeat:0})))}async reset(){for(let e of(this._controlLeft=!1,this._controlRight=!1,this._shiftLeft=!1,this._shiftRight=!1,this._altLeft=!1,this._altRight=!1,this._metaLeft=!1,this._metaRight=!1,this._keys))this.up(I[e]);this._keys.clear()}dispose(){}constructor(e){this._controlLeft=!1,this._controlRight=!1,this._shiftLeft=!1,this._shiftRight=!1,this._altLeft=!1,this._altRight=!1,this._metaLeft=!1,this._metaRight=!1,this._capsLock=!1,this._numLock=!0,this._keys=new Set,this.client=e}}class tJ{static async register(e){let t=await tY.qG.register(e,0,tY.XC.DESCRIPTOR);return new tJ(t)}async down(e){let t=tY.sm[e];t&&(this.hidKeyboard.down(t),await this.aoaKeyboard.sendInputReport(this.hidKeyboard.serializeInputReport()))}async up(e){let t=tY.sm[e];t&&(this.hidKeyboard.up(t),await this.aoaKeyboard.sendInputReport(this.hidKeyboard.serializeInputReport()))}async reset(){this.hidKeyboard.reset(),await this.aoaKeyboard.sendInputReport(this.hidKeyboard.serializeInputReport())}async dispose(){await this.aoaKeyboard.unregister()}constructor(e){this.hidKeyboard=new tY.XC,this.aoaKeyboard=e}}var tX=i(3151),tq=i(4624),t$=i(6882),tQ=i(3524),t0=i(9113),t1=i(1973),t2=i(1249),t3=i(70);let t6=!1,t4=[],t5=0,t8=new Map;class t7 extends tK.Xn{streamId;pictureReadyEvent=new tK.vp;get onPictureReady(){return this.pictureReadyEvent.event}constructor(e){var t;super(),this.streamId=e,this.addDisposable((t=this.handlePictureReady,t8.set(e,t),{dispose(){t8.delete(e)}}))}handlePictureReady=e=>{this.pictureReadyEvent.fire(e)};feed(e){n.postMessage({type:"decode",data:e,offset:0,length:e.byteLength,renderStateId:this.streamId},[e])}dispose(){super.dispose(),n.postMessage({type:"release",renderStateId:this.streamId})}}let t9=()=>{};function ie(){return o||(o=Promise.all([i.e(118).then(i.t.bind(i,6118,19)),i.e(337).then(i.t.bind(i,6337,19))]).then(([e,{default:t}])=>({YuvBuffer:e,YuvCanvas:t}))),o}class it{static capabilities={h264:{maxProfile:P.Baseline,maxLevel:D.Level4}};_renderer;get renderer(){return this._renderer}_frameRendered=0;get frameRendered(){return this._frameRendered}_frameSkipped=0;get frameSkipped(){return this._frameSkipped}_writable;get writable(){return this._writable}_yuvCanvas;_initializer;constructor(){ie(),this._renderer=document.createElement("canvas"),this._writable=new ex.Vj({write:async e=>{switch(e.type){case"configuration":this.configure(e.data).catch(t9);break;case"data":{if(!this._initializer)throw Error("Decoder not configured");let t=await this._initializer.promise;t.feed(e.data.slice().buffer)}}}})}async configure(e){this.dispose(),this._initializer=new tC.hP;let{YuvBuffer:t,YuvCanvas:r}=await ie();this._yuvCanvas||(this._yuvCanvas=r.attach(this._renderer));let{encodedWidth:o,encodedHeight:a,croppedWidth:s,croppedHeight:l,cropLeft:d,cropTop:c}=ea(e),u=o/2,h=a/2,p=t.format({width:o,height:a,chromaWidth:u,chromaHeight:h,cropLeft:d,cropTop:c,cropWidth:s,cropHeight:l,displayWidth:s,displayHeight:l}),m=await function(){if(n||(n=new Worker(i.tu(new URL(i.p+i.u(292),i.b)))).addEventListener("message",({data:e})=>{switch(e.type){case"decoderReady":for(let e of(t6=!0,t4))e.resolve(new t7(t5)),t5+=1;t4.length=0;break;case"pictureReady":t8.get(e.renderStateId)?.(e)}}),!t6){let e=new tC.hP;return t4.push(e),e.promise}let e=new t7(t5);return t5+=1,Promise.resolve(e)}();this._initializer.resolve(m);let g=o*a,f=g+u*h;m.onPictureReady(({data:e})=>{this._frameRendered+=1;let i=new Uint8Array(e),r=t.frame(p,t.lumaPlane(p,i,o,0),t.chromaPlane(p,i,u,g),t.chromaPlane(p,i,u,f));this._yuvCanvas.drawFrame(r)}),m.feed(e.slice().buffer)}dispose(){this._initializer?.promise.then(e=>e.dispose()).catch(t9),this._initializer=void 0}}let ii=(0,et.Z)({labelRight:{marginLeft:"4px"},item:{width:"100%",maxWidth:"300px"}}),ir=(0,ts.Pi)(function(e){let{definition:t,value:i,onChange:r}=e,n=ii(),o=(0,W.jsxs)(J.K,{horizontal:!0,verticalAlign:"center",children:[(0,W.jsx)("span",{children:t.label}),!!t.description&&(0,W.jsx)(tX.G,{content:t.description,children:(0,W.jsx)(tq.J,{className:n.labelRight,iconName:tm.PJ.Info})}),t.labelExtra]});switch(t.type){case"text":return(0,W.jsx)(t$.n,{className:n.item,label:o,placeholder:t.placeholder,value:i,onChange:(e,i)=>r(t,i)});case"dropdown":return(0,W.jsx)(tQ.L,{className:n.item,label:o,options:t.options,placeholder:t.placeholder,selectedKey:i,onChange:(e,i)=>r(t,i.key)});case"toggle":return(0,W.jsx)(t0.Z,{label:o,checked:i,disabled:t.disabled,onChange:(e,i)=>r(t,i)});case"number":return(0,W.jsx)(t1.k,{className:n.item,label:t.label,labelPosition:t2.L.top,min:t.min,max:t.max,step:t.step,value:i.toString(),onChange:(e,i)=>r(t,Number.parseInt(i,10))})}}),io=(0,ta.ky)({displays:[],encoders:[],decoders:[{key:"tinyh264",name:"TinyH264 (Software)",Constructor:it}],settings:{maxSize:1080,videoBitRate:4e6,videoCodec:"h264",lockVideoOrientation:tt.Unlocked,displayId:0,crop:"",powerOn:!0,audio:!0,audioCodec:"aac"},clientSettings:{}},{decoders:ta.LO.shallow,settings:ta.LO.deep,clientSettings:ta.LO.deep});(0,ta.EH)(()=>{tH.d.device&&(0,ta.z)(()=>{io.encoders=[],io.displays=[],io.settings.displayId=void 0})}),(0,ta.EH)(()=>{io.clientSettings.decoder=io.decoders[0].key});let ia=(0,ta.Fl)(()=>{let e=[];return e.push({group:"settings",key:"powerOn",type:"toggle",label:"Wake device up on start"},{group:"clientSettings",key:"turnScreenOff",type:"toggle",label:"Turn screen off during mirroring"},{group:"settings",key:"stayAwake",type:"toggle",label:"Stay awake during mirroring (if plugged in)"},{group:"settings",key:"powerOffOnClose",type:"toggle",label:"Turn device off on stop"}),e.push({group:"settings",key:"displayId",type:"dropdown",label:"Display",placeholder:"Press refresh to update available displays",labelExtra:(0,W.jsx)(t3.h,{iconProps:{iconName:tm.PJ.ArrowClockwise},disabled:!tH.d.device,text:"Refresh",onClick:async()=>{try{await il.pushServer();let e=await tE.getDisplays(tH.d.device,eF,"2.0",new tO(new ti({logLevel:te.Debug})));(0,ta.z)(()=>{if(io.displays=e,!io.settings.displayId||!io.displays.some(e=>e.id===io.settings.displayId)){var t;io.settings.displayId=null===(t=io.displays[0])||void 0===t?void 0:t.id}})}catch(e){tH.d.showErrorDialog(e)}}}),options:io.displays.map(e=>({key:e.id,text:"".concat(e.id).concat(e.resolution?" (".concat(e.resolution,")"):"")}))}),e.push({group:"settings",key:"crop",type:"text",label:"Crop",placeholder:"W:H:X:Y"}),e.push({group:"settings",key:"maxSize",type:"number",label:"Max Resolution (longer side, 0 = unlimited)",min:0,max:2560,step:50},{group:"settings",key:"videoBitRate",type:"number",label:"Max Video Bitrate (bps)",min:100,max:1e8,step:100},{group:"settings",key:"videoCodec",type:"dropdown",label:"Video Codec",options:[{key:"h264",text:"H.264"},{key:"h265",text:"H.265"}]},{group:"settings",key:"videoEncoder",type:"dropdown",label:"Video Encoder",placeholder:0===io.encoders.length?"Press refresh button to update encoder list":"(default)",labelExtra:(0,W.jsx)(t3.h,{iconProps:{iconName:tm.PJ.ArrowClockwise},disabled:!tH.d.device,text:"Refresh",onClick:async()=>{try{await il.pushServer();let e=await tE.getEncoders(tH.d.device,eF,"2.0",new tO(new ti({logLevel:te.Debug})));(0,ta.z)(()=>{io.encoders=e})}catch(e){tH.d.showErrorDialog(e)}}}),options:io.encoders.filter(e=>"video"===e.type&&(!e.codec||e.codec===io.settings.videoCodec)).map(e=>({key:e.name,text:e.name}))}),e.push({group:"settings",key:"lockVideoOrientation",type:"dropdown",label:"Lock Video Orientation",options:[{key:tt.Unlocked,text:"Unlocked"},{key:tt.Initial,text:"Current"},{key:tt.Portrait,text:"Portrait"},{key:tt.Landscape,text:"Landscape"},{key:tt.PortraitFlipped,text:"Portrait (Flipped)"},{key:tt.LandscapeFlipped,text:"Landscape (Flipped)"}]}),io.decoders.length>1&&e.push({group:"clientSettings",key:"decoder",type:"dropdown",label:"Video Decoder",options:io.decoders.map(e=>({key:e.key,text:e.name,data:e}))}),e.push({group:"clientSettings",key:"ignoreDecoderCodecArgs",type:"toggle",label:"Ignore video decoder's codec options",description:"Some decoders don't support all H.264 profile/levels, so they request the device to encode at their highest-supported codec. However, some super old devices may not support that codec so their encoders will fail to start. Use this option to let device choose the codec to be used."}),e.push({group:"settings",key:"audio",type:"toggle",label:"Forward Audio (Requires Android 11)"},{group:"settings",key:"audioCodec",type:"dropdown",label:"Audio Codec",options:[{key:"raw",text:"Raw"},{key:"aac",text:"AAC"},{key:"opus",text:"Opus"}]},{group:"settings",key:"audioEncoder",type:"dropdown",placeholder:0===io.encoders.length?"Press refresh button to update encoder list":"(default)",label:"Audio Encoder",labelExtra:(0,W.jsx)(t3.h,{iconProps:{iconName:tm.PJ.ArrowClockwise},disabled:!tH.d.device,text:"Refresh",onClick:async()=>{try{await il.pushServer();let e=await tE.getEncoders(tH.d.device,eF,"2.0",new tO(new ti({logLevel:te.Debug})));(0,ta.z)(()=>{io.encoders=e})}catch(e){tH.d.showErrorDialog(e)}}}),options:io.encoders.filter(e=>"audio"===e.type&&e.codec===io.settings.audioCodec).map(e=>({key:e.name,text:e.name}))}),e});(0,ta.EH)(()=>{if(0===io.encoders.length){io.settings.videoEncoder="",io.settings.audioEncoder="";return}let e=io.encoders.filter(e=>"video"===e.type&&e.codec===io.settings.videoCodec);io.settings.videoEncoder&&e.every(e=>e.name!==io.settings.videoEncoder)&&(io.settings.videoEncoder="");let t=io.encoders.filter(e=>"audio"===e.type&&e.codec===io.settings.audioCodec);io.settings.audioEncoder&&t.every(e=>e.name!==io.settings.audioEncoder)&&(io.settings.audioEncoder="")});let is=()=>{},il=new class{get rotatedWidth(){return 1&il.rotation?il.height:il.width}get rotatedHeight(){return 1&il.rotation?il.width:il.height}async pushServer(){let e=await tW();await tE.pushServer(tH.d.device,new ex.Pz({start(t){t.enqueue(new ex.sS(e)),t.close()}}))}async stop(){var e;await (null===(e=this.client)||void 0===e?void 0:e.close()),this.dispose()}dispose(){var e,t,i;null===(e=this.decoder)||void 0===e||e.dispose(),this.decoder=void 0,tS.recording&&(tS.recorder.stop(),tS.recording=!1),null===(t=this.keyboard)||void 0===t||t.dispose(),this.keyboard=void 0,null===(i=this.audioPlayer)||void 0===i||i.stop(),this.audioPlayer=void 0,this.fps="0",clearTimeout(this.fpsCounterIntervalId),this.isFullScreen&&(document.exitFullscreen().catch(is),this.isFullScreen=!1),this.client=void 0,this.running=!1}setFullScreenContainer(e){this.fullScreenContainer=e}setRendererContainer(e){this.rendererContainer=e}clientPositionToDevicePosition(e,t){let i=this.rendererContainer.getBoundingClientRect(),r=eD((e-i.x)/i.width,0,1),n=eD((t-i.y)/i.height,0,1);switch(1&this.rotation&&([r,n]=[n,r]),this.rotation){case 1:n=1-n;break;case 2:r=1-r,n=1-n;break;case 3:r=1-r}return{x:r*this.width,y:n*this.height}}constructor(){this.running=!1,this.fullScreenContainer=null,this.rendererContainer=null,this.isFullScreen=!1,this.logVisible=!1,this.log=[],this.demoModeVisible=!1,this.navigationBarVisible=!0,this.width=0,this.height=0,this.rotation=0,this.client=void 0,this.hoverHelper=void 0,this.keyboard=void 0,this.audioPlayer=void 0,this.decoder=void 0,this.fpsCounterIntervalId=void 0,this.fps="0",this.connecting=!1,this.serverTotalSize=0,this.serverDownloadedSize=0,this.debouncedServerDownloadedSize=0,this.serverDownloadSpeed=0,this.serverUploadedSize=0,this.debouncedServerUploadedSize=0,this.serverUploadSpeed=0,this.start=async()=>{if(tH.d.device)try{var e,t;let i;if(!io.clientSettings.decoder)throw Error("No available decoder");(0,ta.z)(()=>{this.serverTotalSize=0,this.serverDownloadedSize=0,this.debouncedServerDownloadedSize=0,this.serverUploadedSize=0,this.debouncedServerUploadedSize=0,this.connecting=!0});let r=setInterval((0,ta.aD)(()=>{this.serverDownloadSpeed=this.serverDownloadedSize-this.debouncedServerDownloadedSize,this.debouncedServerDownloadedSize=this.serverDownloadedSize}),1e3);try{i=await tW((0,ta.aD)(e=>{let[t,i]=e;this.serverDownloadedSize=t,this.serverTotalSize=i})),(0,ta.z)(()=>{this.serverDownloadSpeed=this.serverDownloadedSize-this.debouncedServerDownloadedSize,this.debouncedServerDownloadedSize=this.serverDownloadedSize})}finally{clearInterval(r)}r=setInterval((0,ta.aD)(()=>{this.serverUploadSpeed=this.serverUploadedSize-this.debouncedServerUploadedSize,this.debouncedServerUploadedSize=this.serverUploadedSize}),1e3);try{await tE.pushServer(tH.d.device,new ex.Pz({start(e){e.enqueue(new ex.sS(i)),e.close()}}).pipeThrough(new ex.em(tx.j4)).pipeThrough(new tm.hK((0,ta.aD)(e=>{this.serverUploadedSize=e})))),(0,ta.z)(()=>{this.serverUploadSpeed=this.serverUploadedSize-this.debouncedServerUploadedSize,this.debouncedServerUploadedSize=this.serverUploadedSize})}finally{clearInterval(r)}let n=null!==(t=io.decoders.find(e=>e.key===io.clientSettings.decoder))&&void 0!==t?t:io.decoders[0],o=new eP;if(!io.clientSettings.ignoreDecoderCodecArgs){let e=n.Constructor.capabilities[io.settings.videoCodec];e&&(o.value.profile=e.maxProfile,o.value.level=e.maxLevel)}let a=new tO(new ti({...io.settings,logLevel:te.Debug,scid:e7.random(),sendDeviceMeta:!1,sendDummyByte:!1,videoCodecOptions:o}));(0,ta.z)(()=>{this.log=[],this.log.push("[client] Server version: ".concat("2.0")),this.log.push("[client] Server arguments: ".concat(a.serialize().join(" ")))});let s=await tE.start(tH.d.device,eF,"2.0",a);s.stdout.pipeTo(new ex.Vj({write:(0,ta.aD)(e=>{this.log.push(e)})})),tS.recorder=new tw,s.videoStream.then(e=>{let{stream:t,metadata:i}=e;(0,ta.z)(()=>{tS.recorder.videoMetadata=i});let r=new n.Constructor(i.codec);(0,ta.z)(()=>{this.decoder=r;let e=0,t=0;this.fpsCounterIntervalId=setInterval((0,ta.aD)(()=>{let i=r.frameRendered-e,n=r.frameSkipped-t;this.fps="".concat(i).concat(n?"+".concat(n," skipped"):""),e=r.frameRendered,t=r.frameSkipped}),1e3)});let o=0n,a=new ex.N7(e=>{if(tS.recorder.addVideoPacket(e),"configuration"===e.type){let t,r;switch(i.codec){case K.H264:({croppedWidth:t,croppedHeight:r}=ea(e.data));break;case K.H265:({croppedWidth:t,croppedHeight:r}=ep(e.data));break;default:throw Error("Codec not supported")}(0,ta.z)(()=>{this.log.push("[client] Video size changed: ".concat(t,"x").concat(r)),this.width=t,this.height=r})}else if(e.keyframe&&void 0!==e.pts){if(o){let t=Number(e.pts-o)/1e3|0;(0,ta.z)(()=>{this.log.push("[client] Keyframe interval: ".concat(t,"ms"))})}o=e.pts}});t.pipeThrough(a).pipeTo(r.writable).catch(e=>{console.log("video error",e)})}),null===(e=s.audioStream)||void 0===e||e.then(async e=>{switch(e.type){case"disabled":(0,ta.z)(()=>this.log.push("[client] Demuxer audio: stream explicitly disabled by the device"));return;case"errored":(0,ta.z)(()=>this.log.push("[client] Demuxer audio: stream configuration error on the device"));return;case"success":break;default:throw Error("Unexpected audio metadata type ".concat(e.type))}let[t,i]=e.stream.tee();switch(e.codec){case eR.RAW:{let e=new tF(48e3);this.audioPlayer=e,i.pipeTo(new ex.Vj({write:t=>{e.feed(new Int16Array(t.data.buffer,t.data.byteOffset,t.data.byteLength/Int16Array.BYTES_PER_ELEMENT))}})).catch(is),await this.audioPlayer.start();break}case eR.OPUS:{let t=new tI(48e3);this.audioPlayer=t,i.pipeThrough(new tV({codec:e.codec.webCodecId,numberOfChannels:2,sampleRate:48e3})).pipeTo(new ex.Vj({write:e=>{t.feed(e)}})).catch(is),await t.start();break}case eR.AAC:{let t=new tU(48e3);this.audioPlayer=t,i.pipeThrough(new tj({codec:e.codec.webCodecId,numberOfChannels:2,sampleRate:48e3})).pipeTo(new ex.Vj({write:e=>{t.feed(e)}})).catch(is),await t.start();break}default:throw Error("Unsupported audio codec ".concat(e.codec.optionValue))}(0,ta.z)(()=>{tS.recorder.audioCodec=e.codec}),t.pipeTo(new ex.Vj({write:e=>{"data"===e.type&&tS.recorder.addAudioPacket(e)}})).catch(is)}),s.exit.then(this.dispose),s.deviceMessageStream.pipeTo(new ex.Vj({write(e){e.type===H.Clipboard&&window.navigator.clipboard.writeText(e.content)}})).catch(()=>{}),io.clientSettings.turnScreenOff&&await s.controlMessageWriter.setScreenPowerMode(U.Off),(0,ta.z)(()=>{this.client=s,this.hoverHelper=new ev,this.running=!0}),tH.d.backend instanceof tL.Ub?this.keyboard=await tJ.register(tH.d.backend.device):this.keyboard=new tZ(s)}catch(e){tH.d.showErrorDialog(e)}finally{(0,ta.z)(()=>{this.connecting=!1})}},(0,ta.ky)(this,{start:!1,stop:ta.aD.bound,dispose:ta.aD.bound,setFullScreenContainer:ta.aD.bound,setRendererContainer:ta.aD.bound,clientPositionToDevicePosition:!1}),(0,ta.EH)(()=>{tH.d.device||this.dispose()}),"object"==typeof document&&document.addEventListener("fullscreenchange",()=>{document.fullscreenElement||(0,ta.z)(()=>{this.isFullScreen=!1})}),(0,ta.EH)(()=>{if(this.rendererContainer&&this.decoder){for(;this.rendererContainer.firstChild;)this.rendererContainer.firstChild.remove();this.rendererContainer.appendChild(this.decoder.renderer)}})}},id=(0,ta.Fl)(()=>{let e=[];return e.push({key:"stop",iconProps:{iconName:tm.PJ.Stop},text:"Stop",onClick:il.stop}),e.push(tS.recording?{key:"Record",iconProps:{iconName:tm.PJ.Record,style:{color:"red"}},text:"".concat(tS.hours?"".concat(tS.hours,":"):"").concat(tS.minutes.toString().padStart(2,"0"),":").concat(tS.seconds.toString().padStart(2,"0")),onClick:(0,ta.aD)(()=>{il.fullScreenContainer.focus(),tS.recorder.stop(),tS.recording=!1})}:{key:"Record",disabled:!il.running,iconProps:{iconName:tm.PJ.Record},text:"Record",onClick:(0,ta.aD)(()=>{il.fullScreenContainer.focus(),tS.recorder.start(),tS.recording=!0})}),e.push({key:"fullscreen",disabled:!il.running,iconProps:{iconName:tm.PJ.FullScreenMaximize},iconOnly:!0,text:"Fullscreen",onClick:(0,ta.aD)(()=>{il.fullScreenContainer.focus(),il.fullScreenContainer.requestFullscreen(),il.isFullScreen=!0})}),e.push({key:"volumeUp",disabled:!il.running,iconProps:{iconName:tm.PJ.Speaker2},iconOnly:!0,text:"Volume Up",onClick:async()=>{var e,t;il.fullScreenContainer.focus(),await (null===(e=il.client)||void 0===e?void 0:e.controlMessageWriter.injectKeyCode({action:R.Down,keyCode:I.VolumeUp,repeat:0,metaState:0})),await (null===(t=il.client)||void 0===t?void 0:t.controlMessageWriter.injectKeyCode({action:R.Up,keyCode:I.VolumeUp,repeat:0,metaState:0}))}},{key:"volumeDown",disabled:!il.running,iconProps:{iconName:tm.PJ.Speaker1},iconOnly:!0,text:"Volume Down",onClick:async()=>{var e,t;il.fullScreenContainer.focus(),await (null===(e=il.client)||void 0===e?void 0:e.controlMessageWriter.injectKeyCode({action:R.Down,keyCode:I.VolumeDown,repeat:0,metaState:0})),await (null===(t=il.client)||void 0===t?void 0:t.controlMessageWriter.injectKeyCode({action:R.Up,keyCode:I.VolumeDown,repeat:0,metaState:0}))}},{key:"volumeMute",disabled:!il.running,iconProps:{iconName:tm.PJ.SpeakerOff},iconOnly:!0,text:"Toggle Mute",onClick:async()=>{var e,t;il.fullScreenContainer.focus(),await (null===(e=il.client)||void 0===e?void 0:e.controlMessageWriter.injectKeyCode({action:R.Down,keyCode:I.VolumeMute,repeat:0,metaState:0})),await (null===(t=il.client)||void 0===t?void 0:t.controlMessageWriter.injectKeyCode({action:R.Up,keyCode:I.VolumeMute,repeat:0,metaState:0}))}}),e.push({key:"rotateDevice",disabled:!il.running,iconProps:{iconName:tm.PJ.Orientation},iconOnly:!0,text:"Rotate Device",onClick:()=>{il.fullScreenContainer.focus(),il.client.controlMessageWriter.rotateDevice()}},{key:"rotateVideoLeft",disabled:!il.running,iconProps:{iconName:tm.PJ.RotateLeft},iconOnly:!0,text:"Rotate Video Left",onClick:(0,ta.aD)(()=>{il.fullScreenContainer.focus(),il.rotation-=1,il.rotation<0&&(il.rotation=3)})},{key:"rotateVideoRight",disabled:!il.running,iconProps:{iconName:tm.PJ.RotateRight},iconOnly:!0,text:"Rotate Video Right",onClick:(0,ta.aD)(()=>{il.fullScreenContainer.focus(),il.rotation=il.rotation+1&3})}),e.push({key:"turnScreenOff",disabled:!il.running,iconProps:{iconName:tm.PJ.Lightbulb},iconOnly:!0,text:"Turn Screen Off",onClick:()=>{il.fullScreenContainer.focus(),il.client.controlMessageWriter.setScreenPowerMode(U.Off)}},{key:"turnScreenOn",disabled:!il.running,iconProps:{iconName:tm.PJ.LightbulbFilament},iconOnly:!0,text:"Turn Screen On",onClick:()=>{il.fullScreenContainer.focus(),il.client.controlMessageWriter.setScreenPowerMode(U.Normal)}}),il.running&&e.push({key:"fps",text:"FPS: ".concat(il.fps),disabled:!0}),e.push({key:"spacer",onRender:()=>(0,W.jsx)(tg.X,{})},{key:"separator",disabled:!0,itemType:th.n.Divider}),e.push({key:"NavigationBar",iconProps:{iconName:tm.PJ.PanelBottom},canCheck:!0,checked:il.navigationBarVisible,text:"Navigation Bar",iconOnly:!0,onClick:(0,ta.aD)(()=>{il.navigationBarVisible=!il.navigationBarVisible})},{key:"Log",iconProps:{iconName:tm.PJ.TextGrammarError},canCheck:!0,checked:il.logVisible,text:"Log",iconOnly:!0,onClick:(0,ta.aD)(()=>{il.logVisible=!il.logVisible})},{key:"DemoMode",iconProps:{iconName:tm.PJ.Wand},canCheck:!0,checked:il.demoModeVisible,text:"Demo Mode",iconOnly:!0,onClick:(0,ta.aD)(()=>{il.demoModeVisible=!il.demoModeVisible})}),e}),ic=(0,ts.Pi)(function(){return(0,W.jsx)(tp.X,{items:id.get()})});var iu=i(3189);let ih=(0,et.Z)({container:{height:"40px",backgroundColor:"#999"},bar:{width:"100%",maxWidth:"300px"},icon:{color:"white"},back:{transform:"rotate(180deg)"}});function ip(e){return!!il.client&&0===e.button&&(il.fullScreenContainer.focus(),e.currentTarget.setPointerCapture(e.pointerId),e.preventDefault(),e.stopPropagation(),!0)}function im(e){return!!il.client&&0===e.button}function ig(e){ip(e)&&il.client.controlMessageWriter.backOrScreenOn(R.Down)}function iv(e){im(e)&&il.client.controlMessageWriter.backOrScreenOn(R.Up)}function iy(e){ip(e)&&il.client.controlMessageWriter.injectKeyCode({action:R.Down,keyCode:I.AndroidHome,repeat:0,metaState:0})}function ib(e){im(e)&&il.client.controlMessageWriter.injectKeyCode({action:R.Up,keyCode:I.AndroidHome,repeat:0,metaState:0})}function iw(e){ip(e)&&il.client.controlMessageWriter.injectKeyCode({action:R.Down,keyCode:I.AndroidAppSwitch,repeat:0,metaState:0})}function iS(e){im(e)&&il.client.controlMessageWriter.injectKeyCode({action:R.Up,keyCode:I.AndroidAppSwitch,repeat:0,metaState:0})}let ix=(0,ts.Pi)(function(e){let{className:t,style:i,children:r}=e,n=ih();return il.navigationBarVisible?(0,W.jsxs)(J.K,{className:(0,iu.z)(n.container,t),verticalFill:!0,horizontalAlign:"center",style:i,children:[r,(0,W.jsxs)(J.K,{className:n.bar,verticalFill:!0,horizontal:!0,horizontalAlign:"space-evenly",verticalAlign:"center",children:[(0,W.jsx)(t3.h,{className:(0,iu.z)(n.back,n.icon),iconProps:{iconName:tm.PJ.Play},onPointerDown:ig,onPointerUp:iv}),(0,W.jsx)(t3.h,{className:n.icon,iconProps:{iconName:tm.PJ.Circle},onPointerDown:iy,onPointerUp:ib}),(0,W.jsx)(t3.h,{className:n.icon,iconProps:{iconName:tm.PJ.Stop},onPointerDown:iw,onPointerUp:iS})]})]}):(0,W.jsx)("div",{className:t,style:i,children:r})}),iL=(0,et.Z)({video:{transformOrigin:"center center",touchAction:"none"}});function i_(e){if(!il.client)return;il.fullScreenContainer.focus(),e.preventDefault(),e.stopPropagation();let{x:t,y:i}=il.clientPositionToDevicePosition(e.clientX,e.clientY);il.client.controlMessageWriter.injectScroll({screenWidth:il.client.screenWidth,screenHeight:il.client.screenHeight,pointerX:t,pointerY:i,scrollX:-e.deltaX/100,scrollY:-e.deltaY/100,buttons:0})}let ik=[T.Primary,T.Tertiary,T.Secondary,T.Back,T.Forward];function iE(e,t){let i;if(!il.client)return;let{pointerType:r}=t;i="mouse"===r?z.Finger:BigInt(t.pointerId);let{x:n,y:o}=il.clientPositionToDevicePosition(t.clientX,t.clientY),a=il.hoverHelper.process({action:e,pointerId:i,screenWidth:il.client.screenWidth,screenHeight:il.client.screenHeight,pointerX:n,pointerY:o,pressure:t.pressure,actionButton:ik[t.button],buttons:t.buttons});for(let e of a)il.client.controlMessageWriter.injectTouch(e)}function iC(e){il.client&&(il.fullScreenContainer.focus(),e.preventDefault(),e.stopPropagation(),e.currentTarget.setPointerCapture(e.pointerId),iE(A.Down,e))}function iP(e){il.client&&(e.preventDefault(),e.stopPropagation(),iE(0===e.buttons?A.HoverMove:A.Move,e))}function iD(e){il.client&&(e.preventDefault(),e.stopPropagation(),iE(A.Up,e))}function iM(e){il.client&&(e.preventDefault(),e.stopPropagation(),iE(A.HoverExit,e),iE(A.Up,e))}function iN(e){e.preventDefault()}function iA(){let e=iL(),[t,i]=(0,tc.useState)(null);return(0,tc.useEffect)(()=>{if(il.setRendererContainer(t),t)return t.addEventListener("wheel",i_,{passive:!1}),()=>{t.removeEventListener("wheel",i_)}},[t]),(0,W.jsx)("div",{ref:i,className:e.video,style:{width:il.width,height:il.height,transform:"translate(".concat((il.rotatedWidth-il.width)/2,"px, ").concat((il.rotatedHeight-il.height)/2,"px) rotate(").concat(90*il.rotation,"deg)")},onPointerDown:iC,onPointerMove:iP,onPointerUp:iD,onPointerCancel:iD,onPointerLeave:iM,onContextMenu:iN})}let iT=(e,t,i,r,n)=>{(0,tc.useEffect)(()=>{let n="function"==typeof e?e():e;return n.addEventListener(t,i,r),()=>n.removeEventListener(t,i,r)},n)},iz=tc.useLayoutEffect;Symbol("UNINITIALIZED");let iO="undefined"!=typeof localStorage?function(e,t){var i;let[r,n]=(0,tc.useState)(()=>localStorage.getItem(e)||t);iT(globalThis,"storage",()=>n(null!==(i=localStorage.getItem(e))&&void 0!==i?i:t),{passive:!0},[e,t]);let o=function(e){let t=function(e){let t=(0,tc.useRef)(e);return iz(()=>{t.current=e},[e]),t}(e);return function(e){let t=(0,tc.useRef)(e);return t.current}(function(){for(var e=arguments.length,i=Array(e),r=0;r<e;r++)i[r]=arguments[r];return t.current(...i)})}(t=>{n(t),localStorage.setItem(e,t)});return[r,o]}:(e,t)=>[t,()=>{}],iR=(0,et.Z)({layerHost:{position:"absolute",top:0,bottom:0,left:0,right:0,pointerEvents:"none",...ei.q5.margin(0)},fullScreenContainer:{flexGrow:1,display:"flex",flexDirection:"column",backgroundColor:"black",":focus-visible":{...ei.q5.outline("0")}},fullScreenStatusBar:{display:"flex",color:"white",columnGap:"12px",...ei.q5.padding("8px","20px")},spacer:{flexGrow:1}}),iF=(0,ts.Pi)(()=>{let e=iR(),t=(0,ee.M)("layerHost"),[i,r]=(0,tc.useState)(!1);return((0,tc.useEffect)(()=>{r(!0)},[]),i)?(0,W.jsxs)(W.Fragment,{children:[(0,W.jsx)(Y.Z,{id:t,className:e.layerHost}),(0,W.jsx)(Z.V,{hidden:!il.connecting,modalProps:{layerProps:{hostId:t}},dialogContentProps:{title:"Connecting..."},children:(0,W.jsxs)(J.K,{tokens:tm.WT,children:[(0,W.jsx)(X.Y,{label:"Downloading scrcpy server...",percentComplete:il.serverTotalSize?il.serverDownloadedSize/il.serverTotalSize:void 0,description:(0,tm.CY)(il.debouncedServerDownloadedSize,il.serverTotalSize,il.serverDownloadSpeed)}),(0,W.jsx)(X.Y,{label:"Pushing scrcpy server to device...",progressHidden:0===il.serverTotalSize||il.serverDownloadedSize!==il.serverTotalSize,percentComplete:il.serverUploadedSize/il.serverTotalSize,description:(0,tm.CY)(il.debouncedServerUploadedSize,il.serverTotalSize,il.serverUploadSpeed)}),(0,W.jsx)(X.Y,{label:"Starting scrcpy server on device...",progressHidden:0===il.serverTotalSize||il.serverUploadedSize!==il.serverTotalSize})]})})]}):null});async function iI(e){if(!il.client)return;e.preventDefault(),e.stopPropagation();let{type:t,code:i}=e;il.keyboard["keydown"===t?"down":"up"](i)}function iU(){var e;il.client&&(null===(e=il.keyboard)||void 0===e||e.reset())}let iH=()=>{var e;let t=iR();(0,tc.useEffect)(()=>{1===io.decoders.length&&"function"==typeof window.VideoDecoder&&(0,ta.z)(()=>{io.decoders.unshift({key:"webcodecs",name:"WebCodecs",Constructor:to})})},[]);let[i,r]=(0,tc.useState)(!1);(0,tc.useEffect)(()=>{if("keyboard"in navigator)return navigator.keyboard.lock(),r(!0),()=>{navigator.keyboard.unlock()}},[]);let[n,o]=iO("scrcpy-hint-hidden","false");return(0,tc.useEffect)(()=>(window.addEventListener("blur",iU),()=>{window.removeEventListener("blur",iU)}),[]),(0,W.jsxs)(J.K,{...tm.LE,children:[(0,W.jsx)(td(),{children:(0,W.jsx)("title",{children:"Scrcpy - Tango"})}),il.running?(0,W.jsxs)(W.Fragment,{children:[(0,W.jsx)(ic,{}),(0,W.jsxs)(J.K,{horizontal:!0,grow:!0,styles:{root:{height:0}},children:[(0,W.jsxs)("div",{ref:il.setFullScreenContainer,className:t.fullScreenContainer,tabIndex:0,onKeyDown:iI,onKeyUp:iI,children:[i&&"true"!==n&&il.isFullScreen&&(0,W.jsxs)("div",{className:t.fullScreenStatusBar,children:[(0,W.jsx)("div",{children:null===(e=tH.d.backend)||void 0===e?void 0:e.serial}),(0,W.jsxs)("div",{children:["FPS: ",il.fps]}),(0,W.jsx)("div",{className:t.spacer}),(0,W.jsx)("div",{children:"Press and hold ESC to exit full screen"}),(0,W.jsx)(q.r,{onClick:()=>o("true"),children:"Don't show again"})]}),(0,W.jsx)(tu.wM,{width:il.rotatedWidth,height:il.rotatedHeight,BottomElement:ix,children:(0,W.jsx)(iA,{})})]}),(0,W.jsx)("div",{style:{padding:12,overflow:"hidden auto",display:il.logVisible?"block":"none",width:500,fontFamily:"monospace",overflowY:"auto",whiteSpace:"pre-wrap",wordWrap:"break-word"},children:il.log.map((e,t)=>(0,W.jsx)("div",{children:e},t))}),(0,W.jsx)(tu.bq,{style:{display:il.demoModeVisible?"block":"none"}})]})]}):(0,W.jsxs)(W.Fragment,{children:[(0,W.jsxs)("div",{children:[(0,W.jsx)(tu.dL,{href:"https://github.com/Genymobile/scrcpy",spaceAfter:!0,children:"Scrcpy"}),"can mirror device display and audio with low latency and control the device, all without root access."]}),(0,W.jsx)("div",{children:"This is a TypeScript re-implementation of the client part. Paired with official pre-built server binary."}),(0,W.jsx)($.v,{align:"start",children:(0,W.jsx)(Q.K,{text:"Start",disabled:!tH.d.device,onClick:il.start})}),ia.get().map(e=>(0,W.jsx)(ir,{definition:e,value:io[e.group][e.key],onChange:(0,ta.aD)((e,t)=>io[e.group][e.key]=t)},e.key)),(0,W.jsx)(iF,{})]})]})};var ij=(0,ts.Pi)(iH)},756:function(e,t,i){"use strict";e.exports=i.p+"static/media/worker.d1c3f006.js"},4439:function(e,t,i){"use strict";e.exports=i.p+"static/chunks/scrcpy-server.f1534f67e140bcdb"}},function(e){e.O(0,[882,743,341,774,888,179],function(){return e(e.s=7934)}),_N_E=e.O()}]);
//# sourceMappingURL=scrcpy-9b72cf65a70dc234.js.map