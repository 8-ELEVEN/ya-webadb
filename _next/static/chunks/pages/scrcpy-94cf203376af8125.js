(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[533],{197:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/scrcpy",function(){return n(9027)}])},9027:function(e,t,n){"use strict";n.r(t),n.d(t,{ScrcpyServerVersion:function(){return De},default:function(){return Ie}});var r,i,o=n(3363),s=n.n(o),a=n(5202),c=n(5610),d=n(6393),l=n(556),h=n(9347),u=function(e){var t=e.id,n=e.className;return d.useEffect((function(){(0,h.EQ)(t)}),[]),p((function(){(0,h.EQ)(t)})),d.createElement("div",(0,c.pi)({},e,{className:(0,l.i)("ms-LayerHost",n)}))},p=function(e){var t=d.useRef(e);t.current=e,d.useEffect((function(){return function(){t.current&&t.current()}}),[])},v=n(2960),f=n(4546),m=n(5439),g=n(5080),w=n(7299),y=n(5378),b=n(8216),x=n(390),S=n(7899),E=n(2366),C=n(776),P=n(8571),k=n(9107),_=n(6501),D=n(8099),L=n(3780);!function(e){e[e.InjectKeycode=0]="InjectKeycode",e[e.InjectText=1]="InjectText",e[e.InjectTouch=2]="InjectTouch",e[e.InjectScroll=3]="InjectScroll",e[e.BackOrScreenOn=4]="BackOrScreenOn",e[e.ExpandNotificationPanel=5]="ExpandNotificationPanel",e[e.CollapseNotificationPanel=6]="CollapseNotificationPanel",e[e.GetClipboard=7]="GetClipboard",e[e.SetClipboard=8]="SetClipboard",e[e.SetScreenPowerMode=9]="SetScreenPowerMode",e[e.RotateDevice=10]="RotateDevice"}(r||(r={})),function(e){e[e.Down=0]="Down",e[e.Up=1]="Up",e[e.Move=2]="Move",e[e.Cancel=3]="Cancel",e[e.Outside=4]="Outside",e[e.PointerDown=5]="PointerDown",e[e.PointerUp=6]="PointerUp",e[e.HoverMove=7]="HoverMove",e[e.Scroll=8]="Scroll",e[e.HoverEnter=9]="HoverEnter",e[e.HoverExit=10]="HoverExit",e[e.ButtonPress=11]="ButtonPress",e[e.ButtonRelease=12]="ButtonRelease"}(i||(i={}));const j=(new L.ZP).uint8("type",r.InjectTouch).uint8("action",(0,L.W$)()).uint64("pointerId").uint32("pointerX").uint32("pointerY").uint16("screenWidth").uint16("screenHeight").uint16("pressure").uint32("buttons"),z=(new L.ZP).uint8("type",r.InjectText).uint32("length").string("text",{lengthField:"length"});var R,O;!function(e){e[e.Down=0]="Down",e[e.Up=1]="Up"}(R||(R={})),function(e){e[e.Home=3]="Home",e[e.Back=4]="Back",e[e.A=29]="A",e[e.B=30]="B",e[e.C=31]="C",e[e.D=32]="D",e[e.E=33]="E",e[e.F=34]="F",e[e.G=35]="G",e[e.H=36]="H",e[e.I=37]="I",e[e.J=38]="J",e[e.K=39]="K",e[e.L=40]="L",e[e.M=41]="M",e[e.N=42]="N",e[e.O=43]="O",e[e.P=44]="P",e[e.Q=45]="Q",e[e.R=46]="R",e[e.S=47]="S",e[e.T=48]="T",e[e.U=49]="U",e[e.V=50]="V",e[e.W=51]="W",e[e.X=52]="X",e[e.Y=53]="Y",e[e.Z=54]="Z",e[e.Space=62]="Space",e[e.Delete=67]="Delete",e[e.AppSwitch=187]="AppSwitch"}(O||(O={}));const I=(new L.ZP).uint8("type",r.InjectKeycode).uint8("action",(0,L.W$)()).uint32("keyCode").uint32("repeat").uint32("metaState");var T,U;function H(e){return new Promise((t=>{globalThis.setTimeout(t,e)}))}!function(e){e[e.Baseline=1]="Baseline",e[e.Main=2]="Main",e[e.Extended=4]="Extended",e[e.High=8]="High",e[e.High10=16]="High10",e[e.High422=32]="High422",e[e.High444=64]="High444",e[e.ConstrainedBaseline=65536]="ConstrainedBaseline",e[e.ConstrainedHigh=524288]="ConstrainedHigh"}(T||(T={})),function(e){e[e.Level1=1]="Level1",e[e.Level1b=2]="Level1b",e[e.Level11=4]="Level11",e[e.Level12=8]="Level12",e[e.Level13=16]="Level13",e[e.Level2=32]="Level2",e[e.Level21=64]="Level21",e[e.Level22=128]="Level22",e[e.Level3=256]="Level3",e[e.Level31=512]="Level31",e[e.Level32=1024]="Level32",e[e.Level4=2048]="Level4",e[e.Level41=4096]="Level41",e[e.Level42=8192]="Level42",e[e.Level5=16384]="Level5",e[e.Level51=32768]="Level51",e[e.Level52=65536]="Level52",e[e.Level6=131072]="Level6",e[e.Level61=262144]="Level61",e[e.Level62=524288]="Level62"}(U||(U={}));class B{constructor(e){this.device=e}initialize(){}dispose(){}}class G extends B{connect(){return(0,c.mG)(this,void 0,void 0,(function*(){return new _.wZ(yield this.device.createSocket("localabstract:scrcpy"))}))}connectAndRetry(){return(0,c.mG)(this,void 0,void 0,(function*(){for(let t=0;t<100;t++)try{return yield this.connect()}catch(e){yield H(100)}throw new Error("Can't connect to server after 100 retries")}))}connectAndReadByte(){return(0,c.mG)(this,void 0,void 0,(function*(){const e=yield this.connectAndRetry();return yield e.read(1),e}))}getStreams(){return(0,c.mG)(this,void 0,void 0,(function*(){return[yield this.connectAndReadByte(),yield this.connectAndRetry()]}))}}class N extends B{initialize(){return(0,c.mG)(this,void 0,void 0,(function*(){try{yield this.device.reverse.remove("localabstract:scrcpy")}catch(e){}this.streams=new _.NH,this.address=yield this.device.reverse.add("localabstract:scrcpy",27183,{onSocket:(e,t)=>{this.streams.enqueue(t)}})}))}accept(){return(0,c.mG)(this,void 0,void 0,(function*(){return new _.wZ(yield this.streams.dequeue())}))}getStreams(){return(0,c.mG)(this,void 0,void 0,(function*(){return[yield this.accept(),yield this.accept()]}))}dispose(){this.device.reverse.remove(this.address)}}const A="/data/local/tmp/scrcpy-server.jar";var F,W;!function(e){e.Debug="debug",e.Info="info",e.Warn="warn",e.Error="error"}(F||(F={})),function(e){e[e.Unlocked=-1]="Unlocked",e[e.Portrait=0]="Portrait",e[e.Landscape=1]="Landscape",e[e.PortraitFlipped=2]="PortraitFlipped",e[e.LandscapeFlipped=3]="LandscapeFlipped"}(W||(W={}));const K=(new L.ZP).uint8("type",(0,L.W$)());const M=(new L.ZP).uint8("type",(0,L.W$)()).uint8("action",(0,L.W$)());class V extends class{constructor({path:e=A,version:t="1.17",logLevel:n=F.Error,maxSize:r=0,bitRate:i,maxFps:o=0,orientation:s=W.Unlocked,tunnelForward:a=!1,profile:c=T.Baseline,level:d=U.Level4,encoder:l="-"}){this.path=e,this.version=t,this.logLevel=n,this.maxSize=r,this.bitRate=i,this.maxFps=o,this.orientation=s,this.tunnelForward=a,this.profile=c,this.level=d,this.encoder=l}formatServerArguments(){return[`CLASSPATH=${this.path}`,"app_process","/","com.genymobile.scrcpy.Server",this.version,this.logLevel,this.maxSize.toString(),this.bitRate.toString(),this.maxFps.toString(),this.orientation.toString(),this.tunnelForward.toString(),"-","true","true","0","false","true",`profile=${this.profile},level=${this.level}`,this.encoder]}formatGetEncoderListArguments(){return[`CLASSPATH=${this.path}`,"app_process","/","com.genymobile.scrcpy.Server",this.version,this.logLevel,this.maxSize.toString(),this.bitRate.toString(),this.maxFps.toString(),this.orientation.toString(),this.tunnelForward.toString(),"-","true","true","0","false","true",`profile=${this.profile},level=${this.level}`,"_"]}createConnection(e){return this.tunnelForward?new G(e):new N(e)}getOutputEncoderNameRegex(){return/^\s+scrcpy --encoder-name '(.*?)'/}createBackOrScreenOnEvent(e,t){if(e===R.Down)return K.serialize({type:r.BackOrScreenOn},t.backend)}}{constructor(e){super(e);const{powerOffOnClose:t=!1}=e;this.powerOffOnClose=t}formatServerArguments(){return[...super.formatServerArguments(),this.powerOffOnClose.toString()]}formatGetEncoderListArguments(){return[...super.formatGetEncoderListArguments(),this.powerOffOnClose.toString()]}getOutputEncoderNameRegex(){return/^\s+scrcpy --encoder '(.*?)'/}createBackOrScreenOnEvent(e,t){return M.serialize({type:r.BackOrScreenOn,action:e},t.backend)}}function $(e,t,n={}){return(0,c.mG)(this,void 0,void 0,(function*(){const{path:r=A,onProgress:i}=n;return(yield e.sync()).write(r,t,void 0,void 0,i)}))}class Y{constructor(e){this.bytePosition=0,this.bitPosition=0,this.buffer=e}read(e){let t=0;for(let n=0;n<e;n+=1)t=t<<1|this.next();return t}next(){const e=this.buffer[this.bytePosition]>>7-this.bitPosition&1;return this.bitPosition+=1,8===this.bitPosition&&(this.bytePosition+=1,this.bitPosition=0),e}decodeExponentialGolombNumber(){let e=0;for(;0===this.next();)e+=1;return 0===e?0:(1<<e|this.read(e))-1}}function Z(e){for(const t of function*(e){let t=-1,n=0,r=0,i=!1;for(const o of e){if(e[n]=o,n+=1,i){if(o>3)throw new Error("Invalid data");i=!1;continue}if(0==o){r+=1;continue}const s=r;if(r=0,-1===t){if(s>=2&&1===o){n=0,t=0;continue}throw new Error("Invalid data")}if(!(s<2))if(1!==o){if(s>2)throw new Error("Invalid data");switch(o){case 2:throw new Error("Invalid data");case 3:n-=1,i=!0}}else n-=s+1,yield e.subarray(t,n),t=n}if(i||0!==r)throw new Error("Invalid data");yield e.subarray(t,n)}(new Uint8Array(e))){const e=new Y(t);if(0!==e.next())throw new Error("Invalid data");const n=e.read(2);if(7!==e.read(5))continue;if(0===n)throw new Error("Invalid data");const r=e.read(8),i=e.read(8),o=new Y(new Uint8Array([i])),s=!!o.next(),a=!!o.next(),c=!!o.next(),d=!!o.next(),l=!!o.next(),h=!!o.next();if(0!==o.read(2))throw new Error("Invalid data");const u=e.read(8),p=e.decodeExponentialGolombNumber();if(100===r||110===r||122===r||244===r||44===r||83===r||86===r||118===r||128===r||138===r||139===r||134===r){const t=e.decodeExponentialGolombNumber();if(3===t){e.next()}e.decodeExponentialGolombNumber(),e.decodeExponentialGolombNumber(),e.next();if(!!e.next()){const n=[];for(let r=0;r<(3!==t?8:12);r++)n[r]=!!e.next(),n[r]}}e.decodeExponentialGolombNumber();const v=e.decodeExponentialGolombNumber();if(0===v){e.decodeExponentialGolombNumber()}else if(1===v){e.next(),e.decodeExponentialGolombNumber(),e.decodeExponentialGolombNumber();const t=e.decodeExponentialGolombNumber(),n=[];for(let r=0;r<t;r++)n[r]=e.decodeExponentialGolombNumber()}e.decodeExponentialGolombNumber(),e.next();const f=e.decodeExponentialGolombNumber(),m=e.decodeExponentialGolombNumber(),g=e.next();if(!g){e.next()}e.next();const w=!!e.next();let y,b,x,S;w?(y=e.decodeExponentialGolombNumber(),b=e.decodeExponentialGolombNumber(),x=e.decodeExponentialGolombNumber(),S=e.decodeExponentialGolombNumber()):(y=0,b=0,x=0,S=0);e.next();return{profile_idc:r,constraint_set:i,constraint_set0_flag:s,constraint_set1_flag:a,constraint_set2_flag:c,constraint_set3_flag:d,constraint_set4_flag:l,constraint_set5_flag:h,level_idc:u,seq_parameter_set_id:p,pic_width_in_mbs_minus1:f,pic_height_in_map_units_minus1:m,frame_mbs_only_flag:g,frame_cropping_flag:w,frame_crop_left_offset:y,frame_crop_right_offset:b,frame_crop_top_offset:x,frame_crop_bottom_offset:S}}throw new Error("Invalid data")}class X{constructor(e){this.start=0,this.peekEnd=0,this.text=e}next(){let e=this.peek();return this.start=this.peekEnd,this.peekEnd=0,e}peek(){if(this.peekEnd)return this.peekLine;const e=this.text.indexOf("\n",this.start);if(-1===e)return this.peekLine=void 0,void(this.peekEnd=this.text.length);const t=this.text.substring(this.start,e);return this.peekLine=t,this.peekEnd=e+1,t}}const q=(new L.ZP).uint16("width").uint16("height"),Q=(new L.ZP).int64("pts").uint32("size").arrayBuffer("data",{lengthField:"size"}),J=BigInt(-1),ee=(new L.ZP).uint32("length").string("content",{lengthField:"length"});class te{constructor(e){this.debugEvent=new k.vp,this.infoEvent=new k.vp,this.errorEvent=new k.vp,this.closeEvent=new k.vp,this._running=!1,this.sizeChangedEvent=new k.vp,this.videoDataEvent=new _.$,this.clipboardChangeEvent=new k.vp,this.sendingTouchMessage=!1,this.device=e}static pushServer(e,t,n){$(e,t,n)}static getEncoders(e,t){return(0,c.mG)(this,void 0,void 0,(function*(){const n=new te(e),r=t.getOutputEncoderNameRegex(),i=new D.h,o=[];return n.onError((({message:e,error:t})=>{if(t&&"com.genymobile.scrcpy.InvalidEncoderException"!==t.type)return void i.reject(new Error(`${t.type}: ${t.message}`));const n=e.match(r);n&&o.push(n[1])})),n.onClose((()=>{i.resolve(o)})),yield n.startCore(t.formatGetEncoderListArguments(),t.createConnection(e)),i.promise}))}get backend(){return this.device.backend}get onDebug(){return this.debugEvent.event}get onInfo(){return this.infoEvent.event}get onError(){return this.errorEvent.event}get onClose(){return this.closeEvent.event}get running(){return this._running}get screenWidth(){return this._screenWidth}get screenHeight(){return this._screenHeight}get onSizeChanged(){return this.sizeChangedEvent.event}get onVideoData(){return this.videoDataEvent.event}get onClipboardChange(){return this.clipboardChangeEvent.event}startCore(e,t){return(0,c.mG)(this,void 0,void 0,(function*(){let n;try{yield t.initialize(),n=yield this.device.childProcess.spawn(e,{shells:[_._n]}),n.onStdout(this.handleProcessOutput,this);const r=new D.h,i=n.onExit((()=>{r.reject(new Error("scrcpy server exited prematurely"))})),[o,s]=yield Promise.race([r.promise,t.getStreams()]);i(),this.process=n,this.process.onExit(this.handleProcessClosed,this),this.videoStream=o,this.controlStream=s,this._running=!0,this.receiveVideo(),this.receiveControl()}catch(r){throw yield null===n||void 0===n?void 0:n.kill(),r}finally{t.dispose()}}))}start(e){return this.options=e,this.startCore(e.formatServerArguments(),e.createConnection(this.device))}handleProcessOutput(e){const t=this.device.backend.decodeUtf8(e);for(const n of function*(e){const t=new X(e);let n;for(;n=t.next();)if(""!==n){if(n.startsWith("[server] ")){if(n=n.substring("[server] ".length),n.startsWith("DEBUG: ")){yield{level:F.Debug,message:n.substring("DEBUG: ".length)};continue}if(n.startsWith("INFO: ")){yield{level:F.Info,message:n.substring("INFO: ".length)};continue}if(n.startsWith("ERROR: ")){n=n.substring("ERROR: ".length);const e=n;let r;if(n.startsWith("Exception on thread")&&(n=t.next())){const[e,i]=n.split(": ",2),o=[];for(;(n=t.peek())&&n.startsWith("\t");)o.push(n.trim()),t.next();r={type:e,message:i,stackTrace:o}}yield{level:F.Error,message:e,error:r};continue}}yield{level:F.Info,message:n}}}(t))switch(n.level){case F.Debug:this.debugEvent.fire(n.message);break;case F.Info:this.infoEvent.fire(n.message);break;case F.Error:this.errorEvent.fire(n)}}handleProcessClosed(){this._running=!1,this.closeEvent.fire()}receiveVideo(){return(0,c.mG)(this,void 0,void 0,(function*(){if(!this.videoStream)throw new Error("receiveVideo started before initialization");try{yield this.videoStream.read(64);const{width:e,height:t}=yield q.deserialize(this.videoStream);let n;for(this._screenWidth=e,this._screenHeight=t;this._running;){const{pts:e,data:t}=yield Q.deserialize(this.videoStream);if(!t||0===t.byteLength)continue;if(e===J){const e=Z(t.slice(0)),{pic_width_in_mbs_minus1:r,pic_height_in_map_units_minus1:i,frame_mbs_only_flag:o,frame_crop_left_offset:s,frame_crop_right_offset:a,frame_crop_top_offset:c,frame_crop_bottom_offset:d}=e,l=16*(r+1),h=(i+1)*(2-o)*16,u=2*s,p=2*a,v=2*c,f=2*d,m=l-u-p,g=h-v-f;this._screenWidth=m,this._screenHeight=g,this.sizeChangedEvent.fire({sequenceParameterSet:e,width:l,height:h,cropLeft:u,cropRight:p,cropTop:v,cropBottom:f,croppedWidth:m,croppedHeight:g}),n=t;continue}let r;n?(r=new Uint8Array(n.byteLength+t.byteLength),r.set(new Uint8Array(n)),r.set(new Uint8Array(t),n.byteLength),n=void 0):r=new Uint8Array(t),yield this.videoDataEvent.fire({pts:e,size:r.byteLength,data:r.buffer})}}catch(e){if(!this._running)return}}))}receiveControl(){return(0,c.mG)(this,void 0,void 0,(function*(){if(!this.controlStream)throw new Error("receiveControl started before initialization");try{for(;;){const e=yield this.controlStream.read(1);switch(new Uint8Array(e)[0]){case 0:const{content:e}=yield ee.deserialize(this.controlStream);this.clipboardChangeEvent.fire(e);break;default:throw new Error("unknown control message type")}}}catch(e){if(!this._running)return}}))}injectKeyCode(e){return(0,c.mG)(this,void 0,void 0,(function*(){if(!this.controlStream)throw new Error("injectKeyCode called before initialization");yield this.controlStream.write(I.serialize(Object.assign(Object.assign({},e),{type:r.InjectKeycode}),this.backend))}))}injectText(e){return(0,c.mG)(this,void 0,void 0,(function*(){if(!this.controlStream)throw new Error("injectText called before initialization");yield this.controlStream.write(z.serialize({type:r.InjectText,text:e},this.backend))}))}injectTouch(e){return(0,c.mG)(this,void 0,void 0,(function*(){if(!this.controlStream)throw new Error("injectTouch called before initialization");if(!this.screenWidth||!this.screenHeight)return;if(this.sendingTouchMessage&&e.action===i.Move)return;this.sendingTouchMessage=!0;const t=j.serialize(Object.assign(Object.assign({},e),{type:r.InjectTouch,screenWidth:this.screenWidth,screenHeight:this.screenHeight}),this.backend);yield this.controlStream.write(t),this.sendingTouchMessage=!1}))}pressBackOrTurnOnScreen(e){return(0,c.mG)(this,void 0,void 0,(function*(){if(!this.controlStream)throw new Error("pressBackOrTurnOnScreen called before initialization");const t=this.options.createBackOrScreenOnEvent(e,this.device);t&&(yield this.controlStream.write(t))}))}close(){var e,t,n;return(0,c.mG)(this,void 0,void 0,(function*(){this._running&&(this._running=!1,null===(e=this.videoStream)||void 0===e||e.close(),null===(t=this.controlStream)||void 0===t||t.close(),yield null===(n=this.process)||void 0===n?void 0:n.kill())}))}}let ne,re=!1;const ie=[];let oe=0;const se=new k.vp;class ae extends k.Xn{constructor(e){super(),this.pictureReadyEvent=new k.vp,this.streamId=e,this.addDisposable(se.event(this.handlePictureReady,this))}get onPictureReady(){return this.pictureReadyEvent.event}handlePictureReady(e){e.renderStateId===this.streamId&&this.pictureReadyEvent.fire(e)}feed(e){ne.postMessage({type:"decode",data:e,offset:0,length:e.byteLength,renderStateId:this.streamId},[e])}dispose(){super.dispose(),ne.postMessage({type:"release",renderStateId:this.streamId})}}let ce;function de(){return ce||(ce=Promise.all([n.e(949).then(n.t.bind(n,7949,23)),n.e(299).then(n.t.bind(n,6272,23))]).then((([e,{default:t}])=>({YuvBuffer:e,YuvCanvas:t})))),ce}class le{constructor(){this.maxProfile=T.Baseline,this.maxLevel=U.Level4,de(),this._element=document.createElement("canvas")}get element(){return this._element}setSize(e){var t;return(0,c.mG)(this,void 0,void 0,(function*(){const{YuvBuffer:r,YuvCanvas:i}=yield de();this._yuvCanvas||(this._yuvCanvas=i.attach(this._element));const{width:o,height:s}=e,a=o/2,c=s/2;this._element.width=e.croppedWidth,this._element.height=e.croppedHeight;const d=r.format({width:o,height:s,chromaWidth:a,chromaHeight:c,cropLeft:e.cropLeft,cropTop:e.cropTop,cropWidth:e.croppedWidth,cropHeight:e.croppedHeight,displayWidth:e.croppedWidth,displayHeight:e.croppedHeight});null===(t=this._wrapperInitializePromise)||void 0===t||t.then((e=>e.dispose())),this._wrapperInitializePromise=function(){if(ne||(ne=new Worker(new URL(n.p+n.u(130),n.b),{type:void 0}),ne.addEventListener("message",(e=>{const{data:t}=e;switch(t.type){case"decoderReady":re=!0;for(const e of ie)e.resolve(new ae(oe)),oe+=1;ie.length=0;break;case"pictureReady":se.fire(t)}}))),!re){const e=new D.h;return ie.push(e),e.promise}const e=new ae(oe);return oe+=1,Promise.resolve(e)}();const l=yield this._wrapperInitializePromise,h=o*s,u=h+a*c;l.onPictureReady((({data:e})=>{const t=new Uint8Array(e),n=r.frame(d,r.lumaPlane(d,t,o,0),r.chromaPlane(d,t,a,h),r.chromaPlane(d,t,a,u));this._yuvCanvas.drawFrame(n)}))}))}feed(e){return(0,c.mG)(this,void 0,void 0,(function*(){if(!this._wrapperInitializePromise)throw new Error("Decoder not initialized");(yield this._wrapperInitializePromise).feed(e)}))}dispose(){var e;null===(e=this._wrapperInitializePromise)||void 0===e||e.then((e=>e.dispose()))}}function he(e){return e.toString(16).padStart(2,"0").toUpperCase()}class ue{constructor(){this.maxProfile=T.High,this.maxLevel=U.Level5,this._element=document.createElement("canvas"),this.context=this._element.getContext("2d"),this.decoder=new VideoDecoder({output:e=>{this.context.drawImage(e,0,0),e.close()},error(){}})}get element(){return this._element}setSize(e){const{sequenceParameterSet:{profile_idc:t,constraint_set:n,level_idc:r}}=e;this._element.width=e.croppedWidth,this._element.height=e.croppedHeight;const i=`avc1.${[t,n,r].map(he).join("")}`;this.decoder.configure({codec:i,optimizeForLatency:!0})}feed(e){this.decoder.decode(new EncodedVideoChunk({type:"key",timestamp:0,data:e}))}dispose(){this.decoder.close()}}var pe=n(6165),ve=n(6885),fe=n(2782),me=n(9346),ge=n(6929),we=n(3685);function ye(e,t,n,r,i,o,s){try{var a=e[o](s),c=a.value}catch(d){return void n(d)}a.done?t(c):Promise.resolve(c).then(r,i)}function be(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var o=e.apply(t,n);function s(e){ye(o,r,i,s,a,"next",e)}function a(e){ye(o,r,i,s,a,"throw",e)}s(void 0)}))}}function xe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Se(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Ee(e,t,n){return t&&Se(e.prototype,t),n&&Se(e,n),e}function Ce(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Pe(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=[],r=!0,i=!1,o=void 0;try{for(var s,a=e[Symbol.iterator]();!(r=(s=a.next()).done)&&(n.push(s.value),!t||n.length!==t);r=!0);}catch(c){i=!0,o=c}finally{try{r||null==a.return||a.return()}finally{if(i)throw o}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var ke,_e=new n.U(n(4439)).toString(),De="1.19",Le=function(){function e(t){xe(this,e),this._downloaded=0,this._total=0,this.progressEvent=new k.vp,this.promise=this.fetch(t)}return Ee(e,[{key:"downloaded",get:function(){return this._downloaded}},{key:"total",get:function(){return this._total}},{key:"onProgress",get:function(){return this.progressEvent.event}},{key:"fetch",value:function(e){return be(s().mark((function t(){var n,r,i,o,a,c,d,l,h,u,p,v,f;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,window.fetch(e);case 2:n=t.sent,this._total=Number.parseInt(null!==(r=n.headers.get("Content-Length"))&&void 0!==r?r:"0",10),this.progressEvent.fire([this._downloaded,this._total]),i=n.body.getReader(),o=[];case 8:return t.next=11,i.read();case 11:if(!(a=t.sent).done){t.next=14;break}return t.abrupt("break",19);case 14:o.push(a.value),this._downloaded+=a.value.byteLength,this.progressEvent.fire([this._downloaded,this._total]),t.next=8;break;case 19:for(this._total=o.reduce((function(e,t){return e+t.byteLength}),0),c=new Uint8Array(this._total),d=0,l=!0,h=!1,u=void 0,t.prev=23,p=o[Symbol.iterator]();!(l=(v=p.next()).done);l=!0)f=v.value,c.set(f,d),d+=f.byteLength;t.next=31;break;case 27:t.prev=27,t.t0=t.catch(23),h=!0,u=t.t0;case 31:t.prev=31,t.prev=32,l||null==p.return||p.return();case 34:if(t.prev=34,!h){t.next=37;break}throw u;case 37:return t.finish(34);case 38:return t.finish(31);case 39:return t.abrupt("return",c.buffer);case 40:case"end":return t.stop()}}),t,this,[[23,27,31,39],[32,,34,38]])})).bind(this))()}}]),e}();function je(e,t,n){return e<t?t:e>n?n:e}var ze=function(){function e(t,n,r,i){var o=void 0===r?0:r,s=void 0===i?0:i;xe(this,e),this.key=t,this.client=n,this.delay=o,this.interval=s}return Ee(e,[{key:"press",value:function(){var e=this;return be(s().mark((function t(){var n;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.client.injectKeyCode({action:R.Down,keyCode:this.key,repeat:0,metaState:0});case 2:if(0!==this.delay){t.next=4;break}return t.abrupt("return");case 4:n=setTimeout(be(s().mark((function t(){var n;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.client.injectKeyCode({action:R.Down,keyCode:e.key,repeat:1,metaState:0});case 2:if(0!==e.interval){t.next=4;break}return t.abrupt("return");case 4:n=setInterval(be(s().mark((function t(){return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.client.injectKeyCode({action:R.Down,keyCode:e.key,repeat:1,metaState:0});case 2:case"end":return t.stop()}}),t)}))),e.interval),e.onRelease=function(){return clearInterval(n)};case 6:case"end":return t.stop()}}),t)}))),this.delay),this.onRelease=function(){return clearTimeout(n)};case 6:case"end":return t.stop()}}),t,this)})).bind(this))()}},{key:"release",value:function(){return be(s().mark((function e(){var t,n;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return null===(n=(t=this).onRelease)||void 0===n||n.call(t),e.next=4,this.client.injectKeyCode({action:R.Up,keyCode:this.key,repeat:0,metaState:0});case 4:case"end":return e.stop()}}),e,this)})).bind(this))()}}]),e}(),Re=new(function(){function e(){var t=this;if(xe(this,e),this.running=!1,this.deviceView=null,this.rendererContainer=null,this.settingsVisible=!1,this.demoModeVisible=!1,this.width=0,this.height=0,this.encoders=[],this.decoders=[{name:"TinyH264 (Software)",factory:le}],this.selectedDecoder=this.decoders[0],this.resolution=1080,this.bitRate=4e6,this.tunnelForward=!1,this.connecting=!1,this.serverTotalSize=0,this.serverDownloadedSize=0,this.debouncedServerDownloadedSize=0,this.serverDownloadSpeed=0,this.serverUploadedSize=0,this.debouncedServerUploadedSize=0,this.serverUploadSpeed=0,this.start=be(s().mark((function e(){var t,n,r,i,o,a,c,d;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(ge.CO.device){e.next=2;break}return e.abrupt("return");case 2:if(e.prev=2,t=this,Re.selectedDecoder){e.next=6;break}throw new Error("No available decoder");case 6:return(0,pe.z)((function(){t.serverTotalSize=0,t.serverDownloadedSize=0,t.serverUploadedSize=0,t.connecting=!0})),e.next=9,s=(0,pe.aD)((function(e){var n=Pe(e,2),r=n[0],i=n[1];t.serverDownloadedSize=r,t.serverTotalSize=i})),ke||(ke=new Le(_e)).promise.catch((function(e){ke=void 0})),s&&(ke.onProgress(s),s([ke.downloaded,ke.total])),ke.promise;case 9:return n=e.sent,e.next=12,$(ge.CO.device,n,{onProgress:(0,pe.aD)((function(e){t.serverUploadedSize=e}))});case 12:return e.next=14,te.getEncoders(ge.CO.device,new V({version:De,logLevel:F.Debug,bitRate:4e6,tunnelForward:this.tunnelForward}));case 14:if(0!==(r=e.sent).length){e.next=17;break}throw new Error("No available encoder found");case 17:return(0,pe.z)((function(){t.encoders=r})),e.next=20,$(ge.CO.device,n);case 20:return i=this.selectedDecoder.factory,o=new i,(0,pe.z)((function(){t.decoder=o})),(a=new te(ge.CO.device)).onDebug((function(e){console.debug("[server] "+e)})),a.onInfo((function(e){console.log("[server] "+e)})),a.onError((function(e){var t=e.message;ge.CO.showErrorDialog(t)})),a.onClose(stop),a.onSizeChanged((0,pe.aD)((function(e){var n=e.croppedWidth,r=e.croppedHeight;t.width=n,t.height=r,o.setSize(e)}))),a.onVideoData((function(e){var t=e.data;o.feed(t)})),a.onClipboardChange((function(e){window.navigator.clipboard.writeText(e)})),e.next=34,a.start(new V({version:De,logLevel:F.Debug,maxSize:this.resolution,bitRate:this.bitRate,orientation:W.Unlocked,tunnelForward:this.tunnelForward,encoder:null!==(c=this.selectedEncoder)&&void 0!==c?c:r[0],profile:o.maxProfile,level:o.maxLevel}));case 34:(0,pe.z)((function(){t.client=a,t.running=!0})),e.next=40;break;case 37:e.prev=37,e.t0=e.catch(2),ge.CO.showErrorDialog(e.t0.message);case 40:return e.prev=40,d=this,(0,pe.z)((function(){d.connecting=!1})),e.finish(40);case 44:case"end":return e.stop()}var s}),e,this,[[2,37,40,44]])})).bind(this)).bind(this),this.handleBackPointerDown=function(e){0===e.button&&(e.currentTarget.setPointerCapture(e.pointerId),t.client.pressBackOrTurnOnScreen(R.Down))},this.handleBackPointerUp=function(e){0===e.button&&t.client.pressBackOrTurnOnScreen(R.Up)},this.handleHomePointerDown=function(e){var n;0===e.button&&(e.currentTarget.setPointerCapture(e.pointerId),null===(n=t.homeKeyRepeater)||void 0===n||n.press())},this.handleHomePointerUp=function(e){var n;0===e.button&&(null===(n=t.homeKeyRepeater)||void 0===n||n.release())},this.handleAppSwitchPointerDown=function(e){var n;0===e.button&&(e.currentTarget.setPointerCapture(e.pointerId),null===(n=t.appSwitchKeyRepeater)||void 0===n||n.press())},this.handleAppSwitchPointerUp=function(e){var n;0===e.button&&(null===(n=t.appSwitchKeyRepeater)||void 0===n||n.release())},this.injectTouch=function(e,n){if(t.client){var r=t.rendererContainer.getBoundingClientRect(),i=n.clientX-r.x,o=n.clientY-r.y,s=je(i/r.width,0,1)*t.width,a=je(o/r.height,0,1)*t.height;t.client.injectTouch({action:e,pointerId:BigInt(n.pointerId),pointerX:s,pointerY:a,pressure:65535*n.pressure,buttons:0})}},this.handlePointerDown=function(e){0===e.button&&(t.rendererContainer.focus(),e.currentTarget.setPointerCapture(e.pointerId),t.injectTouch(i.Down,e))},this.handlePointerMove=function(e){1===e.buttons&&t.injectTouch(i.Move,e)},this.handlePointerUp=function(e){0===e.button&&(e.currentTarget.releasePointerCapture(e.pointerId),t.injectTouch(i.Up,e))},this.handleKeyDown=be(s().mark((function e(t){var n,r,i;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.client){e.next=2;break}return e.abrupt("return");case 2:if(n=t.key,r=t.code,!n.match(/^[a-z0-9]$/i)){e.next=6;break}return this.client.injectText(n),e.abrupt("return");case 6:if(!(i={Backspace:O.Delete,Space:O.Space}[r])){e.next=12;break}return e.next=10,this.client.injectKeyCode({action:R.Down,keyCode:i,metaState:0,repeat:0});case 10:return e.next=12,this.client.injectKeyCode({action:R.Up,keyCode:i,metaState:0,repeat:0});case 12:case"end":return e.stop()}}),e,this)})).bind(this)).bind(this),(0,pe.ky)(this,{decoders:pe.LO.shallow,selectedDecoder:pe.LO.ref,start:!1,stop:pe.aD.bound,handleDeviceViewRef:pe.aD.bound,handleRendererContainerRef:pe.aD.bound,handleBackPointerDown:!1,handleBackPointerUp:!1,handleHomePointerDown:!1,handleHomePointerUp:!1,handleAppSwitchPointerDown:!1,handleAppSwitchPointerUp:!1,handleCurrentEncoderChange:pe.aD.bound,handleSelectedDecoderChange:pe.aD.bound,handleResolutionChange:pe.aD.bound,handleTunnelForwardChange:pe.aD.bound,handleBitRateChange:pe.aD.bound,injectTouch:!1,handlePointerDown:!1,handlePointerMove:!1,handlePointerUp:!1,handleKeyDown:!1,homeKeyRepeater:!1,appSwitchKeyRepeater:!1}),(0,pe.EH)((function(){if(ge.CO.device){var e=t;(0,pe.z)((function(){e.encoders=[],e.selectedEncoder=void 0}))}else t.stop()})),(0,pe.EH)((function(){if(t.rendererContainer&&t.decoder){for(;t.rendererContainer.firstChild;)t.rendererContainer.firstChild.remove();t.rendererContainer.appendChild(t.decoder.element)}})),(0,pe.EH)((function(){t.client?(t.homeKeyRepeater=new ze(O.Home,t.client),t.appSwitchKeyRepeater=new ze(O.AppSwitch,t.client)):(t.homeKeyRepeater=void 0,t.appSwitchKeyRepeater=void 0)})),"function"===typeof window.VideoDecoder){var n=this;setTimeout((0,pe.aD)((function(){n.decoders.unshift({name:"WebCodecs",factory:ue}),n.selectedDecoder=n.decoders[0]})),0)}}return Ee(e,[{key:"commandBarItems",get:function(){var e=this,t=[];return this.running?t.push({key:"stop",iconProps:{iconName:"Stop"},text:"Stop",onClick:this.stop}):t.push({key:"start",disabled:!ge.CO.device,iconProps:{iconName:"Play"},text:"Start",onClick:this.start}),t.push({key:"fullscreen",disabled:!this.running,iconProps:{iconName:"Fullscreen"},text:"Fullscreen",onClick:function(){var t;null===(t=e.deviceView)||void 0===t||t.enterFullscreen()}}),t}},{key:"commandBarFarItems",get:function(){var e=this;return[{key:"Settings",iconProps:{iconName:"Settings"},checked:this.settingsVisible,text:"Settings",onClick:(0,pe.aD)((function(){e.settingsVisible=!e.settingsVisible}))},{key:"DemoMode",iconProps:{iconName:"Personalize"},checked:this.demoModeVisible,text:"Demo Mode Settings",onClick:(0,pe.aD)((function(){e.demoModeVisible=!e.demoModeVisible}))},{key:"info",iconProps:{iconName:"Info"},iconOnly:!0,tooltipHostProps:{content:(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("p",{children:[(0,a.jsx)(me.dL,{href:"https://github.com/Genymobile/scrcpy",spaceAfter:!0,children:"Scrcpy"}),"developed by Genymobile can display the screen with low latency (1~2 frames) and control the device, all without root access."]}),(0,a.jsx)("p",{children:"This is a TypeScript implementation of the client part. Paired with official pre-built server binary."})]}),calloutProps:{calloutMaxWidth:300}}}]}},{key:"stop",value:function(){var e,t;null===(e=this.decoder)||void 0===e||e.dispose(),this.decoder=void 0,null===(t=this.client)||void 0===t||t.close(),this.client=void 0,this.running=!1}},{key:"handleDeviceViewRef",value:function(e){this.deviceView=e}},{key:"handleRendererContainerRef",value:function(e){this.rendererContainer=e}},{key:"handleCurrentEncoderChange",value:function(e,t){t&&(this.selectedEncoder=t.text)}},{key:"handleSelectedDecoderChange",value:function(e,t){t&&(this.selectedDecoder=t.data)}},{key:"handleResolutionChange",value:function(e,t){void 0!==t&&(this.resolution=+t)}},{key:"handleBitRateChange",value:function(e,t){void 0!==t&&(this.bitRate=+t)}},{key:"handleTunnelForwardChange",value:function(e,t){void 0!==t&&(this.tunnelForward=t)}}]),e}()),Oe=(0,ve.Pi)((function(){var e=(0,P.M)("layerHost"),t=(0,d.useState)(!1),n=t[0],r=t[1];return(0,d.useEffect)((function(){r(!0)}),[]),n?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(u,{id:e,style:{position:"absolute",top:0,bottom:0,left:0,right:0,margin:0,pointerEvents:"none"}}),(0,a.jsx)(v.V,{hidden:!Re.connecting,modalProps:{layerProps:{hostId:e}},dialogContentProps:{title:"Connecting..."},children:(0,a.jsxs)(f.K,{tokens:we.WT,children:[(0,a.jsx)(m.Y,{label:"1. Downloading scrcpy server...",percentComplete:Re.serverTotalSize?Re.serverDownloadedSize/Re.serverTotalSize:void 0,description:(0,we.CY)(Re.debouncedServerDownloadedSize,Re.serverTotalSize,Re.serverDownloadSpeed)}),(0,a.jsx)(m.Y,{label:"2. Pushing scrcpy server to device...",progressHidden:0===Re.serverTotalSize||Re.serverDownloadedSize!==Re.serverTotalSize,percentComplete:Re.serverUploadedSize/Re.serverTotalSize,description:(0,we.CY)(Re.debouncedServerUploadedSize,Re.serverTotalSize,Re.serverUploadSpeed)}),(0,a.jsx)(m.Y,{label:"3. Starting scrcpy server on device...",progressHidden:0===Re.serverTotalSize||Re.serverUploadedSize!==Re.serverTotalSize})]})})]}):null})),Ie=(0,ve.Pi)((function(){var e=(0,a.jsx)(f.K,{verticalFill:!0,horizontalAlign:"center",style:{background:"#999"},children:(0,a.jsxs)(f.K,{verticalFill:!0,horizontal:!0,style:{width:"100%",maxWidth:300},horizontalAlign:"space-evenly",verticalAlign:"center",children:[(0,a.jsx)(g.h,{iconProps:{iconName:"Play"},style:{transform:"rotate(180deg)",color:"white"},onPointerDown:Re.handleBackPointerDown,onPointerUp:Re.handleBackPointerUp}),(0,a.jsx)(g.h,{iconProps:{iconName:"LocationCircle"},style:{color:"white"},onPointerDown:Re.handleHomePointerDown,onPointerUp:Re.handleHomePointerUp}),(0,a.jsx)(g.h,{iconProps:{iconName:"Stop"},style:{color:"white"},onPointerDown:Re.handleAppSwitchPointerDown,onPointerUp:Re.handleAppSwitchPointerUp})]})});return(0,a.jsxs)(f.K,function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){Ce(e,t,n[t])}))}return e}({},we.LE,{children:[(0,a.jsx)(fe.default,{children:(0,a.jsx)("title",{children:"Scrcpy - WebADB"})}),(0,a.jsx)(w.X,{items:Re.commandBarItems,farItems:Re.commandBarFarItems}),(0,a.jsxs)(f.K,{horizontal:!0,grow:!0,styles:{root:{height:0}},children:[(0,a.jsx)(me.wM,{ref:Re.handleDeviceViewRef,width:Re.width,height:Re.height,bottomElement:e,bottomHeight:40,children:(0,a.jsx)("div",{ref:Re.handleRendererContainerRef,tabIndex:-1,onPointerDown:Re.handlePointerDown,onPointerMove:Re.handlePointerMove,onPointerUp:Re.handlePointerUp,onPointerCancel:Re.handlePointerUp,onKeyDown:Re.handleKeyDown})}),(0,a.jsxs)("div",{style:{padding:12,overflow:"hidden auto",display:Re.settingsVisible?"block":"none",width:300},children:[(0,a.jsx)("div",{children:"Changes will take effect on next connection"}),(0,a.jsx)(y.L,{label:"Encoder",options:Re.encoders.map((function(e){return{key:e,text:e}})),selectedKey:Re.selectedEncoder,placeholder:"Connect once to retrieve encoder list",onChange:Re.handleCurrentEncoderChange}),Re.decoders.length>1&&(0,a.jsx)(y.L,{label:"Decoder",options:Re.decoders.map((function(e){return{key:e.name,text:e.name,data:e}})),selectedKey:Re.selectedDecoder.name,onChange:Re.handleSelectedDecoderChange}),(0,a.jsx)(b.k,{label:"Max Resolution (longer side, 0 = unlimited)",labelPosition:x.L.top,value:Re.resolution.toString(),min:0,max:2560,step:100,onChange:Re.handleResolutionChange}),(0,a.jsx)(b.k,{label:"Max Bit Rate",labelPosition:x.L.top,value:Re.bitRate.toString(),min:100,max:1e7,step:100,onChange:Re.handleBitRateChange}),(0,a.jsx)(S.Z,{label:(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("span",{children:["Use forward connection"," "]}),(0,a.jsx)(E.G,{content:"Old Android devices may not support reverse connection when using ADB over WiFi",children:(0,a.jsx)(C.J,{iconName:"Info"})})]}),checked:Re.tunnelForward,onChange:Re.handleTunnelForwardChange})]}),(0,a.jsx)(me.Uv,{style:{display:Re.demoModeVisible?"block":"none"}}),(0,a.jsx)(Oe,{})]})]}))}))},2782:function(e,t,n){e.exports=n(6906)},4439:function(e,t,n){"use strict";e.exports=n.p+"static/chunks/scrcpy-server.90ed0ba4964d045b"}},function(e){e.O(0,[888,179],(function(){return t=197,e(e.s=t);var t}));var t=e.O();_N_E=t}]);
//# sourceMappingURL=scrcpy-94cf203376af8125.js.map