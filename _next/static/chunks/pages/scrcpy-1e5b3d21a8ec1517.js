(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[533],{8640:function(e,t,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/scrcpy",function(){return r(6710)}])},6710:function(e,t,r){"use strict";let i,n,o;r.r(t),r.d(t,{default:function(){return tN}});var a,s,l,c,d,u,h,p,g,v,m,w,y,f,b,S,x,P,k,D,C,z,M=r(4471),L=r(9001),E=r(7703),V=r(4792),T=r(3242),j=r(4373),I=r(6261);function O(e){return e.toString(16).padStart(2,"0").toUpperCase()}class N{maxProfile=void 0;maxLevel=void 0;_writable;get writable(){return this._writable}_renderer;get renderer(){return this._renderer}_frameRendered=0;get frameRendered(){return this._frameRendered}context;decoder;lastFrame;animationFrame=0;constructor(){this._renderer=document.createElement("canvas"),this.context=this._renderer.getContext("2d"),this.decoder=new VideoDecoder({output:e=>{this.lastFrame&&this.lastFrame.close(),this.lastFrame=e,this.animationFrame||this.render()},error(e){}}),this._writable=new I.Vj({write:e=>{switch(e.type){case"configuration":this.configure(e.data);break;case"frame":this.decoder.decode(new EncodedVideoChunk({type:!1===e.keyframe?"delta":"key",timestamp:0,data:e.data}))}}})}render=()=>{this.lastFrame&&(this._frameRendered+=1,this.context.drawImage(this.lastFrame,0,0),this.lastFrame.close(),this.lastFrame=void 0),this.animationFrame=requestAnimationFrame(this.render)};configure(e){let{profileIndex:t,constraintSet:r,levelIndex:i}=e;this._renderer.width=e.croppedWidth,this._renderer.height=e.croppedHeight;let n=`avc1.${[t,r,i].map(O).join("")}`;this.decoder.configure({codec:n,optimizeForLatency:!0})}dispose(){cancelAnimationFrame(this.animationFrame),this.decoder.close()}}var _=r(6323),R=r(6779),U=r(6609),H=r.n(U),F=r(3370),A=r(6745),B=r(1891),W=r(5201),G=r(6789);class K{adb;options;constructor(e,t){this.adb=e,this.options=t}initialize(){}dispose(){}}class J extends K{connect(){return this.adb.createSocket("localabstract:scrcpy")}async connectAndRetry(){for(let e=0;e<100;e+=1)try{return await this.connect()}catch(t){await (0,G.gw)(100)}throw Error("Can't connect to server after 100 retries")}async connectVideoStream(){let{readable:e}=await this.connectAndRetry();if(this.options.sendDummyByte){let t=e.getReader(),{done:r,value:i}=await t.read();if(r||1!==i.byteLength||0!==i[0])throw Error("Unexpected response from server");t.releaseLock()}return e}async getStreams(){let e;let t=await this.connectVideoStream();if(this.options.control&&(e=await this.connectAndRetry()),this.options.sendDeviceMeta){let r=t.getReader(),{done:i,value:n}=await r.read();if(i||68!==n.byteLength)throw Error("Unexpected response from server");r.releaseLock()}return[t,e]}}class Y extends K{streams;address;async initialize(){await this.adb.reverse.remove("localabstract:scrcpy").catch(e=>{});let e=new I.GJ;this.streams=e.readable.getReader();let t=e.writable.getWriter();this.address=await this.adb.reverse.add("localabstract:scrcpy","tcp:27183",e=>(t.write(e),!0))}async accept(){return(await this.streams.read()).value}async getStreams(){let e;let{readable:t}=await this.accept();if(this.options.control&&(e=await this.accept()),this.options.sendDeviceMeta){let r=t.getReader(),{done:i,value:n}=await r.read();if(i||68!==n.byteLength)throw Error("Unexpected response from server");r.releaseLock()}return[t,e]}dispose(){this.adb.reverse.remove(this.address).catch(e=>{})}}class X{raw;get value(){return this.raw.value}set value(e){this.raw.value=e}constructor(e){this.raw=e}getDefaultValue(){return this.raw.getDefaultValue()}formatServerArguments(){return this.raw.formatServerArguments()}getOutputEncoderNameRegex(){return this.raw.getOutputEncoderNameRegex()}createVideoStreamTransformer(){return this.raw.createVideoStreamTransformer()}getControlMessageTypes(){return this.raw.getControlMessageTypes()}serializeBackOrScreenOnControlMessage(e){return this.raw.serializeBackOrScreenOnControlMessage(e)}getScrollController(){return this.raw.getScrollController()}}class Z extends X{createConnection(e){let t={control:!0,sendDummyByte:!0,sendDeviceMeta:!0};return this.value.tunnelForward?new J(e,t):new Y(e,t)}}class $ extends Z{createConnection(e){let t={...this.getDefaultValue(),...this.value};return this.value.tunnelForward?new J(e,t):new Y(e,t)}}var q=r(7417),Q=r(9229);function ee(e,t,r){return e<t?t:e>r?r:e}(a=w=w||(w={}))[a.InjectKeyCode=0]="InjectKeyCode",a[a.InjectText=1]="InjectText",a[a.InjectTouch=2]="InjectTouch",a[a.InjectScroll=3]="InjectScroll",a[a.BackOrScreenOn=4]="BackOrScreenOn",a[a.ExpandNotificationPanel=5]="ExpandNotificationPanel",a[a.ExpandSettingPanel=6]="ExpandSettingPanel",a[a.CollapseNotificationPanel=7]="CollapseNotificationPanel",a[a.GetClipboard=8]="GetClipboard",a[a.SetClipboard=9]="SetClipboard",a[a.SetScreenPowerMode=10]="SetScreenPowerMode",a[a.RotateDevice=11]="RotateDevice",(s=y=y||(y={}))[s.Down=0]="Down",s[s.Up=1]="Up",s[s.Move=2]="Move",s[s.Cancel=3]="Cancel",s[s.Outside=4]="Outside",s[s.PointerDown=5]="PointerDown",s[s.PointerUp=6]="PointerUp",s[s.HoverMove=7]="HoverMove",s[s.Scroll=8]="Scroll",s[s.HoverEnter=9]="HoverEnter",s[s.HoverExit=10]="HoverExit",s[s.ButtonPress=11]="ButtonPress",s[s.ButtonRelease=12]="ButtonRelease",(l=f=f||(f={})).Mouse=BigInt(-1),l.Finger=BigInt(-2),l.VirtualMouse=BigInt(-3),l.VirtualFinger=BigInt(-4);let et=new Q.Pl({size:2,signed:!1,deserialize(e,t){let r=Q.ek.Uint16.deserialize(e,t);return r/65535},serialize(e,t,r,i){r=65535*ee(r,0,1),Q.ek.Uint16.serialize(e,t,r,i)}}),er=new Q.ZP().uint8("type",w.InjectTouch).uint8("action",(0,Q.W$)()).uint64("pointerId").uint32("pointerX").uint32("pointerY").uint16("screenWidth").uint16("screenHeight").field("pressure",et).uint32("buttons");class ei{lastHoverMessage;process(e){let t=[];return this.lastHoverMessage&&this.lastHoverMessage.pointerId!==e.pointerId&&(t.push({...this.lastHoverMessage,action:y.Up}),this.lastHoverMessage=void 0),e.action===y.HoverMove&&(this.lastHoverMessage=e),e.type=w.InjectTouch,t.push(e),t}}(c=b=b||(b={}))[c.Down=0]="Down",c[c.Up=1]="Up",(d=S=S||(S={}))[d.Home=3]="Home",d[d.Back=4]="Back",d[d.DPadUp=19]="DPadUp",d[d.DPadDown=20]="DPadDown",d[d.DPadLeft=21]="DPadLeft",d[d.DPadRight=22]="DPadRight",d[d.VolumeUp=24]="VolumeUp",d[d.VolumeDown=25]="VolumeDown",d[d.A=29]="A",d[d.B=30]="B",d[d.C=31]="C",d[d.D=32]="D",d[d.E=33]="E",d[d.F=34]="F",d[d.G=35]="G",d[d.H=36]="H",d[d.I=37]="I",d[d.J=38]="J",d[d.K=39]="K",d[d.L=40]="L",d[d.M=41]="M",d[d.N=42]="N",d[d.O=43]="O",d[d.P=44]="P",d[d.Q=45]="Q",d[d.R=46]="R",d[d.S=47]="S",d[d.T=48]="T",d[d.U=49]="U",d[d.V=50]="V",d[d.W=51]="W",d[d.X=52]="X",d[d.Y=53]="Y",d[d.Z=54]="Z",d[d.Tab=61]="Tab",d[d.Space=62]="Space",d[d.Enter=66]="Enter",d[d.Delete=67]="Delete",d[d.Escape=111]="Escape",d[d.ForwardDelete=112]="ForwardDelete",d[d.MoveHome=122]="MoveHome",d[d.MoveEnd=123]="MoveEnd",d[d.VolumeMute=164]="VolumeMute",d[d.AppSwitch=187]="AppSwitch";let en=new Q.ZP().uint8("type",w.InjectKeyCode).uint8("action",(0,Q.W$)()).uint32("keyCode").uint32("repeat").uint32("metaState"),eo=new Q.ZP().uint8("type",w.InjectText).uint32("length").string("text",{lengthField:"length"}),ea=new Q.ZP().uint8("type",w.RotateDevice);(u=x=x||(x={}))[u.Off=0]="Off",u[u.Normal=2]="Normal";let es=new Q.ZP().uint8("type",w.SetScreenPowerMode).uint8("mode",(0,Q.W$)());class el{options;types;writer;scrollController;constructor(e,t){this.writer=e.getWriter(),this.options=t,this.types=t.getControlMessageTypes(),this.scrollController=t.getScrollController()}getTypeValue(e){let t=this.types.indexOf(e);if(-1===t)throw Error("Not supported");return t}injectKeyCode(e){return this.writer.write(en.serialize({...e,type:this.getTypeValue(w.InjectKeyCode)}))}injectText(e){return this.writer.write(eo.serialize({text:e,type:this.getTypeValue(w.InjectText)}))}injectTouch(e){return this.writer.write(er.serialize({...e,type:this.getTypeValue(w.InjectTouch)}))}injectScroll(e){e.type=this.getTypeValue(w.InjectScroll);let t=this.scrollController.serializeScrollMessage(e);if(t)return this.writer.write(t)}async backOrScreenOn(e){let t=this.options.serializeBackOrScreenOnControlMessage({action:e,type:this.getTypeValue(w.BackOrScreenOn)});if(t)return await this.writer.write(t)}setScreenPowerMode(e){return this.writer.write(es.serialize({mode:e,type:this.getTypeValue(w.SetScreenPowerMode)}))}rotateDevice(){return this.writer.write(ea.serialize({type:this.getTypeValue(w.RotateDevice)}))}close(){return this.writer.close()}}(h=P=P||(P={}))[h.Clipboard=0]="Clipboard",h[h.AckClipboard=1]="AckClipboard";let ec=new Q.ZP().uint32("length").string("content",{lengthField:"length"}).extra({type:P.Clipboard});class ed extends I.pC{constructor(){super(async e=>{let t=await e.read(1);if(0===t[0])return await ec.deserialize(e);throw Error("unknown control message type")})}}let eu={repeatPreviousFrameAfter:"long",maxPtsGapToEncoder:"long"};class eh{value;constructor(e){this.value=e}toOptionValue(){let e=Object.entries(this.value).filter(([,e])=>void 0!==e);if(0!==e.length)return e.map(([e,t])=>{let r=eu[e];return`${e.replace(/([A-Z])/g,"-$1").toLowerCase()}${r?`:${r}`:""}=${t}`}).join(",")}}class ep{buffer;bytePosition=0;bitPosition=0;constructor(e){this.buffer=e}read(e){let t=0;for(let r=0;r<e;r+=1)t=t<<1|this.next();return t}next(){let e=this.buffer[this.bytePosition]>>7-this.bitPosition&1;return this.bitPosition+=1,8===this.bitPosition&&(this.bytePosition+=1,this.bitPosition=0),e}decodeExponentialGolombNumber(){let e=0;for(;0===this.next();)e+=1;return 0===e?0:(1<<e|this.read(e))-1}}function*eg(e){let t=-1,r=0,i=!1;for(let n=0;n<e.length;n+=1){let o=e[n];if(i){if(o>3)throw Error("Invalid data");i=!1;continue}if(0===o){r+=1;continue}let a=r;if(r=0,-1===t){if(a>=2&&1===o){t=n+1;continue}throw Error("Invalid data")}if(!(a<2)){if(1===o){yield e.subarray(t,n-a),t=n+1;continue}if(a>2)throw Error("Invalid data");switch(o){case 2:throw Error("Invalid data");case 3:i=!0}}}if(i)throw Error("Invalid data");yield e.subarray(t,e.length)}let ev="/data/local/tmp/scrcpy-server.jar";function em(e,t){var r;return"object"==typeof(r=e)&&null!==r&&"toOptionValue"in r&&"function"==typeof r.toOptionValue&&(e=e.toOptionValue()),void 0===e?t:String(e)}let ew=new Q.ZP().uint8("type",w.InjectScroll).uint32("pointerX").uint32("pointerY").uint16("screenWidth").uint16("screenHeight").int32("scrollX").int32("scrollY");class ey{accumulatedX=0;accumulatedY=0;processMessage(e){this.accumulatedX+=e.scrollX,this.accumulatedY+=e.scrollY;let t=0,r=0;if(this.accumulatedX>=1?(t=1,this.accumulatedX=0):this.accumulatedX<=-1&&(t=-1,this.accumulatedX=0),this.accumulatedY>=1?(r=1,this.accumulatedY=0):this.accumulatedY<=-1&&(r=-1,this.accumulatedY=0),0!==t||0!==r)return e.scrollX=t,e.scrollY=r,e}serializeScrollMessage(e){let t=this.processMessage(e);if(t)return ew.serialize(t)}}(p=k=k||(k={})).Verbose="verbose",p.Debug="debug",p.Info="info",p.Warn="warn",p.Error="error",(g=D=D||(D={}))[g.Initial=-2]="Initial",g[g.Unlocked=-1]="Unlocked",g[g.Portrait=0]="Portrait",g[g.Landscape=1]="Landscape",g[g.PortraitFlipped=2]="PortraitFlipped",g[g.LandscapeFlipped=3]="LandscapeFlipped";let ef=new Q.ZP().uint64("pts").uint32("size").uint8Array("data",{lengthField:"size"}),eb=BigInt(1)<<BigInt(63),eS=new Q.ZP().uint8("type",w.BackOrScreenOn);class ex{value;constructor(e){new.target===ex&&e.logLevel===k.Verbose&&(e.logLevel=k.Debug),new.target===ex&&e.lockVideoOrientation===D.Initial&&(e.lockVideoOrientation=D.Unlocked),this.value=e}getArgumentOrder(){return["logLevel","maxSize","bitRate","maxFps","lockVideoOrientation","tunnelForward","crop","sendFrameMeta","control","displayId","showTouches","stayAwake","codecOptions","encoderName"]}getDefaultValue(){return{logLevel:k.Debug,maxSize:0,bitRate:8e6,maxFps:0,lockVideoOrientation:D.Unlocked,tunnelForward:!1,crop:"-",sendFrameMeta:!0,control:!0,displayId:0,showTouches:!1,stayAwake:!1,codecOptions:new eh({}),encoderName:"-"}}formatServerArguments(){let e=this.getDefaultValue();return this.getArgumentOrder().map(t=>em(this.value[t]||e[t],"-"))}getOutputEncoderNameRegex(){return/\s+scrcpy --encoder-name '(.*?)'/}createVideoStreamTransformer(){let e;if(!1===this.value.sendFrameMeta)return new I.GJ({transform(e,t){t.enqueue({type:"frame",data:e})}});let t=new I.gL(ef);return{writable:t.writable,readable:t.readable.pipeThrough(new I.GJ({transform(t,r){let i;if(t.pts===eb){let{sequenceParameterSet:n,pictureParameterSet:o}=function(e){let t,r;for(let i of eg(e)){let n=31&i[0];switch(n){case 7:if(t=i,r)return{sequenceParameterSet:t,pictureParameterSet:r};break;case 8:if(r=i,t)return{sequenceParameterSet:t,pictureParameterSet:r}}}throw Error("Invalid data")}(t.data),{profile_idc:a,constraint_set:s,level_idc:l,pic_width_in_mbs_minus1:c,pic_height_in_map_units_minus1:d,frame_mbs_only_flag:u,frame_crop_left_offset:h,frame_crop_right_offset:p,frame_crop_top_offset:g,frame_crop_bottom_offset:v}=function(e){let t,r,i,n;let o=new ep(e);if(0!==o.next())throw Error("Invalid data");let a=o.read(2),s=o.read(5);if(7!==s||0===a)throw Error("Invalid data");let l=o.read(8),c=o.read(8),d=new ep(new Uint8Array([c])),u=!!d.next(),h=!!d.next(),p=!!d.next(),g=!!d.next(),v=!!d.next(),m=!!d.next();if(0!==d.read(2))throw Error("Invalid data");let w=o.read(8),y=o.decodeExponentialGolombNumber();if(100===l||110===l||122===l||244===l||44===l||83===l||86===l||118===l||128===l||138===l||139===l||134===l){let f=o.decodeExponentialGolombNumber();3===f&&o.next(),o.decodeExponentialGolombNumber(),o.decodeExponentialGolombNumber(),o.next();let b=!!o.next();if(b){let S=[];for(let x=0;x<(3!==f?8:12);x+=1)S[x]=!!o.next(),S[x]}}o.decodeExponentialGolombNumber();let P=o.decodeExponentialGolombNumber();if(0===P)o.decodeExponentialGolombNumber();else if(1===P){o.next(),o.decodeExponentialGolombNumber(),o.decodeExponentialGolombNumber();let k=o.decodeExponentialGolombNumber(),D=[];for(let C=0;C<k;C+=1)D[C]=o.decodeExponentialGolombNumber()}o.decodeExponentialGolombNumber(),o.next();let z=o.decodeExponentialGolombNumber(),M=o.decodeExponentialGolombNumber(),L=o.next();L||o.next(),o.next();let E=!!o.next();return E?(t=o.decodeExponentialGolombNumber(),r=o.decodeExponentialGolombNumber(),i=o.decodeExponentialGolombNumber(),n=o.decodeExponentialGolombNumber()):(t=0,r=0,i=0,n=0),o.next(),{profile_idc:l,constraint_set:c,constraint_set0_flag:u,constraint_set1_flag:h,constraint_set2_flag:p,constraint_set3_flag:g,constraint_set4_flag:v,constraint_set5_flag:m,level_idc:w,seq_parameter_set_id:y,pic_width_in_mbs_minus1:z,pic_height_in_map_units_minus1:M,frame_mbs_only_flag:L,frame_cropping_flag:E,frame_crop_left_offset:t,frame_crop_right_offset:r,frame_crop_top_offset:i,frame_crop_bottom_offset:n}}(function(e){let t;let r=0,i=0,n=!1;for(let o=0;o<e.length;o+=1){let a=e[o];if(t&&(t[r]=a,r+=1),n){if(a>3)throw Error("Invalid data");n=!1;continue}if(0===a){i+=1;continue}let s=i;if(i=0,!(s<2)){if(1===a||s>2)throw Error("Invalid data");switch(a){case 2:throw Error("Invalid data");case 3:n=!0,t?r-=1:((t=new Uint8Array(e.length-1)).set(e.subarray(0,o-s)),r=o-s+1)}}}return t?.subarray(0,r)??e}(n)),m=(c+1)*16,w=(d+1)*(2-u)*16,y=2*h,f=2*p,b=2*g,S=2*v;e=t.data,r.enqueue({type:"configuration",pictureParameterSet:o,sequenceParameterSet:n,data:{profileIndex:a,constraintSet:s,levelIndex:l,encodedWidth:m,encodedHeight:w,cropLeft:y,cropRight:f,cropTop:b,cropBottom:S,croppedWidth:m-y-f,croppedHeight:w-b-S}});return}e?((i=new Uint8Array(e.byteLength+t.data.byteLength)).set(e),i.set(t.data,e.byteLength),e=void 0):i=t.data,r.enqueue({type:"frame",pts:t.pts,data:i})}}))}}getControlMessageTypes(){return[w.InjectKeyCode,w.InjectText,w.InjectTouch,w.InjectScroll,w.BackOrScreenOn,w.ExpandNotificationPanel,w.CollapseNotificationPanel,w.GetClipboard,w.SetClipboard,w.SetScreenPowerMode,w.RotateDevice]}serializeBackOrScreenOnControlMessage(e){if(e.action===b.Down)return eS.serialize(e)}getScrollController(){return new ey}}let eP=new Q.ZP().fields(eS).uint8("action",(0,Q.W$)());class ek extends ex{constructor(e){super(e)}getArgumentOrder(){return super.getArgumentOrder().concat(["powerOffOnClose"])}getDefaultValue(){return{...super.getDefaultValue(),powerOffOnClose:!1}}getOutputEncoderNameRegex(){return/\s+scrcpy --encoder '(.*?)'/}getControlMessageTypes(){let e=super.getControlMessageTypes();return e.splice(6,0,w.ExpandSettingPanel),e}serializeBackOrScreenOnControlMessage(e){return eP.serialize(e)}}class eD extends ek{constructor(e){super(e)}getDefaultValue(){return{...super.getDefaultValue(),clipboardAutosync:!0}}formatServerArguments(){return Object.entries(this.value).map(([e,t])=>[e,em(t,void 0)]).filter(e=>void 0!==e[1]).map(([e,t])=>`${e.replace(/([A-Z])/g,"_$1").toLowerCase()}=${t}`)}}let eC=new Q.ZP().fields(ew).int32("buttons");class ez extends ey{serializeScrollMessage(e){let t=this.processMessage(e);if(t)return eC.serialize(t)}}class eM extends eD{constructor(e){e.rawVideoStream&&(e.sendDeviceMeta=!1,e.sendFrameMeta=!1,e.sendDummyByte=!1),super(e)}getDefaultValue(){return{...super.getDefaultValue(),downsizeOnError:!0,sendDeviceMeta:!0,sendDummyByte:!0,rawVideoStream:!1}}getScrollController(){return new ez}}let eL=BigInt(1)<<BigInt(62);class eE extends eM{constructor(e){super(e)}getDefaultValue(){return{...super.getDefaultValue(),cleanup:!0}}createVideoStreamTransformer(){let e=super.createVideoStreamTransformer();return{writable:e.writable,readable:e.readable.pipeThrough(new I.GJ({transform(e,t){if("frame"!==e.type){t.enqueue(e);return}void 0!==e.pts&&e.pts&eL&&(e.keyframe=!0,e.pts&=~eL),t.enqueue(e)}}))}}}class eV extends eE{constructor(e){super(e)}getDefaultValue(){return{...super.getDefaultValue(),powerOn:!0}}}let eT=new Q.Pl({size:2,signed:!0,deserialize(e,t){let r=Q.ek.Int16.deserialize(e,t);return r/32767},serialize(e,t,r,i){r=32767*ee(r,-1,1),Q.ek.Int16.serialize(e,t,r,i)}}),ej=new Q.ZP().uint8("type",w.InjectScroll).uint32("pointerX").uint32("pointerY").uint16("screenWidth").uint16("screenHeight").field("scrollX",eT).field("scrollY",eT).int32("buttons");class eI{serializeScrollMessage(e){return ej.serialize(e)}}class eO extends eV{getScrollController(){return new eI}}class eN extends I.Pz{array;index=0;constructor(e){super({start:async()=>{await Promise.resolve(),this.array=e},pull:e=>{this.index<this.array.length?(e.enqueue(this.array[this.index]),this.index+=1):e.close()}})}}class e_ extends I.Pz{streams;index=0;reader;constructor(...e){super({start:async t=>{await Promise.resolve(),this.streams=e,this.advance(t)},pull:async e=>{let t=await this.reader.read();if(!t.done){e.enqueue(t.value);return}this.advance(e)}})}advance(e){this.index<this.streams.length?(this.reader=this.streams[this.index].getReader(),this.index+=1):e.close()}}class eR extends Error{output;constructor(e){super("scrcpy server exited prematurely"),this.output=e}}class eU{static pushServer(e,t=ev){let r;return new I.BF({start:async()=>(r=await e.sync()).write(t),async close(){await r.dispose()}})}static async start(e,t,r,i){let n;let o=i.createConnection(e);try{await o.initialize(),n=await e.subprocess.spawn([`CLASSPATH=${t}`,"app_process","/","com.genymobile.scrcpy.Server",r,...i.formatServerArguments()],{protocols:[q.vf]});let a=n.stdout.pipeThrough(new I.xU).pipeThrough(new I.Jb("\n")),s=[],l=new I.HS,c=a.pipeTo(new I.Vj({write(e){s.push(e)}}),{signal:l.signal,preventCancel:!0}).catch(e=>{}),d=await Promise.race([n.exit,o.getStreams()]);if("number"==typeof d)throw new eR(s);l.abort(),await c;let[u,h]=d;return new eU(i,n,new e_(new eN(s),a),u,h)}catch(p){throw await n?.kill(),p}finally{o.dispose()}}static async getEncoders(e,t,r,i){Object.assign(i.value,{encoderName:"_",control:!1,sendDeviceMeta:!1,sendDummyByte:!1});let n=await eU.start(e,t,r,i),o=i.getOutputEncoderNameRegex(),a=[];return await n.stdout.pipeTo(new I.Vj({write(e){let t=e.match(o);t&&a.push(t[1])}})),a}static async getDisplays(e,t,r,i){Object.assign(i.value,{displayId:-1,control:!1,sendDeviceMeta:!1,sendDummyByte:!1});try{await eU.start(e,t,r,i)}catch(l){if(l instanceof eR){let n=/\s+scrcpy --display (\d+)/,o=[];for(let a of l.output){let s=a.match(n);s&&o.push(Number.parseInt(s[1],10))}return o}}throw Error("failed to get displays")}process;_stdout;get stdout(){return this._stdout}get exit(){return this.process.exit}_screenWidth;get screenWidth(){return this._screenWidth}_screenHeight;get screenHeight(){return this._screenHeight}_videoStream;get videoStream(){return this._videoStream}_controlMessageSerializer;get controlMessageSerializer(){return this._controlMessageSerializer}_deviceMessageStream;get deviceMessageStream(){return this._deviceMessageStream}constructor(e,t,r,i,n){this.process=t,this._stdout=r,this._videoStream=i.pipeThrough(e.createVideoStreamTransformer()).pipeThrough(new I.N7(e=>{"configuration"===e.type&&(this._screenWidth=e.data.croppedWidth,this._screenHeight=e.data.croppedHeight)})),n&&(this._controlMessageSerializer=new el(n.writable,e),this._deviceMessageStream=n.readable.pipeThrough(new ed))}async close(){await this.process.kill()}}(v=C=C||(C={}))[v.Baseline=1]="Baseline",v[v.Main=2]="Main",v[v.Extended=4]="Extended",v[v.High=8]="High",v[v.High10=16]="High10",v[v.High422=32]="High422",v[v.High444=64]="High444",v[v.ConstrainedBaseline=65536]="ConstrainedBaseline",v[v.ConstrainedHigh=524288]="ConstrainedHigh",(m=z=z||(z={}))[m.Level1=1]="Level1",m[m.Level1b=2]="Level1b",m[m.Level11=4]="Level11",m[m.Level12=8]="Level12",m[m.Level13=16]="Level13",m[m.Level2=32]="Level2",m[m.Level21=64]="Level21",m[m.Level22=128]="Level22",m[m.Level3=256]="Level3",m[m.Level31=512]="Level31",m[m.Level32=1024]="Level32",m[m.Level4=2048]="Level4",m[m.Level41=4096]="Level41",m[m.Level42=8192]="Level42",m[m.Level5=16384]="Level5",m[m.Level51=32768]="Level51",m[m.Level52=65536]="Level52",m[m.Level6=131072]="Level6",m[m.Level61=262144]="Level61",m[m.Level62=524288]="Level62";var eH=r(6328),eF=r(9367),eA=r(9470);function eB(){let[e,t]=(0,F.useState)(null);return(0,F.useEffect)(()=>{if(!e)return;let t=e.parentElement,r=t.style.flexGrow;return t.style.flexGrow="1",()=>{t.style.flexGrow=r}},[e]),(0,M.jsx)("div",{ref:t})}var eW=r(248),eG=r.n(eW);class eK extends I.N7{appendFrame(e){let t=Number(e.pts);-1===this.firstTimestamp?(this.firstTimestamp=t,t=0):t-=this.firstTimestamp;let r=function(e){let t=[],r=0;for(let i of eg(e))t.push(i),r+=i.byteLength+4;let n=new Uint8Array(r),o=0;for(let a of t)n[o]=a.byteLength>>24,n[o+1]=a.byteLength>>16,n[o+2]=a.byteLength>>8,n[o+3]=255&a.byteLength,n.set(a,o+4),o+=4+a.byteLength;return n}(e.data);this.muxer.addVideoChunkRaw(r,e.keyframe?"key":"delta",t,this.configurationWritten?void 0:{decoderConfig:{codec:"",description:this.avcConfiguration}}),this.configurationWritten=!0}start(){if(this.running=!0,this.muxer=new(eG())({target:"buffer",video:{codec:"V_MPEG4/ISO/AVC",width:this.width,height:this.height}}),this.framesFromKeyframe.length>0)for(let e of this.framesFromKeyframe)this.appendFrame(e)}stop(){if(!this.muxer)return;let e=this.muxer.finalize(),t=new Date,r=(0,eF.yH)("Recording ".concat(t.getFullYear(),"-").concat((t.getMonth()+1).toString().padStart(2,"0"),"-").concat(t.getDate().toString().padStart(2,"0")," ").concat(t.getHours().toString().padStart(2,"0"),"-").concat(t.getMinutes().toString().padStart(2,"0"),"-").concat(t.getSeconds().toString().padStart(2,"0"),".webm")),i=r.getWriter();i.write(new Uint8Array(e)),i.close(),this.muxer=void 0,this.configurationWritten=!1,this.running=!1,this.firstTimestamp=-1}constructor(){super(e=>{try{if("configuration"===e.type){this.width=e.data.croppedWidth,this.height=e.data.croppedHeight,this.avcConfiguration=function(e,t){let r=new Uint8Array(11+e.byteLength+t.byteLength);return r[0]=1,r[1]=e[1],r[2]=e[2],r[3]=e[3],r[4]=255,r[5]=225,r[6]=e.byteLength>>8,r[7]=255&e.byteLength,r.set(e,8),r[8+e.byteLength]=1,r[9+e.byteLength]=t.byteLength>>8,r[10+e.byteLength]=255&t.byteLength,r.set(t,11+e.byteLength),r}(e.sequenceParameterSet,e.pictureParameterSet),this.configurationWritten=!1;return}if(!0===e.keyframe&&(this.framesFromKeyframe.length=0),this.framesFromKeyframe.push(e),!this.muxer)return;this.appendFrame(e)}catch(t){console.error(t)}}),this.running=!1,this.width=0,this.height=0,this.firstTimestamp=-1,this.configurationWritten=!1,this.framesFromKeyframe=[]}}let eJ=(0,_.ky)({recorder:new eK,recording:!1,intervalId:-1,hours:0,minutes:0,seconds:0});(0,_.U5)(()=>eJ.recording,e=>{e?eJ.intervalId=window.setInterval((0,_.aD)(()=>{eJ.seconds+=1,eJ.seconds>=60&&(eJ.seconds=0,eJ.minutes+=1),eJ.minutes>=60&&(eJ.minutes=0,eJ.hours+=1)}),1e3):(window.clearInterval(eJ.intervalId),eJ.intervalId=-1,eJ.hours=0,eJ.minutes=0,eJ.seconds=0)});var eY="1.25",eX=r(2469);let eZ=new r.U(r(4439));class e${get downloaded(){return this._downloaded}get total(){return this._total}get onProgress(){return this.progressEvent.event}async fetch(e){var t;let r=await window.fetch(e);this._total=Number.parseInt(null!==(t=r.headers.get("Content-Length"))&&void 0!==t?t:"0",10),this.progressEvent.fire([this._downloaded,this._total]);let i=r.body.getReader(),n=[];for(;;){let o=await i.read();if(o.done)break;n.push(o.value),this._downloaded+=o.value.byteLength,this.progressEvent.fire([this._downloaded,this._total])}this._total=n.reduce((e,t)=>e+t.byteLength,0);let a=new Uint8Array(this._total),s=0;for(let l of n)a.set(l,s),s+=l.byteLength;return a}constructor(e){this._downloaded=0,this._total=0,this.progressEvent=new eX.vp,this.promise=this.fetch(e)}}function eq(e){return i||(i=new e$(eZ)).promise.catch(e=>{i=void 0}),e&&(i.onProgress(e),e([i.downloaded,i.total])),i.promise}var eQ=r(5697),e0=r(911),e1=r(5138),e2=r(4306),e3=r(2669),e6=r(345),e4=r(9339),e8=r(7105),e5=r(7609);let e7=!1,e9=[],te=0,tt=new Map;class tr extends eX.Xn{streamId;pictureReadyEvent=new eX.vp;get onPictureReady(){return this.pictureReadyEvent.event}constructor(e){var t;super(),this.streamId=e,this.addDisposable((t=this.handlePictureReady,tt.set(e,t),{dispose(){tt.delete(e)}}))}handlePictureReady=e=>{this.pictureReadyEvent.fire(e)};feed(e){n.postMessage({type:"decode",data:e,offset:0,length:e.byteLength,renderStateId:this.streamId},[e])}dispose(){super.dispose(),n.postMessage({type:"release",renderStateId:this.streamId})}}function ti(){return o||(o=Promise.all([r.e(118).then(r.t.bind(r,6118,19)),r.e(337).then(r.t.bind(r,6337,19))]).then(([e,{default:t}])=>({YuvBuffer:e,YuvCanvas:t}))),o}class tn{maxProfile=C.Baseline;maxLevel=z.Level4;_renderer;get renderer(){return this._renderer}_frameRendered=0;get frameRendered(){return this._frameRendered}_writable;get writable(){return this._writable}_yuvCanvas;_initializer;constructor(){ti(),this._renderer=document.createElement("canvas"),this._writable=new I.Vj({write:async e=>{switch(e.type){case"configuration":this.configure(e.data);break;case"frame":{if(!this._initializer)throw Error("Decoder not configured");let t=await this._initializer.promise;t.feed(e.data.slice().buffer)}}}})}async configure(e){this.dispose(),this._initializer=new G.hP;let{YuvBuffer:t,YuvCanvas:i}=await ti();this._yuvCanvas||(this._yuvCanvas=i.attach(this._renderer));let{encodedWidth:o,encodedHeight:a}=e,s=o/2,l=a/2;this._renderer.width=e.croppedWidth,this._renderer.height=e.croppedHeight;let c=t.format({width:o,height:a,chromaWidth:s,chromaHeight:l,cropLeft:e.cropLeft,cropTop:e.cropTop,cropWidth:e.croppedWidth,cropHeight:e.croppedHeight,displayWidth:e.croppedWidth,displayHeight:e.croppedHeight}),d=await function(){if(n||(n=new Worker(r.tu(new URL(r.p+r.u(292),r.b)))).addEventListener("message",({data:e})=>{switch(e.type){case"decoderReady":for(let t of(e7=!0,e9))t.resolve(new tr(te)),te+=1;e9.length=0;break;case"pictureReady":tt.get(e.renderStateId)?.(e)}}),!e7){let e=new G.hP;return e9.push(e),e.promise}let t=new tr(te);return te+=1,Promise.resolve(t)}();this._initializer.resolve(d);let u=o*a,h=u+s*l;d.onPictureReady(({data:e})=>{this._frameRendered+=1;let r=new Uint8Array(e),i=t.frame(c,t.lumaPlane(c,r,o,0),t.chromaPlane(c,r,s,u),t.chromaPlane(c,r,s,h));this._yuvCanvas.drawFrame(i)})}dispose(){this._initializer?.promise.then(e=>e.dispose()).catch(e=>{}),this._initializer=void 0}}let to=(0,e5.Z)({labelRight:{marginLeft:"4px"}}),ta=(0,R.Pi)(function(e){let{definition:t,settings:r,onChange:i}=e,n=to(),o=(0,M.jsxs)(V.K,{horizontal:!0,verticalAlign:"center",children:[(0,M.jsx)("span",{children:t.label}),!!t.description&&(0,M.jsx)(eQ.G,{content:t.description,children:(0,M.jsx)(e0.J,{className:n.labelRight,iconName:eF.PJ.Info})}),t.labelExtra]});switch(t.type){case"text":return(0,M.jsx)(e1.n,{label:o,placeholder:t.placeholder,value:r[t.key],onChange:(e,r)=>i(t.key,r)});case"dropdown":return(0,M.jsx)(e2.L,{label:o,options:t.options,placeholder:t.placeholder,selectedKey:r[t.key],onChange:(e,r)=>i(t.key,r.key)});case"toggle":return(0,M.jsx)(e3.Z,{label:o,checked:r[t.key],onChange:(e,r)=>i(t.key,r)});case"number":return(0,M.jsx)(e6.k,{label:t.label,labelPosition:e4.L.top,min:t.min,max:t.max,step:t.step,value:r[t.key].toString(),onChange:(e,r)=>i(t.key,Number.parseInt(r,10))})}}),ts=(0,_.ky)({settingsVisible:!1,displays:[],encoders:[],decoders:[{key:"tinyh264",name:"TinyH264 (Software)",Constructor:tn}],settings:{maxSize:1080,bitRate:4e6,lockVideoOrientation:D.Unlocked,displayId:0,crop:"",powerOn:!0}});(0,_.EH)(()=>{eH.d.device&&(0,_.z)(()=>{ts.encoders=[],ts.settings.encoderName=void 0,ts.displays=[],ts.settings.displayId=void 0})}),(0,_.EH)(()=>{ts.settings.decoder=ts.decoders[0].key});let tl=(0,_.Fl)(()=>{let e=[];return e.push({key:"powerOn",type:"toggle",label:"Turn device on when starting"},{key:"turnScreenOff",type:"toggle",label:"Turn screen off when starting"},{key:"stayAwake",type:"toggle",label:"Stay awake (if plugged in)"},{key:"powerOffOnClose",type:"toggle",label:"Turn device off when exiting"}),e.push({key:"displayId",type:"dropdown",label:"Display",placeholder:"Press refresh to update available displays",labelExtra:(0,M.jsx)(e8.h,{iconProps:{iconName:eF.PJ.ArrowClockwise},disabled:!eH.d.device,text:"Refresh",onClick:async()=>{try{await tc.pushServer();let e=await eU.getDisplays(eH.d.device,ev,eY,new $(new eO({logLevel:k.Debug,tunnelForward:ts.settings.tunnelForward})));(0,_.z)(()=>{ts.displays=e,ts.settings.displayId&&ts.displays.includes(ts.settings.displayId)||(ts.settings.displayId=ts.displays[0])})}catch(t){eH.d.showErrorDialog(t)}}}),options:ts.displays.map(e=>({key:e,text:e.toString()}))}),e.push({key:"crop",type:"text",label:"Crop",placeholder:"W:H:X:Y"}),e.push({key:"maxSize",type:"number",label:"Max Resolution (longer side, 0 = unlimited)",min:0,max:2560,step:50}),e.push({key:"bitRate",type:"number",label:"Max Bit Rate",min:100,max:1e8,step:100}),e.push({key:"lockVideoOrientation",type:"dropdown",label:"Lock Video Orientation",options:[{key:D.Unlocked,text:"Unlocked"},{key:D.Initial,text:"Current"},{key:D.Portrait,text:"Portrait"},{key:D.Landscape,text:"Landscape"},{key:D.PortraitFlipped,text:"Portrait (Flipped)"},{key:D.LandscapeFlipped,text:"Landscape (Flipped)"}]}),e.push({key:"encoderName",type:"dropdown",label:"Encoder",placeholder:"Press refresh to update available encoders",labelExtra:(0,M.jsx)(e8.h,{iconProps:{iconName:eF.PJ.ArrowClockwise},disabled:!eH.d.device,text:"Refresh",onClick:async()=>{try{await tc.pushServer();let e=await eU.getEncoders(eH.d.device,ev,eY,new $(new eO({logLevel:k.Debug,tunnelForward:ts.settings.tunnelForward})));(0,_.z)(()=>{ts.encoders=e,ts.settings.encoderName&&ts.encoders.includes(ts.settings.encoderName)||(ts.settings.encoderName=ts.encoders[0])})}catch(t){eH.d.showErrorDialog(t)}}}),options:ts.encoders.map(e=>({key:e,text:e}))}),ts.decoders.length>1&&e.push({key:"decoder",type:"dropdown",label:"Decoder",options:ts.decoders.map(e=>({key:e.key,text:e.name,data:e}))}),e.push({key:"ignoreDecoderCodecArgs",type:"toggle",label:"Ignore decoder's codec arguments",description:"Some decoders don't support all H.264 profile/levels, so they request the device to encode at their highest-supported codec. However, some super old devices may not support that codec so their encoders will fail to start. Use this option to let device choose the codec to be used."}),e.push({key:"tunnelForward",type:"toggle",label:"Use forward connection",description:"Android before version 9 has a bug that prevents reverse tunneling when using ADB over WiFi."}),e}),tc=new class{get rotatedWidth(){return 1&tc.rotation?tc.height:tc.width}get rotatedHeight(){return 1&tc.rotation?tc.width:tc.height}async pushServer(){let e=await eq();await new I.Pz({start(t){t.enqueue(e),t.close()}}).pipeTo(eU.pushServer(eH.d.device))}async stop(){var e;await (null===(e=this.client)||void 0===e?void 0:e.close()),this.dispose()}dispose(){var e;null===(e=this.decoder)||void 0===e||e.dispose(),this.decoder=void 0,eJ.recording&&(eJ.recorder.stop(),eJ.recording=!1),this.fps=0,clearTimeout(this.fpsCounterIntervalId),this.client=void 0,this.running=!1}handleDeviceViewRef(e){this.deviceView=e}handleRendererContainerRef(e){this.rendererContainer=e}clientPositionToDevicePosition(e,t){let r=this.rendererContainer.getBoundingClientRect(),i=ee((e-r.x)/r.width,0,1),n=ee((t-r.y)/r.height,0,1);switch(1&this.rotation&&([i,n]=[n,i]),this.rotation){case 1:n=1-n;break;case 2:i=1-i,n=1-n;break;case 3:i=1-i}return{x:i*this.width,y:n*this.height}}constructor(){this.running=!1,this.deviceView=null,this.rendererContainer=null,this.logVisible=!1,this.log=[],this.demoModeVisible=!1,this.navigationBarVisible=!0,this.width=0,this.height=0,this.rotation=0,this.client=void 0,this.hoverHelper=void 0,this.decoder=void 0,this.configuration=void 0,this.fpsCounterIntervalId=void 0,this.fps=0,this.connecting=!1,this.serverTotalSize=0,this.serverDownloadedSize=0,this.debouncedServerDownloadedSize=0,this.serverDownloadSpeed=0,this.serverUploadedSize=0,this.debouncedServerUploadedSize=0,this.serverUploadSpeed=0,this.start=async()=>{if(eH.d.device)try{var e;let t;if(!ts.settings.decoder)throw Error("No available decoder");(0,_.z)(()=>{this.serverTotalSize=0,this.serverDownloadedSize=0,this.debouncedServerDownloadedSize=0,this.serverUploadedSize=0,this.debouncedServerUploadedSize=0,this.connecting=!0});let r=setInterval((0,_.aD)(()=>{this.serverDownloadSpeed=this.serverDownloadedSize-this.debouncedServerDownloadedSize,this.debouncedServerDownloadedSize=this.serverDownloadedSize}),1e3);try{t=await eq((0,_.aD)(e=>{let[t,r]=e;this.serverDownloadedSize=t,this.serverTotalSize=r})),(0,_.z)(()=>{this.serverDownloadSpeed=this.serverDownloadedSize-this.debouncedServerDownloadedSize,this.debouncedServerDownloadedSize=this.serverDownloadedSize})}finally{clearInterval(r)}r=setInterval((0,_.aD)(()=>{this.serverUploadSpeed=this.serverUploadedSize-this.debouncedServerUploadedSize,this.debouncedServerUploadedSize=this.serverUploadedSize}),1e3);try{await new I.Pz({start(e){e.enqueue(t),e.close()}}).pipeThrough(new I.Cc(q.j4)).pipeThrough(new eF.hK((0,_.aD)(e=>{this.serverUploadedSize=e}))).pipeTo(eU.pushServer(eH.d.device)),(0,_.z)(()=>{this.serverUploadSpeed=this.serverUploadedSize-this.debouncedServerUploadedSize,this.debouncedServerUploadedSize=this.serverUploadedSize})}finally{clearInterval(r)}let i=null!==(e=ts.decoders.find(e=>e.key===ts.settings.decoder))&&void 0!==e?e:ts.decoders[0],n=new i.Constructor;(0,_.z)(()=>{this.decoder=n;let e=0;this.fpsCounterIntervalId=setInterval((0,_.aD)(()=>{this.fps=n.frameRendered-e,e=n.frameRendered}),1e3)});let o=new $(new eO({logLevel:k.Debug,...ts.settings,sendDeviceMeta:!1,sendDummyByte:!1,codecOptions:ts.settings.ignoreDecoderCodecArgs?void 0:new eh({profile:n.maxProfile,level:n.maxLevel})}));(0,_.z)(()=>{this.log=[],this.log.push("[client] Server version: ".concat(eY)),this.log.push("[client] Server arguments: ".concat(o.formatServerArguments().join(" ")))});let a=await eU.start(eH.d.device,ev,eY,o);a.stdout.pipeTo(new I.Vj({write:(0,_.aD)(e=>{this.log.push(e)})})),eJ.recorder=new eK,a.videoStream.pipeThrough(new I.N7((0,_.aD)(e=>{if("configuration"===e.type){let{croppedWidth:t,croppedHeight:r}=e.data;this.log.push("[client] Video size changed: ".concat(t,"x").concat(r)),this.configuration=e,this.width=t,this.height=r}}))).pipeThrough(eJ.recorder).pipeTo(n.writable).catch(()=>{}),a.exit.then(this.dispose),a.deviceMessageStream.pipeTo(new I.Vj({write(e){e.type===P.Clipboard&&window.navigator.clipboard.writeText(e.content)}})).catch(()=>{}),ts.settings.turnScreenOff&&await a.controlMessageSerializer.setScreenPowerMode(x.Off),(0,_.z)(()=>{this.client=a,this.hoverHelper=new ei,this.running=!0})}catch(s){eH.d.showErrorDialog(s)}finally{(0,_.z)(()=>{this.connecting=!1})}},(0,_.ky)(this,{start:!1,stop:_.aD.bound,dispose:_.aD.bound,handleDeviceViewRef:_.aD.bound,handleRendererContainerRef:_.aD.bound,clientPositionToDevicePosition:!1}),(0,_.EH)(()=>{eH.d.device||this.dispose()}),(0,_.EH)(()=>{if(this.rendererContainer&&this.decoder){for(;this.rendererContainer.firstChild;)this.rendererContainer.firstChild.remove();this.rendererContainer.appendChild(this.decoder.renderer)}})}},td=(0,_.Fl)(()=>{let e=[];return tc.running?e.push({key:"stop",iconProps:{iconName:eF.PJ.Stop},text:"Stop",onClick:tc.stop}):e.push({key:"start",disabled:!eH.d.device,iconProps:{iconName:eF.PJ.Play},text:"Start",onClick:tc.start}),e.push(eJ.recording?{key:"Record",iconProps:{iconName:eF.PJ.Record,style:{color:"red"}},text:"".concat(eJ.hours?"".concat(eJ.hours,":"):"").concat(eJ.minutes.toString().padStart(2,"0"),":").concat(eJ.seconds.toString().padStart(2,"0")),onClick:(0,_.aD)(()=>{eJ.recorder.stop(),eJ.recording=!1})}:{key:"Record",disabled:!tc.running,iconProps:{iconName:eF.PJ.Record},text:"Record",onClick:(0,_.aD)(()=>{eJ.recorder.start(),eJ.recording=!0})}),e.push({key:"fullscreen",disabled:!tc.running,iconProps:{iconName:eF.PJ.FullScreenMaximize},iconOnly:!0,text:"Fullscreen",onClick:()=>{var e;null===(e=tc.deviceView)||void 0===e||e.enterFullscreen()}}),e.push({key:"volumeUp",disabled:!tc.running,iconProps:{iconName:eF.PJ.Speaker2},iconOnly:!0,text:"Volume Up",onClick:async()=>{var e,t;await (null===(e=tc.client)||void 0===e?void 0:e.controlMessageSerializer.injectKeyCode({action:b.Down,keyCode:S.VolumeUp,repeat:0,metaState:0})),await (null===(t=tc.client)||void 0===t?void 0:t.controlMessageSerializer.injectKeyCode({action:b.Up,keyCode:S.VolumeUp,repeat:0,metaState:0}))}},{key:"volumeDown",disabled:!tc.running,iconProps:{iconName:eF.PJ.Speaker1},iconOnly:!0,text:"Volume Down",onClick:async()=>{var e,t;await (null===(e=tc.client)||void 0===e?void 0:e.controlMessageSerializer.injectKeyCode({action:b.Down,keyCode:S.VolumeDown,repeat:0,metaState:0})),await (null===(t=tc.client)||void 0===t?void 0:t.controlMessageSerializer.injectKeyCode({action:b.Up,keyCode:S.VolumeDown,repeat:0,metaState:0}))}},{key:"volumeMute",disabled:!tc.running,iconProps:{iconName:eF.PJ.SpeakerOff},iconOnly:!0,text:"Toggle Mute",onClick:async()=>{var e,t;await (null===(e=tc.client)||void 0===e?void 0:e.controlMessageSerializer.injectKeyCode({action:b.Down,keyCode:S.VolumeMute,repeat:0,metaState:0})),await (null===(t=tc.client)||void 0===t?void 0:t.controlMessageSerializer.injectKeyCode({action:b.Up,keyCode:S.VolumeMute,repeat:0,metaState:0}))}}),e.push({key:"rotateDevice",disabled:!tc.running,iconProps:{iconName:eF.PJ.Orientation},iconOnly:!0,text:"Rotate Device",onClick:()=>{tc.client.controlMessageSerializer.rotateDevice()}},{key:"rotateVideoLeft",disabled:!tc.running,iconProps:{iconName:eF.PJ.RotateLeft},iconOnly:!0,text:"Rotate Video Left",onClick:(0,_.aD)(()=>{tc.rotation-=1,tc.rotation<0&&(tc.rotation=3)})},{key:"rotateVideoRight",disabled:!tc.running,iconProps:{iconName:eF.PJ.RotateRight},iconOnly:!0,text:"Rotate Video Right",onClick:(0,_.aD)(()=>{tc.rotation=tc.rotation+1&3})}),e.push({key:"turnScreenOff",disabled:!tc.running,iconProps:{iconName:eF.PJ.Lightbulb},iconOnly:!0,text:"Turn Screen Off",onClick:()=>{tc.client.controlMessageSerializer.setScreenPowerMode(x.Off)}},{key:"turnScreenOn",disabled:!tc.running,iconProps:{iconName:eF.PJ.LightbulbFilament},iconOnly:!0,text:"Turn Screen On",onClick:()=>{tc.client.controlMessageSerializer.setScreenPowerMode(x.Normal)}}),tc.running&&e.push({key:"fps",text:"FPS: ".concat(tc.fps),disabled:!0}),e.push({key:"spacer",onRender:()=>(0,M.jsx)(eB,{})},{key:"separator",disabled:!0,itemType:B.n.Divider}),e.push({key:"NavigationBar",iconProps:{iconName:eF.PJ.PanelBottom},canCheck:!0,checked:tc.navigationBarVisible,text:"Navigation Bar",iconOnly:!0,onClick:(0,_.aD)(()=>{tc.navigationBarVisible=!tc.navigationBarVisible})},{key:"Log",iconProps:{iconName:eF.PJ.TextGrammarError},canCheck:!0,checked:tc.logVisible,text:"Log",iconOnly:!0,onClick:(0,_.aD)(()=>{tc.logVisible=!tc.logVisible})},{key:"Settings",iconProps:{iconName:eF.PJ.Settings},canCheck:!0,checked:ts.settingsVisible,text:"Settings",iconOnly:!0,onClick:(0,_.aD)(()=>{ts.settingsVisible=!ts.settingsVisible})},{key:"DemoMode",iconProps:{iconName:eF.PJ.Wand},canCheck:!0,checked:tc.demoModeVisible,text:"Demo Mode",iconOnly:!0,onClick:(0,_.aD)(()=>{tc.demoModeVisible=!tc.demoModeVisible})},{key:"info",iconProps:{iconName:eF.PJ.Info},iconOnly:!0,text:"About",tooltipHostProps:{content:(0,M.jsxs)(M.Fragment,{children:[(0,M.jsxs)("p",{children:[(0,M.jsx)(eA.d,{href:"https://github.com/Genymobile/scrcpy",spaceAfter:!0,children:"Scrcpy"}),"developed by Genymobile can display the screen with low latency (1~2 frames) and control the device, all without root access."]}),(0,M.jsx)("p",{children:"This is a TypeScript implementation of the client part. Paired with official pre-built server binary."})]}),calloutProps:{calloutMaxWidth:300}}}),e}),tu=(0,R.Pi)(function(){return(0,M.jsx)(W.X,{items:td.get()})});var th=r(1893);let tp=(0,e5.Z)({container:{height:"40px",backgroundColor:"#999"},bar:{width:"100%",maxWidth:"300px"},icon:{color:"white"},back:{transform:"rotate(180deg)"}});function tg(e){return!!tc.client&&0===e.button&&(e.currentTarget.setPointerCapture(e.pointerId),!0)}function tv(e){return!!tc.client&&0===e.button}function tm(e){tg(e)&&tc.client.controlMessageSerializer.backOrScreenOn(b.Down)}function tw(e){tv(e)&&tc.client.controlMessageSerializer.backOrScreenOn(b.Up)}function ty(e){tg(e)&&tc.client.controlMessageSerializer.injectKeyCode({action:b.Down,keyCode:S.Home,repeat:0,metaState:0})}function tf(e){tv(e)&&tc.client.controlMessageSerializer.injectKeyCode({action:b.Up,keyCode:S.Home,repeat:0,metaState:0})}function tb(e){tg(e)&&tc.client.controlMessageSerializer.injectKeyCode({action:b.Down,keyCode:S.AppSwitch,repeat:0,metaState:0})}function tS(e){tv(e)&&tc.client.controlMessageSerializer.injectKeyCode({action:b.Up,keyCode:S.AppSwitch,repeat:0,metaState:0})}let tx=(0,R.Pi)(function(e){let{className:t,style:r,children:i}=e,n=tp();return tc.navigationBarVisible?(0,M.jsxs)(V.K,{className:(0,th.z)(n.container,t),verticalFill:!0,horizontalAlign:"center",style:r,children:[i,(0,M.jsxs)(V.K,{className:n.bar,verticalFill:!0,horizontal:!0,horizontalAlign:"space-evenly",verticalAlign:"center",children:[(0,M.jsx)(e8.h,{className:(0,th.z)(n.back,n.icon),iconProps:{iconName:eF.PJ.Play},onPointerDown:tm,onPointerUp:tw}),(0,M.jsx)(e8.h,{className:n.icon,iconProps:{iconName:eF.PJ.Circle},onPointerDown:ty,onPointerUp:tf}),(0,M.jsx)(e8.h,{className:n.icon,iconProps:{iconName:eF.PJ.Stop},onPointerDown:tb,onPointerUp:tS})]})]}):(0,M.jsx)("div",{className:t,style:r,children:i})}),tP=(0,e5.Z)({video:{transformOrigin:"center center",touchAction:"none"}});function tk(e){if(!tc.client)return;e.preventDefault(),e.stopPropagation();let{x:t,y:r}=tc.clientPositionToDevicePosition(e.clientX,e.clientY);tc.client.controlMessageSerializer.injectScroll({screenWidth:tc.client.screenWidth,screenHeight:tc.client.screenHeight,pointerX:t,pointerY:r,scrollX:-e.deltaX/100,scrollY:-e.deltaY/100,buttons:0})}function tD(e,t){let r;if(!tc.client)return;let{pointerType:i}=t;r="mouse"===i?f.Finger:BigInt(t.pointerId);let{x:n,y:o}=tc.clientPositionToDevicePosition(t.clientX,t.clientY),a=tc.hoverHelper.process({action:e,pointerId:r,screenWidth:tc.client.screenWidth,screenHeight:tc.client.screenHeight,pointerX:n,pointerY:o,pressure:t.pressure,buttons:t.buttons});for(let s of a)tc.client.controlMessageSerializer.injectTouch(s)}function tC(e){tc.rendererContainer.focus(),e.preventDefault(),e.stopPropagation(),e.currentTarget.setPointerCapture(e.pointerId),tD(y.Down,e)}function tz(e){tc.client&&(e.preventDefault(),e.stopPropagation(),tD(0===e.buttons?y.HoverMove:y.Move,e))}function tM(e){e.preventDefault(),e.stopPropagation(),tD(y.Up,e)}function tL(e){e.preventDefault(),e.stopPropagation(),tD(y.HoverExit,e),tD(y.Up,e)}function tE(e){e.preventDefault()}let tV={Enter:S.Enter,Escape:S.Escape,Backspace:S.Delete,Tab:S.Tab,Delete:S.ForwardDelete,Home:S.MoveHome,End:S.MoveEnd,Space:S.Space,ArrowUp:S.DPadUp,ArrowDown:S.DPadDown,ArrowLeft:S.DPadLeft,ArrowRight:S.DPadRight};async function tT(e){if(!tc.client)return;let{key:t,code:r}=e;if(t.match(/^[!-`{-~]$/i)){tc.client.controlMessageSerializer.injectText(t);return}let i=tV[r];i&&(e.preventDefault(),e.stopPropagation(),tc.client.controlMessageSerializer.injectKeyCode({action:b.Down,keyCode:i,metaState:0,repeat:0}),tc.client.controlMessageSerializer.injectKeyCode({action:b.Up,keyCode:i,metaState:0,repeat:0}))}function tj(){let e=tP(),[t,r]=(0,F.useState)(null);return(0,F.useEffect)(()=>{if(tc.handleRendererContainerRef(t),t)return t.addEventListener("wheel",tk,{passive:!1}),()=>{t.removeEventListener("wheel",tk)}},[t]),(0,M.jsx)("div",{ref:r,tabIndex:-1,className:e.video,style:{width:tc.width,height:tc.height,transform:"translate(".concat((tc.rotatedWidth-tc.width)/2,"px, ").concat((tc.rotatedHeight-tc.height)/2,"px) rotate(").concat(90*tc.rotation,"deg)")},onPointerDown:tC,onPointerMove:tz,onPointerUp:tM,onPointerCancel:tM,onPointerLeave:tL,onKeyDown:tT,onContextMenu:tE})}let tI=(0,R.Pi)(()=>{let e=(0,j.M)("layerHost"),[t,r]=(0,F.useState)(!1);return((0,F.useEffect)(()=>{r(!0)},[]),t)?(0,M.jsxs)(M.Fragment,{children:[(0,M.jsx)(L.Z,{id:e,style:{position:"absolute",top:0,bottom:0,left:0,right:0,margin:0,pointerEvents:"none"}}),(0,M.jsx)(E.V,{hidden:!tc.connecting,modalProps:{layerProps:{hostId:e}},dialogContentProps:{title:"Connecting..."},children:(0,M.jsxs)(V.K,{tokens:eF.WT,children:[(0,M.jsx)(T.Y,{label:"1. Downloading scrcpy server...",percentComplete:tc.serverTotalSize?tc.serverDownloadedSize/tc.serverTotalSize:void 0,description:(0,eF.CY)(tc.debouncedServerDownloadedSize,tc.serverTotalSize,tc.serverDownloadSpeed)}),(0,M.jsx)(T.Y,{label:"2. Pushing scrcpy server to device...",progressHidden:0===tc.serverTotalSize||tc.serverDownloadedSize!==tc.serverTotalSize,percentComplete:tc.serverUploadedSize/tc.serverTotalSize,description:(0,eF.CY)(tc.debouncedServerUploadedSize,tc.serverTotalSize,tc.serverUploadSpeed)}),(0,M.jsx)(T.Y,{label:"3. Starting scrcpy server on device...",progressHidden:0===tc.serverTotalSize||tc.serverUploadedSize!==tc.serverTotalSize})]})})]}):null}),tO=()=>((0,F.useEffect)(()=>{1===ts.decoders.length&&"function"==typeof window.VideoDecoder&&(0,_.z)(()=>{ts.decoders.unshift({key:"webcodecs",name:"WebCodecs",Constructor:N})})},[]),(0,M.jsxs)(V.K,{...eF.LE,children:[(0,M.jsx)(H(),{children:(0,M.jsx)("title",{children:"Scrcpy - Android Web Toolbox"})}),(0,M.jsx)(tu,{}),(0,M.jsxs)(V.K,{horizontal:!0,grow:!0,styles:{root:{height:0}},children:[(0,M.jsx)(A.wM,{ref:tc.handleDeviceViewRef,width:tc.rotatedWidth,height:tc.rotatedHeight,BottomElement:tx,children:(0,M.jsx)(tj,{})}),(0,M.jsx)("div",{style:{padding:12,overflow:"hidden auto",display:tc.logVisible?"block":"none",width:500,fontFamily:"monospace",overflowY:"auto",whiteSpace:"pre-wrap",wordWrap:"break-word"},children:tc.log.map((e,t)=>(0,M.jsx)("div",{children:e},t))}),(0,M.jsxs)("div",{style:{padding:12,overflow:"hidden auto",display:ts.settingsVisible?"block":"none",width:300},children:[(0,M.jsx)("div",{children:"Changes will take effect on next connection"}),tl.get().map(e=>(0,M.jsx)(ta,{definition:e,settings:ts.settings,onChange:(0,_.aD)((e,t)=>ts.settings[e]=t)},e.key))]}),(0,M.jsx)(A.bq,{style:{display:tc.demoModeVisible?"block":"none"}}),(0,M.jsx)(tI,{})]})]}));var tN=(0,R.Pi)(tO)},4439:function(e,t,r){"use strict";e.exports=r.p+"static/chunks/scrcpy-server.50786887a0e88460"}},function(e){e.O(0,[138,307,774,888,179],function(){return e(e.s=8640)}),_N_E=e.O()}]);
//# sourceMappingURL=scrcpy-1e5b3d21a8ec1517.js.map