(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[941],{7655:function(e,t,i){(window.__NEXT_P=window.__NEXT_P||[]).push(["/file-manager",function(){return i(1519)}])},1519:function(e,t,i){"use strict";i.r(t);var s=i(4471),n=i(6883),a=i(1420),o=i(4293),l=i(4893),r=i(9486),d=i(1647),h=i(6006),c=i(5114),u=i(3181),p=i(328),m=i(2315),y=i(6885),g=i(4361),f=i(6691),b=i(1913),w=i(7199),x=i(1251),k=i(1212),v=i(132),z=i(4132),S=i(5616),C=i(6261),D=i(6323),I=i(6779),j=i(7417),P=i.n(j),T=i(6547),q=i.n(T),L=i(51),E=i.n(L),F=i(3370),N=i(8763),R=i(1436),U=i(291);function _(e){return e.key=e.name,e}(0,x.Mg)();let M=(0,n.ZC)({name:{cursor:"pointer","&:hover":{textDecoration:"underline"}}}),W=(e,t)=>e&&t?t({...e,styles:(0,n.E$)(e.styles,{root:{paddingTop:0}})}):null;function H(e,t){let i=e.toLocaleLowerCase().localeCompare(t.toLocaleLowerCase());return 0!==i?i:e.localeCompare(t)}let K=new class{get breadcrumbItems(){let e="",t=this.path.split("/").filter(Boolean).map(t=>({key:e+="/"+t,text:t,onClick:(e,t)=>{t&&this.pushPathQuery(t.key)}}));return t.unshift({key:"/",text:"Device",onClick:()=>this.pushPathQuery("/")}),t[t.length-1].isCurrentItem=!0,delete t[t.length-1].onClick,t}get menuItems(){let e=[];switch(this.selectedItems.length){case 0:e.push({key:"upload",text:"Upload",iconProps:{iconName:U.PJ.CloudArrowUp,style:{height:20,fontSize:20,lineHeight:1.5}},disabled:!R.q.device,onClick:()=>((async()=>{let e=await (0,U.oT)({multiple:!0});for(let t=0;t<e.length;t++){let i=e.item(t);await this.upload(i)}})(),!1)});break;case 1:this.selectedItems[0].type===S.d6.File&&e.push({key:"download",text:"Download",iconProps:{iconName:U.PJ.CloudArrowDown,style:{height:20,fontSize:20,lineHeight:1.5}},onClick:()=>((async()=>{let e=await R.q.device.sync();try{let t=this.selectedItems[0],i=E().resolve(this.path,t.name);await e.read(i).pipeTo((0,U.yH)(t.name,Number(t.size)))}catch(s){R.q.showErrorDialog(s)}finally{e.dispose()}})(),!1)});default:e.push({key:"delete",text:"Delete",iconProps:{iconName:U.PJ.Delete,style:{height:20,fontSize:20,lineHeight:1.5}},onClick:()=>((async()=>{try{for(let e of this.selectedItems){let t=await R.q.device.rm(E().resolve(this.path,e.name));if(t){R.q.showErrorDialog(t);return}}}catch(i){R.q.showErrorDialog(i)}finally{this.loadFiles()}})(),!1)})}return e}get sortedList(){let e=this.items.slice();return e.sort((e,t)=>{let i;let s=e.type===S.d6.File?1:0,n=t.type===S.d6.File?1:0;if(s!==n)i=s-n;else{let a=e[this.sortKey],o=t[this.sortKey];i=a===o?H(e.name,t.name):"string"==typeof a?H(a,o):a<o?-1:1}return this.sortDescending&&(i*=-1),i}),e}get columns(){var e,t;let i=[{key:"type",name:"File Type",iconName:U.PJ.Document20,isIconOnly:!0,minWidth:20,maxWidth:20,isCollapsible:!0,onRender(e){let t;switch(e.type){case S.d6.Link:t="linkedfolder16_svg";break;case S.d6.Directory:({iconName:t}=(0,k.EX)({type:v.I.folder}));break;case S.d6.File:({iconName:t}=(0,k.EX)({extension:E().extname(e.name)}));break;default:({iconName:t}=(0,k.EX)({type:v.I.genericFile}))}let i=(0,n.q7)(t).code.props.src;return(0,s.jsx)(a.J,{imageProps:{crossOrigin:"anonymous",src:i},style:{width:20,height:20}})}},{key:"name",name:"Name",minWidth:0,isRowHeader:!0,onRender:e=>(0,s.jsx)("span",{className:M.name,"data-selection-invoke":!0,children:e.name})},{key:"permission",name:"Permission",minWidth:0,isCollapsible:!0,onRender:e=>"".concat((e.mode>>6&4).toString(8)).concat((e.mode>>3&4).toString(8)).concat((4&e.mode).toString(8))},{key:"size",name:"Size",minWidth:0,isCollapsible:!0,onRender:e=>e.type===S.d6.File?(0,U.BU)(Number(e.size)):""},{key:"mtime",name:"Last Modified Time",minWidth:150,isCollapsible:!0,onRender:e=>new Date(1e3*Number(e.mtime)).toLocaleString()}];for(let o of((null===(e=R.q.device)||void 0===e?void 0:null===(t=e.features)||void 0===t?void 0:t.includes(S.Pq.ListV2))&&i.push({key:"ctime",name:"Creation Time",minWidth:150,isCollapsible:!0,onRender:e=>new Date(1e3*Number(e.ctime)).toLocaleString()},{key:"atime",name:"Last Access Time",minWidth:150,isCollapsible:!0,onRender:e=>new Date(1e3*Number(e.atime)).toLocaleString()}),i))o.onColumnClick=(e,t)=>{this.sortKey===t.key?(0,D.z)(()=>this.sortDescending=!this.sortDescending):(0,D.z)(()=>{this.sortKey=t.key,this.sortDescending=!1})},o.key===this.sortKey&&(o.isSorted=!0,o.isSortedDescending=this.sortDescending);return i}changeDirectory(e){this.path!==e&&(this.path=e,R.q.device&&this.loadFiles())}constructor(){this.initial=!0,this.visible=!1,this.path="/",this.loading=!1,this.items=[],this.sortKey="name",this.sortDescending=!1,this.uploading=!1,this.uploadPath=void 0,this.uploadedSize=0,this.uploadTotalSize=0,this.debouncedUploadedSize=0,this.uploadSpeed=0,this.selectedItems=[],this.contextMenuTarget=void 0,this.pushPathQuery=e=>{q().push({query:{...q().query,path:e}})},this.loadFiles=(0,U.FW)(async e=>{let t=this.path;if((0,D.z)(()=>this.items=[]),!R.q.device)return;(0,D.z)(()=>this.loading=!0);let i=await R.q.device.sync(),s=[],n=[],a=setInterval(()=>{e.aborted||(0,D.z)(()=>this.items=s.slice())},1e3);try{for await(let o of i.opendir(t)){if(e.aborted)return;"."!==o.name&&".."!==o.name&&(o.type===S.d6.Link?n.push(o):s.push(_(o)))}for(let l of n){if(e.aborted)return;await i.isDirectory(E().resolve(t,l.name))||(l.mode=S.d6.File<<12|l.permission,l.size=0n),s.push(_(l))}if(e.aborted)return;(0,D.z)(()=>this.items=s)}finally{e.aborted||(0,D.z)(()=>this.loading=!1),clearInterval(a),i.dispose()}}),this.upload=async e=>{let t=await R.q.device.sync();try{let i=E().resolve(this.path,e.name);(0,D.z)(()=>{this.uploading=!0,this.uploadPath=e.name,this.uploadedSize=0,this.uploadTotalSize=e.size,this.debouncedUploadedSize=0,this.uploadSpeed=0});let s=setInterval((0,D.aD)(()=>{this.uploadSpeed=this.uploadedSize-this.debouncedUploadedSize,this.debouncedUploadedSize=this.uploadedSize}),1e3);try{await (0,U.Xd)(e).pipeThrough(new C.Cc(S.j4)).pipeThrough(new U.hK((0,D.aD)(e=>{this.uploadedSize=e}))).pipeTo(t.write(i,S.d6.File<<12|438,e.lastModified/1e3)),(0,D.z)(()=>{this.uploadSpeed=this.uploadedSize-this.debouncedUploadedSize,this.debouncedUploadedSize=this.uploadedSize})}finally{clearInterval(s)}}catch(n){R.q.showErrorDialog(n)}finally{t.dispose(),this.loadFiles(),(0,D.z)(()=>{this.uploading=!1})}},(0,D.ky)(this,{initial:!1,items:D.LO.shallow,pushPathQuery:!1,changeDirectory:D.aD.bound,loadFiles:!1}),(0,D.EH)(()=>{R.q.device?this.initial&&this.visible&&(this.initial=!1,this.loadFiles()):this.initial=!0})}},A=(0,I.Pi)(()=>(0,s.jsx)(o.V,{hidden:!K.uploading,dialogContentProps:{title:"Uploading...",subText:K.uploadPath},children:(0,s.jsx)(l.Y,{description:(0,U.CY)(K.debouncedUploadedSize,K.uploadTotalSize,K.uploadSpeed),percentComplete:K.uploadedSize/K.uploadTotalSize})})),O=()=>{(0,F.useEffect)(()=>((0,D.z)(()=>{K.visible=!0}),()=>{(0,D.z)(()=>{K.visible=!1})}));let e=(0,T.useRouter)();(0,F.useEffect)(()=>{let t=e.query.path;if(!t){e.replace({query:{...e.query,path:K.path}});return}Array.isArray(t)&&(t=t[0]),K.changeDirectory(t)},[e]);let[t,i]=(0,F.useState)(),n=(0,F.useCallback)(async e=>{let t=await R.q.device.sync();try{let s=t.read(e),n=new Response(s),a=await n.blob(),o=window.URL.createObjectURL(a);i(o)}finally{t.dispose()}},[]),a=(0,F.useCallback)(()=>{i(void 0)},[]),o=(0,F.useCallback)(e=>{switch(e.type){case S.d6.Link:case S.d6.Directory:K.pushPathQuery(E().resolve(K.path,e.name));break;case S.d6.File:switch(E().extname(e.name)){case".jpg":case".png":case".svg":case".gif":n(E().resolve(K.path,e.name))}}},[n]),l=(0,z.B)(()=>new r.Y({onSelectionChanged(){(0,D.z)(()=>{K.selectedItems=l.getSelection()})}})),x=(0,F.useCallback)((e,t,i)=>!!i&&(K.menuItems.length&&(0,D.z)(()=>{K.contextMenuTarget=i}),!1),[]),k=(0,F.useCallback)(()=>{(0,D.z)(()=>K.contextMenuTarget=void 0)},[]);return(0,s.jsxs)(d.K,{...U.LE,children:[(0,s.jsx)(P(),{children:(0,s.jsx)("title",{children:"File Manager - Android Web Toolbox"})}),(0,s.jsx)(N.X3,{items:K.menuItems}),(0,s.jsx)(h.a,{items:K.breadcrumbItems}),(0,s.jsxs)(c.v,{grow:!0,styles:{root:{margin:"-8px -16px -16px -16px",padding:"8px 16px 16px 16px",overflowY:"auto"}},children:[(0,s.jsx)(u.x,{selection:l,children:(0,s.jsx)(p.J,{items:K.sortedList,columns:K.columns,setKey:K.path,selection:l,layoutMode:m.Oh.justified,enableShimmer:K.loading&&0===K.items.length,onItemInvoked:o,onItemContextMenu:x,onRenderDetailsHeader:W,usePageCache:!0,useReducedRowRenderer:!0})}),t&&(0,s.jsx)(y.m,{children:(0,s.jsx)(g.a,{onClick:a,children:(0,s.jsx)("div",{style:{width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center"},children:(0,s.jsx)("img",{src:t,alt:"",style:{maxWidth:"100%",maxHeight:"100%"}})})})})]}),(0,s.jsx)(N.ag,{children:(0,s.jsx)(f.r,{items:K.menuItems,hidden:!K.contextMenuTarget,directionalHint:b.b.bottomLeftEdge,target:K.contextMenuTarget,onDismiss:k,contextualMenuItemAs:e=>(0,s.jsx)(w.W,{...e,hasIcons:!1})})}),(0,s.jsx)(A,{})]})};t.default=(0,I.Pi)(O)}},function(e){e.O(0,[575,774,888,179],function(){return e(e.s=7655)}),_N_E=e.O()}]);
//# sourceMappingURL=file-manager-793c4a90f2303f79.js.map