{"version":3,"file":"static/chunks/pages/scrcpy-4be67dddd427e863.js","mappings":"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","sources":["webpack://_N_E/?7ce0","webpack://_N_E/../../common/temp/node_modules/.pnpm/@fluentui+react@8.104.1_ib3m5ricvtkl2cll7qpr2f6lvq/node_modules/@fluentui/react/lib/components/src/components/Layer/LayerHost.tsx","webpack://_N_E/../../libraries/scrcpy/src/adb/connection.ts","webpack://_N_E/../../libraries/scrcpy/src/adb/options/types.ts","webpack://_N_E/../../libraries/scrcpy/src/adb/options/1_16.ts","webpack://_N_E/../../libraries/scrcpy/src/adb/options/1_22.ts","webpack://_N_E/../../libraries/scrcpy/src/adb/options/index.ts","webpack://_N_E/../../libraries/scrcpy/src/control/type.ts","webpack://_N_E/../../libraries/scrcpy/src/control/inject-touch.ts","webpack://_N_E/../../libraries/scrcpy/src/control/hover-helper.ts","webpack://_N_E/../../libraries/scrcpy/src/control/inject-keycode.ts","webpack://_N_E/../../libraries/scrcpy/src/control/inject-text.ts","webpack://_N_E/../../libraries/scrcpy/src/control/rotate-device.ts","webpack://_N_E/../../libraries/scrcpy/src/control/set-screen-power-mode.ts","webpack://_N_E/../../libraries/scrcpy/src/control/serializer.ts","webpack://_N_E/../../libraries/scrcpy/src/control/index.ts","webpack://_N_E/../../libraries/scrcpy/src/device-message/type.ts","webpack://_N_E/../../libraries/scrcpy/src/device-message/clipboard.ts","webpack://_N_E/../../libraries/scrcpy/src/device-message/stream.ts","webpack://_N_E/../../libraries/scrcpy/src/device-message/index.ts","webpack://_N_E/../../libraries/scrcpy/src/options/1_16/codec-options.ts","webpack://_N_E/../../libraries/scrcpy/src/options/types.ts","webpack://_N_E/../../libraries/scrcpy/src/options/1_16/h264-configuration.ts","webpack://_N_E/../../libraries/scrcpy/src/options/1_16/scroll.ts","webpack://_N_E/../../libraries/scrcpy/src/options/1_16/options.ts","webpack://_N_E/../../libraries/scrcpy/src/options/1_16/index.ts","webpack://_N_E/../../libraries/scrcpy/src/options/1_18.ts","webpack://_N_E/../../libraries/scrcpy/src/options/1_21.ts","webpack://_N_E/../../libraries/scrcpy/src/options/1_22/scroll.ts","webpack://_N_E/../../libraries/scrcpy/src/options/1_22/options.ts","webpack://_N_E/../../libraries/scrcpy/src/options/1_22/index.ts","webpack://_N_E/../../libraries/scrcpy/src/options/1_23.ts","webpack://_N_E/../../libraries/scrcpy/src/options/1_24.ts","webpack://_N_E/../../libraries/scrcpy/src/options/1_25/scroll.ts","webpack://_N_E/../../libraries/scrcpy/src/options/1_25/options.ts","webpack://_N_E/../../libraries/scrcpy/src/options/1_25/index.ts","webpack://_N_E/../../libraries/scrcpy/src/options/index.ts","webpack://_N_E/../../libraries/scrcpy/src/adb/client.ts","webpack://_N_E/../../libraries/scrcpy/src/adb/index.ts","webpack://_N_E/../../libraries/scrcpy/src/codec.ts","webpack://_N_E/../../libraries/scrcpy/src/index.ts","webpack://_N_E/../../libraries/scrcpy-decoder-tinyh264/src/wrapper.ts","webpack://_N_E/../../libraries/scrcpy-decoder-tinyh264/src/index.ts","webpack://_N_E/../../libraries/scrcpy-decoder-webcodecs/src/index.ts","webpack://_N_E/../../libraries/scrcpy/bin/version.js","webpack://_N_E/./src/pages/scrcpy.tsx","webpack://_N_E/<anon>"],"sourcesContent":["\n    (window.__NEXT_P = window.__NEXT_P || []).push([\n      \"/scrcpy\",\n      function () {\n        return require(\"private-next-pages/scrcpy.tsx\");\n      }\n    ]);\n    if(module.hot) {\n      module.hot.dispose(function () {\n        window.__NEXT_P.push([\"/scrcpy\"])\n      });\n    }\n  ","import * as React from 'react';\nimport { useUnmount } from '@fluentui/react-hooks';\nimport { css, getId } from '../../Utilities';\nimport { notifyHostChanged, registerLayerHost, unregisterLayerHost } from './Layer.notification';\nimport type { ILayerHost, ILayerHostProps } from './LayerHost.types';\n\nexport const LayerHost: React.FunctionComponent<ILayerHostProps> = props => {\n  const { className } = props;\n\n  const [layerHostId] = React.useState(() => getId());\n\n  const { id: hostId = layerHostId } = props;\n\n  const layerHostRef = React.useRef<ILayerHost>({\n    hostId,\n    rootRef: React.useRef<HTMLDivElement | null>(null),\n    notifyLayersChanged: () => {\n      // Nothing, since the default implementation of Layer Host does not need to react to layer changes.\n    },\n  });\n\n  React.useImperativeHandle(props.componentRef, () => layerHostRef.current);\n\n  React.useEffect(() => {\n    registerLayerHost(hostId, layerHostRef.current);\n    notifyHostChanged(hostId);\n    // eslint-disable-next-line react-hooks/exhaustive-deps -- should only run on first render\n  }, []);\n\n  useUnmount(() => {\n    unregisterLayerHost(hostId, layerHostRef.current);\n    notifyHostChanged(hostId);\n  });\n\n  return <div {...props} className={css('ms-LayerHost', className)} ref={layerHostRef.current.rootRef} />;\n};\n","import { type Adb } from \"@yume-chan/adb\";\nimport { delay } from \"@yume-chan/async\";\nimport { type Disposable } from \"@yume-chan/event\";\nimport {\n    TransformStream,\n    type ReadableStream,\n    type ReadableStreamDefaultReader,\n    type ReadableWritablePair,\n} from \"@yume-chan/stream-extra\";\nimport { type ValueOrPromise } from \"@yume-chan/struct\";\n\nexport interface AdbScrcpyConnectionOptions {\n    control: boolean;\n\n    /**\n     * Write a byte on start to detect connection issues\n     */\n    sendDummyByte: boolean;\n\n    /**\n     * Send device name and size\n     */\n    sendDeviceMeta: boolean;\n}\n\nexport abstract class AdbScrcpyConnection implements Disposable {\n    protected adb: Adb;\n\n    protected options: AdbScrcpyConnectionOptions;\n\n    public constructor(adb: Adb, options: AdbScrcpyConnectionOptions) {\n        this.adb = adb;\n        this.options = options;\n    }\n\n    public initialize(): ValueOrPromise<void> {\n        // do nothing\n    }\n\n    public abstract getStreams(): ValueOrPromise<\n        [\n            videoSteam: ReadableStream<Uint8Array>,\n            controlStream:\n                | ReadableWritablePair<Uint8Array, Uint8Array>\n                | undefined\n        ]\n    >;\n\n    public dispose(): void {\n        // do nothing\n    }\n}\n\nexport class AdbScrcpyForwardConnection extends AdbScrcpyConnection {\n    private connect(): Promise<ReadableWritablePair<Uint8Array, Uint8Array>> {\n        return this.adb.createSocket(\"localabstract:scrcpy\");\n    }\n\n    private async connectAndRetry(): Promise<\n        ReadableWritablePair<Uint8Array, Uint8Array>\n    > {\n        for (let i = 0; i < 100; i += 1) {\n            try {\n                return await this.connect();\n            } catch (e) {\n                await delay(100);\n            }\n        }\n        throw new Error(`Can't connect to server after 100 retries`);\n    }\n\n    private async connectVideoStream(): Promise<ReadableStream<Uint8Array>> {\n        const { readable: videoStream } = await this.connectAndRetry();\n        if (this.options.sendDummyByte) {\n            const reader = videoStream.getReader();\n            const { done, value } = await reader.read();\n            // server will write a `0` to signal connection success\n            if (done || value.byteLength !== 1 || value[0] !== 0) {\n                throw new Error(\"Unexpected response from server\");\n            }\n            reader.releaseLock();\n        }\n        return videoStream;\n    }\n\n    public async getStreams(): Promise<\n        [\n            videoSteam: ReadableStream<Uint8Array>,\n            controlStream:\n                | ReadableWritablePair<Uint8Array, Uint8Array>\n                | undefined\n        ]\n    > {\n        const videoStream = await this.connectVideoStream();\n\n        let controlStream:\n            | ReadableWritablePair<Uint8Array, Uint8Array>\n            | undefined;\n        if (this.options.control) {\n            controlStream = await this.connectAndRetry();\n        }\n\n        // Server only writes device meta after control socket is connected (if enabled)\n        if (this.options.sendDeviceMeta) {\n            const reader = videoStream.getReader();\n            const { done, value } = await reader.read();\n            // 64 bytes device name + 2 bytes video width + 2 bytes video height\n            if (done || value.byteLength !== 64 + 2 + 2) {\n                throw new Error(\"Unexpected response from server\");\n            }\n            reader.releaseLock();\n        }\n\n        return [videoStream, controlStream];\n    }\n}\n\nexport class AdbScrcpyReverseConnection extends AdbScrcpyConnection {\n    private streams!: ReadableStreamDefaultReader<\n        ReadableWritablePair<Uint8Array, Uint8Array>\n    >;\n\n    private address!: string;\n\n    public override async initialize(): Promise<void> {\n        // try to unbind first, ignore errors\n        await this.adb.reverse.remove(\"localabstract:scrcpy\").catch((e) => {\n            void e;\n        });\n\n        const queue = new TransformStream<\n            ReadableWritablePair<Uint8Array, Uint8Array>,\n            ReadableWritablePair<Uint8Array, Uint8Array>\n        >();\n        this.streams = queue.readable.getReader();\n        const writer = queue.writable.getWriter();\n        this.address = await this.adb.reverse.add(\n            \"localabstract:scrcpy\",\n            \"tcp:27183\",\n            (socket) => {\n                void writer.write(socket);\n                return true;\n            }\n        );\n    }\n\n    private async accept(): Promise<\n        ReadableWritablePair<Uint8Array, Uint8Array>\n    > {\n        return (await this.streams.read()).value!;\n    }\n\n    public async getStreams(): Promise<\n        [\n            videoSteam: ReadableStream<Uint8Array>,\n            controlStream:\n                | ReadableWritablePair<Uint8Array, Uint8Array>\n                | undefined\n        ]\n    > {\n        const { readable: videoStream } = await this.accept();\n\n        let controlStream:\n            | ReadableWritablePair<Uint8Array, Uint8Array>\n            | undefined;\n        if (this.options.control) {\n            controlStream = await this.accept();\n        }\n\n        // Server only writes device meta after control socket is connected (if enabled)\n        if (this.options.sendDeviceMeta) {\n            const reader = videoStream.getReader();\n            const { done, value } = await reader.read();\n            // 64 bytes device name + 2 bytes video width + 2 bytes video height\n            if (done || value.byteLength !== 64 + 2 + 2) {\n                throw new Error(\"Unexpected response from server\");\n            }\n            reader.releaseLock();\n        }\n\n        return [videoStream, controlStream];\n    }\n\n    public override dispose() {\n        // Don't await this!\n        // `reverse.remove`'s response will never arrive\n        // before we read all pending data from `videoStream`\n        this.adb.reverse.remove(this.address).catch((e) => {\n            void e;\n        });\n    }\n}\n","import { type Adb } from \"@yume-chan/adb\";\nimport { type TransformStream } from \"@yume-chan/stream-extra\";\n\nimport {\n    type ScrcpyBackOrScreenOnControlMessage,\n    type ScrcpyControlMessageType,\n} from \"../../control/index.js\";\nimport {\n    type ScrcpyOptions,\n    type ScrcpyVideoStreamPacket,\n} from \"../../options/index.js\";\nimport { type AdbScrcpyConnection } from \"../connection.js\";\n\nexport interface AdbScrcpyOptions<T extends object> extends ScrcpyOptions<T> {\n    createConnection(adb: Adb): AdbScrcpyConnection;\n}\n\nexport abstract class AdbScrcpyOptionsBase<T extends object>\n    implements ScrcpyOptions<T>\n{\n    private raw: ScrcpyOptions<T>;\n\n    public get value(): Partial<T> {\n        return this.raw.value;\n    }\n    public set value(value: Partial<T>) {\n        this.raw.value = value;\n    }\n\n    public constructor(raw: ScrcpyOptions<T>) {\n        this.raw = raw;\n    }\n\n    public getDefaultValue(): T {\n        return this.raw.getDefaultValue();\n    }\n\n    public formatServerArguments(): string[] {\n        return this.raw.formatServerArguments();\n    }\n\n    public getOutputEncoderNameRegex(): RegExp {\n        return this.raw.getOutputEncoderNameRegex();\n    }\n\n    public createVideoStreamTransformer(): TransformStream<\n        Uint8Array,\n        ScrcpyVideoStreamPacket\n    > {\n        return this.raw.createVideoStreamTransformer();\n    }\n\n    public getControlMessageTypes(): ScrcpyControlMessageType[] {\n        return this.raw.getControlMessageTypes();\n    }\n\n    public serializeBackOrScreenOnControlMessage(\n        message: ScrcpyBackOrScreenOnControlMessage\n    ): Uint8Array | undefined {\n        return this.raw.serializeBackOrScreenOnControlMessage(message);\n    }\n\n    public getScrollController() {\n        return this.raw.getScrollController();\n    }\n\n    public abstract createConnection(adb: Adb): AdbScrcpyConnection;\n}\n","import { type Adb } from \"@yume-chan/adb\";\n\nimport { type ScrcpyOptionsInit1_16 } from \"../../options/index.js\";\nimport {\n    AdbScrcpyForwardConnection,\n    AdbScrcpyReverseConnection,\n    type AdbScrcpyConnection,\n    type AdbScrcpyConnectionOptions,\n} from \"../connection.js\";\n\nimport { AdbScrcpyOptionsBase } from \"./types.js\";\n\nexport class AdbScrcpyOptions1_16<\n    T extends ScrcpyOptionsInit1_16 = ScrcpyOptionsInit1_16\n> extends AdbScrcpyOptionsBase<T> {\n    public override createConnection(adb: Adb): AdbScrcpyConnection {\n        const options: AdbScrcpyConnectionOptions = {\n            // Old versions always have control stream no matter what the option is\n            // Pass `control: false` to `Connection` will disable the control stream\n            control: true,\n            sendDummyByte: true,\n            sendDeviceMeta: true,\n        };\n        if (this.value.tunnelForward) {\n            return new AdbScrcpyForwardConnection(adb, options);\n        } else {\n            return new AdbScrcpyReverseConnection(adb, options);\n        }\n    }\n}\n","import { type Adb } from \"@yume-chan/adb\";\n\nimport { type ScrcpyOptionsInit1_22 } from \"../../options/index.js\";\nimport {\n    type AdbScrcpyConnection,\n    AdbScrcpyForwardConnection,\n    AdbScrcpyReverseConnection,\n} from \"../connection.js\";\n\nimport { AdbScrcpyOptions1_16 } from \"./1_16.js\";\n\nexport class AdbScrcpyOptions1_22<\n    T extends ScrcpyOptionsInit1_22 = ScrcpyOptionsInit1_22\n> extends AdbScrcpyOptions1_16<T> {\n    public override createConnection(adb: Adb): AdbScrcpyConnection {\n        const options = {\n            ...this.getDefaultValue(),\n            ...this.value,\n        };\n        if (this.value.tunnelForward) {\n            return new AdbScrcpyForwardConnection(adb, options);\n        } else {\n            return new AdbScrcpyReverseConnection(adb, options);\n        }\n    }\n}\n","export * from './1_16.js';\nexport * from './1_22.js';\nexport * from './types.js';\n","// https://github.com/Genymobile/scrcpy/blob/fa5b2a29e983a46b49531def9cf3d80c40c3de37/app/src/control_msg.h#L23\n// For their message bodies, see https://github.com/Genymobile/scrcpy/blob/5c62f3419d252d10cd8c9cbb7c918b358b81f2d0/app/src/control_msg.c#L92\n// Their IDs change between versions, so always use `options.getControlMessageTypes()`\nexport enum ScrcpyControlMessageType {\n    InjectKeyCode,\n    InjectText,\n    InjectTouch,\n    InjectScroll,\n    BackOrScreenOn,\n    ExpandNotificationPanel,\n    ExpandSettingPanel,\n    CollapseNotificationPanel,\n    GetClipboard,\n    SetClipboard,\n    SetScreenPowerMode,\n    RotateDevice,\n}\n","import Struct, {\n    NumberFieldDefinition,\n    NumberFieldType,\n    placeholder,\n} from \"@yume-chan/struct\";\n\nimport { ScrcpyControlMessageType } from \"./type.js\";\n\n// https://developer.android.com/reference/android/view/MotionEvent#constants_1\nexport enum AndroidMotionEventAction {\n    Down,\n    Up,\n    Move,\n    Cancel,\n    Outside,\n    PointerDown,\n    PointerUp,\n    HoverMove,\n    Scroll,\n    HoverEnter,\n    HoverExit,\n    ButtonPress,\n    ButtonRelease,\n}\n\n// eslint-disable-next-line @typescript-eslint/no-namespace\nexport namespace ScrcpyPointerId {\n    export const Mouse = BigInt(-1);\n    export const Finger = BigInt(-2);\n    export const VirtualMouse = BigInt(-3);\n    export const VirtualFinger = BigInt(-4);\n}\n\nexport function clamp(value: number, min: number, max: number): number {\n    if (value < min) {\n        return min;\n    }\n\n    if (value > max) {\n        return max;\n    }\n\n    return value;\n}\n\nconst Uint16Max = (1 << 16) - 1;\n\nconst ScrcpyFloatToUint16NumberType: NumberFieldType = {\n    size: 2,\n    signed: false,\n    deserialize(array, littleEndian) {\n        const value = NumberFieldType.Uint16.deserialize(array, littleEndian);\n        return value / Uint16Max;\n    },\n    serialize(dataView, offset, value, littleEndian) {\n        value = clamp(value, 0, 1) * Uint16Max;\n        NumberFieldType.Uint16.serialize(dataView, offset, value, littleEndian);\n    },\n};\n\nconst ScrcpyFloatToUint16FieldDefinition = new NumberFieldDefinition(\n    ScrcpyFloatToUint16NumberType\n);\n\nexport const ScrcpyInjectTouchControlMessage = new Struct()\n    .uint8(\"type\", ScrcpyControlMessageType.InjectTouch as const)\n    .uint8(\"action\", placeholder<AndroidMotionEventAction>())\n    .uint64(\"pointerId\")\n    .uint32(\"pointerX\")\n    .uint32(\"pointerY\")\n    .uint16(\"screenWidth\")\n    .uint16(\"screenHeight\")\n    .field(\"pressure\", ScrcpyFloatToUint16FieldDefinition)\n    .uint32(\"buttons\");\n\nexport type ScrcpyInjectTouchControlMessage =\n    typeof ScrcpyInjectTouchControlMessage[\"TInit\"];\n","import {\n    AndroidMotionEventAction,\n    type ScrcpyInjectTouchControlMessage,\n} from \"./inject-touch.js\";\nimport { ScrcpyControlMessageType } from \"./type.js\";\n\n/**\n * On Android, touching the screen with a finger will disable mouse cursor.\n * However, Scrcpy doesn't do that, and can inject two pointers at the same time.\n * This can cause finger events to be \"ignored\" because mouse is still the primary pointer.\n *\n * This helper class injects an extra `ACTION_UP` event,\n * so Scrcpy server can remove the previously hovering pointer.\n */\nexport class ScrcpyHoverHelper {\n    // AFAIK, only mouse and pen can have hover state\n    // and you can't have two mouses or pens.\n    private lastHoverMessage: ScrcpyInjectTouchControlMessage | undefined;\n\n    public process(\n        message: Omit<ScrcpyInjectTouchControlMessage, \"type\">\n    ): ScrcpyInjectTouchControlMessage[] {\n        const result: ScrcpyInjectTouchControlMessage[] = [];\n\n        // A different pointer appeared,\n        // Cancel previously hovering pointer so Scrcpy server can free up the pointer ID.\n        if (\n            this.lastHoverMessage &&\n            this.lastHoverMessage.pointerId !== message.pointerId\n        ) {\n            // TODO: Inject MotionEvent.ACTION_HOVER_EXIT\n            // From testing, it seems no App cares about this event.\n            result.push({\n                ...this.lastHoverMessage,\n                action: AndroidMotionEventAction.Up,\n            });\n            this.lastHoverMessage = undefined;\n        }\n\n        if (message.action === AndroidMotionEventAction.HoverMove) {\n            // TODO: Inject MotionEvent.ACTION_HOVER_ENTER\n            this.lastHoverMessage = message as ScrcpyInjectTouchControlMessage;\n        }\n\n        (message as ScrcpyInjectTouchControlMessage).type =\n            ScrcpyControlMessageType.InjectTouch;\n        result.push(message as ScrcpyInjectTouchControlMessage);\n\n        return result;\n    }\n}\n","import Struct, { placeholder } from \"@yume-chan/struct\";\n\nimport { ScrcpyControlMessageType } from \"./type.js\";\n\nexport enum AndroidKeyEventAction {\n    Down = 0,\n    Up = 1,\n}\n\n// https://github.com/Genymobile/scrcpy/blob/cabb102a04153f9c237b18257d3269a058558c63/app/src/android/keycodes.h#L26\nexport enum AndroidKeyCode {\n    Home = 3,\n    Back = 4,\n\n    DPadUp = 19,\n    DPadDown,\n    DPadLeft,\n    DPadRight,\n\n    VolumeUp = 24,\n    VolumeDown,\n\n    A = 29,\n    B,\n    C,\n    D,\n    E,\n    F,\n    G,\n    H,\n    I,\n    J,\n    K,\n    L,\n    M,\n    N,\n    O,\n    P,\n    Q,\n    R,\n    S,\n    T,\n    U,\n    V,\n    W,\n    X,\n    Y,\n    Z,\n\n    Tab = 61,\n    Space,\n    Enter = 66,\n    Delete,\n    Escape = 111,\n    ForwardDelete,\n\n    MoveHome = 122,\n    MoveEnd = 123,\n\n    VolumeMute = 164,\n    AppSwitch = 187,\n}\n\nexport const ScrcpyInjectKeyCodeControlMessage = new Struct()\n    .uint8(\"type\", ScrcpyControlMessageType.InjectKeyCode as const)\n    .uint8(\"action\", placeholder<AndroidKeyEventAction>())\n    .uint32(\"keyCode\")\n    .uint32(\"repeat\")\n    .uint32(\"metaState\");\n\nexport type ScrcpyInjectKeyCodeControlMessage =\n    typeof ScrcpyInjectKeyCodeControlMessage[\"TInit\"];\n","import Struct from '@yume-chan/struct';\n\nimport { ScrcpyControlMessageType } from './type.js';\n\nexport const ScrcpyInjectTextControlMessage =\n    new Struct()\n        .uint8('type', ScrcpyControlMessageType.InjectText as const)\n        .uint32('length')\n        .string('text', { lengthField: 'length' });\n\nexport type ScrcpyInjectTextControlMessage =\n    typeof ScrcpyInjectTextControlMessage['TInit'];\n","import Struct from '@yume-chan/struct';\n\nimport { ScrcpyControlMessageType } from './type.js';\n\nexport const ScrcpyRotateDeviceControlMessage =\n    new Struct()\n        .uint8('type', ScrcpyControlMessageType.RotateDevice as const)\n\nexport type ScrcpyRotateDeviceControlMessage =\n    typeof ScrcpyRotateDeviceControlMessage['TInit'];\n","import Struct, { placeholder } from '@yume-chan/struct';\n\nimport { ScrcpyControlMessageType } from './type.js';\n\n// https://cs.android.com/android/platform/superproject/+/master:frameworks/base/core/java/android/view/SurfaceControl.java;l=659;drc=20303e05bf73796124ab70a279cf849b61b97905\nexport enum AndroidScreenPowerMode {\n    Off = 0,\n    Normal = 2\n}\n\nexport const ScrcpySetScreenPowerModeControlMessage =\n    new Struct()\n        .uint8('type', ScrcpyControlMessageType.SetScreenPowerMode as const)\n        .uint8('mode', placeholder<AndroidScreenPowerMode>());\n\nexport type ScrcpySetScreenPowerModeControlMessage =\n    typeof ScrcpySetScreenPowerModeControlMessage['TInit'];\n","import {\n    type WritableStream,\n    type WritableStreamDefaultWriter,\n} from \"@yume-chan/stream-extra\";\n\nimport {\n    type ScrcpyOptions,\n    type ScrcpyScrollController,\n} from \"../options/index.js\";\n\nimport {\n    ScrcpyInjectKeyCodeControlMessage,\n    type AndroidKeyEventAction,\n} from \"./inject-keycode.js\";\nimport { type ScrcpyInjectScrollControlMessage } from \"./inject-scroll.js\";\nimport { ScrcpyInjectTextControlMessage } from \"./inject-text.js\";\nimport { ScrcpyInjectTouchControlMessage } from \"./inject-touch.js\";\nimport { ScrcpyRotateDeviceControlMessage } from \"./rotate-device.js\";\nimport {\n    ScrcpySetScreenPowerModeControlMessage,\n    type AndroidScreenPowerMode,\n} from \"./set-screen-power-mode.js\";\nimport { ScrcpyControlMessageType } from \"./type.js\";\n\nexport class ScrcpyControlMessageSerializer {\n    private options: ScrcpyOptions<object>;\n    /** Control message type values for current version of server */\n    private types: ScrcpyControlMessageType[];\n    private writer: WritableStreamDefaultWriter<Uint8Array>;\n    private scrollController: ScrcpyScrollController;\n\n    public constructor(\n        stream: WritableStream<Uint8Array>,\n        options: ScrcpyOptions<object>\n    ) {\n        this.writer = stream.getWriter();\n\n        this.options = options;\n        this.types = options.getControlMessageTypes();\n        this.scrollController = options.getScrollController();\n    }\n\n    public getTypeValue(type: ScrcpyControlMessageType): number {\n        const value = this.types.indexOf(type);\n        if (value === -1) {\n            throw new Error(\"Not supported\");\n        }\n        return value;\n    }\n\n    public injectKeyCode(\n        message: Omit<ScrcpyInjectKeyCodeControlMessage, \"type\">\n    ) {\n        return this.writer.write(\n            ScrcpyInjectKeyCodeControlMessage.serialize({\n                ...message,\n                type: this.getTypeValue(ScrcpyControlMessageType.InjectKeyCode),\n            })\n        );\n    }\n\n    public injectText(text: string) {\n        return this.writer.write(\n            ScrcpyInjectTextControlMessage.serialize({\n                text,\n                type: this.getTypeValue(ScrcpyControlMessageType.InjectText),\n            })\n        );\n    }\n\n    /**\n     * `pressure` is a float value between 0 and 1.\n     */\n    public injectTouch(message: Omit<ScrcpyInjectTouchControlMessage, \"type\">) {\n        return this.writer.write(\n            ScrcpyInjectTouchControlMessage.serialize({\n                ...message,\n                type: this.getTypeValue(ScrcpyControlMessageType.InjectTouch),\n            })\n        );\n    }\n\n    /**\n     * `scrollX` and `scrollY` are float values between 0 and 1.\n     */\n    public injectScroll(\n        message: Omit<ScrcpyInjectScrollControlMessage, \"type\">\n    ) {\n        (message as ScrcpyInjectScrollControlMessage).type = this.getTypeValue(\n            ScrcpyControlMessageType.InjectScroll\n        );\n\n        const data = this.scrollController.serializeScrollMessage(\n            message as ScrcpyInjectScrollControlMessage\n        );\n        if (!data) {\n            return;\n        }\n\n        return this.writer.write(data);\n    }\n\n    public async backOrScreenOn(action: AndroidKeyEventAction) {\n        const buffer = this.options.serializeBackOrScreenOnControlMessage({\n            action,\n            type: this.getTypeValue(ScrcpyControlMessageType.BackOrScreenOn),\n        });\n\n        if (buffer) {\n            return await this.writer.write(buffer);\n        }\n    }\n\n    public setScreenPowerMode(mode: AndroidScreenPowerMode) {\n        return this.writer.write(\n            ScrcpySetScreenPowerModeControlMessage.serialize({\n                mode,\n                type: this.getTypeValue(\n                    ScrcpyControlMessageType.SetScreenPowerMode\n                ),\n            })\n        );\n    }\n\n    public rotateDevice() {\n        return this.writer.write(\n            ScrcpyRotateDeviceControlMessage.serialize({\n                type: this.getTypeValue(ScrcpyControlMessageType.RotateDevice),\n            })\n        );\n    }\n\n    public close() {\n        return this.writer.close();\n    }\n}\n","export * from \"./back-or-screen-on.js\";\nexport * from \"./hover-helper.js\";\nexport * from \"./inject-keycode.js\";\nexport * from \"./inject-scroll.js\";\nexport * from \"./inject-text.js\";\nexport * from \"./inject-touch.js\";\nexport * from \"./rotate-device.js\";\nexport * from \"./serializer.js\";\nexport * from \"./set-screen-power-mode.js\";\nexport * from \"./type.js\";\n","// https://github.com/Genymobile/scrcpy/blob/41abe021e2a73efd4899b0efcd0b9eef9ec68c9b/server/src/main/java/com/genymobile/scrcpy/DeviceMessage.java#L5\nexport enum ScrcpyDeviceMessageType {\n    Clipboard,\n    AckClipboard,\n}\n","import Struct from \"@yume-chan/struct\";\n\nimport { ScrcpyDeviceMessageType } from \"./type.js\";\n\nexport const ScrcpyClipboardDeviceMessage = new Struct()\n    .uint32(\"length\")\n    .string(\"content\", { lengthField: \"length\" })\n    .extra({ type: ScrcpyDeviceMessageType.Clipboard as const });\n\nexport type ScrcpyClipboardDeviceMessage =\n    typeof ScrcpyClipboardDeviceMessage[\"TDeserializeResult\"];\n","import { BufferedTransformStream } from \"@yume-chan/stream-extra\";\n\nimport { ScrcpyClipboardDeviceMessage } from \"./clipboard.js\";\n\nexport type ScrcpyDeviceMessage = ScrcpyClipboardDeviceMessage;\n\nexport class ScrcpyDeviceMessageDeserializeStream extends BufferedTransformStream<ScrcpyDeviceMessage> {\n    constructor() {\n        super(async (stream) => {\n            const type = await stream.read(1);\n            switch (type[0]) {\n                case 0:\n                    return await ScrcpyClipboardDeviceMessage.deserialize(\n                        stream\n                    );\n                default:\n                    throw new Error(\"unknown control message type\");\n            }\n        });\n    }\n}\n","export * from './clipboard.js';\nexport * from './stream.js';\nexport * from './type.js';\n","import {\n    type AndroidCodecLevel,\n    type AndroidCodecProfile,\n} from \"../../codec.js\";\nimport { type ScrcpyOptionValue } from \"../types.js\";\n\n/**\n * If the option you need is not in this type,\n * please file an issue on GitHub.\n */\nexport interface CodecOptionsInit {\n    profile: AndroidCodecProfile;\n    level: AndroidCodecLevel;\n\n    iFrameInterval: number;\n    repeatPreviousFrameAfter: number;\n    maxPtsGapToEncoder: number;\n}\n\nfunction toDashCase(input: string) {\n    return input.replace(/([A-Z])/g, \"-$1\").toLowerCase();\n}\n\nconst CODEC_OPTION_TYPES: Partial<\n    Record<keyof CodecOptionsInit, \"long\" | \"float\" | \"string\">\n> = {\n    repeatPreviousFrameAfter: \"long\",\n    maxPtsGapToEncoder: \"long\",\n};\n\nexport class CodecOptions implements ScrcpyOptionValue {\n    public value: Partial<CodecOptionsInit>;\n\n    public constructor(value: Partial<CodecOptionsInit>) {\n        this.value = value;\n    }\n\n    public toOptionValue(): string | undefined {\n        const entries = Object.entries(this.value).filter(\n            ([, value]) => value !== undefined\n        );\n\n        if (entries.length === 0) {\n            return undefined;\n        }\n\n        return entries\n            .map(([key, value]) => {\n                const type = CODEC_OPTION_TYPES[key as keyof CodecOptionsInit];\n                return `${toDashCase(key)}${type ? `:${type}` : \"\"}=${value}`;\n            })\n            .join(\",\");\n    }\n}\n","import { type TransformStream } from \"@yume-chan/stream-extra\";\n\nimport {\n    type ScrcpyBackOrScreenOnControlMessage,\n    type ScrcpyControlMessageType,\n} from \"../control/index.js\";\n\nimport { type ScrcpyScrollController } from \"./1_16/scroll.js\";\n\nexport const DEFAULT_SERVER_PATH = \"/data/local/tmp/scrcpy-server.jar\";\n\nexport interface ScrcpyOptionValue {\n    toOptionValue(): string | undefined;\n}\n\nexport function isScrcpyOptionValue(\n    value: unknown\n): value is ScrcpyOptionValue {\n    return (\n        typeof value === \"object\" &&\n        value !== null &&\n        \"toOptionValue\" in value &&\n        typeof value.toOptionValue === \"function\"\n    );\n}\n\nexport function toScrcpyOptionValue<T>(value: unknown, empty: T): string | T {\n    if (isScrcpyOptionValue(value)) {\n        value = value.toOptionValue();\n    }\n\n    // `value` may become `undefined` after `toOptionValue`\n    if (value === undefined) {\n        return empty;\n    }\n\n    return String(value);\n}\n\nexport interface H264Configuration {\n    profileIndex: number;\n    constraintSet: number;\n    levelIndex: number;\n\n    encodedWidth: number;\n    encodedHeight: number;\n\n    cropLeft: number;\n    cropRight: number;\n\n    cropTop: number;\n    cropBottom: number;\n\n    croppedWidth: number;\n    croppedHeight: number;\n}\n\nexport interface ScrcpyVideoStreamConfigurationPacket {\n    type: \"configuration\";\n    sequenceParameterSet: Uint8Array;\n    pictureParameterSet: Uint8Array;\n    data: H264Configuration;\n}\n\nexport interface ScrcpyVideoStreamFramePacket {\n    type: \"frame\";\n    keyframe?: boolean | undefined;\n    pts?: bigint | undefined;\n    data: Uint8Array;\n}\n\nexport type ScrcpyVideoStreamPacket =\n    | ScrcpyVideoStreamConfigurationPacket\n    | ScrcpyVideoStreamFramePacket;\n\nexport interface ScrcpyOptions<T extends object> {\n    value: Partial<T>;\n\n    getDefaultValue(): T;\n\n    formatServerArguments(): string[];\n\n    getOutputEncoderNameRegex(): RegExp;\n\n    createVideoStreamTransformer(): TransformStream<\n        Uint8Array,\n        ScrcpyVideoStreamPacket\n    >;\n\n    getControlMessageTypes(): ScrcpyControlMessageType[];\n\n    serializeBackOrScreenOnControlMessage(\n        message: ScrcpyBackOrScreenOnControlMessage\n    ): Uint8Array | undefined;\n\n    getScrollController(): ScrcpyScrollController;\n}\n","// cspell: ignore golomb\n// cspell: ignore qpprime\n\n// H.264 has two standards: ITU-T H.264 and ISO/IEC 14496-10\n// they have the same content, and refer themselves as \"H.264\".\n// The name \"AVC\" (Advanced Video Coding) is only used in ISO spec name,\n// and other ISO specs referring to H.264.\n// Because this module parses H.264 Annex B format,\n// it's named \"h264\" instead of \"avc\".\n\nclass BitReader {\n    private buffer: Uint8Array;\n\n    private bytePosition = 0;\n\n    private bitPosition = 0;\n\n    public constructor(buffer: Uint8Array) {\n        this.buffer = buffer;\n    }\n\n    public read(length: number): number {\n        let result = 0;\n        for (let i = 0; i < length; i += 1) {\n            result = (result << 1) | this.next();\n        }\n        return result;\n    }\n\n    public next(): number {\n        const value =\n            (this.buffer[this.bytePosition]! >> (7 - this.bitPosition)) & 1;\n        this.bitPosition += 1;\n        if (this.bitPosition === 8) {\n            this.bytePosition += 1;\n            this.bitPosition = 0;\n        }\n        return value;\n    }\n\n    public decodeExponentialGolombNumber(): number {\n        let length = 0;\n        while (this.next() === 0) {\n            length += 1;\n        }\n        if (length === 0) {\n            return 0;\n        }\n        return ((1 << length) | this.read(length)) - 1;\n    }\n}\n\n/**\n * Parse NAL units from H.264 Annex B formatted data.\n */\nfunction* iterateNalu(buffer: Uint8Array): Generator<Uint8Array> {\n    // -1 means we haven't found the first start code\n    let start = -1;\n    let writeIndex = 0;\n\n    // How many `0x00`s in a row we have counted\n    let zeroCount = 0;\n\n    let inEmulation = false;\n\n    for (const byte of buffer) {\n        buffer[writeIndex] = byte;\n        writeIndex += 1;\n\n        if (inEmulation) {\n            if (byte > 0x03) {\n                // `0x00000304` or larger are invalid\n                throw new Error(\"Invalid data\");\n            }\n\n            inEmulation = false;\n            continue;\n        }\n\n        if (byte == 0x00) {\n            zeroCount += 1;\n            continue;\n        }\n\n        const lastZeroCount = zeroCount;\n        zeroCount = 0;\n\n        if (start === -1) {\n            // 0x000001 is the start code\n            // But it can be preceded by any number of zeros\n            // So 2 is the minimal\n            if (lastZeroCount >= 2 && byte === 0x01) {\n                // Found start of first NAL unit\n                writeIndex = 0;\n                start = 0;\n                continue;\n            }\n\n            // Not begin with start code\n            throw new Error(\"Invalid data\");\n        }\n\n        if (lastZeroCount < 2) {\n            // zero or one `0x00`s are acceptable\n            continue;\n        }\n\n        if (byte === 0x01) {\n            // Remove all leading `0x00`s and this `0x01`\n            writeIndex -= lastZeroCount + 1;\n\n            // Found another NAL unit\n            yield buffer.subarray(start, writeIndex);\n\n            start = writeIndex;\n            continue;\n        }\n\n        if (lastZeroCount > 2) {\n            // Too much `0x00`s\n            throw new Error(\"Invalid data\");\n        }\n\n        switch (byte) {\n            case 0x02:\n                // Didn't find why, but 7.4.1 NAL unit semantics forbids `0x000002` appearing in NAL units\n                throw new Error(\"Invalid data\");\n            case 0x03:\n                // `0x000003` is the \"emulation_prevention_three_byte\"\n                // `0x00000300`, `0x00000301`, `0x00000302` and `0x00000303` represent\n                // `0x000000`, `0x000001`, `0x000002` and `0x000003` respectively\n\n                // Remove current byte\n                writeIndex -= 1;\n\n                inEmulation = true;\n                break;\n            default:\n                // `0x000004` or larger are as-is\n                break;\n        }\n    }\n\n    if (inEmulation || zeroCount !== 0) {\n        throw new Error(\"Invalid data\");\n    }\n\n    yield buffer.subarray(start, writeIndex);\n}\n\n// 7.3.2.1.1 Sequence parameter set data syntax\n// Variable names in this method uses the snake_case convention as in the spec for easier referencing.\nexport function parseSequenceParameterSet(buffer: Uint8Array) {\n    const reader = new BitReader(buffer);\n    if (reader.next() !== 0) {\n        throw new Error(\"Invalid data\");\n    }\n\n    const nal_ref_idc = reader.read(2);\n    const nal_unit_type = reader.read(5);\n\n    if (nal_unit_type !== 7) {\n        throw new Error(\"Invalid data\");\n    }\n\n    if (nal_ref_idc === 0) {\n        throw new Error(\"Invalid data\");\n    }\n\n    const profile_idc = reader.read(8);\n    const constraint_set = reader.read(8);\n\n    const constraint_set_reader = new BitReader(\n        new Uint8Array([constraint_set])\n    );\n    const constraint_set0_flag = !!constraint_set_reader.next();\n    const constraint_set1_flag = !!constraint_set_reader.next();\n    const constraint_set2_flag = !!constraint_set_reader.next();\n    const constraint_set3_flag = !!constraint_set_reader.next();\n    const constraint_set4_flag = !!constraint_set_reader.next();\n    const constraint_set5_flag = !!constraint_set_reader.next();\n\n    // reserved_zero_2bits\n    if (constraint_set_reader.read(2) !== 0) {\n        throw new Error(\"Invalid data\");\n    }\n\n    const level_idc = reader.read(8);\n    const seq_parameter_set_id = reader.decodeExponentialGolombNumber();\n\n    if (\n        profile_idc === 100 ||\n        profile_idc === 110 ||\n        profile_idc === 122 ||\n        profile_idc === 244 ||\n        profile_idc === 44 ||\n        profile_idc === 83 ||\n        profile_idc === 86 ||\n        profile_idc === 118 ||\n        profile_idc === 128 ||\n        profile_idc === 138 ||\n        profile_idc === 139 ||\n        profile_idc === 134\n    ) {\n        const chroma_format_idc = reader.decodeExponentialGolombNumber();\n        if (chroma_format_idc === 3) {\n            // separate_colour_plane_flag\n            reader.next();\n        }\n\n        // bit_depth_luma_minus8\n        reader.decodeExponentialGolombNumber();\n        // bit_depth_chroma_minus8\n        reader.decodeExponentialGolombNumber();\n\n        // qpprime_y_zero_transform_bypass_flag\n        reader.next();\n\n        const seq_scaling_matrix_present_flag = !!reader.next();\n        if (seq_scaling_matrix_present_flag) {\n            const seq_scaling_list_present_flag: boolean[] = [];\n            for (let i = 0; i < (chroma_format_idc !== 3 ? 8 : 12); i += 1) {\n                seq_scaling_list_present_flag[i] = !!reader.next();\n                if (seq_scaling_list_present_flag[i])\n                    if (i < 6) {\n                        // TODO\n                        // scaling_list( ScalingList4x4[ i ], 16,\n                        //               UseDefaultScalingMatrix4x4Flag[ i ])\n                    } else {\n                        // TODO\n                        // scaling_list( ScalingList8x8[ i − 6 ], 64,\n                        //               UseDefaultScalingMatrix8x8Flag[ i − 6 ] )\n                    }\n            }\n        }\n    }\n\n    // log2_max_frame_num_minus4\n    reader.decodeExponentialGolombNumber();\n    const pic_order_cnt_type = reader.decodeExponentialGolombNumber();\n    if (pic_order_cnt_type === 0) {\n        // log2_max_pic_order_cnt_lsb_minus4\n        reader.decodeExponentialGolombNumber();\n    } else if (pic_order_cnt_type === 1) {\n        // delta_pic_order_always_zero_flag\n        reader.next();\n        // offset_for_non_ref_pic\n        reader.decodeExponentialGolombNumber();\n        // offset_for_top_to_bottom_field\n        reader.decodeExponentialGolombNumber();\n        const num_ref_frames_in_pic_order_cnt_cycle =\n            reader.decodeExponentialGolombNumber();\n        const offset_for_ref_frame: number[] = [];\n        for (let i = 0; i < num_ref_frames_in_pic_order_cnt_cycle; i += 1) {\n            offset_for_ref_frame[i] = reader.decodeExponentialGolombNumber();\n        }\n    }\n\n    // max_num_ref_frames\n    reader.decodeExponentialGolombNumber();\n    // gaps_in_frame_num_value_allowed_flag\n    reader.next();\n    const pic_width_in_mbs_minus1 = reader.decodeExponentialGolombNumber();\n    const pic_height_in_map_units_minus1 =\n        reader.decodeExponentialGolombNumber();\n\n    const frame_mbs_only_flag = reader.next();\n    if (!frame_mbs_only_flag) {\n        // mb_adaptive_frame_field_flag\n        reader.next();\n    }\n\n    // direct_8x8_inference_flag\n    reader.next();\n\n    const frame_cropping_flag = !!reader.next();\n    let frame_crop_left_offset: number;\n    let frame_crop_right_offset: number;\n    let frame_crop_top_offset: number;\n    let frame_crop_bottom_offset: number;\n    if (frame_cropping_flag) {\n        frame_crop_left_offset = reader.decodeExponentialGolombNumber();\n        frame_crop_right_offset = reader.decodeExponentialGolombNumber();\n        frame_crop_top_offset = reader.decodeExponentialGolombNumber();\n        frame_crop_bottom_offset = reader.decodeExponentialGolombNumber();\n    } else {\n        frame_crop_left_offset = 0;\n        frame_crop_right_offset = 0;\n        frame_crop_top_offset = 0;\n        frame_crop_bottom_offset = 0;\n    }\n\n    const vui_parameters_present_flag = !!reader.next();\n    if (vui_parameters_present_flag) {\n        // TODO\n        // vui_parameters( )\n    }\n\n    return {\n        profile_idc,\n        constraint_set,\n        constraint_set0_flag,\n        constraint_set1_flag,\n        constraint_set2_flag,\n        constraint_set3_flag,\n        constraint_set4_flag,\n        constraint_set5_flag,\n        level_idc,\n        seq_parameter_set_id,\n        pic_width_in_mbs_minus1,\n        pic_height_in_map_units_minus1,\n        frame_mbs_only_flag,\n        frame_cropping_flag,\n        frame_crop_left_offset,\n        frame_crop_right_offset,\n        frame_crop_top_offset,\n        frame_crop_bottom_offset,\n    };\n}\n\n/**\n * Find Sequence Parameter Set (SPS) and Picture Parameter Set (PPS)\n * from H.264 Annex B formatted data.\n */\nexport function parseH264Configuration(buffer: Uint8Array) {\n    let sequenceParameterSet: Uint8Array | undefined;\n    let pictureParameterSet: Uint8Array | undefined;\n\n    for (const nalu of iterateNalu(buffer)) {\n        const naluType = nalu[0]! & 0x1f;\n        switch (naluType) {\n            case 7: // Sequence parameter set\n                sequenceParameterSet = nalu;\n                if (pictureParameterSet) {\n                    return {\n                        sequenceParameterSet,\n                        pictureParameterSet,\n                    };\n                }\n                break;\n            case 8: // Picture parameter set\n                pictureParameterSet = nalu;\n                if (sequenceParameterSet) {\n                    return {\n                        sequenceParameterSet,\n                        pictureParameterSet,\n                    };\n                }\n                break;\n            default:\n                // ignore\n                break;\n        }\n    }\n\n    throw new Error(\"Invalid data\");\n}\n","import Struct from \"@yume-chan/struct\";\n\nimport {\n    ScrcpyControlMessageType,\n    type ScrcpyInjectScrollControlMessage,\n} from \"../../control/index.js\";\n\nexport interface ScrcpyScrollController {\n    serializeScrollMessage(\n        message: ScrcpyInjectScrollControlMessage\n    ): Uint8Array | undefined;\n}\n\nexport const ScrcpyInjectScrollControlMessage1_16 = new Struct()\n    .uint8(\"type\", ScrcpyControlMessageType.InjectScroll as const)\n    .uint32(\"pointerX\")\n    .uint32(\"pointerY\")\n    .uint16(\"screenWidth\")\n    .uint16(\"screenHeight\")\n    .int32(\"scrollX\")\n    .int32(\"scrollY\");\n\n/**\n * Old version of Scrcpy server only supports integer values for scroll.\n *\n * Accumulate scroll values and send scroll message when accumulated value\n * reaches 1 or -1.\n */\nexport class ScrcpyScrollController1_16 implements ScrcpyScrollController {\n    private accumulatedX = 0;\n    private accumulatedY = 0;\n\n    protected processMessage(\n        message: ScrcpyInjectScrollControlMessage\n    ): ScrcpyInjectScrollControlMessage | undefined {\n        this.accumulatedX += message.scrollX;\n        this.accumulatedY += message.scrollY;\n\n        let scrollX = 0;\n        let scrollY = 0;\n        if (this.accumulatedX >= 1) {\n            scrollX = 1;\n            this.accumulatedX = 0;\n        } else if (this.accumulatedX <= -1) {\n            scrollX = -1;\n            this.accumulatedX = 0;\n        }\n\n        if (this.accumulatedY >= 1) {\n            scrollY = 1;\n            this.accumulatedY = 0;\n        } else if (this.accumulatedY <= -1) {\n            scrollY = -1;\n            this.accumulatedY = 0;\n        }\n\n        if (scrollX === 0 && scrollY === 0) {\n            return undefined;\n        }\n\n        message.scrollX = scrollX;\n        message.scrollY = scrollY;\n        return message;\n    }\n\n    public serializeScrollMessage(\n        message: ScrcpyInjectScrollControlMessage\n    ): Uint8Array | undefined {\n        const processed = this.processMessage(message);\n        if (!processed) {\n            return undefined;\n        }\n\n        return ScrcpyInjectScrollControlMessage1_16.serialize(processed);\n    }\n}\n","import {\n    StructDeserializeStream,\n    TransformStream,\n} from \"@yume-chan/stream-extra\";\nimport Struct from \"@yume-chan/struct\";\n\nimport {\n    AndroidKeyEventAction,\n    ScrcpyControlMessageType,\n    type ScrcpyBackOrScreenOnControlMessage,\n} from \"../../control/index.js\";\nimport {\n    toScrcpyOptionValue,\n    type ScrcpyOptions,\n    type ScrcpyVideoStreamPacket,\n} from \"../types.js\";\n\nimport { CodecOptions } from \"./codec-options.js\";\nimport {\n    parseH264Configuration,\n    parseSequenceParameterSet,\n} from \"./h264-configuration.js\";\nimport {\n    ScrcpyScrollController1_16,\n    type ScrcpyScrollController,\n} from \"./scroll.js\";\n\nexport enum ScrcpyLogLevel {\n    Verbose = \"verbose\",\n    Debug = \"debug\",\n    Info = \"info\",\n    Warn = \"warn\",\n    Error = \"error\",\n}\n\nexport enum ScrcpyVideoOrientation {\n    Initial = -2,\n    Unlocked = -1,\n    Portrait = 0,\n    Landscape = 1,\n    PortraitFlipped = 2,\n    LandscapeFlipped = 3,\n}\n\nexport interface ScrcpyOptionsInit1_16 {\n    logLevel: ScrcpyLogLevel;\n\n    /**\n     * The maximum value of both width and height.\n     */\n    maxSize: number;\n\n    bitRate: number;\n\n    /**\n     * 0 for unlimited.\n     *\n     * @default 0\n     */\n    maxFps: number;\n\n    /**\n     * The orientation of the video stream.\n     *\n     * It will not keep the device screen in specific orientation,\n     * only the captured video will in this orientation.\n     */\n    lockVideoOrientation: ScrcpyVideoOrientation;\n\n    tunnelForward: boolean;\n\n    crop: string;\n\n    /**\n     * Send PTS so that the client may record properly\n     *\n     * Note: When `sendFrameMeta: false` is specified,\n     * `onChangeEncoding` event won't fire and `onVideoData` event doesn't\n     * merge sps/pps frame and first video frame. Which means you can't use\n     * the shipped decoders to render the video\n     * (You can still record the stream into a file).\n     *\n     * @default true\n     */\n    sendFrameMeta: boolean;\n\n    /**\n     * @default true\n     */\n    control: boolean;\n\n    displayId: number;\n\n    showTouches: boolean;\n\n    stayAwake: boolean;\n\n    codecOptions: CodecOptions;\n\n    encoderName: string;\n}\n\nexport const VideoPacket = new Struct()\n    .uint64(\"pts\")\n    .uint32(\"size\")\n    .uint8Array(\"data\", { lengthField: \"size\" });\n\nexport const NO_PTS = BigInt(1) << BigInt(63);\n\nexport const ScrcpyBackOrScreenOnControlMessage1_16 = new Struct().uint8(\n    \"type\",\n    ScrcpyControlMessageType.BackOrScreenOn as const\n);\n\nexport class ScrcpyOptions1_16<\n    T extends ScrcpyOptionsInit1_16 = ScrcpyOptionsInit1_16\n> implements ScrcpyOptions<T>\n{\n    public value: Partial<T>;\n\n    public constructor(value: Partial<ScrcpyOptionsInit1_16>) {\n        if (\n            new.target === ScrcpyOptions1_16 &&\n            value.logLevel === ScrcpyLogLevel.Verbose\n        ) {\n            value.logLevel = ScrcpyLogLevel.Debug;\n        }\n\n        if (\n            new.target === ScrcpyOptions1_16 &&\n            value.lockVideoOrientation === ScrcpyVideoOrientation.Initial\n        ) {\n            value.lockVideoOrientation = ScrcpyVideoOrientation.Unlocked;\n        }\n\n        this.value = value as Partial<T>;\n    }\n\n    protected getArgumentOrder(): (keyof T)[] {\n        return [\n            \"logLevel\",\n            \"maxSize\",\n            \"bitRate\",\n            \"maxFps\",\n            \"lockVideoOrientation\",\n            \"tunnelForward\",\n            \"crop\",\n            \"sendFrameMeta\",\n            \"control\",\n            \"displayId\",\n            \"showTouches\",\n            \"stayAwake\",\n            \"codecOptions\",\n            \"encoderName\",\n        ];\n    }\n\n    public getDefaultValue(): T {\n        return {\n            logLevel: ScrcpyLogLevel.Debug,\n            maxSize: 0,\n            bitRate: 8_000_000,\n            maxFps: 0,\n            lockVideoOrientation: ScrcpyVideoOrientation.Unlocked,\n            tunnelForward: false,\n            crop: \"-\",\n            sendFrameMeta: true,\n            control: true,\n            displayId: 0,\n            showTouches: false,\n            stayAwake: false,\n            codecOptions: new CodecOptions({}),\n            encoderName: \"-\",\n        } as T;\n    }\n\n    public formatServerArguments(): string[] {\n        const defaults = this.getDefaultValue();\n        return this.getArgumentOrder().map((key) =>\n            toScrcpyOptionValue(this.value[key] || defaults[key], \"-\")\n        );\n    }\n\n    public getOutputEncoderNameRegex(): RegExp {\n        return /\\s+scrcpy --encoder-name '(.*?)'/;\n    }\n\n    public createVideoStreamTransformer(): TransformStream<\n        Uint8Array,\n        ScrcpyVideoStreamPacket\n    > {\n        // Optimized path for video frames only\n        if (this.value.sendFrameMeta === false) {\n            return new TransformStream({\n                transform(chunk, controller) {\n                    controller.enqueue({\n                        type: \"frame\",\n                        data: chunk,\n                    });\n                },\n            });\n        }\n\n        let header: Uint8Array | undefined;\n\n        const deserializeStream = new StructDeserializeStream(VideoPacket);\n        return {\n            writable: deserializeStream.writable,\n            readable: deserializeStream.readable.pipeThrough(\n                new TransformStream({\n                    transform(packet, controller) {\n                        if (packet.pts === NO_PTS) {\n                            const {\n                                sequenceParameterSet,\n                                pictureParameterSet,\n                            } = parseH264Configuration(packet.data.slice());\n\n                            const {\n                                profile_idc: profileIndex,\n                                constraint_set: constraintSet,\n                                level_idc: levelIndex,\n                                pic_width_in_mbs_minus1,\n                                pic_height_in_map_units_minus1,\n                                frame_mbs_only_flag,\n                                frame_crop_left_offset,\n                                frame_crop_right_offset,\n                                frame_crop_top_offset,\n                                frame_crop_bottom_offset,\n                            } = parseSequenceParameterSet(sequenceParameterSet);\n\n                            const encodedWidth =\n                                (pic_width_in_mbs_minus1 + 1) * 16;\n                            const encodedHeight =\n                                (pic_height_in_map_units_minus1 + 1) *\n                                (2 - frame_mbs_only_flag) *\n                                16;\n                            const cropLeft = frame_crop_left_offset * 2;\n                            const cropRight = frame_crop_right_offset * 2;\n                            const cropTop = frame_crop_top_offset * 2;\n                            const cropBottom = frame_crop_bottom_offset * 2;\n\n                            const croppedWidth =\n                                encodedWidth - cropLeft - cropRight;\n                            const croppedHeight =\n                                encodedHeight - cropTop - cropBottom;\n\n                            header = packet.data;\n                            controller.enqueue({\n                                type: \"configuration\",\n                                pictureParameterSet,\n                                sequenceParameterSet,\n                                data: {\n                                    profileIndex,\n                                    constraintSet,\n                                    levelIndex,\n                                    encodedWidth,\n                                    encodedHeight,\n                                    cropLeft,\n                                    cropRight,\n                                    cropTop,\n                                    cropBottom,\n                                    croppedWidth,\n                                    croppedHeight,\n                                },\n                            });\n                            return;\n                        }\n\n                        let frameData: Uint8Array;\n                        if (header) {\n                            frameData = new Uint8Array(\n                                header.byteLength + packet.data.byteLength\n                            );\n                            frameData.set(header);\n                            frameData.set(packet.data, header.byteLength);\n                            header = undefined;\n                        } else {\n                            frameData = packet.data;\n                        }\n\n                        controller.enqueue({\n                            type: \"frame\",\n                            pts: packet.pts,\n                            data: frameData,\n                        });\n                    },\n                })\n            ),\n        };\n    }\n\n    public getControlMessageTypes(): ScrcpyControlMessageType[] {\n        return [\n            /*  0 */ ScrcpyControlMessageType.InjectKeyCode,\n            /*  1 */ ScrcpyControlMessageType.InjectText,\n            /*  2 */ ScrcpyControlMessageType.InjectTouch,\n            /*  3 */ ScrcpyControlMessageType.InjectScroll,\n            /*  4 */ ScrcpyControlMessageType.BackOrScreenOn,\n            /*  5 */ ScrcpyControlMessageType.ExpandNotificationPanel,\n            /*  6 */ ScrcpyControlMessageType.CollapseNotificationPanel,\n            /*  7 */ ScrcpyControlMessageType.GetClipboard,\n            /*  8 */ ScrcpyControlMessageType.SetClipboard,\n            /*  9 */ ScrcpyControlMessageType.SetScreenPowerMode,\n            /* 10 */ ScrcpyControlMessageType.RotateDevice,\n        ];\n    }\n\n    public serializeBackOrScreenOnControlMessage(\n        message: ScrcpyBackOrScreenOnControlMessage\n    ) {\n        if (message.action === AndroidKeyEventAction.Down) {\n            return ScrcpyBackOrScreenOnControlMessage1_16.serialize(message);\n        }\n\n        return undefined;\n    }\n\n    public getScrollController(): ScrcpyScrollController {\n        return new ScrcpyScrollController1_16();\n    }\n}\n","export * from \"./codec-options.js\";\nexport * from \"./h264-configuration.js\";\nexport * from \"./options.js\";\nexport * from \"./scroll.js\";\n","import Struct, { placeholder } from \"@yume-chan/struct\";\n\nimport {\n    ScrcpyControlMessageType,\n    type AndroidKeyEventAction,\n    type ScrcpyBackOrScreenOnControlMessage,\n} from \"../control/index.js\";\n\nimport {\n    ScrcpyBackOrScreenOnControlMessage1_16,\n    ScrcpyOptions1_16,\n    type ScrcpyOptionsInit1_16,\n} from \"./1_16/options.js\";\n\nexport interface ScrcpyOptionsInit1_18 extends ScrcpyOptionsInit1_16 {\n    powerOffOnClose: boolean;\n}\n\nexport const ScrcpyBackOrScreenOnControlMessage1_18 = new Struct()\n    .fields(ScrcpyBackOrScreenOnControlMessage1_16)\n    .uint8(\"action\", placeholder<AndroidKeyEventAction>());\n\nexport type ScrcpyBackOrScreenOnControlMessage1_18 =\n    typeof ScrcpyBackOrScreenOnControlMessage1_18[\"TInit\"];\n\nexport class ScrcpyOptions1_18<\n    T extends ScrcpyOptionsInit1_18 = ScrcpyOptionsInit1_18\n> extends ScrcpyOptions1_16<T> {\n    constructor(value: Partial<ScrcpyOptionsInit1_18>) {\n        super(value);\n    }\n\n    protected override getArgumentOrder(): (keyof T)[] {\n        return super.getArgumentOrder().concat([\"powerOffOnClose\"]);\n    }\n\n    public override getDefaultValue(): T {\n        return {\n            ...super.getDefaultValue(),\n            powerOffOnClose: false,\n        };\n    }\n\n    public override getOutputEncoderNameRegex(): RegExp {\n        return /\\s+scrcpy --encoder '(.*?)'/;\n    }\n\n    public override getControlMessageTypes(): ScrcpyControlMessageType[] {\n        /**\n         *  0 InjectKeycode\n         *  1 InjectText\n         *  2 InjectTouch\n         *  3 InjectScroll\n         *  4 BackOrScreenOn\n         *  5 ExpandNotificationPanel\n         *  6 ExpandSettingsPanel\n         *  7 CollapseNotificationPanel\n         *  8 GetClipboard\n         *  9 SetClipboard\n         * 10 SetScreenPowerMode\n         * 11 RotateDevice\n         */\n        const types = super.getControlMessageTypes();\n        types.splice(6, 0, ScrcpyControlMessageType.ExpandSettingPanel);\n        return types;\n    }\n\n    public override serializeBackOrScreenOnControlMessage(\n        message: ScrcpyBackOrScreenOnControlMessage\n    ) {\n        return ScrcpyBackOrScreenOnControlMessage1_18.serialize(message);\n    }\n}\n","// cspell: ignore autosync\n\nimport { ScrcpyOptions1_18, type ScrcpyOptionsInit1_18 } from './1_18.js';\nimport { toScrcpyOptionValue } from './types.js';\n\nexport interface ScrcpyOptionsInit1_21 extends ScrcpyOptionsInit1_18 {\n    clipboardAutosync?: boolean;\n}\n\nfunction toSnakeCase(input: string): string {\n    return input.replace(/([A-Z])/g, '_$1').toLowerCase();\n}\n\nexport class ScrcpyOptions1_21<T extends ScrcpyOptionsInit1_21 = ScrcpyOptionsInit1_21>\n    extends ScrcpyOptions1_18<T> {\n    public constructor(init: Partial<ScrcpyOptionsInit1_21>) {\n        super(init);\n    }\n\n    public override getDefaultValue(): T {\n        return {\n            ...super.getDefaultValue(),\n            clipboardAutosync: true,\n        };\n    }\n\n    public override formatServerArguments(): string[] {\n        // 1.21 changed the format of arguments\n        // So `getArgumentOrder()` is no longer needed\n        return Object.entries(this.value)\n            .map(\n                ([key, value]) =>\n                    [key, toScrcpyOptionValue(value, undefined)] as const\n            )\n            .filter(\n                (pair): pair is [string, string] =>\n                    pair[1] !== undefined\n            )\n            .map(\n                ([key, value]) =>\n                    `${toSnakeCase(key)}=${value}`\n            );\n    }\n}\n","import Struct from \"@yume-chan/struct\";\n\nimport {\n    ScrcpyInjectScrollControlMessage1_16,\n    ScrcpyScrollController1_16,\n} from \"../1_16/index.js\";\n\nexport const ScrcpyInjectScrollControlMessage1_22 = new Struct()\n    .fields(ScrcpyInjectScrollControlMessage1_16)\n    .int32(\"buttons\");\n\nexport type ScrcpyInjectScrollControlMessage1_22 =\n    typeof ScrcpyInjectScrollControlMessage1_22[\"TInit\"];\n\nexport class ScrcpyScrollController1_22 extends ScrcpyScrollController1_16 {\n    public override serializeScrollMessage(\n        message: ScrcpyInjectScrollControlMessage1_22\n    ): Uint8Array | undefined {\n        const processed = this.processMessage(message);\n        if (!processed) {\n            return undefined;\n        }\n\n        return ScrcpyInjectScrollControlMessage1_22.serialize(processed);\n    }\n}\n","import { type ScrcpyScrollController } from \"../1_16/index.js\";\nimport { ScrcpyOptions1_21, type ScrcpyOptionsInit1_21 } from \"../1_21.js\";\n\nimport { ScrcpyScrollController1_22 } from \"./scroll.js\";\n\nexport interface ScrcpyOptionsInit1_22 extends ScrcpyOptionsInit1_21 {\n    downsizeOnError: boolean;\n\n    /**\n     * Send device name and size at start of video stream.\n     *\n     * @default true\n     */\n    sendDeviceMeta: boolean;\n\n    /**\n     * Send a `0` byte on start of video stream to detect connection issues\n     *\n     * @default true\n     */\n    sendDummyByte: boolean;\n\n    /**\n     * Implies `sendDeviceMeta: false`, `sendFrameMeta: false` and `sendDummyByte: false`\n     *\n     * @default false\n     */\n    rawVideoStream: boolean;\n}\n\nexport class ScrcpyOptions1_22<\n    T extends ScrcpyOptionsInit1_22 = ScrcpyOptionsInit1_22\n> extends ScrcpyOptions1_21<T> {\n    public constructor(init: Partial<ScrcpyOptionsInit1_22>) {\n        if (init.rawVideoStream) {\n            // Set implied options for client-side processing\n            init.sendDeviceMeta = false;\n            init.sendFrameMeta = false;\n            init.sendDummyByte = false;\n        }\n\n        super(init);\n    }\n\n    public override getDefaultValue(): T {\n        return {\n            ...super.getDefaultValue(),\n            downsizeOnError: true,\n            sendDeviceMeta: true,\n            sendDummyByte: true,\n            rawVideoStream: false,\n        };\n    }\n\n    public override getScrollController(): ScrcpyScrollController {\n        return new ScrcpyScrollController1_22();\n    }\n}\n","export * from \"./options.js\";\nexport * from \"./scroll.js\";\n","import { TransformStream } from \"@yume-chan/stream-extra\";\n\nimport {\n    ScrcpyOptions1_22,\n    type ScrcpyOptionsInit1_22,\n} from \"./1_22/options.js\";\nimport { type ScrcpyVideoStreamPacket } from \"./types.js\";\n\nexport interface ScrcpyOptionsInit1_23 extends ScrcpyOptionsInit1_22 {\n    cleanup: boolean;\n}\n\nconst KEYFRAME_PTS = BigInt(1) << BigInt(62);\n\nexport class ScrcpyOptions1_23<\n    T extends ScrcpyOptionsInit1_23 = ScrcpyOptionsInit1_23\n> extends ScrcpyOptions1_22<T> {\n    public constructor(init: Partial<ScrcpyOptionsInit1_23>) {\n        super(init);\n    }\n\n    public override getDefaultValue(): T {\n        return {\n            ...super.getDefaultValue(),\n            cleanup: true,\n        };\n    }\n\n    public override createVideoStreamTransformer(): TransformStream<\n        Uint8Array,\n        ScrcpyVideoStreamPacket\n    > {\n        const superStream = super.createVideoStreamTransformer();\n        return {\n            writable: superStream.writable,\n            readable: superStream.readable.pipeThrough(\n                new TransformStream({\n                    transform(packet, controller): void {\n                        if (packet.type !== \"frame\") {\n                            controller.enqueue(packet);\n                            return;\n                        }\n\n                        if (\n                            packet.pts !== undefined &&\n                            packet.pts & KEYFRAME_PTS\n                        ) {\n                            packet.keyframe = true;\n                            packet.pts &= ~KEYFRAME_PTS;\n                        }\n\n                        controller.enqueue(packet);\n                    },\n                })\n            ),\n        };\n    }\n}\n","import { ScrcpyOptions1_23, type ScrcpyOptionsInit1_23 } from './1_23.js';\n\nexport interface ScrcpyOptionsInit1_24 extends ScrcpyOptionsInit1_23 {\n    powerOn: boolean;\n}\n\nexport class ScrcpyOptions1_24<T extends ScrcpyOptionsInit1_24 = ScrcpyOptionsInit1_24>\n    extends ScrcpyOptions1_23<T> {\n    public constructor(init: Partial<ScrcpyOptionsInit1_24>) {\n        super(init);\n    }\n\n    public override getDefaultValue(): T {\n        return {\n            ...super.getDefaultValue(),\n            powerOn: true,\n        };\n    }\n}\n","import Struct, {\n    NumberFieldDefinition,\n    NumberFieldType,\n} from \"@yume-chan/struct\";\n\nimport {\n    clamp,\n    ScrcpyControlMessageType,\n    type ScrcpyInjectScrollControlMessage,\n} from \"../../control/index.js\";\nimport { type ScrcpyScrollController } from \"../1_16/index.js\";\n\nconst Int16Max = (1 << 15) - 1;\n\nconst ScrcpyFloatToInt16NumberType: NumberFieldType = {\n    size: 2,\n    signed: true,\n    deserialize(array, littleEndian) {\n        const value = NumberFieldType.Int16.deserialize(array, littleEndian);\n        return value / Int16Max;\n    },\n    serialize(dataView, offset, value, littleEndian) {\n        value = clamp(value, -1, 1) * Int16Max;\n        NumberFieldType.Int16.serialize(dataView, offset, value, littleEndian);\n    },\n};\n\nconst ScrcpyFloatToInt16FieldDefinition = new NumberFieldDefinition(\n    ScrcpyFloatToInt16NumberType\n);\n\nexport const ScrcpyInjectScrollControlMessage1_25 = new Struct()\n    .uint8(\"type\", ScrcpyControlMessageType.InjectScroll as const)\n    .uint32(\"pointerX\")\n    .uint32(\"pointerY\")\n    .uint16(\"screenWidth\")\n    .uint16(\"screenHeight\")\n    .field(\"scrollX\", ScrcpyFloatToInt16FieldDefinition)\n    .field(\"scrollY\", ScrcpyFloatToInt16FieldDefinition)\n    .int32(\"buttons\");\n\nexport type ScrcpyInjectScrollControlMessage1_25 =\n    typeof ScrcpyInjectScrollControlMessage1_25[\"TInit\"];\n\nexport class ScrcpyScrollController1_25 implements ScrcpyScrollController {\n    serializeScrollMessage(\n        message: ScrcpyInjectScrollControlMessage\n    ): Uint8Array | undefined {\n        return ScrcpyInjectScrollControlMessage1_25.serialize(message);\n    }\n}\n","import { type ScrcpyScrollController } from \"../1_16/index.js\";\nimport { ScrcpyOptions1_24, type ScrcpyOptionsInit1_24 } from \"../1_24.js\";\n\nimport { ScrcpyScrollController1_25 } from \"./scroll.js\";\n\nexport class ScrcpyOptions1_25<\n    T extends ScrcpyOptionsInit1_24 = ScrcpyOptionsInit1_24\n> extends ScrcpyOptions1_24<T> {\n    public override getScrollController(): ScrcpyScrollController {\n        return new ScrcpyScrollController1_25();\n    }\n}\n","export * from \"./options.js\";\nexport * from \"./scroll.js\";\n","export * from './1_16/index.js';\nexport * from './1_18.js';\nexport * from './1_21.js';\nexport * from \"./1_22/index.js\";\nexport * from \"./1_23.js\";\nexport * from \"./1_24.js\";\nexport * from \"./1_25/index.js\";\nexport * from \"./types.js\";\n","import {\n    AdbSubprocessNoneProtocol,\n    type Adb,\n    type AdbSubprocessProtocol,\n    type AdbSync,\n} from \"@yume-chan/adb\";\nimport {\n    AbortController,\n    DecodeUtf8Stream,\n    InspectStream,\n    ReadableStream,\n    SplitStringStream,\n    WrapWritableStream,\n    WritableStream,\n    type ReadableStreamDefaultController,\n    type ReadableStreamDefaultReader,\n    type ReadableWritablePair,\n} from \"@yume-chan/stream-extra\";\n\nimport { ScrcpyControlMessageSerializer } from \"../control/index.js\";\nimport {\n    ScrcpyDeviceMessageDeserializeStream,\n    type ScrcpyDeviceMessage,\n} from \"../device-message/index.js\";\nimport {\n    DEFAULT_SERVER_PATH,\n    type ScrcpyVideoStreamPacket,\n} from \"../options/index.js\";\n\nimport { type AdbScrcpyOptions } from \"./options/index.js\";\n\nclass ArrayToStream<T> extends ReadableStream<T> {\n    private array!: T[];\n    private index = 0;\n\n    constructor(array: T[]) {\n        super({\n            start: async () => {\n                await Promise.resolve();\n                this.array = array;\n            },\n            pull: (controller) => {\n                if (this.index < this.array.length) {\n                    controller.enqueue(this.array[this.index]!);\n                    this.index += 1;\n                } else {\n                    controller.close();\n                }\n            },\n        });\n    }\n}\n\nclass ConcatStream<T> extends ReadableStream<T> {\n    private streams!: ReadableStream<T>[];\n    private index = 0;\n    private reader!: ReadableStreamDefaultReader<T>;\n\n    constructor(...streams: ReadableStream<T>[]) {\n        super({\n            start: async (controller) => {\n                await Promise.resolve();\n\n                this.streams = streams;\n                this.advance(controller);\n            },\n            pull: async (controller) => {\n                const result = await this.reader.read();\n                if (!result.done) {\n                    controller.enqueue(result.value);\n                    return;\n                }\n                this.advance(controller);\n            },\n        });\n    }\n\n    private advance(controller: ReadableStreamDefaultController<T>) {\n        if (this.index < this.streams.length) {\n            this.reader = this.streams[this.index]!.getReader();\n            this.index += 1;\n        } else {\n            controller.close();\n        }\n    }\n}\n\nexport class ScrcpyExitedError extends Error {\n    public output: string[];\n\n    public constructor(output: string[]) {\n        super(\"scrcpy server exited prematurely\");\n        this.output = output;\n    }\n}\n\nexport class AdbScrcpyClient {\n    public static pushServer(adb: Adb, path = DEFAULT_SERVER_PATH) {\n        let sync!: AdbSync;\n        return new WrapWritableStream<Uint8Array>({\n            async start() {\n                sync = await adb.sync();\n                return sync.write(path);\n            },\n            async close() {\n                await sync.dispose();\n            },\n        });\n    }\n\n    public static async start(\n        adb: Adb,\n        path: string,\n        version: string,\n        options: AdbScrcpyOptions<object>\n    ) {\n        const connection = options.createConnection(adb);\n        let process: AdbSubprocessProtocol | undefined;\n\n        try {\n            await connection.initialize();\n\n            process = await adb.subprocess.spawn(\n                [\n                    // cspell: disable-next-line\n                    `CLASSPATH=${path}`,\n                    \"app_process\",\n                    /* unused */ \"/\",\n                    \"com.genymobile.scrcpy.Server\",\n                    version,\n                    ...options.formatServerArguments(),\n                ],\n                {\n                    // Scrcpy server doesn't use stderr,\n                    // so disable Shell Protocol to simplify processing\n                    protocols: [AdbSubprocessNoneProtocol],\n                }\n            );\n\n            const stdout = process.stdout\n                .pipeThrough(new DecodeUtf8Stream())\n                .pipeThrough(new SplitStringStream(\"\\n\"));\n\n            // Read stdout, otherwise `process.exit` won't resolve.\n            const output: string[] = [];\n            const abortController = new AbortController();\n            const pipe = stdout\n                .pipeTo(\n                    new WritableStream({\n                        write(chunk) {\n                            output.push(chunk);\n                        },\n                    }),\n                    {\n                        signal: abortController.signal,\n                        preventCancel: true,\n                    }\n                )\n                .catch((e) => {\n                    void e;\n                });\n\n            const result = await Promise.race([\n                process.exit,\n                connection.getStreams(),\n            ]);\n\n            if (typeof result === \"number\") {\n                throw new ScrcpyExitedError(output);\n            }\n\n            abortController.abort();\n            await pipe;\n\n            const [videoStream, controlStream] = result;\n            return new AdbScrcpyClient(\n                options,\n                process,\n                new ConcatStream(new ArrayToStream(output), stdout),\n                videoStream,\n                controlStream\n            );\n        } catch (e) {\n            await process?.kill();\n            throw e;\n        } finally {\n            connection.dispose();\n        }\n    }\n\n    /**\n     * This method will modify the given `options`,\n     * so don't reuse it elsewhere.\n     */\n    public static async getEncoders(\n        adb: Adb,\n        path: string,\n        version: string,\n        options: AdbScrcpyOptions<object>\n    ): Promise<string[]> {\n        Object.assign(options.value, {\n            // Provide an invalid encoder name\n            // So the server will return all available encoders\n            encoderName: \"_\",\n            // Disable control for faster connection in 1.22+\n            control: false,\n            sendDeviceMeta: false,\n            sendDummyByte: false,\n        });\n\n        // Scrcpy server will open connections, before initializing encoder\n        // Thus although an invalid encoder name is given, the start process will success\n        const client = await AdbScrcpyClient.start(adb, path, version, options);\n\n        const encoderNameRegex = options.getOutputEncoderNameRegex();\n        const encoders: string[] = [];\n        await client.stdout.pipeTo(\n            new WritableStream({\n                write(line) {\n                    const match = line.match(encoderNameRegex);\n                    if (match) {\n                        encoders.push(match[1]!);\n                    }\n                },\n            })\n        );\n\n        return encoders;\n    }\n\n    /**\n     * This method will modify the given `options`,\n     * so don't reuse it elsewhere.\n     */\n    public static async getDisplays(\n        adb: Adb,\n        path: string,\n        version: string,\n        options: AdbScrcpyOptions<object>\n    ): Promise<number[]> {\n        Object.assign(options.value, {\n            // Similar to `getEncoders`, pass an invalid option and parse the output\n            displayId: -1,\n            // Disable control for faster connection in 1.22+\n            control: false,\n            sendDeviceMeta: false,\n            sendDummyByte: false,\n        });\n\n        try {\n            // Server will exit before opening connections when an invalid display id was given.\n            await AdbScrcpyClient.start(adb, path, version, options);\n        } catch (e) {\n            if (e instanceof ScrcpyExitedError) {\n                const displayIdRegex = /\\s+scrcpy --display (\\d+)/;\n                const displays: number[] = [];\n                for (const line of e.output) {\n                    const match = line.match(displayIdRegex);\n                    if (match) {\n                        displays.push(Number.parseInt(match[1]!, 10));\n                    }\n                }\n                return displays;\n            }\n        }\n\n        throw new Error(\"failed to get displays\");\n    }\n\n    private process: AdbSubprocessProtocol;\n\n    private _stdout: ReadableStream<string>;\n    public get stdout() {\n        return this._stdout;\n    }\n\n    public get exit() {\n        return this.process.exit;\n    }\n\n    private _screenWidth: number | undefined;\n    public get screenWidth() {\n        return this._screenWidth;\n    }\n\n    private _screenHeight: number | undefined;\n    public get screenHeight() {\n        return this._screenHeight;\n    }\n\n    private _videoStream: ReadableStream<ScrcpyVideoStreamPacket>;\n    public get videoStream() {\n        return this._videoStream;\n    }\n\n    private _controlMessageSerializer:\n        | ScrcpyControlMessageSerializer\n        | undefined;\n    public get controlMessageSerializer() {\n        return this._controlMessageSerializer;\n    }\n\n    private _deviceMessageStream:\n        | ReadableStream<ScrcpyDeviceMessage>\n        | undefined;\n    public get deviceMessageStream() {\n        return this._deviceMessageStream;\n    }\n\n    public constructor(\n        options: AdbScrcpyOptions<object>,\n        process: AdbSubprocessProtocol,\n        stdout: ReadableStream<string>,\n        videoStream: ReadableStream<Uint8Array>,\n        controlStream: ReadableWritablePair<Uint8Array, Uint8Array> | undefined\n    ) {\n        this.process = process;\n        this._stdout = stdout;\n\n        this._videoStream = videoStream\n            .pipeThrough(options.createVideoStreamTransformer())\n            .pipeThrough(\n                new InspectStream((packet) => {\n                    if (packet.type === \"configuration\") {\n                        this._screenWidth = packet.data.croppedWidth;\n                        this._screenHeight = packet.data.croppedHeight;\n                    }\n                })\n            );\n\n        if (controlStream) {\n            this._controlMessageSerializer = new ScrcpyControlMessageSerializer(\n                controlStream.writable,\n                options\n            );\n            this._deviceMessageStream = controlStream.readable.pipeThrough(\n                new ScrcpyDeviceMessageDeserializeStream()\n            );\n        }\n    }\n\n    public async close() {\n        await this.process.kill();\n    }\n}\n","export * from './options/index.js';\nexport * from './client.js';\nexport * from './connection.js';\n","// From https://developer.android.com/reference/android/media/MediaCodecInfo.CodecProfileLevel\nexport enum AndroidCodecProfile {\n    Baseline = 0x01,\n    Main = 0x02,\n    Extended = 0x04,\n    High = 0x08,\n    High10 = 0x10,\n    High422 = 0x20,\n    High444 = 0x40,\n    ConstrainedBaseline = 0x10000,\n    ConstrainedHigh = 0x80000,\n}\n\nexport enum AndroidCodecLevel {\n    Level1 = 0x01,\n    Level1b = 0x02,\n    Level11 = 0x04,\n    Level12 = 0x08,\n    Level13 = 0x10,\n    Level2 = 0x20,\n    Level21 = 0x40,\n    Level22 = 0x80,\n    Level3 = 0x100,\n    Level31 = 0x200,\n    Level32 = 0x400,\n    Level4 = 0x800,\n    Level41 = 0x1000,\n    Level42 = 0x2000,\n    Level5 = 0x4000,\n    Level51 = 0x8000,\n    Level52 = 0x10000,\n    Level6 = 0x20000,\n    Level61 = 0x40000,\n    Level62 = 0x80000,\n}\n","export * from './adb/index.js';\nexport * from './codec.js';\nexport * from './control/index.js';\nexport * from './device-message/index.js';\nexport * from './options/index.js';\n","import { PromiseResolver } from \"@yume-chan/async\";\nimport {\n    AutoDisposable,\n    EventEmitter,\n    type Disposable,\n} from \"@yume-chan/event\";\n\nlet worker: Worker | undefined;\nlet workerReady = false;\nconst pendingResolvers: PromiseResolver<TinyH264Wrapper>[] = [];\nlet streamId = 0;\n\nexport interface PictureReadyEventArgs {\n    renderStateId: number;\n\n    width: number;\n\n    height: number;\n\n    data: ArrayBuffer;\n}\n\nconst PICTURE_READY_SUBSCRIPTIONS = new Map<\n    number,\n    (e: PictureReadyEventArgs) => void\n>();\n\nfunction subscribePictureReady(\n    streamId: number,\n    handler: (e: PictureReadyEventArgs) => void\n): Disposable {\n    PICTURE_READY_SUBSCRIPTIONS.set(streamId, handler);\n\n    return {\n        dispose() {\n            PICTURE_READY_SUBSCRIPTIONS.delete(streamId);\n        },\n    };\n}\n\nexport class TinyH264Wrapper extends AutoDisposable {\n    public readonly streamId: number;\n\n    private readonly pictureReadyEvent =\n        new EventEmitter<PictureReadyEventArgs>();\n    public get onPictureReady() {\n        return this.pictureReadyEvent.event;\n    }\n\n    public constructor(streamId: number) {\n        super();\n\n        this.streamId = streamId;\n        this.addDisposable(\n            subscribePictureReady(streamId, this.handlePictureReady)\n        );\n    }\n\n    private handlePictureReady = (e: PictureReadyEventArgs) => {\n        this.pictureReadyEvent.fire(e);\n    };\n\n    public feed(data: ArrayBuffer) {\n        worker!.postMessage(\n            {\n                type: \"decode\",\n                data: data,\n                offset: 0,\n                length: data.byteLength,\n                renderStateId: this.streamId,\n            },\n            [data]\n        );\n    }\n\n    public override dispose() {\n        super.dispose();\n        worker!.postMessage({\n            type: \"release\",\n            renderStateId: this.streamId,\n        });\n    }\n}\n\ninterface TinyH264MessageBase {\n    type: string;\n}\n\ninterface TinyH264DecoderReadyMessage extends TinyH264MessageBase {\n    type: \"decoderReady\";\n}\n\ninterface TinyH264PictureReadyMessage\n    extends TinyH264MessageBase,\n        PictureReadyEventArgs {\n    type: \"pictureReady\";\n}\n\ntype TinyH264Message =\n    | TinyH264DecoderReadyMessage\n    | TinyH264PictureReadyMessage;\n\nexport function createTinyH264Wrapper(): Promise<TinyH264Wrapper> {\n    if (!worker) {\n        worker = new Worker(new URL(\"./worker.js\", import.meta.url));\n        worker.addEventListener(\n            \"message\",\n            ({ data }: MessageEvent<TinyH264Message>) => {\n                switch (data.type) {\n                    case \"decoderReady\":\n                        workerReady = true;\n                        for (const resolver of pendingResolvers) {\n                            resolver.resolve(new TinyH264Wrapper(streamId));\n                            streamId += 1;\n                        }\n                        pendingResolvers.length = 0;\n                        break;\n                    case \"pictureReady\":\n                        PICTURE_READY_SUBSCRIPTIONS.get(data.renderStateId)?.(\n                            data\n                        );\n                        break;\n                }\n            }\n        );\n    }\n\n    if (!workerReady) {\n        const resolver = new PromiseResolver<TinyH264Wrapper>();\n        pendingResolvers.push(resolver);\n        return resolver.promise;\n    }\n\n    const decoder = new TinyH264Wrapper(streamId);\n    streamId += 1;\n    return Promise.resolve(decoder);\n}\n","import { PromiseResolver } from \"@yume-chan/async\";\nimport {\n    AndroidCodecLevel,\n    AndroidCodecProfile,\n    type H264Configuration,\n    type ScrcpyVideoStreamPacket,\n} from \"@yume-chan/scrcpy\";\nimport { WritableStream } from \"@yume-chan/stream-extra\";\nimport { type default as YuvBuffer } from \"yuv-buffer\";\nimport { type default as YuvCanvas } from \"yuv-canvas\";\n\nimport { createTinyH264Wrapper, type TinyH264Wrapper } from \"./wrapper.js\";\n\nlet cachedInitializePromise:\n    | Promise<{ YuvBuffer: typeof YuvBuffer; YuvCanvas: typeof YuvCanvas }>\n    | undefined;\nfunction initialize() {\n    if (!cachedInitializePromise) {\n        cachedInitializePromise = Promise.all([\n            import(\"yuv-buffer\"),\n            import(\"yuv-canvas\"),\n        ]).then(([YuvBuffer, { default: YuvCanvas }]) => ({\n            YuvBuffer,\n            YuvCanvas,\n        }));\n    }\n\n    return cachedInitializePromise;\n}\n\nexport class TinyH264Decoder {\n    public readonly maxProfile = AndroidCodecProfile.Baseline;\n\n    public readonly maxLevel = AndroidCodecLevel.Level4;\n\n    private _renderer: HTMLCanvasElement;\n    public get renderer() {\n        return this._renderer;\n    }\n\n    private _frameRendered = 0;\n    public get frameRendered() {\n        return this._frameRendered;\n    }\n\n    private _writable: WritableStream<ScrcpyVideoStreamPacket>;\n    public get writable() {\n        return this._writable;\n    }\n\n    private _yuvCanvas: YuvCanvas | undefined;\n    private _initializer: PromiseResolver<TinyH264Wrapper> | undefined;\n\n    public constructor() {\n        void initialize();\n\n        this._renderer = document.createElement(\"canvas\");\n\n        this._writable = new WritableStream<ScrcpyVideoStreamPacket>({\n            write: async (packet) => {\n                switch (packet.type) {\n                    case \"configuration\":\n                        void this.configure(packet.data);\n                        break;\n                    case \"frame\": {\n                        if (!this._initializer) {\n                            throw new Error(\"Decoder not configured\");\n                        }\n\n                        const wrapper = await this._initializer.promise;\n                        wrapper.feed(packet.data.slice().buffer);\n                        break;\n                    }\n                }\n            },\n        });\n    }\n\n    private async configure(config: H264Configuration) {\n        this.dispose();\n\n        this._initializer = new PromiseResolver<TinyH264Wrapper>();\n        const { YuvBuffer, YuvCanvas } = await initialize();\n\n        if (!this._yuvCanvas) {\n            this._yuvCanvas = YuvCanvas.attach(this._renderer);\n        }\n\n        const { encodedWidth, encodedHeight } = config;\n        const chromaWidth = encodedWidth / 2;\n        const chromaHeight = encodedHeight / 2;\n\n        this._renderer.width = config.croppedWidth;\n        this._renderer.height = config.croppedHeight;\n        const format = YuvBuffer.format({\n            width: encodedWidth,\n            height: encodedHeight,\n            chromaWidth,\n            chromaHeight,\n            cropLeft: config.cropLeft,\n            cropTop: config.cropTop,\n            cropWidth: config.croppedWidth,\n            cropHeight: config.croppedHeight,\n            displayWidth: config.croppedWidth,\n            displayHeight: config.croppedHeight,\n        });\n\n        const wrapper = await createTinyH264Wrapper();\n        this._initializer.resolve(wrapper);\n\n        const uPlaneOffset = encodedWidth * encodedHeight;\n        const vPlaneOffset = uPlaneOffset + chromaWidth * chromaHeight;\n        wrapper.onPictureReady(({ data }) => {\n            this._frameRendered += 1;\n            const array = new Uint8Array(data);\n            const frame = YuvBuffer.frame(\n                format,\n                YuvBuffer.lumaPlane(format, array, encodedWidth, 0),\n                YuvBuffer.chromaPlane(format, array, chromaWidth, uPlaneOffset),\n                YuvBuffer.chromaPlane(format, array, chromaWidth, vPlaneOffset)\n            );\n            this._yuvCanvas!.drawFrame(frame);\n        });\n    }\n\n    public dispose(): void {\n        this._initializer?.promise\n            .then((wrapper) => wrapper.dispose())\n            .catch((e) => {\n                void e;\n            });\n        this._initializer = undefined;\n    }\n}\n","import {\n    type H264Configuration,\n    type ScrcpyVideoStreamPacket,\n} from \"@yume-chan/scrcpy\";\nimport { WritableStream } from \"@yume-chan/stream-extra\";\n\nfunction toHex(value: number) {\n    return value.toString(16).padStart(2, \"0\").toUpperCase();\n}\n\nexport class WebCodecsDecoder {\n    // Usually, browsers can decode most configurations,\n    // So let device choose best profile and level for itself.\n    public readonly maxProfile = undefined;\n    public readonly maxLevel = undefined;\n\n    private _writable: WritableStream<ScrcpyVideoStreamPacket>;\n    public get writable() {\n        return this._writable;\n    }\n\n    private _renderer: HTMLCanvasElement;\n    public get renderer() {\n        return this._renderer;\n    }\n\n    private _frameRendered = 0;\n    public get frameRendered() {\n        return this._frameRendered;\n    }\n\n    private context: CanvasRenderingContext2D;\n    private decoder: VideoDecoder;\n\n    // Limit FPS to system refresh rate\n    private lastFrame: VideoFrame | undefined;\n    private animationFrame = 0;\n\n    public constructor() {\n        this._renderer = document.createElement(\"canvas\");\n\n        this.context = this._renderer.getContext(\"2d\")!;\n        this.decoder = new VideoDecoder({\n            output: (frame) => {\n                if (this.lastFrame) {\n                    this.lastFrame.close();\n                }\n                this.lastFrame = frame;\n\n                if (!this.animationFrame) {\n                    // Start render loop on first frame\n                    this.render();\n                }\n            },\n            error(e) {\n                void e;\n            },\n        });\n\n        this._writable = new WritableStream<ScrcpyVideoStreamPacket>({\n            write: (packet) => {\n                switch (packet.type) {\n                    case \"configuration\":\n                        this.configure(packet.data);\n                        break;\n                    case \"frame\":\n                        this.decoder.decode(\n                            new EncodedVideoChunk({\n                                // Treat `undefined` as `key`, otherwise won't decode.\n                                type:\n                                    packet.keyframe === false ? \"delta\" : \"key\",\n                                timestamp: 0,\n                                data: packet.data,\n                            })\n                        );\n                        break;\n                }\n            },\n        });\n    }\n\n    private render = () => {\n        if (this.lastFrame) {\n            this._frameRendered += 1;\n            this.context.drawImage(this.lastFrame, 0, 0);\n            this.lastFrame.close();\n            this.lastFrame = undefined;\n        }\n\n        this.animationFrame = requestAnimationFrame(this.render);\n    };\n\n    private configure(config: H264Configuration) {\n        const { profileIndex, constraintSet, levelIndex } = config;\n\n        this._renderer.width = config.croppedWidth;\n        this._renderer.height = config.croppedHeight;\n\n        // https://www.rfc-editor.org/rfc/rfc6381#section-3.3\n        // ISO Base Media File Format Name Space\n        const codec = `avc1.${[profileIndex, constraintSet, levelIndex]\n            .map(toHex)\n            .join(\"\")}`;\n        this.decoder.configure({\n            codec: codec,\n            optimizeForLatency: true,\n        });\n    }\n\n    public dispose() {\n        cancelAnimationFrame(this.animationFrame);\n        this.decoder.close();\n    }\n}\n","export default '1.25';","import {\n    CommandBar,\n    Dialog,\n    Dropdown,\n    ICommandBarItemProps,\n    Icon,\n    IconButton,\n    IDropdownOption,\n    LayerHost,\n    Position,\n    ProgressIndicator,\n    SpinButton,\n    Stack,\n    TextField,\n    Toggle,\n    TooltipHost,\n} from \"@fluentui/react\";\nimport { useId } from \"@fluentui/react-hooks\";\nimport { makeStyles } from \"@griffel/react\";\nimport {\n    action,\n    autorun,\n    makeAutoObservable,\n    observable,\n    runInAction,\n} from \"mobx\";\nimport { observer } from \"mobx-react-lite\";\nimport { NextPage } from \"next\";\nimport Head from \"next/head\";\nimport { CSSProperties, ReactNode, useEffect, useState } from \"react\";\n\nimport { ADB_SYNC_MAX_PACKET_SIZE } from \"@yume-chan/adb\";\nimport { Disposable, EventEmitter } from \"@yume-chan/event\";\nimport {\n    AdbScrcpyClient,\n    AdbScrcpyOptions1_22,\n    AndroidCodecLevel,\n    AndroidCodecProfile,\n    AndroidKeyCode,\n    AndroidKeyEventAction,\n    AndroidMotionEventAction,\n    AndroidScreenPowerMode,\n    clamp,\n    CodecOptions,\n    DEFAULT_SERVER_PATH,\n    ScrcpyDeviceMessageType,\n    ScrcpyHoverHelper,\n    ScrcpyLogLevel,\n    ScrcpyOptions1_25,\n    ScrcpyOptionsInit1_24,\n    ScrcpyPointerId,\n    ScrcpyVideoOrientation,\n    type ScrcpyVideoStreamPacket,\n} from \"@yume-chan/scrcpy\";\nimport { TinyH264Decoder } from \"@yume-chan/scrcpy-decoder-tinyh264\";\nimport { WebCodecsDecoder } from \"@yume-chan/scrcpy-decoder-webcodecs\";\nimport SCRCPY_SERVER_VERSION from \"@yume-chan/scrcpy/bin/version\";\nimport {\n    ChunkStream,\n    InspectStream,\n    ReadableStream,\n    WritableStream,\n} from \"@yume-chan/stream-extra\";\n\nimport {\n    DemoModePanel,\n    DeviceView,\n    DeviceViewRef,\n    ExternalLink,\n} from \"../components\";\nimport { GlobalState } from \"../state\";\nimport {\n    CommonStackTokens,\n    formatSpeed,\n    Icons,\n    ProgressStream,\n    RouteStackProps,\n} from \"../utils\";\n\nconst SERVER_URL = new URL(\n    \"@yume-chan/scrcpy/bin/scrcpy-server?url\",\n    import.meta.url\n);\n\nclass FetchWithProgress {\n    public readonly promise: Promise<Uint8Array>;\n\n    private _downloaded = 0;\n    public get downloaded() {\n        return this._downloaded;\n    }\n\n    private _total = 0;\n    public get total() {\n        return this._total;\n    }\n\n    private progressEvent = new EventEmitter<\n        [download: number, total: number]\n    >();\n    public get onProgress() {\n        return this.progressEvent.event;\n    }\n\n    public constructor(url: string | URL) {\n        this.promise = this.fetch(url);\n    }\n\n    private async fetch(url: string | URL) {\n        const response = await window.fetch(url);\n        this._total = Number.parseInt(\n            response.headers.get(\"Content-Length\") ?? \"0\",\n            10\n        );\n        this.progressEvent.fire([this._downloaded, this._total]);\n\n        const reader = response.body!.getReader();\n        const chunks: Uint8Array[] = [];\n        while (true) {\n            const result = await reader.read();\n            if (result.done) {\n                break;\n            }\n            chunks.push(result.value);\n            this._downloaded += result.value.byteLength;\n            this.progressEvent.fire([this._downloaded, this._total]);\n        }\n\n        this._total = chunks.reduce(\n            (result, item) => result + item.byteLength,\n            0\n        );\n        const result = new Uint8Array(this._total);\n        let position = 0;\n        for (const chunk of chunks) {\n            result.set(chunk, position);\n            position += chunk.byteLength;\n        }\n        return result;\n    }\n}\n\nlet cachedValue: FetchWithProgress | undefined;\nfunction fetchServer(\n    onProgress?: (e: [downloaded: number, total: number]) => void\n) {\n    if (!cachedValue) {\n        cachedValue = new FetchWithProgress(SERVER_URL);\n        cachedValue.promise.catch((e) => {\n            cachedValue = undefined;\n        });\n    }\n\n    if (onProgress) {\n        cachedValue.onProgress(onProgress);\n        onProgress([cachedValue.downloaded, cachedValue.total]);\n    }\n\n    return cachedValue.promise;\n}\n\nexport interface H264Decoder extends Disposable {\n    readonly maxProfile: AndroidCodecProfile | undefined;\n    readonly maxLevel: AndroidCodecLevel | undefined;\n\n    readonly renderer: HTMLElement;\n    readonly frameRendered: number;\n    readonly writable: WritableStream<ScrcpyVideoStreamPacket>;\n}\n\nexport interface H264DecoderConstructor {\n    new (): H264Decoder;\n}\n\ninterface DecoderDefinition {\n    key: string;\n    name: string;\n    Constructor: H264DecoderConstructor;\n}\n\ntype RequiredScrcpyOptions = Pick<\n    ScrcpyOptionsInit1_24,\n    \"crop\" | \"maxSize\" | \"bitRate\" | \"powerOn\"\n>;\ntype OptionalScrcpyOptions = Partial<\n    Pick<\n        ScrcpyOptionsInit1_24,\n        | \"displayId\"\n        | \"lockVideoOrientation\"\n        | \"encoderName\"\n        | \"tunnelForward\"\n        | \"stayAwake\"\n        | \"powerOffOnClose\"\n    >\n>;\n\ninterface Settings extends RequiredScrcpyOptions, OptionalScrcpyOptions {\n    turnScreenOff?: boolean;\n    decoder?: string;\n    ignoreDecoderCodecArgs?: boolean;\n}\n\ninterface SettingDefinitionBase {\n    key: keyof Settings;\n    type: string;\n    label: string;\n    labelExtra?: JSX.Element;\n    description?: string;\n}\n\ninterface TextSettingDefinition extends SettingDefinitionBase {\n    type: \"text\";\n    placeholder?: string;\n}\n\ninterface DropdownSettingDefinition extends SettingDefinitionBase {\n    type: \"dropdown\";\n    placeholder?: string;\n    options: IDropdownOption[];\n}\n\ninterface ToggleSettingDefinition extends SettingDefinitionBase {\n    type: \"toggle\";\n}\n\ninterface NumberSettingDefinition extends SettingDefinitionBase {\n    type: \"number\";\n    min?: number;\n    max?: number;\n    step?: number;\n}\n\ntype SettingDefinition =\n    | TextSettingDefinition\n    | DropdownSettingDefinition\n    | ToggleSettingDefinition\n    | NumberSettingDefinition;\n\ninterface SettingItemProps {\n    definition: SettingDefinition;\n    settings: any;\n    onChange: (key: keyof Settings, value: any) => void;\n}\n\nconst useClasses = makeStyles({\n    labelRight: {\n        marginLeft: \"4px\",\n    },\n    video: {\n        transformOrigin: \"center center\",\n        touchAction: \"none\",\n    },\n});\n\nconst SettingItem = observer(function SettingItem({\n    definition,\n    settings,\n    onChange,\n}: SettingItemProps) {\n    const classes = useClasses();\n\n    let label: JSX.Element = (\n        <Stack horizontal verticalAlign=\"center\">\n            <span>{definition.label}</span>\n            {!!definition.description && (\n                <TooltipHost content={definition.description}>\n                    <Icon\n                        className={classes.labelRight}\n                        iconName={Icons.Info}\n                    />\n                </TooltipHost>\n            )}\n            {definition.labelExtra}\n        </Stack>\n    );\n\n    switch (definition.type) {\n        case \"text\":\n            return (\n                <TextField\n                    label={label as any}\n                    placeholder={definition.placeholder}\n                    value={settings[definition.key]}\n                    onChange={(e, value) => onChange(definition.key, value)}\n                />\n            );\n        case \"dropdown\":\n            return (\n                <Dropdown\n                    label={label as any}\n                    options={definition.options}\n                    placeholder={definition.placeholder}\n                    selectedKey={settings[definition.key]}\n                    onChange={(e, option) =>\n                        onChange(definition.key, option!.key)\n                    }\n                />\n            );\n        case \"toggle\":\n            return (\n                <Toggle\n                    label={label}\n                    checked={settings[definition.key]}\n                    onChange={(e, checked) => onChange(definition.key, checked)}\n                />\n            );\n        case \"number\":\n            return (\n                <SpinButton\n                    label={definition.label}\n                    labelPosition={Position.top}\n                    min={definition.min}\n                    max={definition.max}\n                    step={definition.step}\n                    value={settings[definition.key].toString()}\n                    onChange={(e, value) =>\n                        onChange(definition.key, Number.parseInt(value!, 10))\n                    }\n                />\n            );\n    }\n});\n\nconst KEY_MAP = {\n    Enter: AndroidKeyCode.Enter,\n    Escape: AndroidKeyCode.Escape,\n    Backspace: AndroidKeyCode.Delete,\n    Tab: AndroidKeyCode.Tab,\n    Delete: AndroidKeyCode.ForwardDelete,\n    Home: AndroidKeyCode.MoveHome,\n    End: AndroidKeyCode.MoveEnd,\n    Space: AndroidKeyCode.Space,\n    ArrowUp: AndroidKeyCode.DPadUp,\n    ArrowDown: AndroidKeyCode.DPadDown,\n    ArrowLeft: AndroidKeyCode.DPadLeft,\n    ArrowRight: AndroidKeyCode.DPadRight,\n} as Record<string, AndroidKeyCode | undefined>;\n\nclass ScrcpyPageState {\n    running = false;\n\n    deviceView: DeviceViewRef | null = null;\n    rendererContainer: HTMLDivElement | null = null;\n\n    logVisible = false;\n    log: string[] = [];\n    settingsVisible = false;\n    demoModeVisible = false;\n    navigationBarVisible = true;\n\n    width = 0;\n    height = 0;\n    rotate = 0;\n\n    get rotatedWidth() {\n        return state.rotate & 1 ? state.height : state.width;\n    }\n    get rotatedHeight() {\n        return state.rotate & 1 ? state.width : state.height;\n    }\n\n    client: AdbScrcpyClient | undefined = undefined;\n    hoverHelper: ScrcpyHoverHelper | undefined = undefined;\n\n    async pushServer() {\n        const serverBuffer = await fetchServer();\n\n        await new ReadableStream<Uint8Array>({\n            start(controller) {\n                controller.enqueue(serverBuffer);\n                controller.close();\n            },\n        }).pipeTo(AdbScrcpyClient.pushServer(GlobalState.device!));\n    }\n\n    encoders: string[] = [];\n    updateEncoders = async () => {\n        try {\n            await this.pushServer();\n\n            const encoders = await AdbScrcpyClient.getEncoders(\n                GlobalState.device!,\n                DEFAULT_SERVER_PATH,\n                SCRCPY_SERVER_VERSION,\n                new AdbScrcpyOptions1_22(\n                    new ScrcpyOptions1_25({\n                        logLevel: ScrcpyLogLevel.Debug,\n                        tunnelForward: this.settings.tunnelForward,\n                    })\n                )\n            );\n\n            runInAction(() => {\n                this.encoders = encoders;\n                if (\n                    !this.settings.encoderName ||\n                    !this.encoders.includes(this.settings.encoderName)\n                ) {\n                    this.settings.encoderName = this.encoders[0];\n                }\n            });\n        } catch (e: any) {\n            GlobalState.showErrorDialog(e);\n        }\n    };\n\n    decoders: DecoderDefinition[] = [\n        {\n            key: \"tinyh264\",\n            name: \"TinyH264 (Software)\",\n            Constructor: TinyH264Decoder,\n        },\n    ];\n    decoder: H264Decoder | undefined = undefined;\n    fpsCounterIntervalId: any = undefined;\n    fps = 0;\n\n    displays: number[] = [];\n    updateDisplays = async () => {\n        try {\n            await this.pushServer();\n\n            const displays = await AdbScrcpyClient.getDisplays(\n                GlobalState.device!,\n                DEFAULT_SERVER_PATH,\n                SCRCPY_SERVER_VERSION,\n                new AdbScrcpyOptions1_22(\n                    new ScrcpyOptions1_25({\n                        logLevel: ScrcpyLogLevel.Debug,\n                        tunnelForward: this.settings.tunnelForward,\n                    })\n                )\n            );\n\n            runInAction(() => {\n                this.displays = displays;\n                if (\n                    !this.settings.displayId ||\n                    !this.displays.includes(this.settings.displayId)\n                ) {\n                    this.settings.displayId = this.displays[0];\n                }\n            });\n        } catch (e: any) {\n            GlobalState.showErrorDialog(e);\n        }\n    };\n\n    connecting = false;\n    serverTotalSize = 0;\n    serverDownloadedSize = 0;\n    debouncedServerDownloadedSize = 0;\n    serverDownloadSpeed = 0;\n    serverUploadedSize = 0;\n    debouncedServerUploadedSize = 0;\n    serverUploadSpeed = 0;\n\n    get commandBarItems() {\n        const result: ICommandBarItemProps[] = [];\n\n        if (!this.running) {\n            result.push({\n                key: \"start\",\n                disabled: !GlobalState.device,\n                iconProps: { iconName: Icons.Play },\n                text: \"Start\",\n                onClick: this.start as VoidFunction,\n            });\n        } else {\n            result.push({\n                key: \"stop\",\n                iconProps: { iconName: Icons.Stop },\n                text: \"Stop\",\n                onClick: this.stop as VoidFunction,\n            });\n        }\n\n        result.push({\n            key: \"fullscreen\",\n            disabled: !this.running,\n            iconProps: { iconName: Icons.FullScreenMaximize },\n            iconOnly: true,\n            text: \"Fullscreen\",\n            onClick: () => {\n                this.deviceView?.enterFullscreen();\n            },\n        });\n\n        result.push(\n            {\n                key: \"volumeUp\",\n                disabled: !this.running,\n                iconProps: { iconName: Icons.Speaker2 },\n                iconOnly: true,\n                text: \"Volume Up\",\n                onClick: (async () => {\n                    // TODO: Auto repeat when holding\n                    await this.client?.controlMessageSerializer!.injectKeyCode({\n                        action: AndroidKeyEventAction.Down,\n                        keyCode: AndroidKeyCode.VolumeUp,\n                        repeat: 0,\n                        metaState: 0,\n                    });\n                    await this.client?.controlMessageSerializer!.injectKeyCode({\n                        action: AndroidKeyEventAction.Up,\n                        keyCode: AndroidKeyCode.VolumeUp,\n                        repeat: 0,\n                        metaState: 0,\n                    });\n                }) as () => void,\n            },\n            {\n                key: \"volumeDown\",\n                disabled: !this.running,\n                iconProps: { iconName: Icons.Speaker1 },\n                iconOnly: true,\n                text: \"Volume Down\",\n                onClick: (async () => {\n                    await this.client?.controlMessageSerializer!.injectKeyCode({\n                        action: AndroidKeyEventAction.Down,\n                        keyCode: AndroidKeyCode.VolumeDown,\n                        repeat: 0,\n                        metaState: 0,\n                    });\n                    await this.client?.controlMessageSerializer!.injectKeyCode({\n                        action: AndroidKeyEventAction.Up,\n                        keyCode: AndroidKeyCode.VolumeDown,\n                        repeat: 0,\n                        metaState: 0,\n                    });\n                }) as () => void,\n            },\n            {\n                key: \"volumeMute\",\n                disabled: !this.running,\n                iconProps: { iconName: Icons.SpeakerOff },\n                iconOnly: true,\n                text: \"Toggle Mute\",\n                onClick: (async () => {\n                    await this.client?.controlMessageSerializer!.injectKeyCode({\n                        action: AndroidKeyEventAction.Down,\n                        keyCode: AndroidKeyCode.VolumeMute,\n                        repeat: 0,\n                        metaState: 0,\n                    });\n                    await this.client?.controlMessageSerializer!.injectKeyCode({\n                        action: AndroidKeyEventAction.Up,\n                        keyCode: AndroidKeyCode.VolumeMute,\n                        repeat: 0,\n                        metaState: 0,\n                    });\n                }) as () => void,\n            }\n        );\n\n        result.push(\n            {\n                key: \"rotateDevice\",\n                disabled: !this.running,\n                iconProps: { iconName: Icons.Orientation },\n                iconOnly: true,\n                text: \"Rotate Device\",\n                onClick: () => {\n                    this.client!.controlMessageSerializer!.rotateDevice();\n                },\n            },\n            {\n                key: \"rotateVideoLeft\",\n                disabled: !this.running,\n                iconProps: { iconName: Icons.RotateLeft },\n                iconOnly: true,\n                text: \"Rotate Video Left\",\n                onClick: action(() => {\n                    this.rotate -= 1;\n                    if (this.rotate < 0) {\n                        this.rotate = 3;\n                    }\n                }),\n            },\n            {\n                key: \"rotateVideoRight\",\n                disabled: !this.running,\n                iconProps: { iconName: Icons.RotateRight },\n                iconOnly: true,\n                text: \"Rotate Video Right\",\n                onClick: action(() => {\n                    this.rotate = (this.rotate + 1) & 3;\n                }),\n            }\n        );\n\n        result.push(\n            {\n                key: \"turnScreenOff\",\n                disabled: !this.running,\n                iconProps: { iconName: Icons.Lightbulb },\n                iconOnly: true,\n                text: \"Turn Screen Off\",\n                onClick: () => {\n                    this.client!.controlMessageSerializer!.setScreenPowerMode(\n                        AndroidScreenPowerMode.Off\n                    );\n                },\n            },\n            {\n                key: \"turnScreenOn\",\n                disabled: !this.running,\n                iconProps: { iconName: Icons.LightbulbFilament },\n                iconOnly: true,\n                text: \"Turn Screen On\",\n                onClick: () => {\n                    this.client!.controlMessageSerializer!.setScreenPowerMode(\n                        AndroidScreenPowerMode.Normal\n                    );\n                },\n            }\n        );\n\n        if (this.running) {\n            result.push({\n                key: \"fps\",\n                text: `FPS: ${this.fps}`,\n                disabled: true,\n            });\n        }\n\n        return result;\n    }\n\n    get commandBarFarItems(): ICommandBarItemProps[] {\n        return [\n            {\n                key: \"NavigationBar\",\n                iconProps: { iconName: Icons.PanelBottom },\n                checked: this.navigationBarVisible,\n                text: \"Navigation Bar\",\n                iconOnly: true,\n                onClick: action(() => {\n                    this.navigationBarVisible = !this.navigationBarVisible;\n                }),\n            },\n            {\n                key: \"Log\",\n                iconProps: { iconName: Icons.TextGrammarError },\n                checked: this.logVisible,\n                text: \"Log\",\n                iconOnly: true,\n                onClick: action(() => {\n                    this.logVisible = !this.logVisible;\n                }),\n            },\n            {\n                key: \"Settings\",\n                iconProps: { iconName: Icons.Settings },\n                checked: this.settingsVisible,\n                text: \"Settings\",\n                iconOnly: true,\n                onClick: action(() => {\n                    this.settingsVisible = !this.settingsVisible;\n                }),\n            },\n            {\n                key: \"DemoMode\",\n                iconProps: { iconName: Icons.Wand },\n                checked: this.demoModeVisible,\n                text: \"Demo Mode\",\n                iconOnly: true,\n                onClick: action(() => {\n                    this.demoModeVisible = !this.demoModeVisible;\n                }),\n            },\n            {\n                key: \"info\",\n                iconProps: { iconName: Icons.Info },\n                iconOnly: true,\n                tooltipHostProps: {\n                    content: (\n                        <>\n                            <p>\n                                <ExternalLink\n                                    href=\"https://github.com/Genymobile/scrcpy\"\n                                    spaceAfter\n                                >\n                                    Scrcpy\n                                </ExternalLink>\n                                developed by Genymobile can display the screen\n                                with low latency (1~2 frames) and control the\n                                device, all without root access.\n                            </p>\n                            <p>\n                                This is a TypeScript implementation of the\n                                client part. Paired with official pre-built\n                                server binary.\n                            </p>\n                        </>\n                    ),\n                    calloutProps: {\n                        calloutMaxWidth: 300,\n                    },\n                },\n            },\n        ];\n    }\n\n    settings: Settings = {\n        maxSize: 1080,\n        bitRate: 4_000_000,\n        lockVideoOrientation: ScrcpyVideoOrientation.Unlocked,\n        displayId: 0,\n        crop: \"\",\n        powerOn: true,\n    };\n\n    get settingDefinitions() {\n        const result: SettingDefinition[] = [];\n\n        result.push(\n            {\n                key: \"powerOn\",\n                type: \"toggle\",\n                label: \"Turn device on when starting\",\n            },\n            {\n                key: \"turnScreenOff\",\n                type: \"toggle\",\n                label: \"Turn screen off when starting\",\n            },\n            {\n                key: \"stayAwake\",\n                type: \"toggle\",\n                label: \"Stay awake (if plugged in)\",\n            },\n            {\n                key: \"powerOffOnClose\",\n                type: \"toggle\",\n                label: \"Turn device off when exiting\",\n            }\n        );\n\n        result.push({\n            key: \"displayId\",\n            type: \"dropdown\",\n            label: \"Display\",\n            placeholder: \"Press refresh to update available displays\",\n            labelExtra: (\n                <IconButton\n                    iconProps={{ iconName: Icons.ArrowClockwise }}\n                    disabled={!GlobalState.device}\n                    text=\"Refresh\"\n                    onClick={this.updateDisplays}\n                />\n            ),\n            options: this.displays.map((item) => ({\n                key: item,\n                text: item.toString(),\n            })),\n        });\n\n        result.push({\n            key: \"crop\",\n            type: \"text\",\n            label: \"Crop\",\n            placeholder: \"W:H:X:Y\",\n        });\n\n        result.push({\n            key: \"maxSize\",\n            type: \"number\",\n            label: \"Max Resolution (longer side, 0 = unlimited)\",\n            min: 0,\n            max: 2560,\n            step: 50,\n        });\n\n        result.push({\n            key: \"bitRate\",\n            type: \"number\",\n            label: \"Max Bit Rate\",\n            min: 100,\n            max: 100_000_000,\n            step: 100,\n        });\n\n        result.push({\n            key: \"lockVideoOrientation\",\n            type: \"dropdown\",\n            label: \"Lock Video Orientation\",\n            options: [\n                {\n                    key: ScrcpyVideoOrientation.Unlocked,\n                    text: \"Unlocked\",\n                },\n                {\n                    key: ScrcpyVideoOrientation.Initial,\n                    text: \"Current\",\n                },\n                {\n                    key: ScrcpyVideoOrientation.Portrait,\n                    text: \"Portrait\",\n                },\n                {\n                    key: ScrcpyVideoOrientation.Landscape,\n                    text: \"Landscape\",\n                },\n                {\n                    key: ScrcpyVideoOrientation.PortraitFlipped,\n                    text: \"Portrait (Flipped)\",\n                },\n                {\n                    key: ScrcpyVideoOrientation.LandscapeFlipped,\n                    text: \"Landscape (Flipped)\",\n                },\n            ],\n        });\n\n        result.push({\n            key: \"encoderName\",\n            type: \"dropdown\",\n            label: \"Encoder\",\n            placeholder: \"Press refresh to update available encoders\",\n            labelExtra: (\n                <IconButton\n                    iconProps={{ iconName: Icons.ArrowClockwise }}\n                    disabled={!GlobalState.device}\n                    text=\"Refresh\"\n                    onClick={this.updateEncoders}\n                />\n            ),\n            options: this.encoders.map((item) => ({\n                key: item,\n                text: item,\n            })),\n        });\n\n        if (this.decoders.length > 1) {\n            result.push({\n                key: \"decoder\",\n                type: \"dropdown\",\n                label: \"Decoder\",\n                options: this.decoders.map((item) => ({\n                    key: item.key,\n                    text: item.name,\n                    data: item,\n                })),\n            });\n        }\n\n        result.push({\n            key: \"ignoreDecoderCodecArgs\",\n            type: \"toggle\",\n            label: `Ignore decoder's codec arguments`,\n            description: `Some decoders don't support all H.264 profile/levels, so they request the device to encode at their highest-supported codec. However, some super old devices may not support that codec so their encoders will fail to start. Use this option to let device choose the codec to be used.`,\n        });\n\n        result.push({\n            key: \"tunnelForward\",\n            type: \"toggle\",\n            label: \"Use forward connection\",\n            description:\n                \"Android before version 9 has a bug that prevents reverse tunneling when using ADB over WiFi.\",\n        });\n\n        return result;\n    }\n\n    constructor() {\n        makeAutoObservable(this, {\n            decoders: observable.shallow,\n            settings: observable.deep,\n            start: false,\n            stop: action.bound,\n            dispose: action.bound,\n            handleDeviceViewRef: action.bound,\n            handleRendererContainerRef: action.bound,\n            handleBackPointerDown: false,\n            handleBackPointerUp: false,\n            handleHomePointerDown: false,\n            handleHomePointerUp: false,\n            handleAppSwitchPointerDown: false,\n            handleAppSwitchPointerUp: false,\n            calculatePointerPosition: false,\n            injectTouch: false,\n            handlePointerDown: false,\n            handlePointerMove: false,\n            handlePointerUp: false,\n            handlePointerLeave: false,\n            handleWheel: false,\n            handleContextMenu: false,\n            handleKeyDown: false,\n        });\n\n        autorun(() => {\n            if (GlobalState.device) {\n                runInAction(() => {\n                    this.encoders = [];\n                    this.settings.encoderName = undefined;\n\n                    this.displays = [];\n                    this.settings.displayId = undefined;\n                });\n            } else {\n                this.dispose();\n            }\n        });\n\n        autorun(() => {\n            if (this.rendererContainer && this.decoder) {\n                while (this.rendererContainer.firstChild) {\n                    this.rendererContainer.firstChild.remove();\n                }\n                this.rendererContainer.appendChild(this.decoder.renderer);\n            }\n        });\n\n        autorun(() => {\n            this.settings.decoder = this.decoders[0].key;\n        });\n    }\n\n    start = async () => {\n        if (!GlobalState.device) {\n            return;\n        }\n\n        try {\n            if (!this.settings.decoder) {\n                throw new Error(\"No available decoder\");\n            }\n\n            runInAction(() => {\n                this.serverTotalSize = 0;\n                this.serverDownloadedSize = 0;\n                this.debouncedServerDownloadedSize = 0;\n                this.serverUploadedSize = 0;\n                this.debouncedServerUploadedSize = 0;\n                this.connecting = true;\n            });\n\n            let intervalId = setInterval(\n                action(() => {\n                    this.serverDownloadSpeed =\n                        this.serverDownloadedSize -\n                        this.debouncedServerDownloadedSize;\n                    this.debouncedServerDownloadedSize =\n                        this.serverDownloadedSize;\n                }),\n                1000\n            );\n\n            let serverBuffer: Uint8Array;\n\n            try {\n                serverBuffer = await fetchServer(\n                    action(([downloaded, total]) => {\n                        this.serverDownloadedSize = downloaded;\n                        this.serverTotalSize = total;\n                    })\n                );\n                runInAction(() => {\n                    this.serverDownloadSpeed =\n                        this.serverDownloadedSize -\n                        this.debouncedServerDownloadedSize;\n                    this.debouncedServerDownloadedSize =\n                        this.serverDownloadedSize;\n                });\n            } finally {\n                clearInterval(intervalId);\n            }\n\n            intervalId = setInterval(\n                action(() => {\n                    this.serverUploadSpeed =\n                        this.serverUploadedSize -\n                        this.debouncedServerUploadedSize;\n                    this.debouncedServerUploadedSize = this.serverUploadedSize;\n                }),\n                1000\n            );\n\n            try {\n                await new ReadableStream<Uint8Array>({\n                    start(controller) {\n                        controller.enqueue(serverBuffer);\n                        controller.close();\n                    },\n                })\n                    .pipeThrough(new ChunkStream(ADB_SYNC_MAX_PACKET_SIZE))\n                    .pipeThrough(\n                        new ProgressStream(\n                            action((progress) => {\n                                this.serverUploadedSize = progress;\n                            })\n                        )\n                    )\n                    .pipeTo(AdbScrcpyClient.pushServer(GlobalState.device!));\n\n                runInAction(() => {\n                    this.serverUploadSpeed =\n                        this.serverUploadedSize -\n                        this.debouncedServerUploadedSize;\n                    this.debouncedServerUploadedSize = this.serverUploadedSize;\n                });\n            } finally {\n                clearInterval(intervalId);\n            }\n\n            const decoderDefinition =\n                this.decoders.find((x) => x.key === this.settings.decoder) ??\n                this.decoders[0];\n            const decoder = new decoderDefinition.Constructor();\n\n            runInAction(() => {\n                this.decoder = decoder;\n\n                let lastFrameCount = 0;\n                this.fpsCounterIntervalId = setInterval(\n                    action(() => {\n                        this.fps = decoder.frameRendered - lastFrameCount;\n                        lastFrameCount = decoder.frameRendered;\n                    }),\n                    1000\n                );\n            });\n\n            const options = new AdbScrcpyOptions1_22(\n                new ScrcpyOptions1_25({\n                    logLevel: ScrcpyLogLevel.Debug,\n                    ...this.settings,\n                    sendDeviceMeta: false,\n                    sendDummyByte: false,\n                    codecOptions: !this.settings.ignoreDecoderCodecArgs\n                        ? new CodecOptions({\n                              profile: decoder.maxProfile,\n                              level: decoder.maxLevel,\n                          })\n                        : undefined,\n                })\n            );\n\n            runInAction(() => {\n                this.log = [];\n                this.log.push(\n                    `[client] Server version: ${SCRCPY_SERVER_VERSION}`\n                );\n                this.log.push(\n                    `[client] Server arguments: ${options\n                        .formatServerArguments()\n                        .join(\" \")}`\n                );\n            });\n\n            const client = await AdbScrcpyClient.start(\n                GlobalState.device!,\n                DEFAULT_SERVER_PATH,\n                SCRCPY_SERVER_VERSION,\n                options\n            );\n\n            client.stdout.pipeTo(\n                new WritableStream<string>({\n                    write: action((line) => {\n                        this.log.push(line);\n                    }),\n                })\n            );\n\n            client.videoStream\n                .pipeThrough(\n                    new InspectStream(\n                        action((packet: ScrcpyVideoStreamPacket) => {\n                            if (packet.type === \"configuration\") {\n                                const { croppedWidth, croppedHeight } =\n                                    packet.data;\n                                this.log.push(\n                                    `[client] Video size changed: ${croppedWidth}x${croppedHeight}`\n                                );\n\n                                this.width = croppedWidth;\n                                this.height = croppedHeight;\n                            }\n                        })\n                    )\n                )\n                .pipeTo(decoder.writable)\n                .catch(() => {});\n\n            client.exit.then(this.dispose);\n\n            client\n                .deviceMessageStream!.pipeTo(\n                    new WritableStream({\n                        write(message) {\n                            switch (message.type) {\n                                case ScrcpyDeviceMessageType.Clipboard:\n                                    window.navigator.clipboard.writeText(\n                                        message.content\n                                    );\n                                    break;\n                            }\n                        },\n                    })\n                )\n                .catch(() => {});\n\n            if (this.settings.turnScreenOff) {\n                await client.controlMessageSerializer!.setScreenPowerMode(\n                    AndroidScreenPowerMode.Off\n                );\n            }\n\n            runInAction(() => {\n                this.client = client;\n                this.hoverHelper = new ScrcpyHoverHelper();\n                this.running = true;\n            });\n        } catch (e: any) {\n            GlobalState.showErrorDialog(e);\n        } finally {\n            runInAction(() => {\n                this.connecting = false;\n            });\n        }\n    };\n\n    async stop() {\n        // Request to close client first\n        await this.client?.close();\n        this.dispose();\n    }\n\n    dispose() {\n        // Otherwise some packets may still arrive at decoder\n        this.decoder?.dispose();\n        this.decoder = undefined;\n\n        this.fps = 0;\n        clearTimeout(this.fpsCounterIntervalId);\n\n        this.client = undefined;\n        this.running = false;\n    }\n\n    handleDeviceViewRef(element: DeviceViewRef | null) {\n        this.deviceView = element;\n    }\n\n    handleRendererContainerRef(element: HTMLDivElement | null) {\n        this.rendererContainer = element;\n        this.rendererContainer?.addEventListener(\"wheel\", this.handleWheel, {\n            passive: false,\n        });\n    }\n\n    handleBackPointerDown = (e: React.PointerEvent<HTMLDivElement>) => {\n        if (!this.client) {\n            return;\n        }\n\n        if (e.button !== 0) {\n            return;\n        }\n        e.currentTarget.setPointerCapture(e.pointerId);\n\n        this.client!.controlMessageSerializer!.backOrScreenOn(\n            AndroidKeyEventAction.Down\n        );\n    };\n\n    handleBackPointerUp = (e: React.PointerEvent<HTMLDivElement>) => {\n        if (!this.client) {\n            return;\n        }\n\n        if (e.button !== 0) {\n            return;\n        }\n\n        this.client!.controlMessageSerializer!.backOrScreenOn(\n            AndroidKeyEventAction.Up\n        );\n    };\n\n    handleHomePointerDown = (e: React.PointerEvent<HTMLDivElement>) => {\n        if (!this.client) {\n            return;\n        }\n\n        if (e.button !== 0) {\n            return;\n        }\n        e.currentTarget.setPointerCapture(e.pointerId);\n\n        this.client!.controlMessageSerializer!.injectKeyCode({\n            action: AndroidKeyEventAction.Down,\n            keyCode: AndroidKeyCode.Home,\n            repeat: 0,\n            metaState: 0,\n        });\n    };\n\n    handleHomePointerUp = (e: React.PointerEvent<HTMLDivElement>) => {\n        if (!this.client) {\n            return;\n        }\n\n        if (e.button !== 0) {\n            return;\n        }\n\n        this.client!.controlMessageSerializer!.injectKeyCode({\n            action: AndroidKeyEventAction.Up,\n            keyCode: AndroidKeyCode.Home,\n            repeat: 0,\n            metaState: 0,\n        });\n    };\n\n    handleAppSwitchPointerDown = async (\n        e: React.PointerEvent<HTMLDivElement>\n    ) => {\n        if (!this.client) {\n            return;\n        }\n\n        if (e.button !== 0) {\n            return;\n        }\n        e.currentTarget.setPointerCapture(e.pointerId);\n\n        this.client!.controlMessageSerializer!.injectKeyCode({\n            action: AndroidKeyEventAction.Down,\n            keyCode: AndroidKeyCode.AppSwitch,\n            repeat: 0,\n            metaState: 0,\n        });\n    };\n\n    handleAppSwitchPointerUp = async (\n        e: React.PointerEvent<HTMLDivElement>\n    ) => {\n        if (!this.client) {\n            return;\n        }\n\n        if (e.button !== 0) {\n            return;\n        }\n\n        this.client!.controlMessageSerializer!.injectKeyCode({\n            action: AndroidKeyEventAction.Up,\n            keyCode: AndroidKeyCode.AppSwitch,\n            repeat: 0,\n            metaState: 0,\n        });\n    };\n\n    calculatePointerPosition(clientX: number, clientY: number) {\n        const viewRect = this.rendererContainer!.getBoundingClientRect();\n        let pointerViewX = clamp((clientX - viewRect.x) / viewRect.width, 0, 1);\n        let pointerViewY = clamp(\n            (clientY - viewRect.y) / viewRect.height,\n            0,\n            1\n        );\n\n        if (this.rotate & 1) {\n            [pointerViewX, pointerViewY] = [pointerViewY, pointerViewX];\n        }\n        switch (this.rotate) {\n            case 1:\n                pointerViewY = 1 - pointerViewY;\n                break;\n            case 2:\n                pointerViewX = 1 - pointerViewX;\n                pointerViewY = 1 - pointerViewY;\n                break;\n            case 3:\n                pointerViewX = 1 - pointerViewX;\n                break;\n        }\n\n        return {\n            x: pointerViewX * this.width,\n            y: pointerViewY * this.height,\n        };\n    }\n\n    injectTouch = (\n        action: AndroidMotionEventAction,\n        e: React.PointerEvent<HTMLDivElement>\n    ) => {\n        if (!this.client) {\n            return;\n        }\n\n        const { pointerType } = e;\n        let pointerId: bigint;\n        if (pointerType === \"mouse\") {\n            // ScrcpyPointerId.Mouse doesn't work with Chrome browser\n            // https://github.com/Genymobile/scrcpy/issues/3635\n            pointerId = ScrcpyPointerId.Finger;\n        } else {\n            pointerId = BigInt(e.pointerId);\n        }\n\n        const { x, y } = this.calculatePointerPosition(e.clientX, e.clientY);\n\n        const messages = this.hoverHelper!.process({\n            action,\n            pointerId,\n            screenWidth: this.client.screenWidth!,\n            screenHeight: this.client.screenHeight!,\n            pointerX: x,\n            pointerY: y,\n            pressure: e.pressure,\n            buttons: e.buttons,\n        });\n        for (const message of messages) {\n            this.client.controlMessageSerializer!.injectTouch(message);\n        }\n    };\n\n    handlePointerDown = (e: React.PointerEvent<HTMLDivElement>) => {\n        this.rendererContainer!.focus();\n        e.preventDefault();\n        e.stopPropagation();\n        e.currentTarget.setPointerCapture(e.pointerId);\n        this.injectTouch(AndroidMotionEventAction.Down, e);\n    };\n\n    handlePointerMove = (e: React.PointerEvent<HTMLDivElement>) => {\n        if (!this.client) {\n            return;\n        }\n\n        e.preventDefault();\n        e.stopPropagation();\n        this.injectTouch(\n            e.buttons === 0\n                ? AndroidMotionEventAction.HoverMove\n                : AndroidMotionEventAction.Move,\n            e\n        );\n    };\n\n    handlePointerUp = (e: React.PointerEvent<HTMLDivElement>) => {\n        e.preventDefault();\n        e.stopPropagation();\n        this.injectTouch(AndroidMotionEventAction.Up, e);\n    };\n\n    handlePointerLeave = (e: React.PointerEvent<HTMLDivElement>) => {\n        e.preventDefault();\n        e.stopPropagation();\n        // Prevent hover state on device from \"stucking\" at the last position\n        this.injectTouch(AndroidMotionEventAction.HoverExit, e);\n        this.injectTouch(AndroidMotionEventAction.Up, e);\n    };\n\n    handleWheel = (e: WheelEvent) => {\n        if (!this.client) {\n            return;\n        }\n\n        e.preventDefault();\n        e.stopPropagation();\n\n        const { x, y } = this.calculatePointerPosition(e.clientX, e.clientY);\n        this.client!.controlMessageSerializer!.injectScroll({\n            screenWidth: this.client!.screenWidth!,\n            screenHeight: this.client!.screenHeight!,\n            pointerX: x,\n            pointerY: y,\n            scrollX: -e.deltaX / 100,\n            scrollY: -e.deltaY / 100,\n            buttons: 0,\n        });\n    };\n\n    handleContextMenu = (e: React.MouseEvent<HTMLDivElement>) => {\n        e.preventDefault();\n    };\n\n    handleKeyDown = async (e: React.KeyboardEvent<HTMLDivElement>) => {\n        if (!this.client) {\n            return;\n        }\n\n        const { key, code } = e;\n        if (key.match(/^[!-`{-~]$/i)) {\n            this.client!.controlMessageSerializer!.injectText(key);\n            return;\n        }\n\n        const keyCode = KEY_MAP[code];\n\n        if (keyCode) {\n            // Intercept keys like \"Tab\"\n            e.preventDefault();\n            e.stopPropagation();\n\n            this.client!.controlMessageSerializer!.injectKeyCode({\n                action: AndroidKeyEventAction.Down,\n                keyCode,\n                metaState: 0,\n                repeat: 0,\n            });\n            this.client!.controlMessageSerializer!.injectKeyCode({\n                action: AndroidKeyEventAction.Up,\n                keyCode,\n                metaState: 0,\n                repeat: 0,\n            });\n        }\n    };\n}\n\nconst state = new ScrcpyPageState();\n\nconst ConnectionDialog = observer(() => {\n    const layerHostId = useId(\"layerHost\");\n\n    const [isClient, setIsClient] = useState(false);\n\n    useEffect(() => {\n        setIsClient(true);\n    }, []);\n\n    if (!isClient) {\n        return null;\n    }\n\n    return (\n        <>\n            <LayerHost\n                id={layerHostId}\n                style={{\n                    position: \"absolute\",\n                    top: 0,\n                    bottom: 0,\n                    left: 0,\n                    right: 0,\n                    margin: 0,\n                    pointerEvents: \"none\",\n                }}\n            />\n\n            <Dialog\n                hidden={!state.connecting}\n                modalProps={{ layerProps: { hostId: layerHostId } }}\n                dialogContentProps={{ title: \"Connecting...\" }}\n            >\n                <Stack tokens={CommonStackTokens}>\n                    <ProgressIndicator\n                        label=\"1. Downloading scrcpy server...\"\n                        percentComplete={\n                            state.serverTotalSize\n                                ? state.serverDownloadedSize /\n                                  state.serverTotalSize\n                                : undefined\n                        }\n                        description={formatSpeed(\n                            state.debouncedServerDownloadedSize,\n                            state.serverTotalSize,\n                            state.serverDownloadSpeed\n                        )}\n                    />\n\n                    <ProgressIndicator\n                        label=\"2. Pushing scrcpy server to device...\"\n                        progressHidden={\n                            state.serverTotalSize === 0 ||\n                            state.serverDownloadedSize !== state.serverTotalSize\n                        }\n                        percentComplete={\n                            state.serverUploadedSize / state.serverTotalSize\n                        }\n                        description={formatSpeed(\n                            state.debouncedServerUploadedSize,\n                            state.serverTotalSize,\n                            state.serverUploadSpeed\n                        )}\n                    />\n\n                    <ProgressIndicator\n                        label=\"3. Starting scrcpy server on device...\"\n                        progressHidden={\n                            state.serverTotalSize === 0 ||\n                            state.serverUploadedSize !== state.serverTotalSize\n                        }\n                    />\n                </Stack>\n            </Dialog>\n        </>\n    );\n});\n\nconst NavigationBar = observer(function NavigationBar({\n    className,\n    style,\n    children,\n}: {\n    className: string;\n    style: CSSProperties;\n    children: ReactNode;\n}) {\n    if (!state.navigationBarVisible) {\n        return (\n            <div className={className} style={style}>\n                {children}\n            </div>\n        );\n    }\n\n    return (\n        <Stack\n            className={className}\n            verticalFill\n            horizontalAlign=\"center\"\n            style={{ height: \"40px\", background: \"#999\", ...style }}\n        >\n            {children}\n            <Stack\n                verticalFill\n                horizontal\n                style={{ width: \"100%\", maxWidth: 300 }}\n                horizontalAlign=\"space-evenly\"\n                verticalAlign=\"center\"\n            >\n                <IconButton\n                    iconProps={{ iconName: Icons.Play }}\n                    style={{ transform: \"rotate(180deg)\", color: \"white\" }}\n                    onPointerDown={state.handleBackPointerDown}\n                    onPointerUp={state.handleBackPointerUp}\n                />\n                <IconButton\n                    iconProps={{ iconName: Icons.Circle }}\n                    style={{ color: \"white\" }}\n                    onPointerDown={state.handleHomePointerDown}\n                    onPointerUp={state.handleHomePointerUp}\n                />\n                <IconButton\n                    iconProps={{ iconName: Icons.Stop }}\n                    style={{ color: \"white\" }}\n                    onPointerDown={state.handleAppSwitchPointerDown}\n                    onPointerUp={state.handleAppSwitchPointerUp}\n                />\n            </Stack>\n        </Stack>\n    );\n});\n\nconst Scrcpy: NextPage = () => {\n    const classes = useClasses();\n\n    useEffect(() => {\n        // Detect WebCodecs support at client side\n        if (\n            state.decoders.length === 1 &&\n            typeof window.VideoDecoder === \"function\"\n        ) {\n            runInAction(() => {\n                state.decoders.unshift({\n                    key: \"webcodecs\",\n                    name: \"WebCodecs\",\n                    Constructor: WebCodecsDecoder,\n                });\n            });\n        }\n    }, []);\n\n    return (\n        <Stack {...RouteStackProps}>\n            <Head>\n                <title>Scrcpy - Android Web Toolbox</title>\n            </Head>\n\n            <CommandBar\n                items={state.commandBarItems}\n                farItems={state.commandBarFarItems}\n            />\n\n            <Stack horizontal grow styles={{ root: { height: 0 } }}>\n                <DeviceView\n                    ref={state.handleDeviceViewRef}\n                    width={state.rotatedWidth}\n                    height={state.rotatedHeight}\n                    BottomElement={NavigationBar}\n                >\n                    <div\n                        ref={state.handleRendererContainerRef}\n                        tabIndex={-1}\n                        className={classes.video}\n                        style={{\n                            width: state.width,\n                            height: state.height,\n                            transform: `translate(${\n                                (state.rotatedWidth - state.width) / 2\n                            }px, ${\n                                (state.rotatedHeight - state.height) / 2\n                            }px) rotate(${state.rotate * 90}deg)`,\n                        }}\n                        onPointerDown={state.handlePointerDown}\n                        onPointerMove={state.handlePointerMove}\n                        onPointerUp={state.handlePointerUp}\n                        onPointerCancel={state.handlePointerUp}\n                        onPointerLeave={state.handlePointerLeave}\n                        onKeyDown={state.handleKeyDown}\n                        onContextMenu={state.handleContextMenu}\n                    />\n                </DeviceView>\n\n                <div\n                    style={{\n                        padding: 12,\n                        overflow: \"hidden auto\",\n                        display: state.logVisible ? \"block\" : \"none\",\n                        width: 500,\n                        fontFamily: \"monospace\",\n                        overflowY: \"auto\",\n                        whiteSpace: \"pre-wrap\",\n                        wordWrap: \"break-word\",\n                    }}\n                >\n                    {state.log.map((line, index) => (\n                        <div key={index}>{line}</div>\n                    ))}\n                </div>\n\n                <div\n                    style={{\n                        padding: 12,\n                        overflow: \"hidden auto\",\n                        display: state.settingsVisible ? \"block\" : \"none\",\n                        width: 300,\n                    }}\n                >\n                    <div>Changes will take effect on next connection</div>\n\n                    {state.settingDefinitions.map((definition) => (\n                        <SettingItem\n                            key={definition.key}\n                            definition={definition}\n                            settings={state.settings}\n                            onChange={action(\n                                (key, value) =>\n                                    ((state.settings as any)[key] = value)\n                            )}\n                        />\n                    ))}\n                </div>\n\n                <DemoModePanel\n                    style={{\n                        display: state.demoModeVisible ? \"block\" : \"none\",\n                    }}\n                />\n\n                <ConnectionDialog />\n            </Stack>\n        </Stack>\n    );\n};\n\nexport default observer(Scrcpy);\n"],"names":["window","__NEXT_P","push","__webpack_require__","worker","cachedInitializePromise","cachedValue","ScrcpyControlMessageType","AndroidMotionEventAction","ScrcpyPointerId","AndroidKeyEventAction","AndroidKeyCode","AndroidScreenPowerMode","ScrcpyDeviceMessageType","ScrcpyLogLevel","ScrcpyVideoOrientation","AndroidCodecProfile","AndroidCodecLevel","LayerHost","props","className","layerHostId","react","useState","getId","z","_a","id","hostId","layerHostRef","useRef","rootRef","notifyLayersChanged","useImperativeHandle","componentRef","current","useEffect","Layer_notification","_Y","EQ","useUnmount","k","nw","createElement","tslib_es6","pi","css","i","ref","AdbScrcpyConnection","adb","options","initialize","dispose","AdbScrcpyForwardConnection","connect","createSocket","connectAndRetry","e","async_esm","gw","connectVideoStream","readable","videoStream","sendDummyByte","reader","getReader","done","value","read","byteLength","releaseLock","getStreams","controlStream","control","sendDeviceMeta","AdbScrcpyReverseConnection","streams","address","reverse","remove","catch","queue","stream_extra_esm","GJ","writer","writable","getWriter","add","write","socket","accept","AdbScrcpyOptionsBase","raw","constructor","getDefaultValue","formatServerArguments","getOutputEncoderNameRegex","createVideoStreamTransformer","getControlMessageTypes","serializeBackOrScreenOnControlMessage","message","getScrollController","AdbScrcpyOptions1_16","createConnection","tunnelForward","AdbScrcpyOptions1_22","clamp","min","max","Mouse","BigInt","Finger","VirtualMouse","VirtualFinger","ScrcpyFloatToUint16FieldDefinition","struct_esm","Pl","size","signed","deserialize","array","littleEndian","ek","Uint16","serialize","dataView","offset","ScrcpyInjectTouchControlMessage","ZP","uint8","InjectTouch","W$","uint64","uint32","uint16","field","ScrcpyHoverHelper","lastHoverMessage","process","result","pointerId","action","Up","undefined","HoverMove","type","ScrcpyInjectKeyCodeControlMessage","InjectKeyCode","ScrcpyInjectTextControlMessage","InjectText","string","lengthField","ScrcpyRotateDeviceControlMessage","RotateDevice","ScrcpySetScreenPowerModeControlMessage","SetScreenPowerMode","ScrcpyControlMessageSerializer","types","scrollController","stream","getTypeValue","indexOf","injectKeyCode","injectText","text","injectTouch","injectScroll","InjectScroll","data","serializeScrollMessage","backOrScreenOn","buffer","BackOrScreenOn","setScreenPowerMode","mode","rotateDevice","close","ScrcpyClipboardDeviceMessage","extra","Clipboard","ScrcpyDeviceMessageDeserializeStream","pC","CODEC_OPTION_TYPES","repeatPreviousFrameAfter","maxPtsGapToEncoder","CodecOptions","toOptionValue","entries","Object","filter","length","map","key","input","replace","toLowerCase","join","DEFAULT_SERVER_PATH","toScrcpyOptionValue","empty","String","BitReader","bytePosition","bitPosition","next","decodeExponentialGolombNumber","ScrcpyInjectScrollControlMessage1_16","int32","ScrcpyScrollController1_16","accumulatedX","accumulatedY","processMessage","scrollX","scrollY","processed","VideoPacket","uint8Array","NO_PTS","ScrcpyBackOrScreenOnControlMessage1_16","ScrcpyOptions1_16","logLevel","Verbose","Debug","lockVideoOrientation","Initial","Unlocked","getArgumentOrder","maxSize","bitRate","maxFps","crop","sendFrameMeta","displayId","showTouches","stayAwake","codecOptions","encoderName","defaults","header","transform","chunk","controller","enqueue","deserializeStream","gL","pipeThrough","packet","frameData","pts","sequenceParameterSet","pictureParameterSet","parseH264Configuration","nalu","iterateNalu","start","writeIndex","zeroCount","inEmulation","byte","lastZeroCount","subarray","naluType","slice","profile_idc","profileIndex","constraint_set","constraintSet","level_idc","levelIndex","pic_width_in_mbs_minus1","pic_height_in_map_units_minus1","frame_mbs_only_flag","frame_crop_left_offset","frame_crop_right_offset","frame_crop_top_offset","frame_crop_bottom_offset","parseSequenceParameterSet","nal_ref_idc","nal_unit_type","constraint_set_reader","Uint8Array","constraint_set0_flag","constraint_set1_flag","constraint_set2_flag","constraint_set3_flag","constraint_set4_flag","constraint_set5_flag","seq_parameter_set_id","chroma_format_idc","seq_scaling_matrix_present_flag","seq_scaling_list_present_flag","pic_order_cnt_type","num_ref_frames_in_pic_order_cnt_cycle","offset_for_ref_frame","frame_cropping_flag","encodedWidth","encodedHeight","cropLeft","cropRight","cropTop","cropBottom","croppedWidth","croppedHeight","set","ExpandNotificationPanel","CollapseNotificationPanel","GetClipboard","SetClipboard","Down","ScrcpyBackOrScreenOnControlMessage1_18","fields","ScrcpyOptions1_18","concat","powerOffOnClose","splice","ExpandSettingPanel","ScrcpyOptions1_21","init","clipboardAutosync","pair","ScrcpyInjectScrollControlMessage1_22","ScrcpyScrollController1_22","ScrcpyOptions1_22","rawVideoStream","downsizeOnError","KEYFRAME_PTS","ScrcpyOptions1_23","cleanup","superStream","keyframe","ScrcpyOptions1_24","powerOn","ScrcpyFloatToInt16FieldDefinition","Int16","ScrcpyInjectScrollControlMessage1_25","ScrcpyScrollController1_25","ScrcpyOptions1_25","ArrayToStream","Pz","index","Promise","resolve","pull","ConcatStream","advance","ScrcpyExitedError","Error","output","AdbScrcpyClient","pushServer","path","sync","BF","version","connection","subprocess","spawn","protocols","esm","vf","stdout","xU","Jb","abortController","HS","pipe","pipeTo","Vj","signal","preventCancel","race","exit","abort","kill","getEncoders","assign","client","encoderNameRegex","encoders","line","match","getDisplays","displayIdRegex","displays","Number","parseInt","_stdout","_screenWidth","screenWidth","_screenHeight","screenHeight","_videoStream","_controlMessageSerializer","controlMessageSerializer","_deviceMessageStream","deviceMessageStream","N7","workerReady","pendingResolvers","streamId","PICTURE_READY_SUBSCRIPTIONS","Map","TinyH264Wrapper","event_esm","Xn","pictureReadyEvent","vp","onPictureReady","event","handler","addDisposable","handlePictureReady","delete","fire","feed","postMessage","renderStateId","all","then","t","bind","YuvBuffer","default","YuvCanvas","TinyH264Decoder","maxProfile","Baseline","maxLevel","Level4","_renderer","renderer","_frameRendered","frameRendered","_writable","_yuvCanvas","_initializer","document","configure","wrapper","promise","config","hP","attach","chromaWidth","chromaHeight","width","height","format","cropWidth","cropHeight","displayWidth","displayHeight","createTinyH264Wrapper","Worker","tu","URL","p","u","b","addEventListener","resolver","get","decoder","uPlaneOffset","vPlaneOffset","frame","lumaPlane","chromaPlane","drawFrame","toHex","toString","padStart","toUpperCase","WebCodecsDecoder","context","lastFrame","animationFrame","getContext","VideoDecoder","render","error","decode","EncodedVideoChunk","timestamp","drawImage","requestAnimationFrame","codec","optimizeForLatency","cancelAnimationFrame","SERVER_URL","U","FetchWithProgress","downloaded","_downloaded","total","_total","onProgress","progressEvent","fetch","url","response","headers","body","chunks","reduce","item","position","EventEmitter","fetchServer","useClasses","makeStyles","labelRight","marginLeft","video","transformOrigin","touchAction","SettingItem","observer","param","definition","settings","onChange","classes","label","jsx_runtime","jsxs","Stack","horizontal","verticalAlign","jsx","span","description","TooltipHost","content","Icon","iconName","Icons","labelExtra","TextField","placeholder","Dropdown","selectedKey","option","Toggle","checked","SpinButton","labelPosition","Position","step","KEY_MAP","Enter","Escape","Backspace","Tab","Delete","Home","End","Space","ArrowUp","ArrowDown","ArrowLeft","ArrowRight","state","rotatedWidth","rotate","rotatedHeight","serverBuffer","ReadableStream","GlobalState","commandBarItems","running","iconProps","onClick","stop","disabled","iconOnly","_this_deviceView","deviceView","enterFullscreen","_this_client","_this_client1","keyCode","repeat","metaState","fps","commandBarFarItems","navigationBarVisible","logVisible","settingsVisible","demoModeVisible","tooltipHostProps","Fragment","ExternalLink","href","spaceAfter","calloutProps","calloutMaxWidth","settingDefinitions","IconButton","updateDisplays","updateEncoders","decoders","name","_this_decoder","clearTimeout","fpsCounterIntervalId","handleDeviceViewRef","element","handleRendererContainerRef","_this_rendererContainer","rendererContainer","handleWheel","passive","calculatePointerPosition","clientX","clientY","viewRect","getBoundingClientRect","pointerViewX","x","pointerViewY","y","log","hoverHelper","SCRCPY_SERVER_VERSION","runInAction","includes","Constructor","connecting","serverTotalSize","serverDownloadedSize","debouncedServerDownloadedSize","serverDownloadSpeed","serverUploadedSize","debouncedServerUploadedSize","serverUploadSpeed","_this_decoders_find","intervalId","setInterval","clearInterval","ChunkStream","ADB_SYNC_MAX_PACKET_SIZE","ProgressStream","progress","decoderDefinition","find","lastFrameCount","ignoreDecoderCodecArgs","profile","level","WritableStream","InspectStream","navigator","clipboard","writeText","turnScreenOff","handleBackPointerDown","button","currentTarget","setPointerCapture","handleBackPointerUp","handleHomePointerDown","handleHomePointerUp","handleAppSwitchPointerDown","handleAppSwitchPointerUp","pointerType","messages","pointerX","pointerY","pressure","buttons","handlePointerDown","focus","preventDefault","stopPropagation","handlePointerMove","handlePointerUp","handlePointerLeave","deltaX","deltaY","handleContextMenu","handleKeyDown","code","makeAutoObservable","observable","autorun","firstChild","appendChild","ConnectionDialog","useId","isClient","setIsClient","style","top","bottom","left","right","margin","pointerEvents","Dialog","hidden","modalProps","layerProps","dialogContentProps","title","tokens","CommonStackTokens","ProgressIndicator","percentComplete","formatSpeed","progressHidden","NavigationBar","children","verticalFill","horizontalAlign","background","maxWidth","color","onPointerDown","onPointerUp","div","Scrcpy","unshift","RouteStackProps","Head","CommandBar","items","farItems","grow","styles","root","DeviceView","BottomElement","tabIndex","onPointerMove","onPointerCancel","onPointerLeave","onKeyDown","onContextMenu","padding","overflow","display","fontFamily","overflowY","whiteSpace","wordWrap","scrcpy_state","DemoModePanel","scrcpy"],"sourceRoot":""}