(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[941],{1048:function(e,n,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/file-manager",function(){return t(4265)}])},4265:function(e,n,t){"use strict";t.a(e,(async function(e,r){try{t.r(n);var i,a=t(4950),o=t.n(a),s=t(5202),c=t(8306),u=t(4417),l=t(3569),p=t(311),d=t(2041),h=t(2793),f=t(6264),m=t(7182),v=t(7579),y=t(4990),x=t(1344),b=t(8456),g=t(3151),k=t(122),w=t(1131),S=t(6e3),z=t(3344),C=t(2434),T=t(2999),D=t(4622),P=t(5780),j=t(496),F=t(7441),I=t(3003),L=t(3758),E=t(8132),O=t(271),N=t.n(O),_=t(6393),R=t(9498),M=t(3898),U=t(4646);function e(e){var n;if("function"===typeof Symbol){if(Symbol.asyncIterator&&null!=(n=e[Symbol.asyncIterator]))return n.call(e);if(Symbol.iterator&&null!=(n=e[Symbol.iterator]))return n.call(e)}throw new TypeError("Object is not async iterable")}function J(e,n,t,r,i,a,o){try{var s=e[a](o),c=s.value}catch(u){return void t(u)}s.done?n(c):Promise.resolve(c).then(r,i)}function B(e){return function(){var n=this,t=arguments;return new Promise((function(r,i){var a=e.apply(n,t);function o(e){J(a,r,i,o,s,"next",e)}function s(e){J(a,r,i,o,s,"throw",e)}o(void 0)}))}}function Q(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function Y(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Z(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function V(e,n){return null!=n&&"undefined"!==typeof Symbol&&n[Symbol.hasInstance]?!!n[Symbol.hasInstance](e):e instanceof n}function $(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{},r=Object.keys(t);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(t).filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})))),r.forEach((function(n){Z(e,n,t[n])}))}return e}(0,z.Mg)();var W=(0,I.default)().publicRuntimeConfig;function G(e){return $({},e,{key:e.name})}(i=await t(2140)).mitm=W.basePath+"/StreamSaver/mitm.html";var K=(0,c.ZC)({name:{cursor:"pointer","&:hover":{textDecoration:"underline"}}}),A=function(e,n){return e&&n?n($({},e,{styles:(0,c.E$)(e.styles,{root:{paddingTop:0}})})):null};function ee(e,n){var t=e.toLocaleLowerCase().localeCompare(n.toLocaleLowerCase());return 0!==t?t:e.localeCompare(n)}var H=function(){function n(){var t=this;Q(this,n),this.initial=!0,this.visible=!1,this.path="/",this.loading=!1,this.items=[],this.sortKey="name",this.sortDescending=!1,this.uploading=!1,this.uploadPath=void 0,this.uploadedSize=0,this.uploadTotalSize=0,this.debouncedUploadedSize=0,this.uploadSpeed=0,this.selectedItems=[],this.contextMenuTarget=void 0,this.pushPathQuery=function(e){E.default.push({query:$({},E.default.query,{path:e})})};var r=this;this.loadFiles=(0,U.FW)(function(){var n=B(o().mark((function n(t){var i,a,s,c,u,l,p,d,h,f,m,v,y,x,b,g,k,w;return o().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(i=r.path,(0,j.z)((function(){return r.items=[]})),M.n.device){n.next=4;break}return n.abrupt("return");case 4:return(0,j.z)((function(){return r.loading=!0})),n.next=7,M.n.device.sync();case 7:a=n.sent,s=[],c=[],u=setInterval((function(){t.aborted||(0,j.z)((function(){return r.items=s.slice()}))}),1e3),n.prev=11,l=!1,p=!1,n.prev=13,h=e(a.opendir(i));case 15:return n.next=17,h.next();case 17:if(!(l=!(f=n.sent).done)){n.next=28;break}if(m=f.value,v=m,!t.aborted){n.next=22;break}return n.abrupt("return");case 22:if("."!==v.name&&".."!==v.name){n.next=24;break}return n.abrupt("continue",25);case 24:v.type===P.LinuxFileType.Link?c.push(v):s.push(G(v));case 25:l=!1,n.next=15;break;case 28:n.next=34;break;case 30:n.prev=30,n.t0=n.catch(13),p=!0,d=n.t0;case 34:if(n.prev=34,n.prev=35,!l||null==h.return){n.next=39;break}return n.next=39,d.return();case 39:if(n.prev=39,!p){n.next=42;break}throw d;case 42:return n.finish(39);case 43:return n.finish(34);case 44:y=!0,x=!1,b=void 0,n.prev=45,g=c[Symbol.iterator]();case 47:if(y=(k=g.next()).done){n.next=59;break}if(w=k.value,!t.aborted){n.next=51;break}return n.abrupt("return");case 51:return n.next=53,a.isDirectory(N().resolve(i,w.name));case 53:if(n.sent){n.next=55;break}w.mode=P.LinuxFileType.File<<12|w.permission,w.size=0;case 55:s.push(G(w));case 56:y=!0,n.next=47;break;case 59:n.next=65;break;case 61:n.prev=61,n.t1=n.catch(45),x=!0,b=n.t1;case 65:n.prev=65,n.prev=66,y||null==g.return||g.return();case 68:if(n.prev=68,!x){n.next=71;break}throw b;case 71:return n.finish(68);case 72:return n.finish(65);case 73:if(!t.aborted){n.next=75;break}return n.abrupt("return");case 75:(0,j.z)((function(){return r.items=s}));case 76:return n.prev=76,t.aborted||(0,j.z)((function(){return r.loading=!1})),clearInterval(u),a.dispose(),n.finish(76);case 81:case"end":return n.stop()}}),n,null,[[11,,76,81],[13,30,34,44],[35,,39,43],[45,61,65,73],[66,,68,72]])})));return function(e){return n.apply(this,arguments)}}());var i=this;this.upload=function(){var e=B(o().mark((function e(n){var t,r,a;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,M.n.device.sync();case 2:return t=e.sent,e.prev=3,r=N().resolve(i.path,n.name),(0,j.z)((function(){i.uploading=!0,i.uploadPath=n.name,i.uploadedSize=0,i.uploadTotalSize=n.size,i.debouncedUploadedSize=0,i.uploadSpeed=0})),a=setInterval((0,j.aD)((function(){i.uploadSpeed=i.uploadedSize-i.debouncedUploadedSize,i.debouncedUploadedSize=i.uploadedSize})),1e3),e.prev=7,e.next=10,n.stream().pipeThrough(new P.ChunkStream(P.ADB_SYNC_MAX_PACKET_SIZE)).pipeThrough(new U.hK((0,j.aD)((function(e){i.uploadedSize=e})))).pipeTo(t.write(r,P.LinuxFileType.File<<12|438,n.lastModified/1e3));case 10:(0,j.z)((function(){i.uploadSpeed=i.uploadedSize-i.debouncedUploadedSize,i.debouncedUploadedSize=i.uploadedSize}));case 11:return e.prev=11,clearInterval(a),e.finish(11);case 14:e.next=19;break;case 16:e.prev=16,e.t0=e.catch(3),M.n.showErrorDialog(V(e.t0,Error)?e.t0.message:"".concat(e.t0));case 19:return e.prev=19,t.dispose(),i.loadFiles(),(0,j.z)((function(){i.uploading=!1})),e.finish(19);case 24:case"end":return e.stop()}}),e,null,[[3,16,19,24],[7,,11,14]])})));return function(n){return e.apply(this,arguments)}}(),(0,j.ky)(this,{initial:!1,items:j.LO.shallow,pushPathQuery:!1,changeDirectory:j.aD.bound,loadFiles:!1}),(0,j.EH)((function(){M.n.device?t.initial&&t.visible&&(t.initial=!1,t.loadFiles()):t.initial=!0}))}var t,r,a;return n.prototype.changeDirectory=function(e){this.path!==e&&(this.path=e,M.n.device&&this.loadFiles())},t=n,(r=[{key:"breadcrumbItems",get:function(){var e=this,n="",t=this.path.split("/").filter(Boolean).map((function(t){var r=e;return{key:n+="/"+t,text:t,onClick:function(e,n){n&&r.pushPathQuery(n.key)}}}));return t.unshift({key:"/",text:"Device",onClick:function(){return e.pushPathQuery("/")}}),t[t.length-1].isCurrentItem=!0,delete t[t.length-1].onClick,t}},{key:"menuItems",get:function(){var e=[];switch(this.selectedItems.length){case 0:var n=this;e.push({key:"upload",text:"Upload",iconProps:{iconName:U.PJ.CloudArrowUp,style:{height:20,fontSize:20,lineHeight:1.5}},disabled:!M.n.device,onClick:function(){var e=n;return B(o().mark((function n(){var t,r,i;return o().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,(0,U.oT)({multiple:!0});case 2:t=n.sent,r=0;case 4:if(!(r<t.length)){n.next=11;break}return i=t.item(r),n.next=8,e.upload(i);case 8:r++,n.next=4;break;case 11:case"end":return n.stop()}}),n)})))(),!1}});break;case 1:if(this.selectedItems[0].type===P.LinuxFileType.File){var t=this;e.push({key:"download",text:"Download",iconProps:{iconName:U.PJ.CloudArrowDown,style:{height:20,fontSize:20,lineHeight:1.5}},onClick:function(){var e=t;return B(o().mark((function n(){var t,r,a,s,c;return o().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,M.n.device.sync();case 2:return t=n.sent,n.prev=3,r=e.selectedItems[0],a=N().resolve(e.path,r.name),s=t.read(a),c=i.createWriteStream(r.name,{size:r.size}),n.next=10,s.pipeTo(c);case 10:n.next=15;break;case 12:n.prev=12,n.t0=n.catch(3),M.n.showErrorDialog(V(n.t0,Error)?n.t0.message:"".concat(n.t0));case 15:return n.prev=15,t.dispose(),n.finish(15);case 18:case"end":return n.stop()}}),n,null,[[3,12,15,18]])})))(),!1}})}default:var r=this;e.push({key:"delete",text:"Delete",iconProps:{iconName:U.PJ.Delete,style:{height:20,fontSize:20,lineHeight:1.5}},onClick:function(){var e=r;return B(o().mark((function n(){var t,r,i,a,s,c,u;return o().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:n.prev=0,t=!0,r=!1,i=void 0,n.prev=2,a=e.selectedItems[Symbol.iterator]();case 4:if(t=(s=a.next()).done){n.next=15;break}return c=s.value,n.next=8,M.n.device.rm(N().resolve(e.path,c.name));case 8:if(!(u=n.sent)){n.next=12;break}return M.n.showErrorDialog(u),n.abrupt("return");case 12:t=!0,n.next=4;break;case 15:n.next=21;break;case 17:n.prev=17,n.t0=n.catch(2),r=!0,i=n.t0;case 21:n.prev=21,n.prev=22,t||null==a.return||a.return();case 24:if(n.prev=24,!r){n.next=27;break}throw i;case 27:return n.finish(24);case 28:return n.finish(21);case 29:n.next=34;break;case 31:n.prev=31,n.t1=n.catch(0),M.n.showErrorDialog(V(n.t1,Error)?n.t1.message:"".concat(n.t1));case 34:return n.prev=34,e.loadFiles(),n.finish(34);case 37:case"end":return n.stop()}}),n,null,[[0,31,34,37],[2,17,21,29],[22,,24,28]])})))(),!1}})}return e}},{key:"sortedList",get:function(){var e=this,n=this.items.slice();return n.sort((function(n,t){var r,i=n.type===P.LinuxFileType.File?1:0,a=t.type===P.LinuxFileType.File?1:0;if(i!==a)r=i-a;else{var o=n[e.sortKey],s=t[e.sortKey];r=o===s?ee(n.name,t.name):"string"===typeof o?ee(o,s):o<s?-1:1}return e.sortDescending&&(r*=-1),r})),n}},{key:"columns",get:function(){var e=[{key:"type",name:"File Type",iconName:U.PJ.Document20,isIconOnly:!0,minWidth:20,maxWidth:20,isCollapsible:!0,onRender:function(e){var n;switch(e.type){case P.LinuxFileType.Link:n=(0,C.EX)({type:T.I.linkedFolder}).iconName;break;case P.LinuxFileType.Directory:n=(0,C.EX)({type:T.I.folder}).iconName;break;case P.LinuxFileType.File:n=(0,C.EX)({extension:N().extname(e.name)}).iconName;break;default:n=(0,C.EX)({extension:"txt"}).iconName}var t=(0,c.q7)(n).code.props.src;return(0,s.jsx)(u.J,{imageProps:{crossOrigin:"anonymous",src:t},style:{width:20,height:20}})}},{key:"name",name:"Name",minWidth:0,isRowHeader:!0,onRender:function(e){return(0,s.jsx)("span",{className:K.name,"data-selection-invoke":!0,children:e.name})}},{key:"permission",name:"Permission",minWidth:0,isCollapsible:!0,onRender:function(e){return"".concat((e.mode>>6&4).toString(8)).concat((e.mode>>3&4).toString(8)).concat((4&e.mode).toString(8))}},{key:"size",name:"Size",minWidth:0,isCollapsible:!0,onRender:function(e){return e.type===P.LinuxFileType.File?(0,U.BU)(e.size):""}},{key:"mtime",name:"Last Modified Time",minWidth:150,isCollapsible:!0,onRender:function(e){return new Date(1e3*e.mtime).toLocaleString()}}],n=!0,t=!1,r=void 0;try{for(var i,a=e[Symbol.iterator]();!(n=(i=a.next()).done);n=!0){var o=i.value,l=this;o.onColumnClick=function(e,n){if(l.sortKey===n.key){var t=l;(0,j.z)((function(){return t.sortDescending=!t.sortDescending}))}else{var r=l;(0,j.z)((function(){r.sortKey=n.key,r.sortDescending=!1}))}},o.key===this.sortKey&&(o.isSorted=!0,o.isSortedDescending=this.sortDescending)}}catch(p){t=!0,r=p}finally{try{n||null==a.return||a.return()}finally{if(t)throw r}}return e}}])&&Y(t.prototype,r),a&&Y(t,a),n}(),X=new H,q=(0,F.Pi)((function(){return(0,s.jsx)(l.V,{hidden:!X.uploading,dialogContentProps:{title:"Uploading...",subText:X.uploadPath},children:(0,s.jsx)(p.Y,{description:(0,U.CY)(X.debouncedUploadedSize,X.uploadTotalSize,X.uploadSpeed),percentComplete:X.uploadedSize/X.uploadTotalSize})})}));n.default=(0,F.Pi)((function(){(0,_.useEffect)((function(){return(0,j.z)((function(){X.visible=!0})),function(){(0,j.z)((function(){X.visible=!1}))}}));var e=(0,E.useRouter)();(0,_.useEffect)((function(){var n=e.query.path;n?(Array.isArray(n)&&(n=n[0]),X.changeDirectory(n)):e.replace({query:$({},e.query,{path:X.path})})}),[e]);var n=(0,_.useState)(),t=n[0],r=n[1],i=(0,_.useCallback)(function(){var e=B(o().mark((function e(n){var t,i,a,s,c;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,M.n.device.sync();case 2:return t=e.sent,e.prev=3,i=t.read(n),a=new Response(i),e.next=8,a.blob();case 8:s=e.sent,c=window.URL.createObjectURL(s),r(c);case 11:return e.prev=11,t.dispose(),e.finish(11);case 14:case"end":return e.stop()}}),e,null,[[3,,11,14]])})));return function(n){return e.apply(this,arguments)}}(),[]),a=(0,_.useCallback)((function(){r(void 0)}),[]),c=(0,_.useCallback)((function(e){switch(e.type){case P.LinuxFileType.Link:case P.LinuxFileType.Directory:X.pushPathQuery(N().resolve(X.path,e.name));break;case P.LinuxFileType.File:switch(N().extname(e.name)){case".jpg":case".png":case".svg":case".gif":i(N().resolve(X.path,e.name))}}}),[i]),u=(0,D.B)((function(){return new d.Y({onSelectionChanged:function(){var e=u.getSelection();(0,j.z)((function(){X.selectedItems=e}))}})})),l=(0,_.useCallback)((function(e,n,t){return!!t&&(X.menuItems.length&&(0,j.z)((function(){X.contextMenuTarget=t})),!1)}),[]),p=(0,_.useCallback)((function(){(0,j.z)((function(){return X.contextMenuTarget=void 0}))}),[]);return(0,s.jsxs)(h.K,$({},U.LE,{children:[(0,s.jsx)(L.default,{children:(0,s.jsx)("title",{children:"File Manager - WebADB"})}),(0,s.jsx)(R.X3,{items:X.menuItems}),(0,s.jsxs)(f.v,{grow:!0,styles:{root:{margin:"-8px -16px -16px -16px",padding:"8px 16px 16px 16px",minHeight:0}},children:[(0,s.jsxs)(m.x,{selection:u,children:[(0,s.jsx)(v.a,{items:X.breadcrumbItems}),(0,s.jsx)(y.J,{items:X.sortedList,columns:X.columns,setKey:X.path,selection:u,layoutMode:x.Oh.justified,enableShimmer:X.loading&&0===X.items.length,onItemInvoked:c,onItemContextMenu:l,onRenderDetailsHeader:A,usePageCache:!0,useReducedRowRenderer:!0})]}),t&&(0,s.jsx)(b.m,{children:(0,s.jsx)(g.a,{onClick:a,children:(0,s.jsx)("div",{style:{width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center"},children:(0,s.jsx)("img",{src:t,alt:"",style:{maxWidth:"100%",maxHeight:"100%"}})})})}),(0,s.jsx)(R.ag,{children:(0,s.jsx)(k.r,{items:X.menuItems,hidden:!X.contextMenuTarget,directionalHint:w.b.bottomLeftEdge,target:X.contextMenuTarget,onDismiss:p,contextualMenuItemAs:function(e){return(0,s.jsx)(S.W,$({},e,{hasIcons:!1}))}})}),(0,s.jsx)(q,{})]})]}))})),r()}catch(J){r(J)}}),1)}},function(e){e.O(0,[15,774,888,179],(function(){return n=1048,e(e.s=n);var n}));var n=e.O();_N_E=n}]);
//# sourceMappingURL=file-manager-1806ba60024559f9.js.map