(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[533],{8004:function(e,t,n){"use strict";n.d(t,{Z:function(){return d}});var r=n(5418),i=n(6393),o=n(3343),a=n(7539),s=n(9487),c=n(3710),d=function(e){var t=e.className,n=i.useState((function(){return(0,a.z)()}))[0],d=e.id,l=void 0===d?n:d,u=i.useRef({hostId:l,rootRef:i.useRef(null),notifyLayersChanged:function(){}});return i.useImperativeHandle(e.componentRef,(function(){return u.current})),i.useEffect((function(){(0,c._Y)(l,u.current),(0,c.EQ)(l)}),[]),(0,o.k)((function(){(0,c.nw)(l,u.current),(0,c.EQ)(l)})),i.createElement("div",(0,r.pi)({},e,{className:(0,s.i)("ms-LayerHost",t),ref:u.current.rootRef}))}},2905:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/scrcpy",function(){return n(7254)}])},7254:function(e,t,n){"use strict";n.a(e,(async function(e,r){try{n.r(t);var i=n(8648),o=n.n(i),a=n(5202),s=n(4575),c=n(8547),d=n(4782),l=n(9260),u=n(6693),h=n(6314),p=n(8004),f=n(5010),v=n(2585),m=n(7927),g=n(9861),b=n(5404),w=n(2798),y=n(4200),x=n(496),S=n(7441),P=n(6174),k=n(6393),C=n(5780),D=n(458),_=n(8932),j=n(9727),E=n(6606),T=n(9545),z=n(3519),O=e([E,z]);function A(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function W(e){if(Array.isArray(e))return e}function G(e,t,n,r,i,o,a){try{var s=e[o](a),c=s.value}catch(d){return void n(d)}s.done?t(c):Promise.resolve(c).then(r,i)}function F(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var o=e.apply(t,n);function a(e){G(o,r,i,a,s,"next",e)}function s(e){G(o,r,i,a,s,"throw",e)}a(void 0)}))}}function Y(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function K(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Z(e,t,n){return t&&K(e.prototype,t),n&&K(e,n),e}function J(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function X(e,t){var n=null==e?null:"undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,i,o=[],a=!0,s=!1;try{for(n=n.call(e);!(a=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);a=!0);}catch(c){s=!0,i=c}finally{try{a||null==n.return||n.return()}finally{if(s)throw i}}return o}}function $(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function q(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){J(e,t,n[t])}))}return e}function Q(e,t){if(e){if("string"===typeof e)return A(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?A(e,t):void 0}}[E,z]=O.then?(await O)():O;var L,I=new n.U(n(4439)).toString(),H=function(){function e(t){Y(this,e),this._downloaded=0,this._total=0,this.progressEvent=new D.vp,this.promise=this.fetch(t)}return e.prototype.fetch=function(e){var t=this;return F(o().mark((function n(){var r,i,a,s,c,d,l,u,h,p,f,v,m;return o().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,window.fetch(e);case 2:r=n.sent,t._total=Number.parseInt(null!==(i=r.headers.get("Content-Length"))&&void 0!==i?i:"0",10),t.progressEvent.fire([t._downloaded,t._total]),a=r.body.getReader(),s=[];case 8:return n.next=11,a.read();case 11:if(!(c=n.sent).done){n.next=14;break}return n.abrupt("break",19);case 14:s.push(c.value),t._downloaded+=c.value.byteLength,t.progressEvent.fire([t._downloaded,t._total]),n.next=8;break;case 19:for(t._total=s.reduce((function(e,t){return e+t.byteLength}),0),d=new Uint8Array(t._total),l=0,u=!0,h=!1,p=void 0,n.prev=23,f=s[Symbol.iterator]();!(u=(v=f.next()).done);u=!0)m=v.value,d.set(m,l),l+=m.byteLength;n.next=31;break;case 27:n.prev=27,n.t0=n.catch(23),h=!0,p=n.t0;case 31:n.prev=31,n.prev=32,u||null==f.return||f.return();case 34:if(n.prev=34,!h){n.next=37;break}throw p;case 37:return n.finish(34);case 38:return n.finish(31);case 39:return n.abrupt("return",d);case 40:case"end":return n.stop()}}),n,null,[[23,27,31,39],[32,,34,38]])})))()},Z(e,[{key:"downloaded",get:function(){return this._downloaded}},{key:"total",get:function(){return this._total}},{key:"onProgress",get:function(){return this.progressEvent.event}}]),e}();function ee(e,t,n){return e<t?t:e>n?n:e}var V=(0,S.Pi)((function(e){var t,n=e.definition,r=e.settings,i=e.onChange;switch(t=n.description?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("span",{children:[n.label," "]}),(0,a.jsx)(s.G,{content:n.description,children:(0,a.jsx)(c.J,{iconName:z.PJ.Info})})]}):n.label,n.type){case"dropdown":return(0,a.jsx)(d.L,{label:n.label,options:n.options,placeholder:n.placeholder,selectedKey:r[n.key],onChange:function(e,t){return i(n.key,t.key)}});case"toggle":return(0,a.jsx)(l.Z,{label:t,checked:r[n.key],onChange:function(e,t){return i(n.key,t)}});case"number":return(0,a.jsx)(u.k,{label:n.label,labelPosition:h.L.top,min:n.min,max:n.max,step:n.step,value:r[n.key].toString(),onChange:function(e,t){return i(n.key,Number.parseInt(t,10))}})}})),M=function(){function e(){var t=this;Y(this,e),this.running=!1,this.deviceView=null,this.rendererContainer=null,this.logVisible=!1,this.log=[],this.settingsVisible=!1,this.demoModeVisible=!1,this.navigationBarVisible=!0,this.width=0,this.height=0,this.rotate=0,this.client=void 0,this.encoders=[],this.decoders=[{key:"tinyh264",name:"TinyH264 (Software)",Constructor:_.EV}],this.decoder=void 0,this.connecting=!1,this.serverTotalSize=0,this.serverDownloadedSize=0,this.debouncedServerDownloadedSize=0,this.serverDownloadSpeed=0,this.serverUploadedSize=0,this.debouncedServerUploadedSize=0,this.serverUploadSpeed=0,this.settings={maxSize:1080,bitRate:4e6};var n=this;this.start=F(o().mark((function e(){var t,r,i,a,s,c,d,l,u;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(T.n.device){e.next=2;break}return e.abrupt("return");case 2:if(e.prev=2,n.settings.decoder){e.next=5;break}throw new Error("No available decoder");case 5:return(0,x.z)((function(){n.serverTotalSize=0,n.serverDownloadedSize=0,n.debouncedServerDownloadedSize=0,n.serverUploadedSize=0,n.debouncedServerUploadedSize=0,n.connecting=!0})),t=setInterval((0,x.aD)((function(){n.serverDownloadSpeed=n.serverDownloadedSize-n.debouncedServerDownloadedSize,n.debouncedServerDownloadedSize=n.serverDownloadedSize})),1e3),e.prev=8,e.next=11,o=(0,x.aD)((function(e){var t,r,i=(r=2,W(t=e)||X(t,r)||Q(t,r)||$()),o=i[0],a=i[1];n.serverDownloadedSize=o,n.serverTotalSize=a})),L||(L=new H(I)).promise.catch((function(e){L=void 0})),o&&(L.onProgress(o),o([L.downloaded,L.total])),L.promise;case 11:r=e.sent,(0,x.z)((function(){n.serverDownloadSpeed=n.serverDownloadedSize-n.debouncedServerDownloadedSize,n.debouncedServerDownloadedSize=n.serverDownloadedSize}));case 13:return e.prev=13,clearInterval(t),e.finish(13);case 16:return t=setInterval((0,x.aD)((function(){n.serverUploadSpeed=n.serverUploadedSize-n.debouncedServerUploadedSize,n.debouncedServerUploadedSize=n.serverUploadedSize})),1e3),e.prev=17,e.next=20,new C.ReadableStream({start:function(e){e.enqueue(r),e.close()}}).pipeThrough(new C.ChunkStream(C.ADB_SYNC_MAX_PACKET_SIZE)).pipeThrough(new z.hK((0,x.aD)((function(e){n.serverUploadedSize=e})))).pipeTo((0,_.hj)(T.n.device));case 20:(0,x.z)((function(){n.serverUploadSpeed=n.serverUploadedSize-n.debouncedServerUploadedSize,n.debouncedServerUploadedSize=n.serverUploadedSize}));case 21:return e.prev=21,clearInterval(t),e.finish(21);case 24:return e.next=26,_.q3.getEncoders(T.n.device,_.K1,j.Z,new _.xI({logLevel:_.VE.Debug,bitRate:4e6,tunnelForward:n.settings.tunnelForward,sendDeviceMeta:!1,sendDummyByte:!1,control:!1,cleanup:!1}));case 26:if(0!==(i=e.sent).length){e.next=29;break}throw new Error("No available encoder found");case 29:return(0,x.z)((function(){n.encoders=i})),s=null!==(a=n.decoders.find((function(e){return e.key===n.settings.decoder})))&&void 0!==a?a:n.decoders[0],c=new s.Constructor,(0,x.z)((function(){n.decoder=c})),l=new _.xI(q({logLevel:_.VE.Debug},n.settings,{lockVideoOrientation:_.G$.Unlocked,encoderName:null!==(d=n.settings.encoder)&&void 0!==d?d:i[0],sendDeviceMeta:!1,sendDummyByte:!1,codecOptions:n.settings.ignoreDecoderCodecArgs?void 0:new _.P3({profile:c.maxProfile,level:c.maxLevel})})),(0,x.z)((function(){n.log=[],n.log.push("[client] Server version: ".concat(j.Z)),n.log.push("[client] Server arguments: ".concat(l.formatServerArguments().join(" ")))})),e.next=39,_.q3.start(T.n.device,_.K1,j.Z,l);case 39:(u=e.sent).stdout.pipeTo(new C.WritableStream({write:(0,x.aD)((function(e){n.log.push(e)}))})),u.videoStream.pipeThrough(new C.InspectStream((0,x.aD)((function(e){if("configuration"===e.type){var t=e.data,r=t.croppedWidth,i=t.croppedHeight;n.log.push("[client] Video size changed: ".concat(r,"x").concat(i)),n.width=r,n.height=i}})))).pipeTo(c.writable).catch((function(){})),u.exit.then((function(){return n.stop()})),u.onClipboardChange((function(e){window.navigator.clipboard.writeText(e)})),(0,x.z)((function(){n.client=u,n.running=!0})),e.next=50;break;case 47:e.prev=47,e.t0=e.catch(2),T.n.showErrorDialog(e.t0);case 50:return e.prev=50,(0,x.z)((function(){n.connecting=!1})),e.finish(50);case 53:case"end":return e.stop()}var o}),e,null,[[2,47,50,53],[8,,13,16],[17,,21,24]])}))),this.handleBackPointerDown=function(e){t.client&&0===e.button&&(e.currentTarget.setPointerCapture(e.pointerId),t.client.pressBackOrTurnOnScreen(_.vH.Down))},this.handleBackPointerUp=function(e){t.client&&0===e.button&&t.client.pressBackOrTurnOnScreen(_.vH.Up)};var r=this;this.handleHomePointerDown=function(){var e=F(o().mark((function e(t){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r.client){e.next=2;break}return e.abrupt("return");case 2:if(0===t.button){e.next=4;break}return e.abrupt("return");case 4:return t.currentTarget.setPointerCapture(t.pointerId),e.next=7,r.client.injectKeyCode({action:_.vH.Down,keyCode:_.AY.Home,repeat:0,metaState:0});case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();var i=this;this.handleHomePointerUp=function(){var e=F(o().mark((function e(t){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i.client){e.next=2;break}return e.abrupt("return");case 2:if(0===t.button){e.next=4;break}return e.abrupt("return");case 4:return e.next=6,i.client.injectKeyCode({action:_.vH.Up,keyCode:_.AY.Home,repeat:0,metaState:0});case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();var a=this;this.handleAppSwitchPointerDown=function(){var e=F(o().mark((function e(t){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a.client){e.next=2;break}return e.abrupt("return");case 2:if(0===t.button){e.next=4;break}return e.abrupt("return");case 4:return t.currentTarget.setPointerCapture(t.pointerId),e.next=7,a.client.injectKeyCode({action:_.vH.Down,keyCode:_.AY.AppSwitch,repeat:0,metaState:0});case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();var s=this;this.handleAppSwitchPointerUp=function(){var e=F(o().mark((function e(t){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s.client){e.next=2;break}return e.abrupt("return");case 2:if(0===t.button){e.next=4;break}return e.abrupt("return");case 4:return e.next=6,s.client.injectKeyCode({action:_.vH.Up,keyCode:_.AY.AppSwitch,repeat:0,metaState:0});case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.injectTouch=function(e,n){if(t.client){var r=t.calculatePointerPosition(n.clientX,n.clientY),i=r.x,o=r.y;t.client.injectTouch({action:e,pointerId:"mouse"===n.pointerType?BigInt(-1):BigInt(n.pointerId),pointerX:i,pointerY:o,pressure:65535*n.pressure,buttons:n.buttons})}},this.handlePointerDown=function(e){t.rendererContainer.focus(),e.preventDefault(),e.currentTarget.setPointerCapture(e.pointerId),t.injectTouch(_.DC.Down,e)},this.handlePointerMove=function(e){t.injectTouch(0===e.buttons?_.DC.HoverMove:_.DC.Move,e)},this.handlePointerUp=function(e){t.injectTouch(_.DC.Up,e)},this.handleWheel=function(e){if(t.client){e.preventDefault(),e.stopPropagation();var n=t.calculatePointerPosition(e.clientX,e.clientY),r=n.x,i=n.y;t.client.injectScroll({pointerX:r,pointerY:i,scrollX:-Math.sign(e.deltaX),scrollY:-Math.sign(e.deltaY),buttons:0})}},this.handleContextMenu=function(e){e.preventDefault()};var c=this;if(this.handleKeyDown=function(){var e=F(o().mark((function e(t){var n,r,i;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(c.client){e.next=2;break}return e.abrupt("return");case 2:if(n=t.key,r=t.code,!n.match(/^[a-z0-9]$/i)){e.next=6;break}return c.client.injectText(n),e.abrupt("return");case 6:if(!(i={Backspace:_.AY.Delete,Space:_.AY.Space}[r])){e.next=12;break}return e.next=10,c.client.injectKeyCode({action:_.vH.Down,keyCode:i,metaState:0,repeat:0});case 10:return e.next=12,c.client.injectKeyCode({action:_.vH.Up,keyCode:i,metaState:0,repeat:0});case 12:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),(0,x.ky)(this,{decoders:x.LO.shallow,settings:x.LO.deep,start:!1,stop:x.aD.bound,handleDeviceViewRef:x.aD.bound,handleRendererContainerRef:x.aD.bound,handleBackPointerDown:!1,handleBackPointerUp:!1,handleHomePointerDown:!1,handleHomePointerUp:!1,handleAppSwitchPointerDown:!1,handleAppSwitchPointerUp:!1,calculatePointerPosition:!1,injectTouch:!1,handlePointerDown:!1,handlePointerMove:!1,handlePointerUp:!1,handleWheel:!1,handleContextMenu:!1,handleKeyDown:!1}),(0,x.EH)((function(){if(T.n.device){var e=t;(0,x.z)((function(){e.encoders=[],e.settings.encoder=void 0}))}else t.stop()})),(0,x.EH)((function(){if(t.rendererContainer&&t.decoder){for(;t.rendererContainer.firstChild;)t.rendererContainer.firstChild.remove();t.rendererContainer.appendChild(t.decoder.renderer)}})),(0,x.EH)((function(){t.settings.decoder=t.decoders[0].key})),"function"===typeof window.VideoDecoder){var d=this;setTimeout((0,x.aD)((function(){d.decoders.unshift({key:"webcodecs",name:"WebCodecs",Constructor:_.HC})})),0)}}var t=e.prototype;return t.stop=function(){var e=this;return F(o().mark((function t(){var n,r;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=3,null===(n=e.client)||void 0===n?void 0:n.close();case 3:null===(r=e.decoder)||void 0===r||r.dispose(),(0,x.z)((function(){e.client=void 0,e.decoder=void 0,e.running=!1}));case 5:case"end":return t.stop()}}),t)})))()},t.handleDeviceViewRef=function(e){this.deviceView=e},t.handleRendererContainerRef=function(e){var t;this.rendererContainer=e,null===(t=this.rendererContainer)||void 0===t||t.addEventListener("wheel",this.handleWheel,{passive:!1})},t.calculatePointerPosition=function(e,t){var n,r=this.rendererContainer.getBoundingClientRect(),i=ee((e-r.x)/r.width,0,1),o=ee((t-r.y)/r.height,0,1);1&this.rotate&&(i=(n=[o,i])[0],o=n[1]);switch(this.rotate){case 1:o=1-o;break;case 2:i=1-i,o=1-o;break;case 3:i=1-i}return{x:i*this.width,y:o*this.height}},Z(e,[{key:"rotatedWidth",get:function(){return 1&U.rotate?U.height:U.width}},{key:"rotatedHeight",get:function(){return 1&U.rotate?U.width:U.height}},{key:"commandBarItems",get:function(){var e=this,t=[];return this.running?t.push({key:"stop",iconProps:{iconName:z.PJ.Stop},text:"Stop",onClick:this.stop}):t.push({key:"start",disabled:!T.n.device,iconProps:{iconName:z.PJ.Play},text:"Start",onClick:this.start}),t.push({key:"fullscreen",disabled:!this.running,iconProps:{iconName:z.PJ.FullScreenMaximize},iconOnly:!0,text:"Fullscreen",onClick:function(){var t;null===(t=e.deviceView)||void 0===t||t.enterFullscreen()}}),t.push({key:"rotateDevice",disabled:!this.running,iconProps:{iconName:z.PJ.Orientation},iconOnly:!0,text:"Rotate Device",onClick:function(){e.client.rotateDevice()}}),t.push({key:"rotateVideoLeft",disabled:!this.running,iconProps:{iconName:z.PJ.RotateLeft},iconOnly:!0,text:"Rotate Video Left",onClick:function(){e.rotate-=1,e.rotate<0&&(e.rotate=3)}}),t.push({key:"rotateVideoRight",disabled:!this.running,iconProps:{iconName:z.PJ.RotateRight},iconOnly:!0,text:"Rotate Video Right",onClick:function(){e.rotate=e.rotate+1&3}}),t}},{key:"commandBarFarItems",get:function(){var e=this;return[{key:"NavigationBar",iconProps:{iconName:z.PJ.PanelBottom},checked:this.navigationBarVisible,text:"Navigation Bar",iconOnly:!0,onClick:(0,x.aD)((function(){e.navigationBarVisible=!e.navigationBarVisible}))},{key:"Log",iconProps:{iconName:z.PJ.TextGrammarError},checked:this.logVisible,text:"Log",iconOnly:!0,onClick:(0,x.aD)((function(){e.logVisible=!e.logVisible}))},{key:"Settings",iconProps:{iconName:z.PJ.Settings},checked:this.settingsVisible,text:"Settings",iconOnly:!0,onClick:(0,x.aD)((function(){e.settingsVisible=!e.settingsVisible}))},{key:"DemoMode",iconProps:{iconName:z.PJ.Wand},checked:this.demoModeVisible,text:"Demo Mode",iconOnly:!0,onClick:(0,x.aD)((function(){e.demoModeVisible=!e.demoModeVisible}))},{key:"info",iconProps:{iconName:z.PJ.Info},iconOnly:!0,tooltipHostProps:{content:(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("p",{children:[(0,a.jsx)(E.dL,{href:"https://github.com/Genymobile/scrcpy",spaceAfter:!0,children:"Scrcpy"}),"developed by Genymobile can display the screen with low latency (1~2 frames) and control the device, all without root access."]}),(0,a.jsx)("p",{children:"This is a TypeScript implementation of the client part. Paired with official pre-built server binary."})]}),calloutProps:{calloutMaxWidth:300}}}]}},{key:"settingDefinitions",get:function(){var e=[];return e.push({key:"encoder",type:"dropdown",label:"Encoder",placeholder:"Connect once to retrieve encoder list",options:this.encoders.map((function(e){return{key:e,text:e}}))}),this.decoders.length>1&&e.push({key:"decoder",type:"dropdown",label:"Decoder",options:this.decoders.map((function(e){return{key:e.key,text:e.name,data:e}}))}),e.push({key:"ignoreDecoderCodecArgs",type:"toggle",label:"Ignore decoder's codec arguments",description:"Some decoders don't support all H.264 profile/levels, so they request the device to encode at their highest-supported codec. However, some super old devices may not support that codec so their encoders will fail to start. Use this option to let device choose the codec to be used."}),e.push({key:"maxSize",type:"number",label:"Max Resolution (longer side, 0 = unlimited)",min:0,max:2560,step:50}),e.push({key:"bitRate",type:"number",label:"Max Bit Rate",min:100,max:1e8,step:100}),e.push({key:"tunnelForward",type:"toggle",label:"Use forward connection",description:"Android before version 9 has a bug that prevents reverse tunneling when using ADB over WiFi."}),e}}]),e}(),U=new M;console.log(U);var R=(0,S.Pi)((function(){var e=(0,w.M)("layerHost"),t=(0,k.useState)(!1),n=t[0],r=t[1];return(0,k.useEffect)((function(){r(!0)}),[]),n?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(p.Z,{id:e,style:{position:"absolute",top:0,bottom:0,left:0,right:0,margin:0,pointerEvents:"none"}}),(0,a.jsx)(f.V,{hidden:!U.connecting,modalProps:{layerProps:{hostId:e}},dialogContentProps:{title:"Connecting..."},children:(0,a.jsxs)(v.K,{tokens:z.WT,children:[(0,a.jsx)(m.Y,{label:"1. Downloading scrcpy server...",percentComplete:U.serverTotalSize?U.serverDownloadedSize/U.serverTotalSize:void 0,description:(0,z.CY)(U.debouncedServerDownloadedSize,U.serverTotalSize,U.serverDownloadSpeed)}),(0,a.jsx)(m.Y,{label:"2. Pushing scrcpy server to device...",progressHidden:0===U.serverTotalSize||U.serverDownloadedSize!==U.serverTotalSize,percentComplete:U.serverUploadedSize/U.serverTotalSize,description:(0,z.CY)(U.debouncedServerUploadedSize,U.serverTotalSize,U.serverUploadSpeed)}),(0,a.jsx)(m.Y,{label:"3. Starting scrcpy server on device...",progressHidden:0===U.serverTotalSize||U.serverUploadedSize!==U.serverTotalSize})]})})]}):null})),N=(0,S.Pi)((function(e){var t=e.className,n=e.style,r=e.children;return U.navigationBarVisible?(0,a.jsxs)(v.K,{className:t,verticalFill:!0,horizontalAlign:"center",style:q({height:"40px",background:"#999"},n),children:[r,(0,a.jsxs)(v.K,{verticalFill:!0,horizontal:!0,style:{width:"100%",maxWidth:300},horizontalAlign:"space-evenly",verticalAlign:"center",children:[(0,a.jsx)(g.h,{iconProps:{iconName:z.PJ.Play},style:{transform:"rotate(180deg)",color:"white"},onPointerDown:U.handleBackPointerDown,onPointerUp:U.handleBackPointerUp}),(0,a.jsx)(g.h,{iconProps:{iconName:z.PJ.Circle},style:{color:"white"},onPointerDown:U.handleHomePointerDown,onPointerUp:U.handleHomePointerUp}),(0,a.jsx)(g.h,{iconProps:{iconName:z.PJ.Stop},style:{color:"white"},onPointerDown:U.handleAppSwitchPointerDown,onPointerUp:U.handleAppSwitchPointerUp})]})]}):null})),B=(0,y.Z)({video:{transformOrigin:"center center"}});t.default=(0,S.Pi)((function(){var e=B();return(0,a.jsxs)(v.K,q({},z.LE,{children:[(0,a.jsx)(P.default,{children:(0,a.jsx)("title",{children:"Scrcpy - Android Web Toolbox"})}),(0,a.jsx)(b.X,{items:U.commandBarItems,farItems:U.commandBarFarItems}),(0,a.jsxs)(v.K,{horizontal:!0,grow:!0,styles:{root:{height:0}},children:[(0,a.jsx)(E.wM,{ref:U.handleDeviceViewRef,width:U.rotatedWidth,height:U.rotatedHeight,BottomElement:N,children:(0,a.jsx)("div",{ref:U.handleRendererContainerRef,tabIndex:-1,className:e.video,style:{width:U.width,height:U.height,transform:"translate(".concat((U.rotatedWidth-U.width)/2,"px, ").concat((U.rotatedHeight-U.height)/2,"px) rotate(").concat(90*U.rotate,"deg)")},onPointerDown:U.handlePointerDown,onPointerMove:U.handlePointerMove,onPointerUp:U.handlePointerUp,onPointerCancel:U.handlePointerUp,onKeyDown:U.handleKeyDown,onContextMenu:U.handleContextMenu})}),(0,a.jsx)("div",{style:{padding:12,overflow:"hidden auto",display:U.logVisible?"block":"none",width:500,fontFamily:"monospace",overflowY:"auto",whiteSpace:"pre-wrap",wordWrap:"break-word"},children:U.log.map((function(e,t){return(0,a.jsx)("div",{children:e},t)}))}),(0,a.jsxs)("div",{style:{padding:12,overflow:"hidden auto",display:U.settingsVisible?"block":"none",width:300},children:[(0,a.jsx)("div",{children:"Changes will take effect on next connection"}),U.settingDefinitions.map((function(e){return(0,a.jsx)(V,{definition:e,settings:U.settings,onChange:(0,x.aD)((function(e,t){return U.settings[e]=t}))},e.key)}))]}),(0,a.jsx)(E.bq,{style:{display:U.demoModeVisible?"block":"none"}}),(0,a.jsx)(R,{})]})]}))})),r()}catch(A){r(A)}}))},4439:function(e,t,n){"use strict";e.exports=n.p+"static/chunks/scrcpy-server.d406f4d14066a1d3"},9727:function(e,t){"use strict";t.Z="1.24"},8932:function(e,t,n){"use strict";n.d(t,{AY:function(){return p},vH:function(){return h},DC:function(){return i},P3:function(){return B},K1:function(){return H},q3:function(){return m},VE:function(){return R},xI:function(){return ee},G$:function(){return N},EV:function(){return j},HC:function(){return T},hj:function(){return te}});var r,i,o=n(5418),a=n(5780),s=n(458),c=n(1573);!function(e){e[e.InjectKeycode=0]="InjectKeycode",e[e.InjectText=1]="InjectText",e[e.InjectTouch=2]="InjectTouch",e[e.InjectScroll=3]="InjectScroll",e[e.BackOrScreenOn=4]="BackOrScreenOn",e[e.ExpandNotificationPanel=5]="ExpandNotificationPanel",e[e.ExpandSettingPanel=6]="ExpandSettingPanel",e[e.CollapseNotificationPanel=7]="CollapseNotificationPanel",e[e.GetClipboard=8]="GetClipboard",e[e.SetClipboard=9]="SetClipboard",e[e.SetScreenPowerMode=10]="SetScreenPowerMode",e[e.RotateDevice=11]="RotateDevice"}(r||(r={})),function(e){e[e.Down=0]="Down",e[e.Up=1]="Up",e[e.Move=2]="Move",e[e.Cancel=3]="Cancel",e[e.Outside=4]="Outside",e[e.PointerDown=5]="PointerDown",e[e.PointerUp=6]="PointerUp",e[e.HoverMove=7]="HoverMove",e[e.Scroll=8]="Scroll",e[e.HoverEnter=9]="HoverEnter",e[e.HoverExit=10]="HoverExit",e[e.ButtonPress=11]="ButtonPress",e[e.ButtonRelease=12]="ButtonRelease"}(i||(i={}));const d=(new c.ZP).uint8("type"),l=(new c.ZP).fields(d).uint8("action",(0,c.W$)()).uint64("pointerId").uint32("pointerX").uint32("pointerY").uint16("screenWidth").uint16("screenHeight").uint16("pressure").uint32("buttons"),u=(new c.ZP).fields(d).uint32("length").string("text",{lengthField:"length"});var h,p;!function(e){e[e.Down=0]="Down",e[e.Up=1]="Up"}(h||(h={})),function(e){e[e.Home=3]="Home",e[e.Back=4]="Back",e[e.A=29]="A",e[e.B=30]="B",e[e.C=31]="C",e[e.D=32]="D",e[e.E=33]="E",e[e.F=34]="F",e[e.G=35]="G",e[e.H=36]="H",e[e.I=37]="I",e[e.J=38]="J",e[e.K=39]="K",e[e.L=40]="L",e[e.M=41]="M",e[e.N=42]="N",e[e.O=43]="O",e[e.P=44]="P",e[e.Q=45]="Q",e[e.R=46]="R",e[e.S=47]="S",e[e.T=48]="T",e[e.U=49]="U",e[e.V=50]="V",e[e.W=51]="W",e[e.X=52]="X",e[e.Y=53]="Y",e[e.Z=54]="Z",e[e.Space=62]="Space",e[e.Delete=67]="Delete",e[e.AppSwitch=187]="AppSwitch"}(p||(p={}));const f=(new c.ZP).fields(d).uint8("action",(0,c.W$)()).uint32("keyCode").uint32("repeat").uint32("metaState");const v=(new c.ZP).uint32("length").string("content",{lengthField:"length"});class m{constructor(e,t,n,r,i){if(this.clipboardChangeEvent=new s.vp,this.lastTouchMessage=0,this._adb=e,this.options=t,this.process=n,this._stdout=n.stdout.pipeThrough(new a.DecodeUtf8Stream).pipeThrough(new a.TransformStream({transform(e,t){for(const n of function*(e){let t=0;for(;;){const n=e.indexOf("\n",t);if(-1===n)return;const r=e.substring(t,n);yield r,t=n+1}}(e))""!==n&&t.enqueue(n)}})),this._videoStream=r.readable.pipeThrough(t.createVideoStreamTransformer()).pipeThrough(new a.InspectStream((e=>{"configuration"===e.type&&(this._screenWidth=e.data.croppedWidth,this._screenHeight=e.data.croppedHeight)}))),i){const e=new a.AdbBufferedStream(i);this._controlStreamWriter=i.writable.getWriter(),(()=>{(0,o.mG)(this,void 0,void 0,(function*(){try{for(;;){if(0!==(yield e.read(1))[0])throw new Error("unknown control message type");{const{content:t}=yield v.deserialize(e);this.clipboardChangeEvent.fire(t)}}}catch(t){}}))})()}}static getEncoders(e,t,n,r){return(0,o.mG)(this,void 0,void 0,(function*(){r.value.encoderName="_",r.value.control=!1;const i=yield m.start(e,t,n,r),o=r.getOutputEncoderNameRegex(),s=[];return yield i.stdout.pipeTo(new a.WritableStream({write(e){const t=e.match(o);t&&s.push(t[1])}})),s}))}static start(e,t,n,r){return(0,o.mG)(this,void 0,void 0,(function*(){const i=r.createConnection(e);let o;try{yield i.initialize(),o=yield e.subprocess.spawn([`CLASSPATH=${t}`,"app_process","/","com.genymobile.scrcpy.Server",n,...r.formatServerArguments()],{protocols:[a.AdbSubprocessNoneProtocol]});const s=yield Promise.race([o.exit,i.getStreams()]);if("number"===typeof s)throw new Error("scrcpy server exited prematurely");const[c,d]=s;return new m(e,r,o,c,d)}catch(s){throw yield null===o||void 0===o?void 0:o.kill(),s}finally{i.dispose()}}))}get adb(){return this._adb}get stdout(){return this._stdout}get exit(){return this.process.exit}get screenWidth(){return this._screenWidth}get screenHeight(){return this._screenHeight}get videoStream(){return this._videoStream}get onClipboardChange(){return this.clipboardChangeEvent.event}checkControlStream(e){if(!this._controlStreamWriter)throw new Error(`${e} called with control disabled`);return this._controlStreamWriter}getControlMessageTypeValue(e){const t=this.options.getControlMessageTypes().indexOf(e);if(-1===t)throw new Error("Not supported");return t}injectKeyCode(e){return(0,o.mG)(this,void 0,void 0,(function*(){const t=this.checkControlStream("injectKeyCode");yield t.write(f.serialize(Object.assign(Object.assign({},e),{type:this.getControlMessageTypeValue(r.InjectKeycode)})))}))}injectText(e){return(0,o.mG)(this,void 0,void 0,(function*(){const t=this.checkControlStream("injectText");yield t.write(u.serialize({type:this.getControlMessageTypeValue(r.InjectText),text:e}))}))}injectTouch(e){return(0,o.mG)(this,void 0,void 0,(function*(){const t=this.checkControlStream("injectTouch");if(!this.screenWidth||!this.screenHeight)return;const n=Date.now();n-this.lastTouchMessage<16&&[i.Move,i.HoverMove].includes(e.action)||(this.lastTouchMessage=n,yield t.write(l.serialize(Object.assign(Object.assign({},e),{type:this.getControlMessageTypeValue(r.InjectTouch),screenWidth:this.screenWidth,screenHeight:this.screenHeight}))))}))}injectScroll(e){return(0,o.mG)(this,void 0,void 0,(function*(){const t=this.checkControlStream("injectScroll");if(!this.screenWidth||!this.screenHeight)return;const n=this.options.serializeInjectScrollControlMessage(Object.assign(Object.assign({},e),{type:this.getControlMessageTypeValue(r.InjectScroll),screenWidth:this.screenWidth,screenHeight:this.screenHeight}));yield t.write(n)}))}pressBackOrTurnOnScreen(e){return(0,o.mG)(this,void 0,void 0,(function*(){const t=this.checkControlStream("pressBackOrTurnOnScreen"),n=this.options.serializeBackOrScreenOnControlMessage({type:this.getControlMessageTypeValue(r.BackOrScreenOn),action:e});n&&(yield t.write(n))}))}sendSimpleControlMessage(e,t){return(0,o.mG)(this,void 0,void 0,(function*(){const n=this.checkControlStream(t),r=d.serialize({type:this.getControlMessageTypeValue(e)});yield n.write(r)}))}rotateDevice(){return(0,o.mG)(this,void 0,void 0,(function*(){yield this.sendSimpleControlMessage(r.RotateDevice,"rotateDevice")}))}close(){var e;return(0,o.mG)(this,void 0,void 0,(function*(){yield null===(e=this.process)||void 0===e?void 0:e.kill()}))}}var g,b;!function(e){e[e.Baseline=1]="Baseline",e[e.Main=2]="Main",e[e.Extended=4]="Extended",e[e.High=8]="High",e[e.High10=16]="High10",e[e.High422=32]="High422",e[e.High444=64]="High444",e[e.ConstrainedBaseline=65536]="ConstrainedBaseline",e[e.ConstrainedHigh=524288]="ConstrainedHigh"}(g||(g={})),function(e){e[e.Level1=1]="Level1",e[e.Level1b=2]="Level1b",e[e.Level11=4]="Level11",e[e.Level12=8]="Level12",e[e.Level13=16]="Level13",e[e.Level2=32]="Level2",e[e.Level21=64]="Level21",e[e.Level22=128]="Level22",e[e.Level3=256]="Level3",e[e.Level31=512]="Level31",e[e.Level32=1024]="Level32",e[e.Level4=2048]="Level4",e[e.Level41=4096]="Level41",e[e.Level42=8192]="Level42",e[e.Level5=16384]="Level5",e[e.Level51=32768]="Level51",e[e.Level52=65536]="Level52",e[e.Level6=131072]="Level6",e[e.Level61=262144]="Level61",e[e.Level62=524288]="Level62"}(b||(b={}));var w=n(541);let y,x=!1;const S=[];let P=0;const k=new s.vp;class C extends s.Xn{constructor(e){super(),this.pictureReadyEvent=new s.vp,this.streamId=e,this.addDisposable(k.event(this.handlePictureReady,this))}get onPictureReady(){return this.pictureReadyEvent.event}handlePictureReady(e){e.renderStateId===this.streamId&&this.pictureReadyEvent.fire(e)}feed(e){y.postMessage({type:"decode",data:e,offset:0,length:e.byteLength,renderStateId:this.streamId},[e])}dispose(){super.dispose(),y.postMessage({type:"release",renderStateId:this.streamId})}}let D;function _(){return D||(D=Promise.all([n.e(949).then(n.t.bind(n,7949,19)),n.e(358).then(n.t.bind(n,7358,19))]).then((([e,{default:t}])=>({YuvBuffer:e,YuvCanvas:t})))),D}class j{constructor(){this.maxProfile=g.Baseline,this.maxLevel=b.Level4,this._frameRendered=0,_(),this._renderer=document.createElement("canvas"),this._writable=new a.WritableStream({write:e=>(0,o.mG)(this,void 0,void 0,(function*(){switch(e.type){case"configuration":this.configure(e.data);break;case"frame":if(!this._initializer)throw new Error("Decoder not initialized");(yield this._initializer.promise).feed(e.data.slice().buffer)}}))})}get renderer(){return this._renderer}get frameRendered(){return this._frameRendered}get writable(){return this._writable}configure(e){return(0,o.mG)(this,void 0,void 0,(function*(){this.dispose(),this._initializer=new w.h;const{YuvBuffer:t,YuvCanvas:r}=yield _();this._yuvCanvas||(this._yuvCanvas=r.attach(this._renderer));const{encodedWidth:i,encodedHeight:o}=e,a=i/2,s=o/2;this._renderer.width=e.croppedWidth,this._renderer.height=e.croppedHeight;const c=t.format({width:i,height:o,chromaWidth:a,chromaHeight:s,cropLeft:e.cropLeft,cropTop:e.cropTop,cropWidth:e.croppedWidth,cropHeight:e.croppedHeight,displayWidth:e.croppedWidth,displayHeight:e.croppedHeight}),d=yield function(){if(y||(y=new Worker(new URL(n.p+n.u(837),n.b)),y.addEventListener("message",(e=>{const{data:t}=e;switch(t.type){case"decoderReady":x=!0;for(const e of S)e.resolve(new C(P)),P+=1;S.length=0;break;case"pictureReady":k.fire(t)}}))),!x){const e=new w.h;return S.push(e),e.promise}const e=new C(P);return P+=1,Promise.resolve(e)}();this._initializer.resolve(d);const l=i*o,u=l+a*s;d.onPictureReady((({data:e})=>{this._frameRendered+=1;const n=new Uint8Array(e),r=t.frame(c,t.lumaPlane(c,n,i,0),t.chromaPlane(c,n,a,l),t.chromaPlane(c,n,a,u));this._yuvCanvas.drawFrame(r)}))}))}dispose(){var e;null===(e=this._initializer)||void 0===e||e.promise.then((e=>e.dispose())),this._initializer=void 0}}function E(e){return e.toString(16).padStart(2,"0").toUpperCase()}class T{constructor(){this.maxProfile=void 0,this.maxLevel=void 0,this._frameRendered=0,this.animationFrame=0,this.render=()=>{this.lastFrame&&(this._frameRendered+=1,this.context.drawImage(this.lastFrame,0,0),this.lastFrame.close(),this.lastFrame=void 0),this.animationFrame=requestAnimationFrame(this.render)},this._renderer=document.createElement("canvas"),this.context=this._renderer.getContext("2d"),this.decoder=new VideoDecoder({output:e=>{this.lastFrame&&this.lastFrame.close(),this.lastFrame=e,this.animationFrame||this.render()},error(){}}),this._writable=new a.WritableStream({write:e=>(0,o.mG)(this,void 0,void 0,(function*(){switch(e.type){case"configuration":this.configure(e.data);break;case"frame":this.decoder.decode(new EncodedVideoChunk({type:!1===e.keyframe?"delta":"key",timestamp:0,data:e.data}))}}))})}get writable(){return this._writable}get renderer(){return this._renderer}get frameRendered(){return this._frameRendered}configure(e){const{profileIndex:t,constraintSet:n,levelIndex:r}=e;this._renderer.width=e.croppedWidth,this._renderer.height=e.croppedHeight;const i=`avc1.${[t,n,r].map(E).join("")}`;this.decoder.configure({codec:i,optimizeForLatency:!0})}dispose(){cancelAnimationFrame(this.animationFrame),this.decoder.close()}}function z(e){return new Promise((t=>{globalThis.setTimeout(t,e)}))}class O{constructor(e,t){this.device=e,this.options=t}initialize(){}dispose(){}}class L extends O{connect(){return(0,o.mG)(this,void 0,void 0,(function*(){return yield this.device.createSocket("localabstract:scrcpy")}))}connectAndRetry(){return(0,o.mG)(this,void 0,void 0,(function*(){for(let t=0;t<100;t++)try{return yield this.connect()}catch(e){yield z(100)}throw new Error("Can't connect to server after 100 retries")}))}connectVideoStream(){return(0,o.mG)(this,void 0,void 0,(function*(){const e=yield this.connectAndRetry();if(this.options.sendDummyByte){const t=e.readable.getReader(),{done:n,value:r}=yield t.read();if(n||1!==r.byteLength||0!==r[0])throw new Error("Unexpected response from server");t.releaseLock()}return e}))}getStreams(){return(0,o.mG)(this,void 0,void 0,(function*(){const e=yield this.connectVideoStream();let t;if(this.options.control&&(t=yield this.connectAndRetry()),this.options.sendDeviceMeta){const t=e.readable.getReader(),{done:n,value:r}=yield t.read();if(n||68!==r.byteLength)throw new Error("Unexpected response from server");t.releaseLock()}return[e,t]}))}}class I extends O{initialize(){return(0,o.mG)(this,void 0,void 0,(function*(){try{yield this.device.reverse.remove("localabstract:scrcpy")}catch(n){}const e=new TransformStream;this.streams=e.readable.getReader();const t=e.writable.getWriter();this.address=yield this.device.reverse.add("localabstract:scrcpy",27183,(e=>(t.write(e),!0)))}))}accept(){return(0,o.mG)(this,void 0,void 0,(function*(){return(yield this.streams.read()).value}))}getStreams(){return(0,o.mG)(this,void 0,void 0,(function*(){const e=yield this.accept();let t;if(this.options.control&&(t=yield this.accept()),this.options.sendDeviceMeta){const t=e.readable.getReader(),{done:n,value:r}=yield t.read();if(n||68!==r.byteLength)throw new Error("Unexpected response from server");t.releaseLock()}return[e,t]}))}dispose(){this.device.reverse.remove(this.address)}}const H="/data/local/tmp/scrcpy-server.jar";function V(e,t){return function(e){return"object"===typeof e&&null!==e&&"function"===typeof e.toOptionValue}(e)&&(e=e.toOptionValue()),void 0===e?t:`${e}`}class M{constructor(e){this.bytePosition=0,this.bitPosition=0,this.buffer=e}read(e){let t=0;for(let n=0;n<e;n+=1)t=t<<1|this.next();return t}next(){const e=this.buffer[this.bytePosition]>>7-this.bitPosition&1;return this.bitPosition+=1,8===this.bitPosition&&(this.bytePosition+=1,this.bitPosition=0),e}decodeExponentialGolombNumber(){let e=0;for(;0===this.next();)e+=1;return 0===e?0:(1<<e|this.read(e))-1}}function U(e){for(const t of function*(e){let t=-1,n=0,r=0,i=!1;for(const o of e){if(e[n]=o,n+=1,i){if(o>3)throw new Error("Invalid data");i=!1;continue}if(0==o){r+=1;continue}const a=r;if(r=0,-1===t){if(a>=2&&1===o){n=0,t=0;continue}throw new Error("Invalid data")}if(!(a<2))if(1!==o){if(a>2)throw new Error("Invalid data");switch(o){case 2:throw new Error("Invalid data");case 3:n-=1,i=!0}}else n-=a+1,yield e.subarray(t,n),t=n}if(i||0!==r)throw new Error("Invalid data");yield e.subarray(t,n)}(new Uint8Array(e))){const e=new M(t);if(0!==e.next())throw new Error("Invalid data");const n=e.read(2);if(7!==e.read(5))continue;if(0===n)throw new Error("Invalid data");const r=e.read(8),i=e.read(8),o=new M(new Uint8Array([i])),a=!!o.next(),s=!!o.next(),c=!!o.next(),d=!!o.next(),l=!!o.next(),u=!!o.next();if(0!==o.read(2))throw new Error("Invalid data");const h=e.read(8),p=e.decodeExponentialGolombNumber();if(100===r||110===r||122===r||244===r||44===r||83===r||86===r||118===r||128===r||138===r||139===r||134===r){const t=e.decodeExponentialGolombNumber();3===t&&e.next(),e.decodeExponentialGolombNumber(),e.decodeExponentialGolombNumber(),e.next();if(!!e.next()){const n=[];for(let r=0;r<(3!==t?8:12);r++)n[r]=!!e.next(),n[r]}}e.decodeExponentialGolombNumber();const f=e.decodeExponentialGolombNumber();if(0===f)e.decodeExponentialGolombNumber();else if(1===f){e.next(),e.decodeExponentialGolombNumber(),e.decodeExponentialGolombNumber();const t=e.decodeExponentialGolombNumber(),n=[];for(let r=0;r<t;r++)n[r]=e.decodeExponentialGolombNumber()}e.decodeExponentialGolombNumber(),e.next();const v=e.decodeExponentialGolombNumber(),m=e.decodeExponentialGolombNumber(),g=e.next();g||e.next(),e.next();const b=!!e.next();let w,y,x,S;b?(w=e.decodeExponentialGolombNumber(),y=e.decodeExponentialGolombNumber(),x=e.decodeExponentialGolombNumber(),S=e.decodeExponentialGolombNumber()):(w=0,y=0,x=0,S=0);e.next();return{profile_idc:r,constraint_set:i,constraint_set0_flag:a,constraint_set1_flag:s,constraint_set2_flag:c,constraint_set3_flag:d,constraint_set4_flag:l,constraint_set5_flag:u,level_idc:h,seq_parameter_set_id:p,pic_width_in_mbs_minus1:v,pic_height_in_map_units_minus1:m,frame_mbs_only_flag:g,frame_cropping_flag:b,frame_crop_left_offset:w,frame_crop_right_offset:y,frame_crop_top_offset:x,frame_crop_bottom_offset:S}}throw new Error("Invalid data")}var R,N;!function(e){e.Verbose="verbose",e.Debug="debug",e.Info="info",e.Warn="warn",e.Error="error"}(R||(R={})),function(e){e[e.Initial=-2]="Initial",e[e.Unlocked=-1]="Unlocked",e[e.Portrait=0]="Portrait",e[e.Landscape=1]="Landscape",e[e.PortraitFlipped=2]="PortraitFlipped",e[e.LandscapeFlipped=3]="LandscapeFlipped"}(N||(N={}));class B{constructor(e){this.value=e}toOptionValue(){const e=Object.entries(this.value).filter((([e,t])=>void 0!==t));if(0!==e.length)return e.map((([e,t])=>`${e}=${t}`)).join(",")}}const A=(new c.ZP).uint64("pts").uint32("size").uint8Array("data",{lengthField:"size"}),W=BigInt(1)<<BigInt(63),G=d,F=(new c.ZP).fields(d).uint32("pointerX").uint32("pointerY").uint16("screenWidth").uint16("screenHeight").int32("scrollX").int32("scrollY");class Y{constructor(e){new.target===Y&&e.logLevel===R.Verbose&&(e.logLevel=R.Debug),new.target===Y&&e.lockVideoOrientation===N.Initial&&(e.lockVideoOrientation=N.Unlocked),this.value=e}getArgumentOrder(){return["logLevel","maxSize","bitRate","maxFps","lockVideoOrientation","tunnelForward","crop","sendFrameMeta","control","displayId","showTouches","stayAwake","codecOptions","encoderName"]}getDefaultValue(){return{logLevel:R.Debug,maxSize:0,bitRate:8e6,maxFps:0,lockVideoOrientation:N.Unlocked,tunnelForward:!1,crop:"-",sendFrameMeta:!0,control:!0,displayId:0,showTouches:!1,stayAwake:!1,codecOptions:new B({}),encoderName:"-"}}formatServerArguments(){const e=this.getDefaultValue();return this.getArgumentOrder().map((t=>V(this.value[t]||e[t],"-")))}createConnection(e){const t={control:!0,sendDummyByte:!0,sendDeviceMeta:!0};return this.value.tunnelForward?new L(e,t):new I(e,t)}getOutputEncoderNameRegex(){return/\s+scrcpy --encoder-name '(.*?)'/}createVideoStreamTransformer(){if(!1===this.value.sendFrameMeta)return new a.TransformStream({transform(e,t){t.enqueue({type:"frame",data:e})}});let e,t=new a.StructDeserializeStream(A);return{writable:t.writable,readable:t.readable.pipeThrough(new a.TransformStream({transform(t,n){if(t.pts===W){const r=U(t.data.slice().buffer),{profile_idc:i,constraint_set:o,level_idc:a,pic_width_in_mbs_minus1:s,pic_height_in_map_units_minus1:c,frame_mbs_only_flag:d,frame_crop_left_offset:l,frame_crop_right_offset:u,frame_crop_top_offset:h,frame_crop_bottom_offset:p}=r,f=16*(s+1),v=(c+1)*(2-d)*16,m=2*l,g=2*u,b=2*h,w=2*p,y=f-m-g,x=v-b-w;return e=t.data,void n.enqueue({type:"configuration",data:{profileIndex:i,constraintSet:o,levelIndex:a,encodedWidth:f,encodedHeight:v,cropLeft:m,cropRight:g,cropTop:b,cropBottom:w,croppedWidth:y,croppedHeight:x}})}let r;e?(r=new Uint8Array(e.byteLength+t.data.byteLength),r.set(e),r.set(t.data,e.byteLength),e=void 0):r=t.data,n.enqueue({type:"frame",pts:t.pts,data:r})}}))}}getControlMessageTypes(){return[r.InjectKeycode,r.InjectText,r.InjectTouch,r.InjectScroll,r.BackOrScreenOn,r.ExpandNotificationPanel,r.CollapseNotificationPanel,r.GetClipboard,r.SetClipboard,r.SetScreenPowerMode,r.RotateDevice]}serializeBackOrScreenOnControlMessage(e){if(e.action===h.Down)return G.serialize(e)}serializeInjectScrollControlMessage(e){return F.serialize(e)}}const K=(new c.ZP).fields(G).uint8("action",(0,c.W$)());class Z extends Y{constructor(e){super(e)}getArgumentOrder(){return super.getArgumentOrder().concat(["powerOffOnClose"])}getDefaultValue(){return Object.assign(Object.assign({},super.getDefaultValue()),{powerOffOnClose:!1})}getOutputEncoderNameRegex(){return/\s+scrcpy --encoder '(.*?)'/}getControlMessageTypes(){const e=super.getControlMessageTypes();return e.splice(6,0,r.ExpandSettingPanel),e}serializeBackOrScreenOnControlMessage(e){return K.serialize(e)}}class J extends Z{constructor(e){super(e)}getDefaultValue(){return Object.assign(Object.assign({},super.getDefaultValue()),{clipboardAutosync:!0})}formatServerArguments(){return Object.entries(this.value).map((([e,t])=>[e,V(t,void 0)])).filter((e=>void 0!==e[1])).map((([e,t])=>{return`${n=e,n.replace(/([A-Z])/g,"_$1").toLowerCase()}=${t}`;var n}))}}const X=(new c.ZP).fields(F).int32("buttons");class $ extends J{constructor(e){e.rawVideoStream&&(e.sendDeviceMeta=!1,e.sendFrameMeta=!1,e.sendDummyByte=!1),super(e)}getDefaultValue(){return Object.assign(Object.assign({},super.getDefaultValue()),{downsizeOnError:!0,sendDeviceMeta:!0,sendDummyByte:!0,rawVideoStream:!1})}createConnection(e){var t,n,r;const i=this.getDefaultValue(),o={control:null!==(t=this.value.control)&&void 0!==t?t:i.control,sendDummyByte:null!==(n=this.value.sendDummyByte)&&void 0!==n?n:i.sendDummyByte,sendDeviceMeta:null!==(r=this.value.sendDeviceMeta)&&void 0!==r?r:i.sendDeviceMeta};return this.value.tunnelForward?new L(e,o):new I(e,o)}serializeInjectScrollControlMessage(e){return X.serialize(e)}}const q=BigInt(1)<<BigInt(62);class Q extends ${constructor(e){super(e)}getDefaultValue(){return Object.assign(Object.assign({},super.getDefaultValue()),{cleanup:!0})}createVideoStreamTransformer(){const e=super.createVideoStreamTransformer();return{writable:e.writable,readable:e.readable.pipeThrough(new a.TransformStream({transform(e,t){"frame"===e.type?(void 0!==e.pts&&e.pts&q&&(e.keyframe=!0,e.pts&=~q),t.enqueue(e)):t.enqueue(e)}}))}}}class ee extends Q{constructor(e){super(e)}getDefaultValue(){return Object.assign(Object.assign({},super.getDefaultValue()),{powerOn:!0})}}function te(e,t={}){const{path:n=H}=t;let r;return new a.WrapWritableStream({start(){return(0,o.mG)(this,void 0,void 0,(function*(){return r=yield e.sync(),r.write(n)}))},close(){return(0,o.mG)(this,void 0,void 0,(function*(){yield r.dispose()}))}})}}},function(e){e.O(0,[774,888,179],(function(){return t=2905,e(e.s=t);var t}));var t=e.O();_N_E=t}]);
//# sourceMappingURL=scrcpy-e21c1e775072c419.js.map