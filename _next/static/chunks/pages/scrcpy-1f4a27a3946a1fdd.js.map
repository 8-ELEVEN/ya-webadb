{"version":3,"file":"static/chunks/pages/scrcpy-1f4a27a3946a1fdd.js","mappings":"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","sources":["webpack://_N_E/?8373","webpack://_N_E/../../common/temp/node_modules/.pnpm/@fluentui+react@8.68.0_12a6012245369fd5be825566be975ff0/node_modules/@fluentui/react/lib/components/src/components/Layer/LayerHost.tsx","webpack://_N_E/../../libraries/scrcpy/src/adb/connection.ts","webpack://_N_E/../../libraries/scrcpy/src/adb/options/1_22.ts","webpack://_N_E/../../libraries/scrcpy/src/adb/options/1_16.ts","webpack://_N_E/../../libraries/scrcpy/src/adb/options/types.ts","webpack://_N_E/../../libraries/scrcpy/src/control/type.ts","webpack://_N_E/../../libraries/scrcpy/src/control/inject-keycode.ts","webpack://_N_E/../../libraries/scrcpy/src/control/inject-text.ts","webpack://_N_E/../../libraries/scrcpy/src/control/inject-touch.ts","webpack://_N_E/../../libraries/scrcpy/src/control/rotate-device.ts","webpack://_N_E/../../libraries/scrcpy/src/control/serializer.ts","webpack://_N_E/../../libraries/scrcpy/src/device-message/type.ts","webpack://_N_E/../../libraries/scrcpy/src/device-message/clipboard.ts","webpack://_N_E/../../libraries/scrcpy/src/device-message/stream.ts","webpack://_N_E/../../libraries/scrcpy/src/options/1_16/codec-options.ts","webpack://_N_E/../../libraries/scrcpy/src/options/types.ts","webpack://_N_E/../../libraries/scrcpy/src/options/1_16/sps.ts","webpack://_N_E/../../libraries/scrcpy/src/options/1_16/options.ts","webpack://_N_E/../../libraries/scrcpy/src/options/1_18.ts","webpack://_N_E/../../libraries/scrcpy/src/options/1_21.ts","webpack://_N_E/../../libraries/scrcpy/src/options/1_22.ts","webpack://_N_E/../../libraries/scrcpy/src/options/1_23.ts","webpack://_N_E/../../libraries/scrcpy/src/options/1_24.ts","webpack://_N_E/../../libraries/scrcpy/src/adb/client.ts","webpack://_N_E/../../libraries/scrcpy/src/codec.ts","webpack://_N_E/../../libraries/scrcpy/src/decoder/tinyh264/wrapper.ts","webpack://_N_E/../../libraries/scrcpy/src/decoder/tinyh264/index.ts","webpack://_N_E/../../libraries/scrcpy/src/decoder/web-codecs/index.ts","webpack://_N_E/../../libraries/scrcpy/bin/version.js","webpack://_N_E/./src/pages/scrcpy.tsx"],"sourcesContent":["\n    (window.__NEXT_P = window.__NEXT_P || []).push([\n      \"/scrcpy\",\n      function () {\n        return require(\"private-next-pages/scrcpy.tsx\");\n      }\n    ]);\n    if(module.hot) {\n      module.hot.dispose(function () {\n        window.__NEXT_P.push([\"/scrcpy\"])\n      });\n    }\n  ","import * as React from 'react';\nimport { useUnmount } from '@fluentui/react-hooks';\nimport { css, getId } from '../../Utilities';\nimport { notifyHostChanged, registerLayerHost, unregisterLayerHost } from './Layer.notification';\nimport type { ILayerHost, ILayerHostProps } from './LayerHost.types';\n\nexport const LayerHost: React.FunctionComponent<ILayerHostProps> = props => {\n  const { className } = props;\n\n  const [layerHostId] = React.useState(() => getId());\n\n  const { id: hostId = layerHostId } = props;\n\n  const layerHostRef = React.useRef<ILayerHost>({\n    hostId,\n    rootRef: React.useRef<HTMLDivElement | null>(null),\n    notifyLayersChanged: () => {\n      // Nothing, since the default implementation of Layer Host does not need to react to layer changes.\n    },\n  });\n\n  React.useImperativeHandle(props.componentRef, () => layerHostRef.current);\n\n  React.useEffect(() => {\n    registerLayerHost(hostId, layerHostRef.current);\n    notifyHostChanged(hostId);\n    // eslint-disable-next-line react-hooks/exhaustive-deps -- should only run on first render\n  }, []);\n\n  useUnmount(() => {\n    unregisterLayerHost(hostId, layerHostRef.current);\n    notifyHostChanged(hostId);\n  });\n\n  return <div {...props} className={css('ms-LayerHost', className)} ref={layerHostRef.current.rootRef} />;\n};\n","import type { Adb } from '@yume-chan/adb';\nimport { delay } from '@yume-chan/async';\nimport type { Disposable } from '@yume-chan/event';\nimport type { ReadableStream, ReadableWritablePair } from '@yume-chan/stream-extra';\nimport type { ValueOrPromise } from '@yume-chan/struct';\n\nexport interface AdbScrcpyConnectionOptions {\n    control: boolean;\n\n    /**\n     * Write a byte on start to detect connection issues\n     */\n    sendDummyByte: boolean;\n\n    /**\n     * Send device name and size\n     */\n    sendDeviceMeta: boolean;\n}\n\nexport abstract class AdbScrcpyConnection implements Disposable {\n    protected adb: Adb;\n\n    protected options: AdbScrcpyConnectionOptions;\n\n    public constructor(adb: Adb, options: AdbScrcpyConnectionOptions) {\n        this.adb = adb;\n        this.options = options;\n    }\n\n    public initialize(): ValueOrPromise<void> { }\n\n    public abstract getStreams(): ValueOrPromise<[videoSteam: ReadableStream<Uint8Array>, controlStream: ReadableWritablePair<Uint8Array, Uint8Array> | undefined]>;\n\n    public dispose(): void { }\n}\n\nexport class AdbScrcpyForwardConnection extends AdbScrcpyConnection {\n    private connect(): Promise<ReadableWritablePair<Uint8Array, Uint8Array>> {\n        return this.adb.createSocket('localabstract:scrcpy');\n    }\n\n    private async connectAndRetry(): Promise<ReadableWritablePair<Uint8Array, Uint8Array>> {\n        for (let i = 0; i < 100; i++) {\n            try {\n                return await this.connect();\n            } catch (e) {\n                await delay(100);\n            }\n        }\n        throw new Error(`Can't connect to server after 100 retries`);\n    }\n\n    private async connectVideoStream(): Promise<ReadableStream<Uint8Array>> {\n        const { readable: videoStream } = await this.connectAndRetry();\n        if (this.options.sendDummyByte) {\n            const reader = videoStream.getReader();\n            const { done, value } = await reader.read();\n            // server will write a `0` to signal connection success\n            if (done || value.byteLength !== 1 || value[0] !== 0) {\n                throw new Error('Unexpected response from server');\n            }\n            reader.releaseLock();\n        }\n        return videoStream;\n    }\n\n    public async getStreams(): Promise<[videoSteam: ReadableStream<Uint8Array>, controlStream: ReadableWritablePair<Uint8Array, Uint8Array> | undefined]> {\n        const videoStream = await this.connectVideoStream();\n\n        let controlStream: ReadableWritablePair<Uint8Array, Uint8Array> | undefined;\n        if (this.options.control) {\n            controlStream = await this.connectAndRetry();\n        }\n\n        // Server only writes device meta after control socket is connected (if enabled)\n        if (this.options.sendDeviceMeta) {\n            const reader = videoStream.getReader();\n            const { done, value } = await reader.read();\n            // 64 bytes device name + 2 bytes video width + 2 bytes video height\n            if (done || value.byteLength !== 64 + 2 + 2) {\n                throw new Error('Unexpected response from server');\n            }\n            reader.releaseLock();\n        }\n\n        return [videoStream, controlStream];\n    }\n}\n\nexport class AdbScrcpyReverseConnection extends AdbScrcpyConnection {\n    private streams!: ReadableStreamDefaultReader<ReadableWritablePair<Uint8Array, Uint8Array>>;\n\n    private address!: string;\n\n    public override async initialize(): Promise<void> {\n        // try to unbind first, ignore errors\n        await this.adb.reverse.remove('localabstract:scrcpy').catch(() => { });\n\n        const queue = new TransformStream<ReadableWritablePair<Uint8Array, Uint8Array>>();\n        this.streams = queue.readable.getReader();\n        const writer = queue.writable.getWriter();\n        this.address = await this.adb.reverse.add(\n            'localabstract:scrcpy',\n            'tcp:27183',\n            socket => {\n                writer.write(socket);\n                return true;\n            },\n        );\n    }\n\n    private async accept(): Promise<ReadableWritablePair<Uint8Array, Uint8Array>> {\n        return (await this.streams.read()).value!;\n    }\n\n    public async getStreams(): Promise<[videoSteam: ReadableStream<Uint8Array>, controlStream: ReadableWritablePair<Uint8Array, Uint8Array> | undefined]> {\n        const { readable: videoStream } = await this.accept();\n\n        let controlStream: ReadableWritablePair<Uint8Array, Uint8Array> | undefined;\n        if (this.options.control) {\n            controlStream = await this.accept();\n        }\n\n        // Server only writes device meta after control socket is connected (if enabled)\n        if (this.options.sendDeviceMeta) {\n            const reader = videoStream.getReader();\n            const { done, value } = await reader.read();\n            // 64 bytes device name + 2 bytes video width + 2 bytes video height\n            if (done || value.byteLength !== 64 + 2 + 2) {\n                throw new Error('Unexpected response from server');\n            }\n            reader.releaseLock();\n        }\n\n        return [videoStream, controlStream];\n    }\n\n    public override dispose() {\n        // Don't await this!\n        // `reverse.remove`'s response will never arrive\n        // before we read all pending data from `videoStream`\n        this.adb.reverse.remove(this.address);\n    }\n}\n","import type { Adb } from '@yume-chan/adb';\n\nimport type { ScrcpyOptionsInit1_22 } from '../../options/index.js';\nimport { AdbScrcpyConnection, AdbScrcpyForwardConnection, AdbScrcpyReverseConnection } from '../connection.js';\nimport { AdbScrcpyOptions1_16 } from './1_16.js';\n\nexport class AdbScrcpyOptions1_22<T extends ScrcpyOptionsInit1_22 = ScrcpyOptionsInit1_22>\n    extends AdbScrcpyOptions1_16<T> {\n    public override createConnection(adb: Adb): AdbScrcpyConnection {\n        const options = {\n            ...this.getDefaultValue(),\n            ...this.value,\n        };\n        if (this.value.tunnelForward) {\n            return new AdbScrcpyForwardConnection(adb, options);\n        } else {\n            return new AdbScrcpyReverseConnection(adb, options);\n        }\n    }\n}\n","import type { Adb } from '@yume-chan/adb';\n\nimport type { ScrcpyOptionsInit1_16 } from '../../options/index.js';\nimport { AdbScrcpyConnection, AdbScrcpyConnectionOptions, AdbScrcpyForwardConnection, AdbScrcpyReverseConnection } from '../connection.js';\nimport { AdbScrcpyOptionsBase } from './types.js';\n\nexport class AdbScrcpyOptions1_16<T extends ScrcpyOptionsInit1_16 = ScrcpyOptionsInit1_16>\n    extends AdbScrcpyOptionsBase<T> {\n    public override createConnection(adb: Adb): AdbScrcpyConnection {\n        const options: AdbScrcpyConnectionOptions = {\n            // Old versions always have control stream no matter what the option is\n            // Pass `control: false` to `Connection` will disable the control stream\n            control: true,\n            sendDummyByte: true,\n            sendDeviceMeta: true,\n        };\n        if (this.value.tunnelForward) {\n            return new AdbScrcpyForwardConnection(adb, options);\n        } else {\n            return new AdbScrcpyReverseConnection(adb, options);\n        }\n    }\n}\n","import type { Adb } from '@yume-chan/adb';\nimport type { TransformStream } from '@yume-chan/stream-extra';\n\nimport type { ScrcpyControlMessageType } from '../../control/index.js';\nimport type { ScrcpyBackOrScreenOnControlMessage1_18, ScrcpyInjectScrollControlMessage1_22, ScrcpyOptions, ScrcpyVideoStreamPacket } from '../../options/index.js';\nimport type { AdbScrcpyConnection } from '../connection.js';\n\nexport interface AdbScrcpyOptions<T> extends ScrcpyOptions<T> {\n    createConnection(adb: Adb): AdbScrcpyConnection;\n}\n\nexport abstract class AdbScrcpyOptionsBase<T> implements ScrcpyOptions<T> {\n    private raw: ScrcpyOptions<T>;\n\n    public get value(): Partial<T> { return this.raw.value; }\n    public set value(value: Partial<T>) { this.raw.value = value; }\n\n    public constructor(raw: ScrcpyOptions<T>) {\n        this.raw = raw;\n    }\n\n    public getDefaultValue(): T {\n        return this.raw.getDefaultValue();\n    }\n\n    public formatServerArguments(): string[] {\n        return this.raw.formatServerArguments();\n    }\n\n    public getOutputEncoderNameRegex(): RegExp {\n        return this.raw.getOutputEncoderNameRegex();\n    }\n\n    public createVideoStreamTransformer(): TransformStream<Uint8Array, ScrcpyVideoStreamPacket> {\n        return this.raw.createVideoStreamTransformer();\n    }\n\n    public getControlMessageTypes(): ScrcpyControlMessageType[] {\n        return this.raw.getControlMessageTypes();\n    }\n\n    public serializeBackOrScreenOnControlMessage(\n        message: ScrcpyBackOrScreenOnControlMessage1_18,\n    ): Uint8Array | undefined {\n        return this.raw.serializeBackOrScreenOnControlMessage(message);\n    }\n\n    public serializeInjectScrollControlMessage(\n        message: ScrcpyInjectScrollControlMessage1_22,\n    ): Uint8Array {\n        return this.raw.serializeInjectScrollControlMessage(message);\n    }\n\n    public abstract createConnection(adb: Adb): AdbScrcpyConnection;\n}\n","// https://github.com/Genymobile/scrcpy/blob/fa5b2a29e983a46b49531def9cf3d80c40c3de37/app/src/control_msg.h#L23\n// For their message bodies, see https://github.com/Genymobile/scrcpy/blob/5c62f3419d252d10cd8c9cbb7c918b358b81f2d0/app/src/control_msg.c#L92\n// Their IDs change between versions, so always use `options.getControlMessageTypes()`\nexport enum ScrcpyControlMessageType {\n    InjectKeyCode,\n    InjectText,\n    InjectTouch,\n    InjectScroll,\n    BackOrScreenOn,\n    ExpandNotificationPanel,\n    ExpandSettingPanel,\n    CollapseNotificationPanel,\n    GetClipboard,\n    SetClipboard,\n    SetScreenPowerMode,\n    RotateDevice,\n}\n","import Struct, { placeholder } from '@yume-chan/struct';\n\nimport { ScrcpyControlMessageType } from './type.js';\n\nexport enum AndroidKeyEventAction {\n    Down = 0,\n    Up = 1,\n}\n\n// https://github.com/Genymobile/scrcpy/blob/cabb102a04153f9c237b18257d3269a058558c63/app/src/android/keycodes.h#L26\nexport enum AndroidKeyCode {\n    Home = 3,\n    Back = 4,\n    VolumeUp = 24,\n    VolumeDown,\n    A = 29,\n    B,\n    C,\n    D,\n    E,\n    F,\n    G,\n    H,\n    I,\n    J,\n    K,\n    L,\n    M,\n    N,\n    O,\n    P,\n    Q,\n    R,\n    S,\n    T,\n    U,\n    V,\n    W,\n    X,\n    Y,\n    Z,\n    Tab = 61,\n    Space,\n    Enter = 66,\n    Delete,\n    VolumeMute = 164,\n    AppSwitch = 187,\n}\n\nexport const ScrcpyInjectKeyCodeControlMessage =\n    new Struct()\n        .uint8('type', ScrcpyControlMessageType.InjectKeyCode as const)\n        .uint8('action', placeholder<AndroidKeyEventAction>())\n        .uint32('keyCode')\n        .uint32('repeat')\n        .uint32('metaState');\n\nexport type ScrcpyInjectKeyCodeControlMessage =\n    typeof ScrcpyInjectKeyCodeControlMessage['TInit'];\n","import Struct from '@yume-chan/struct';\n\nimport { ScrcpyControlMessageType } from './type.js';\n\nexport const ScrcpyInjectTextControlMessage =\n    new Struct()\n        .uint8('type', ScrcpyControlMessageType.InjectText as const)\n        .uint32('length')\n        .string('text', { lengthField: 'length' });\n\nexport type ScrcpyInjectTextControlMessage =\n    typeof ScrcpyInjectTextControlMessage['TInit'];\n","import Struct, { placeholder } from '@yume-chan/struct';\nimport { ScrcpyControlMessageType } from './type.js';\n\n// https://developer.android.com/reference/android/view/MotionEvent#constants_1\nexport enum AndroidMotionEventAction {\n    Down,\n    Up,\n    Move,\n    Cancel,\n    Outside,\n    PointerDown,\n    PointerUp,\n    HoverMove,\n    Scroll,\n    HoverEnter,\n    HoverExit,\n    ButtonPress,\n    ButtonRelease,\n}\n\nexport const ScrcpyInjectTouchControlMessage =\n    new Struct()\n        .uint8('type', ScrcpyControlMessageType.InjectTouch as const)\n        .uint8('action', placeholder<AndroidMotionEventAction>())\n        .uint64('pointerId')\n        .uint32('pointerX')\n        .uint32('pointerY')\n        .uint16('screenWidth')\n        .uint16('screenHeight')\n        .uint16('pressure')\n        .uint32('buttons');\n\nexport type ScrcpyInjectTouchControlMessage =\n    typeof ScrcpyInjectTouchControlMessage['TInit'];\n","import Struct from '@yume-chan/struct';\n\nimport { ScrcpyControlMessageType } from './type.js';\n\nexport const ScrcpyRotateDeviceControlMessage =\n    new Struct()\n        .uint8('type', ScrcpyControlMessageType.RotateDevice as const)\n\nexport type ScrcpyRotateDeviceControlMessage =\n    typeof ScrcpyRotateDeviceControlMessage['TInit'];\n","import type { WritableStreamDefaultWriter } from '@yume-chan/stream-extra';\n\nimport type { ScrcpyInjectScrollControlMessage1_22, ScrcpyOptions } from '../options/index.js';\nimport { AndroidKeyEventAction, ScrcpyInjectKeyCodeControlMessage } from './inject-keycode.js';\nimport { ScrcpyInjectTextControlMessage } from './inject-text.js';\nimport { ScrcpyInjectTouchControlMessage } from './inject-touch.js';\nimport { ScrcpyRotateDeviceControlMessage } from './rotate-device.js';\nimport { ScrcpyControlMessageType } from './type.js';\n\nexport class ScrcpyControlMessageSerializer {\n    private options: ScrcpyOptions<any>;\n    /** Control message type values for current version of server */\n    private types: ScrcpyControlMessageType[];\n    private writer: WritableStreamDefaultWriter<Uint8Array>;\n\n    public constructor(stream: WritableStream<Uint8Array>, options: ScrcpyOptions<any>) {\n        this.options = options;\n        this.types = options.getControlMessageTypes();\n        this.writer = stream.getWriter();\n    }\n\n    public getTypeValue(type: ScrcpyControlMessageType): number {\n        const value = this.types.indexOf(type);\n        if (value === -1) {\n            throw new Error('Not supported');\n        }\n        return value;\n    }\n\n    public injectKeyCode(message: Omit<ScrcpyInjectKeyCodeControlMessage, 'type'>) {\n        return this.writer.write(ScrcpyInjectKeyCodeControlMessage.serialize({\n            ...message,\n            type: this.getTypeValue(ScrcpyControlMessageType.InjectKeyCode),\n        }));\n    }\n\n    public injectText(text: string) {\n        return this.writer.write(ScrcpyInjectTextControlMessage.serialize({\n            text,\n            type: this.getTypeValue(ScrcpyControlMessageType.InjectText),\n        }));\n    }\n\n    public injectTouch(message: Omit<ScrcpyInjectTouchControlMessage, 'type'>) {\n        return this.writer.write(ScrcpyInjectTouchControlMessage.serialize({\n            ...message,\n            type: this.getTypeValue(ScrcpyControlMessageType.InjectTouch),\n        }));\n    }\n\n    public injectScroll(message: Omit<ScrcpyInjectScrollControlMessage1_22, 'type'>) {\n        return this.writer.write(this.options.serializeInjectScrollControlMessage({\n            ...message,\n            type: this.getTypeValue(ScrcpyControlMessageType.InjectScroll),\n        }));\n    }\n\n    public async backOrScreenOn(action: AndroidKeyEventAction) {\n        const buffer = this.options.serializeBackOrScreenOnControlMessage({\n            action,\n            type: this.getTypeValue(ScrcpyControlMessageType.BackOrScreenOn),\n        });\n\n        if (buffer) {\n            return await this.writer.write(buffer);\n        }\n    }\n\n    public rotateDevice() {\n        return this.writer.write(ScrcpyRotateDeviceControlMessage.serialize({\n            type: this.getTypeValue(ScrcpyControlMessageType.RotateDevice),\n        }));\n    }\n\n    public close() {\n        return this.writer.close();\n    }\n};\n","// https://github.com/Genymobile/scrcpy/blob/41abe021e2a73efd4899b0efcd0b9eef9ec68c9b/server/src/main/java/com/genymobile/scrcpy/DeviceMessage.java#L5\nexport enum ScrcpyDeviceMessageType {\n    Clipboard,\n    AckClipboard,\n}\n","import Struct from '@yume-chan/struct';\nimport { ScrcpyDeviceMessageType } from './type.js';\n\nexport const ScrcpyClipboardDeviceMessage =\n    new Struct()\n        .uint32('length')\n        .string('content', { lengthField: 'length' })\n        .extra({ type: ScrcpyDeviceMessageType.Clipboard as const });\n\nexport type ScrcpyClipboardDeviceMessage =\n    typeof ScrcpyClipboardDeviceMessage['TDeserializeResult'];\n","import { BufferedTransformStream } from '@yume-chan/stream-extra';\nimport { ScrcpyClipboardDeviceMessage } from './clipboard.js';\n\nexport type ScrcpyDeviceMessage =\n    | ScrcpyClipboardDeviceMessage;\n\nexport class ScrcpyDeviceMessageDeserializeStream extends BufferedTransformStream<ScrcpyDeviceMessage> {\n    constructor() {\n        super(async (stream) => {\n            const type = await stream.read(1);\n            switch (type[0]) {\n                case 0:\n                    return await ScrcpyClipboardDeviceMessage.deserialize(stream);\n                default:\n                    throw new Error('unknown control message type');\n            }\n        })\n    }\n}\n","import type { AndroidCodecLevel, AndroidCodecProfile } from '../../codec.js';\nimport type { ScrcpyOptionValue } from '../types.js';\n\nexport interface CodecOptionsInit {\n    profile: AndroidCodecProfile;\n    level: AndroidCodecLevel;\n\n    iFrameInterval: number;\n    repeatPreviousFrameAfter: number;\n    maxPtsGapToEncoder: number;\n}\n\nfunction toDashCase(input: string) {\n    return input.replace(/([A-Z])/g, '-$1').toLowerCase();\n}\n\nconst CODEC_OPTION_TYPES: Partial<Record<keyof CodecOptionsInit, 'long' | 'float' | 'string'>> = {\n    repeatPreviousFrameAfter: 'long',\n    maxPtsGapToEncoder: 'long',\n};\n\nexport class CodecOptions implements ScrcpyOptionValue {\n    public value: Partial<CodecOptionsInit>;\n\n    public constructor(value: Partial<CodecOptionsInit>) {\n        this.value = value;\n    }\n\n    public toOptionValue(): string | undefined {\n        const entries = Object.entries(this.value)\n            .filter(([key, value]) => value !== undefined);\n\n        if (entries.length === 0) {\n            return undefined;\n        }\n\n        return entries\n            .map(([key, value]) => {\n                const type = CODEC_OPTION_TYPES[key as keyof CodecOptionsInit];\n                return `${toDashCase(key)}${type ? `:${type}` : ''}=${value}`;\n            })\n            .join(',');\n    }\n}\n","import type { TransformStream } from '@yume-chan/stream-extra';\n\nimport type { ScrcpyControlMessageType } from '../control/index.js';\nimport type { H264Configuration } from '../decoder/index.js';\nimport type { ScrcpyBackOrScreenOnControlMessage1_18 } from './1_18.js';\nimport type { ScrcpyInjectScrollControlMessage1_22 } from './1_22.js';\n\nexport const DEFAULT_SERVER_PATH = '/data/local/tmp/scrcpy-server.jar';\n\nexport interface ScrcpyOptionValue {\n    toOptionValue(): string | undefined;\n}\n\nexport function isScrcpyOptionValue(value: any): value is ScrcpyOptionValue {\n    return typeof value === 'object' &&\n        value !== null &&\n        typeof value.toOptionValue === 'function';\n}\n\nexport function toScrcpyOptionValue<T>(value: any, empty: T): string | T {\n    if (isScrcpyOptionValue(value)) {\n        value = value.toOptionValue();\n    }\n\n    if (value === undefined) {\n        return empty;\n    }\n\n    return `${value}`;\n}\n\nexport interface ScrcpyVideoStreamConfigurationPacket {\n    type: 'configuration';\n    data: H264Configuration;\n}\n\nexport interface ScrcpyVideoStreamFramePacket {\n    type: 'frame';\n    keyframe?: boolean | undefined;\n    pts?: bigint | undefined;\n    data: Uint8Array;\n}\n\nexport type ScrcpyVideoStreamPacket =\n    | ScrcpyVideoStreamConfigurationPacket\n    | ScrcpyVideoStreamFramePacket;\n\nexport interface ScrcpyOptions<T> {\n    value: Partial<T>;\n\n    getDefaultValue(): T;\n\n    formatServerArguments(): string[];\n\n    getOutputEncoderNameRegex(): RegExp;\n\n    createVideoStreamTransformer(): TransformStream<Uint8Array, ScrcpyVideoStreamPacket>;\n\n    getControlMessageTypes(): ScrcpyControlMessageType[];\n\n    serializeBackOrScreenOnControlMessage(\n        message: ScrcpyBackOrScreenOnControlMessage1_18,\n    ): Uint8Array | undefined;\n\n    serializeInjectScrollControlMessage(\n        message: ScrcpyInjectScrollControlMessage1_22,\n    ): Uint8Array;\n}\n","// cspell: ignore golomb\n// cspell: ignore qpprime\n\nclass BitReader {\n    private buffer: Uint8Array;\n\n    private bytePosition = 0;\n\n    private bitPosition = 0;\n\n    public constructor(buffer: Uint8Array) {\n        this.buffer = buffer;\n    }\n\n    public read(length: number): number {\n        let result = 0;\n        for (let i = 0; i < length; i += 1) {\n            result = (result << 1) | this.next();\n        }\n        return result;\n    }\n\n    public next(): number {\n        const value = (this.buffer[this.bytePosition]! >> (7 - this.bitPosition)) & 1;\n        this.bitPosition += 1;\n        if (this.bitPosition === 8) {\n            this.bytePosition += 1;\n            this.bitPosition = 0;\n        }\n        return value;\n    }\n\n    public decodeExponentialGolombNumber(): number {\n        let length = 0;\n        while (this.next() === 0) {\n            length += 1;\n        }\n        if (length === 0) {\n            return 0;\n        }\n        return (1 << length | this.read(length)) - 1;\n    }\n}\n\nfunction* iterateNalu(buffer: Uint8Array): Generator<Uint8Array> {\n    // -1 means we haven't found the first start code\n    let start = -1;\n    let writeIndex = 0;\n\n    // How many `0x00`s in a row we have counted\n    let zeroCount = 0;\n\n    let inEmulation = false;\n\n    for (const byte of buffer) {\n        buffer[writeIndex] = byte;\n        writeIndex += 1;\n\n        if (inEmulation) {\n            if (byte > 0x03) {\n                // `0x00000304` or larger are invalid\n                throw new Error('Invalid data');\n            }\n\n            inEmulation = false;\n            continue;\n        }\n\n        if (byte == 0x00) {\n            zeroCount += 1;\n            continue;\n        }\n\n        const lastZeroCount = zeroCount;\n        zeroCount = 0;\n\n        if (start === -1) {\n            // 0x000001 is the start code\n            // But it can be preceded by any number of zeros\n            // So 2 is the minimal\n            if (lastZeroCount >= 2 && byte === 0x01) {\n                // Found start of first NAL unit\n                writeIndex = 0;\n                start = 0;\n                continue;\n            }\n\n            // Not begin with start code\n            throw new Error('Invalid data');\n        }\n\n        if (lastZeroCount < 2) {\n            // zero or one `0x00`s are acceptable\n            continue;\n        }\n\n        if (byte === 0x01) {\n            // Remove all leading `0x00`s and this `0x01`\n            writeIndex -= lastZeroCount + 1;\n\n            // Found another NAL unit\n            yield buffer.subarray(start, writeIndex);\n\n            start = writeIndex;\n            continue;\n        }\n\n        if (lastZeroCount > 2) {\n            // Too much `0x00`s\n            throw new Error('Invalid data');\n        }\n\n        switch (byte) {\n            case 0x02:\n                // Didn't find why, but 7.4.1 NAL unit semantics forbids `0x000002` appearing in NAL units\n                throw new Error('Invalid data');\n            case 0x03:\n                // `0x000003` is the \"emulation_prevention_three_byte\"\n                // `0x00000300`, `0x00000301`, `0x00000302` and `0x00000303` represent\n                // `0x000000`, `0x000001`, `0x000002` and `0x000003` respectively\n\n                // Remove current byte\n                writeIndex -= 1;\n\n                inEmulation = true;\n                break;\n            default:\n                // `0x000004` or larger are ok\n                break;\n        }\n    }\n\n    if (inEmulation || zeroCount !== 0) {\n        throw new Error('Invalid data');\n    }\n\n    yield buffer.subarray(start, writeIndex);\n}\n\n// 7.3.2.1.1 Sequence parameter set data syntax\nexport function parse_sequence_parameter_set(buffer: ArrayBuffer) {\n    for (const nalu of iterateNalu(new Uint8Array(buffer))) {\n        const reader = new BitReader(nalu);\n        if (reader.next() !== 0) {\n            throw new Error('Invalid data');\n        }\n\n        const nal_ref_idc = reader.read(2);\n        const nal_unit_type = reader.read(5);\n\n        if (nal_unit_type !== 7) {\n            continue;\n        }\n\n        if (nal_ref_idc === 0) {\n            throw new Error('Invalid data');\n        }\n\n        const profile_idc = reader.read(8);\n        const constraint_set = reader.read(8);\n\n        const constraint_set_reader = new BitReader(new Uint8Array([constraint_set]));\n        const constraint_set0_flag = !!constraint_set_reader.next();\n        const constraint_set1_flag = !!constraint_set_reader.next();\n        const constraint_set2_flag = !!constraint_set_reader.next();\n        const constraint_set3_flag = !!constraint_set_reader.next();\n        const constraint_set4_flag = !!constraint_set_reader.next();\n        const constraint_set5_flag = !!constraint_set_reader.next();\n\n        // reserved_zero_2bits\n        if (constraint_set_reader.read(2) !== 0) {\n            throw new Error('Invalid data');\n        }\n\n        const level_idc = reader.read(8);\n        const seq_parameter_set_id = reader.decodeExponentialGolombNumber();\n\n        if (profile_idc === 100 || profile_idc === 110 ||\n            profile_idc === 122 || profile_idc === 244 || profile_idc === 44 ||\n            profile_idc === 83 || profile_idc === 86 || profile_idc === 118 ||\n            profile_idc === 128 || profile_idc === 138 || profile_idc === 139 ||\n            profile_idc === 134) {\n            const chroma_format_idc = reader.decodeExponentialGolombNumber();\n            if (chroma_format_idc === 3) {\n                // separate_colour_plane_flag\n                reader.next();\n            }\n\n            // bit_depth_luma_minus8\n            reader.decodeExponentialGolombNumber();\n            // bit_depth_chroma_minus8\n            reader.decodeExponentialGolombNumber();\n\n            // qpprime_y_zero_transform_bypass_flag\n            reader.next();\n\n            const seq_scaling_matrix_present_flag = !!reader.next();\n            if (seq_scaling_matrix_present_flag) {\n                const seq_scaling_list_present_flag: boolean[] = [];\n                for (let i = 0; i < ((chroma_format_idc !== 3) ? 8 : 12); i++) {\n                    seq_scaling_list_present_flag[i] = !!reader.next();\n                    if (seq_scaling_list_present_flag[i])\n                        if (i < 6) {\n                            // TODO\n                            // scaling_list( ScalingList4x4[ i ], 16,\n                            //               UseDefaultScalingMatrix4x4Flag[ i ])\n                        } else {\n                            // TODO\n                            // scaling_list( ScalingList8x8[ i − 6 ], 64,\n                            //               UseDefaultScalingMatrix8x8Flag[ i − 6 ] )\n                        }\n                }\n            }\n        }\n\n        // log2_max_frame_num_minus4\n        reader.decodeExponentialGolombNumber();\n        const pic_order_cnt_type = reader.decodeExponentialGolombNumber();\n        if (pic_order_cnt_type === 0) {\n            // log2_max_pic_order_cnt_lsb_minus4\n            reader.decodeExponentialGolombNumber();\n        } else if (pic_order_cnt_type === 1) {\n            // delta_pic_order_always_zero_flag\n            reader.next();\n            // offset_for_non_ref_pic\n            reader.decodeExponentialGolombNumber();\n            // offset_for_top_to_bottom_field\n            reader.decodeExponentialGolombNumber();\n            const num_ref_frames_in_pic_order_cnt_cycle = reader.decodeExponentialGolombNumber();\n            const offset_for_ref_frame: number[] = [];\n            for (let i = 0; i < num_ref_frames_in_pic_order_cnt_cycle; i++) {\n                offset_for_ref_frame[i] = reader.decodeExponentialGolombNumber();\n            }\n        }\n\n        // max_num_ref_frames\n        reader.decodeExponentialGolombNumber();\n        // gaps_in_frame_num_value_allowed_flag\n        reader.next();\n        const pic_width_in_mbs_minus1 = reader.decodeExponentialGolombNumber();\n        const pic_height_in_map_units_minus1 = reader.decodeExponentialGolombNumber();\n\n        const frame_mbs_only_flag = reader.next();\n        if (!frame_mbs_only_flag) {\n            // mb_adaptive_frame_field_flag\n            reader.next();\n        }\n\n        // direct_8x8_inference_flag\n        reader.next();\n\n        const frame_cropping_flag = !!reader.next();\n        let frame_crop_left_offset: number;\n        let frame_crop_right_offset: number;\n        let frame_crop_top_offset: number;\n        let frame_crop_bottom_offset: number;\n        if (frame_cropping_flag) {\n            frame_crop_left_offset = reader.decodeExponentialGolombNumber();\n            frame_crop_right_offset = reader.decodeExponentialGolombNumber();\n            frame_crop_top_offset = reader.decodeExponentialGolombNumber();\n            frame_crop_bottom_offset = reader.decodeExponentialGolombNumber();\n        } else {\n            frame_crop_left_offset = 0;\n            frame_crop_right_offset = 0;\n            frame_crop_top_offset = 0;\n            frame_crop_bottom_offset = 0;\n        }\n\n        const vui_parameters_present_flag = !!reader.next();\n        if (vui_parameters_present_flag) {\n            // TODO\n            // vui_parameters( )\n        }\n\n        return {\n            profile_idc,\n            constraint_set,\n            constraint_set0_flag,\n            constraint_set1_flag,\n            constraint_set2_flag,\n            constraint_set3_flag,\n            constraint_set4_flag,\n            constraint_set5_flag,\n            level_idc,\n            seq_parameter_set_id,\n            pic_width_in_mbs_minus1,\n            pic_height_in_map_units_minus1,\n            frame_mbs_only_flag,\n            frame_cropping_flag,\n            frame_crop_left_offset,\n            frame_crop_right_offset,\n            frame_crop_top_offset,\n            frame_crop_bottom_offset,\n        };\n    }\n\n    throw new Error('Invalid data');\n}\n\nexport type SequenceParameterSet = ReturnType<typeof parse_sequence_parameter_set>;\n","import { StructDeserializeStream, TransformStream } from '@yume-chan/stream-extra';\nimport Struct from '@yume-chan/struct';\n\nimport { AndroidKeyEventAction, ScrcpyControlMessageType } from '../../control/index.js';\nimport type { ScrcpyBackOrScreenOnControlMessage1_18 } from '../1_18.js';\nimport type { ScrcpyInjectScrollControlMessage1_22 } from '../1_22.js';\nimport { toScrcpyOptionValue, type ScrcpyOptions, type ScrcpyVideoStreamPacket } from '../types.js';\nimport { CodecOptions } from './codec-options.js';\nimport { parse_sequence_parameter_set } from './sps.js';\n\nexport enum ScrcpyLogLevel {\n    Verbose = 'verbose',\n    Debug = 'debug',\n    Info = 'info',\n    Warn = 'warn',\n    Error = 'error',\n}\n\nexport enum ScrcpyVideoOrientation {\n    Initial = -2,\n    Unlocked = -1,\n    Portrait = 0,\n    Landscape = 1,\n    PortraitFlipped = 2,\n    LandscapeFlipped = 3,\n}\n\nexport interface ScrcpyOptionsInit1_16 {\n    logLevel: ScrcpyLogLevel;\n\n    /**\n     * The maximum value of both width and height.\n     */\n    maxSize: number;\n\n    bitRate: number;\n\n    /**\n     * 0 for unlimited.\n     *\n     * @default 0\n     */\n    maxFps: number;\n\n    /**\n     * The orientation of the video stream.\n     *\n     * It will not keep the device screen in specific orientation,\n     * only the captured video will in this orientation.\n     */\n    lockVideoOrientation: ScrcpyVideoOrientation;\n\n    tunnelForward: boolean;\n\n    crop: string;\n\n    /**\n     * Send PTS so that the client may record properly\n     *\n     * Note: When `sendFrameMeta: false` is specified,\n     * `onChangeEncoding` event won't fire and `onVideoData` event doesn't\n     * merge sps/pps frame and first video frame. Which means you can't use\n     * the shipped decoders to render the video\n     * (You can still record the stream into a file).\n     *\n     * @default true\n     */\n    sendFrameMeta: boolean;\n\n    /**\n     * @default true\n     */\n    control: boolean;\n\n    displayId: number;\n\n    showTouches: boolean;\n\n    stayAwake: boolean;\n\n    codecOptions: CodecOptions;\n\n    encoderName: string;\n}\n\nexport const VideoPacket =\n    new Struct()\n        .uint64('pts')\n        .uint32('size')\n        .uint8Array('data', { lengthField: 'size' });\n\nexport const NO_PTS = BigInt(1) << BigInt(63);\n\nexport const ScrcpyBackOrScreenOnControlMessage1_16 =\n    new Struct()\n        .uint8('type', ScrcpyControlMessageType.BackOrScreenOn as const);\n\nexport const ScrcpyInjectScrollControlMessage1_16 =\n    new Struct()\n        .uint8('type', ScrcpyControlMessageType.InjectScroll as const)\n        .uint32('pointerX')\n        .uint32('pointerY')\n        .uint16('screenWidth')\n        .uint16('screenHeight')\n        .int32('scrollX')\n        .int32('scrollY');\n\nexport class ScrcpyOptions1_16<T extends ScrcpyOptionsInit1_16 = ScrcpyOptionsInit1_16>\n    implements ScrcpyOptions<T> {\n    public value: Partial<T>;\n\n    public constructor(value: Partial<ScrcpyOptionsInit1_16>) {\n        if (new.target === ScrcpyOptions1_16 &&\n            value.logLevel === ScrcpyLogLevel.Verbose) {\n            value.logLevel = ScrcpyLogLevel.Debug;\n        }\n\n        if (new.target === ScrcpyOptions1_16 &&\n            value.lockVideoOrientation === ScrcpyVideoOrientation.Initial) {\n            value.lockVideoOrientation = ScrcpyVideoOrientation.Unlocked;\n        }\n\n        this.value = value as Partial<T>;\n    }\n\n    protected getArgumentOrder(): (keyof T)[] {\n        return [\n            'logLevel',\n            'maxSize',\n            'bitRate',\n            'maxFps',\n            'lockVideoOrientation',\n            'tunnelForward',\n            'crop',\n            'sendFrameMeta',\n            'control',\n            'displayId',\n            'showTouches',\n            'stayAwake',\n            'codecOptions',\n            'encoderName',\n        ];\n    }\n\n    public getDefaultValue(): T {\n        return {\n            logLevel: ScrcpyLogLevel.Debug,\n            maxSize: 0,\n            bitRate: 8_000_000,\n            maxFps: 0,\n            lockVideoOrientation: ScrcpyVideoOrientation.Unlocked,\n            tunnelForward: false,\n            crop: '-',\n            sendFrameMeta: true,\n            control: true,\n            displayId: 0,\n            showTouches: false,\n            stayAwake: false,\n            codecOptions: new CodecOptions({}),\n            encoderName: '-',\n        } as T;\n    }\n\n    public formatServerArguments(): string[] {\n        const defaults = this.getDefaultValue();\n        return this.getArgumentOrder()\n            .map(\n                key =>\n                    toScrcpyOptionValue(this.value[key] || defaults[key], '-')\n            );\n    }\n\n    public getOutputEncoderNameRegex(): RegExp {\n        return /\\s+scrcpy --encoder-name '(.*?)'/;\n    }\n\n    public createVideoStreamTransformer(): TransformStream<Uint8Array, ScrcpyVideoStreamPacket> {\n        // Optimized path for video frames only\n        if (this.value.sendFrameMeta === false) {\n            return new TransformStream({\n                transform(chunk, controller) {\n                    controller.enqueue({\n                        type: 'frame',\n                        data: chunk,\n                    });\n                },\n            });\n        }\n\n        let header: Uint8Array | undefined;\n\n        let deserializeStream = new StructDeserializeStream(VideoPacket);\n        return {\n            writable: deserializeStream.writable,\n            readable: deserializeStream.readable.pipeThrough(new TransformStream({\n                transform(packet, controller) {\n                    if (packet.pts === NO_PTS) {\n                        const sequenceParameterSet = parse_sequence_parameter_set(packet.data.slice().buffer);\n\n                        const {\n                            profile_idc: profileIndex,\n                            constraint_set: constraintSet,\n                            level_idc: levelIndex,\n                            pic_width_in_mbs_minus1,\n                            pic_height_in_map_units_minus1,\n                            frame_mbs_only_flag,\n                            frame_crop_left_offset,\n                            frame_crop_right_offset,\n                            frame_crop_top_offset,\n                            frame_crop_bottom_offset,\n                        } = sequenceParameterSet;\n\n                        const encodedWidth = (pic_width_in_mbs_minus1 + 1) * 16;\n                        const encodedHeight = (pic_height_in_map_units_minus1 + 1) * (2 - frame_mbs_only_flag) * 16;\n                        const cropLeft = frame_crop_left_offset * 2;\n                        const cropRight = frame_crop_right_offset * 2;\n                        const cropTop = frame_crop_top_offset * 2;\n                        const cropBottom = frame_crop_bottom_offset * 2;\n\n                        const croppedWidth = encodedWidth - cropLeft - cropRight;\n                        const croppedHeight = encodedHeight - cropTop - cropBottom;\n\n                        header = packet.data;\n                        controller.enqueue({\n                            type: 'configuration',\n                            data: {\n                                profileIndex,\n                                constraintSet,\n                                levelIndex,\n                                encodedWidth,\n                                encodedHeight,\n                                cropLeft,\n                                cropRight,\n                                cropTop,\n                                cropBottom,\n                                croppedWidth,\n                                croppedHeight,\n                            }\n                        });\n                        return;\n                    }\n\n                    let frameData: Uint8Array;\n                    if (header) {\n                        frameData = new Uint8Array(header.byteLength + packet.data.byteLength);\n                        frameData.set(header);\n                        frameData.set(packet.data, header.byteLength);\n                        header = undefined;\n                    } else {\n                        frameData = packet.data;\n                    }\n\n                    controller.enqueue({\n                        type: 'frame',\n                        pts: packet.pts,\n                        data: frameData,\n                    });\n                }\n            }))\n        };\n    }\n\n    public getControlMessageTypes(): ScrcpyControlMessageType[] {\n        return [\n            /*  0 */ ScrcpyControlMessageType.InjectKeyCode,\n            /*  1 */ ScrcpyControlMessageType.InjectText,\n            /*  2 */ ScrcpyControlMessageType.InjectTouch,\n            /*  3 */ ScrcpyControlMessageType.InjectScroll,\n            /*  4 */ ScrcpyControlMessageType.BackOrScreenOn,\n            /*  5 */ ScrcpyControlMessageType.ExpandNotificationPanel,\n            /*  6 */ ScrcpyControlMessageType.CollapseNotificationPanel,\n            /*  7 */ ScrcpyControlMessageType.GetClipboard,\n            /*  8 */ ScrcpyControlMessageType.SetClipboard,\n            /*  9 */ ScrcpyControlMessageType.SetScreenPowerMode,\n            /* 10 */ ScrcpyControlMessageType.RotateDevice,\n        ];\n    }\n\n    public serializeBackOrScreenOnControlMessage(\n        message: ScrcpyBackOrScreenOnControlMessage1_18,\n    ) {\n        if (message.action === AndroidKeyEventAction.Down) {\n            return ScrcpyBackOrScreenOnControlMessage1_16.serialize(message);\n        }\n\n        return undefined;\n    }\n\n    public serializeInjectScrollControlMessage(\n        message: ScrcpyInjectScrollControlMessage1_22,\n    ): Uint8Array {\n        return ScrcpyInjectScrollControlMessage1_16.serialize(message);\n    }\n}\n","import Struct, { placeholder } from '@yume-chan/struct';\n\nimport { AndroidKeyEventAction, ScrcpyControlMessageType } from '../control/index.js';\nimport { ScrcpyBackOrScreenOnControlMessage1_16, ScrcpyOptions1_16, type ScrcpyOptionsInit1_16 } from './1_16/options.js';\n\nexport interface ScrcpyOptionsInit1_18 extends ScrcpyOptionsInit1_16 {\n    powerOffOnClose: boolean;\n}\n\nexport const ScrcpyBackOrScreenOnControlMessage1_18 =\n    new Struct()\n        .fields(ScrcpyBackOrScreenOnControlMessage1_16)\n        .uint8('action', placeholder<AndroidKeyEventAction>());\n\nexport type ScrcpyBackOrScreenOnControlMessage1_18 = typeof ScrcpyBackOrScreenOnControlMessage1_18['TInit'];\n\nexport class ScrcpyOptions1_18<T extends ScrcpyOptionsInit1_18 = ScrcpyOptionsInit1_18>\n    extends ScrcpyOptions1_16<T> {\n    constructor(value: Partial<ScrcpyOptionsInit1_18>) {\n        super(value);\n    }\n\n    protected override getArgumentOrder(): (keyof T)[] {\n        return super.getArgumentOrder().concat(['powerOffOnClose']);\n    }\n\n    public override getDefaultValue(): T {\n        return {\n            ...super.getDefaultValue(),\n            powerOffOnClose: false,\n        };\n    }\n\n    public override getOutputEncoderNameRegex(): RegExp {\n        return /\\s+scrcpy --encoder '(.*?)'/;\n    }\n\n    public override getControlMessageTypes(): ScrcpyControlMessageType[] {\n        /**\n         *  0 InjectKeycode\n         *  1 InjectText\n         *  2 InjectTouch\n         *  3 InjectScroll\n         *  4 BackOrScreenOn\n         *  5 ExpandNotificationPanel\n         *  6 ExpandSettingsPanel\n         *  7 CollapseNotificationPanel\n         *  8 GetClipboard\n         *  9 SetClipboard\n         * 10 SetScreenPowerMode\n         * 11 RotateDevice\n         */\n        const types = super.getControlMessageTypes();\n        types.splice(6, 0, ScrcpyControlMessageType.ExpandSettingPanel);\n        return types;\n    }\n\n    public override serializeBackOrScreenOnControlMessage(\n        message: ScrcpyBackOrScreenOnControlMessage1_18,\n    ) {\n        return ScrcpyBackOrScreenOnControlMessage1_18.serialize(message);\n    }\n}\n","// cspell: ignore autosync\n\nimport { ScrcpyOptions1_18, type ScrcpyOptionsInit1_18 } from './1_18.js';\nimport { toScrcpyOptionValue } from './types.js';\n\nexport interface ScrcpyOptionsInit1_21 extends ScrcpyOptionsInit1_18 {\n    clipboardAutosync?: boolean;\n}\n\nfunction toSnakeCase(input: string): string {\n    return input.replace(/([A-Z])/g, '_$1').toLowerCase();\n}\n\nexport class ScrcpyOptions1_21<T extends ScrcpyOptionsInit1_21 = ScrcpyOptionsInit1_21>\n    extends ScrcpyOptions1_18<T> {\n    public constructor(init: Partial<ScrcpyOptionsInit1_21>) {\n        super(init);\n    }\n\n    public override getDefaultValue(): T {\n        return {\n            ...super.getDefaultValue(),\n            clipboardAutosync: true,\n        };\n    }\n\n    public override formatServerArguments(): string[] {\n        // 1.21 changed the format of arguments\n        // So `getArgumentOrder()` is no longer needed\n        return Object.entries(this.value)\n            .map(\n                ([key, value]) =>\n                    [key, toScrcpyOptionValue(value, undefined)] as const\n            )\n            .filter(\n                (pair): pair is [string, string] =>\n                    pair[1] !== undefined\n            )\n            .map(\n                ([key, value]) =>\n                    `${toSnakeCase(key)}=${value}`\n            );\n    }\n}\n","import Struct from '@yume-chan/struct';\n\nimport { ScrcpyInjectScrollControlMessage1_16 } from './1_16/options.js';\nimport { ScrcpyOptions1_21, type ScrcpyOptionsInit1_21 } from './1_21.js';\n\nexport interface ScrcpyOptionsInit1_22 extends ScrcpyOptionsInit1_21 {\n    downsizeOnError: boolean;\n\n    /**\n     * Send device name and size at start of video stream.\n     *\n     * @default true\n     */\n    sendDeviceMeta: boolean;\n\n    /**\n     * Send a `0` byte on start of video stream to detect connection issues\n     *\n     * @default true\n     */\n    sendDummyByte: boolean;\n\n    /**\n     * Implies `sendDeviceMeta: false`, `sendFrameMeta: false` and `sendDummyByte: false`\n     *\n     * @default false\n     */\n    rawVideoStream: boolean;\n}\n\nexport const ScrcpyInjectScrollControlMessage1_22 =\n    new Struct()\n        .fields(ScrcpyInjectScrollControlMessage1_16)\n        .int32('buttons');\n\nexport type ScrcpyInjectScrollControlMessage1_22 =\n    typeof ScrcpyInjectScrollControlMessage1_22['TInit'];\n\nexport class ScrcpyOptions1_22<T extends ScrcpyOptionsInit1_22 = ScrcpyOptionsInit1_22>\n    extends ScrcpyOptions1_21<T> {\n    public constructor(init: Partial<ScrcpyOptionsInit1_22>) {\n        if (init.rawVideoStream) {\n            // Set implied options for client-side processing\n            init.sendDeviceMeta = false;\n            init.sendFrameMeta = false;\n            init.sendDummyByte = false;\n        }\n\n        super(init);\n    }\n\n    public override getDefaultValue(): T {\n        return {\n            ...super.getDefaultValue(),\n            downsizeOnError: true,\n            sendDeviceMeta: true,\n            sendDummyByte: true,\n            rawVideoStream: false,\n        };\n    }\n\n    public override serializeInjectScrollControlMessage(\n        message: ScrcpyInjectScrollControlMessage1_22,\n    ): Uint8Array {\n        return ScrcpyInjectScrollControlMessage1_22.serialize(message);\n    }\n}\n","import { TransformStream } from '@yume-chan/stream-extra';\n\nimport { ScrcpyOptions1_22, type ScrcpyOptionsInit1_22 } from './1_22.js';\nimport type { ScrcpyVideoStreamPacket } from './types.js';\n\nexport interface ScrcpyOptionsInit1_23 extends ScrcpyOptionsInit1_22 {\n    cleanup: boolean;\n}\n\nconst KEYFRAME_PTS = BigInt(1) << BigInt(62);\n\nexport class ScrcpyOptions1_23<T extends ScrcpyOptionsInit1_23 = ScrcpyOptionsInit1_23>\n    extends ScrcpyOptions1_22<T> {\n    public constructor(init: Partial<ScrcpyOptionsInit1_23>) {\n        super(init);\n    }\n\n    public override getDefaultValue(): T {\n        return {\n            ...super.getDefaultValue(),\n            cleanup: true,\n        };\n    }\n\n    public override createVideoStreamTransformer(): TransformStream<Uint8Array, ScrcpyVideoStreamPacket> {\n        const superStream = super.createVideoStreamTransformer();\n        return {\n            writable: superStream.writable,\n            readable: superStream.readable.pipeThrough(new TransformStream({\n                transform(packet, controller): void {\n                    if (packet.type !== 'frame') {\n                        controller.enqueue(packet);\n                        return;\n                    }\n\n                    if (packet.pts !== undefined && packet.pts & KEYFRAME_PTS) {\n                        packet.keyframe = true;\n                        packet.pts &= ~KEYFRAME_PTS;\n                    }\n\n                    controller.enqueue(packet);\n                }\n            }))\n        };\n    }\n}\n","import { ScrcpyOptions1_23, type ScrcpyOptionsInit1_23 } from './1_23.js';\n\nexport interface ScrcpyOptionsInit1_24 extends ScrcpyOptionsInit1_23 {\n    powerOn: boolean;\n}\n\nexport class ScrcpyOptions1_24<T extends ScrcpyOptionsInit1_24 = ScrcpyOptionsInit1_24>\n    extends ScrcpyOptions1_23<T> {\n    public constructor(init: Partial<ScrcpyOptionsInit1_24>) {\n        super(init);\n    }\n\n    public override getDefaultValue(): T {\n        return {\n            ...super.getDefaultValue(),\n            powerOn: true,\n        };\n    }\n}\n","import { Adb, AdbSubprocessNoneProtocol, AdbSubprocessProtocol, AdbSync } from '@yume-chan/adb';\nimport { DecodeUtf8Stream, InspectStream, ReadableStream, SplitStringStream, WrapWritableStream, WritableStream, type ReadableWritablePair } from '@yume-chan/stream-extra';\n\nimport { ScrcpyControlMessageSerializer } from '../control/index.js';\nimport { ScrcpyDeviceMessageDeserializeStream, type ScrcpyDeviceMessage } from '../device-message/index.js';\nimport { DEFAULT_SERVER_PATH, type ScrcpyVideoStreamPacket } from '../options/index.js';\nimport type { AdbScrcpyOptions } from './options/index.js';\n\nclass ArrayToStream<T> extends ReadableStream<T>{\n    private array!: T[];\n    private index = 0;\n\n    constructor(array: T[]) {\n        super({\n            start: async () => {\n                await Promise.resolve();\n                this.array = array;\n            },\n            pull: (controller) => {\n                if (this.index < this.array.length) {\n                    controller.enqueue(this.array[this.index]!);\n                    this.index += 1;\n                } else {\n                    controller.close();\n                }\n            },\n        });\n    }\n}\n\nclass ConcatStream<T> extends ReadableStream<T>{\n    private streams!: ReadableStream<T>[];\n    private index = 0;\n    private reader!: ReadableStreamDefaultReader<T>;\n\n    constructor(...streams: ReadableStream<T>[]) {\n        super({\n            start: async (controller) => {\n                await Promise.resolve();\n\n                this.streams = streams;\n                this.advance(controller);\n            },\n            pull: async (controller) => {\n                const result = await this.reader.read();\n                if (!result.done) {\n                    controller.enqueue(result.value);\n                    return;\n                }\n                this.advance(controller);\n            }\n        });\n    }\n\n    private advance(controller: ReadableStreamDefaultController<T>) {\n        if (this.index < this.streams.length) {\n            this.reader = this.streams[this.index]!.getReader();\n            this.index += 1;\n        } else {\n            controller.close();\n        }\n    }\n}\n\nexport class AdbScrcpyClient {\n    public static pushServer(\n        adb: Adb,\n        path = DEFAULT_SERVER_PATH,\n    ) {\n        let sync!: AdbSync;\n        return new WrapWritableStream<Uint8Array>({\n            async start() {\n                sync = await adb.sync();\n                return sync.write(path);\n            },\n            async close() {\n                await sync.dispose();\n            },\n        });\n    }\n\n    public static async start(\n        adb: Adb,\n        path: string,\n        version: string,\n        options: AdbScrcpyOptions<any>\n    ) {\n        const connection = options.createConnection(adb);\n        let process: AdbSubprocessProtocol | undefined;\n\n        try {\n            await connection.initialize();\n\n            process = await adb.subprocess.spawn(\n                [\n                    // cspell: disable-next-line\n                    `CLASSPATH=${path}`,\n                    'app_process',\n                    /* unused */ '/',\n                    'com.genymobile.scrcpy.Server',\n                    version,\n                    ...options.formatServerArguments(),\n                ],\n                {\n                    // Scrcpy server doesn't use stderr,\n                    // so disable Shell Protocol to simplify processing\n                    protocols: [AdbSubprocessNoneProtocol],\n                }\n            );\n\n            const stdout = process.stdout\n                .pipeThrough(new DecodeUtf8Stream())\n                .pipeThrough(new SplitStringStream('\\n'));\n\n            // Read stdout, otherwise `process.exit` won't resolve.\n            const output: string[] = [];\n            const abortController = new AbortController();\n            const pipe = stdout\n                .pipeTo(new WritableStream({\n                    write(chunk) {\n                        output.push(chunk);\n                    }\n                }), {\n                    signal: abortController.signal,\n                    preventCancel: true,\n                })\n                .catch(() => { });\n\n            const result = await Promise.race([\n                process.exit,\n                connection.getStreams(),\n            ]);\n\n            if (typeof result === 'number') {\n                const error = new Error('scrcpy server exited prematurely');\n                (error as any).output = output;\n                throw error;\n            }\n\n            abortController.abort();\n            await pipe;\n\n            const [videoStream, controlStream] = result;\n            return new AdbScrcpyClient(\n                options,\n                process,\n                new ConcatStream(\n                    new ArrayToStream(output),\n                    stdout,\n                ),\n                videoStream,\n                controlStream\n            );\n        } catch (e) {\n            await process?.kill();\n            throw e;\n        } finally {\n            connection.dispose();\n        }\n    }\n\n    /**\n     * This method will modify the given `options`,\n     * so don't reuse it elsewhere.\n     */\n    public static async getEncoders(\n        adb: Adb,\n        path: string,\n        version: string,\n        options: AdbScrcpyOptions<any>\n    ): Promise<string[]> {\n        // Provide an invalid encoder name\n        // So the server will return all available encoders\n        options.value.encoderName = '_';\n        // Disable control for faster connection in 1.22+\n        options.value.control = false;\n        options.value.sendDeviceMeta = false;\n        options.value.sendDummyByte = false;\n\n        // Scrcpy server will open connections, before initializing encoder\n        // Thus although an invalid encoder name is given, the start process will success\n        const client = await AdbScrcpyClient.start(\n            adb,\n            path,\n            version,\n            options\n        );\n\n        const encoderNameRegex = options.getOutputEncoderNameRegex();\n        const encoders: string[] = [];\n        await client.stdout.pipeTo(new WritableStream({\n            write(line) {\n                const match = line.match(encoderNameRegex);\n                if (match) {\n                    encoders.push(match[1]!);\n                }\n            },\n        }));\n\n        return encoders;\n    }\n\n    /**\n     * This method will modify the given `options`,\n     * so don't reuse it elsewhere.\n     */\n    public static async getDisplays(\n        adb: Adb,\n        path: string,\n        version: string,\n        options: AdbScrcpyOptions<any>\n    ): Promise<number[]> {\n        // Similar to `getEncoders`, pass an invalid option and parse the output\n        options.value.displayId = -1;\n\n        options.value.control = false;\n        options.value.sendDeviceMeta = false;\n        options.value.sendDummyByte = false;\n\n        try {\n            // Server will exit before opening connections when an invalid display id was given.\n            await AdbScrcpyClient.start(adb, path, version, options);\n        } catch (e) {\n            if (e instanceof Error) {\n                const output = (e as any).output as string[];\n\n                const displayIdRegex = /\\s+scrcpy --display (\\d+)/;\n                const displays: number[] = [];\n                for (const line of output) {\n                    const match = line.match(displayIdRegex);\n                    if (match) {\n                        displays.push(Number.parseInt(match[1]!, 10));\n                    }\n                }\n                return displays;\n            }\n        }\n\n        throw new Error('failed to get displays');\n    }\n\n    private process: AdbSubprocessProtocol;\n\n    private _stdout: ReadableStream<string>;\n    public get stdout() { return this._stdout; }\n\n    public get exit() { return this.process.exit; }\n\n    private _screenWidth: number | undefined;\n    public get screenWidth() { return this._screenWidth; }\n\n    private _screenHeight: number | undefined;\n    public get screenHeight() { return this._screenHeight; }\n\n    private _videoStream: ReadableStream<ScrcpyVideoStreamPacket>;\n    public get videoStream() { return this._videoStream; }\n\n    private _controlMessageSerializer: ScrcpyControlMessageSerializer | undefined;\n    public get controlMessageSerializer() { return this._controlMessageSerializer; }\n\n    private _deviceMessageStream: ReadableStream<ScrcpyDeviceMessage> | undefined;\n    public get deviceMessageStream() { return this._deviceMessageStream; }\n\n    public constructor(\n        options: AdbScrcpyOptions<any>,\n        process: AdbSubprocessProtocol,\n        stdout: ReadableStream<string>,\n        videoStream: ReadableStream<Uint8Array>,\n        controlStream: ReadableWritablePair<Uint8Array, Uint8Array> | undefined,\n    ) {\n        this.process = process;\n        this._stdout = stdout;\n\n        this._videoStream = videoStream\n            .pipeThrough(options.createVideoStreamTransformer())\n            .pipeThrough(new InspectStream(packet => {\n                if (packet.type === 'configuration') {\n                    this._screenWidth = packet.data.croppedWidth;\n                    this._screenHeight = packet.data.croppedHeight;\n                }\n            }));\n\n        if (controlStream) {\n            this._controlMessageSerializer = new ScrcpyControlMessageSerializer(controlStream.writable, options);\n            this._deviceMessageStream = controlStream.readable.pipeThrough(new ScrcpyDeviceMessageDeserializeStream());\n        }\n    }\n\n    public async close() {\n        await this.process.kill();\n    }\n}\n","// From https://developer.android.com/reference/android/media/MediaCodecInfo.CodecProfileLevel\nexport enum AndroidCodecProfile {\n    Baseline = 0x01,\n    Main = 0x02,\n    Extended = 0x04,\n    High = 0x08,\n    High10 = 0x10,\n    High422 = 0x20,\n    High444 = 0x40,\n    ConstrainedBaseline = 0x10000,\n    ConstrainedHigh = 0x80000,\n}\n\nexport enum AndroidCodecLevel {\n    Level1 = 0x01,\n    Level1b = 0x02,\n    Level11 = 0x04,\n    Level12 = 0x08,\n    Level13 = 0x10,\n    Level2 = 0x20,\n    Level21 = 0x40,\n    Level22 = 0x80,\n    Level3 = 0x100,\n    Level31 = 0x200,\n    Level32 = 0x400,\n    Level4 = 0x800,\n    Level41 = 0x1000,\n    Level42 = 0x2000,\n    Level5 = 0x4000,\n    Level51 = 0x8000,\n    Level52 = 0x10000,\n    Level6 = 0x20000,\n    Level61 = 0x40000,\n    Level62 = 0x80000,\n}\n","import { PromiseResolver } from '@yume-chan/async';\nimport { AutoDisposable, Disposable, EventEmitter } from '@yume-chan/event';\n\nlet worker: Worker | undefined;\nlet workerReady = false;\nconst pendingResolvers: PromiseResolver<TinyH264Wrapper>[] = [];\nlet streamId = 0;\n\nexport interface PictureReadyEventArgs {\n    renderStateId: number;\n\n    width: number;\n\n    height: number;\n\n    data: ArrayBuffer;\n}\n\nconst PICTURE_READY_SUBSCRIPTIONS = new Map<number, (e: PictureReadyEventArgs) => void>();\n\nfunction subscribePictureReady(streamId: number, handler: (e: PictureReadyEventArgs) => void): Disposable {\n    PICTURE_READY_SUBSCRIPTIONS.set(streamId, handler);\n\n    return {\n        dispose() {\n            PICTURE_READY_SUBSCRIPTIONS.delete(streamId);\n        }\n    };\n}\n\nexport class TinyH264Wrapper extends AutoDisposable {\n    public readonly streamId: number;\n\n    private readonly pictureReadyEvent = new EventEmitter<PictureReadyEventArgs>();\n    public get onPictureReady() { return this.pictureReadyEvent.event; }\n\n    public constructor(streamId: number) {\n        super();\n\n        this.streamId = streamId;\n        this.addDisposable(subscribePictureReady(streamId, this.handlePictureReady));\n    }\n\n    private handlePictureReady = (e: PictureReadyEventArgs) => {\n        this.pictureReadyEvent.fire(e);\n    };\n\n    public feed(data: ArrayBuffer) {\n        worker!.postMessage({\n            type: 'decode',\n            data: data,\n            offset: 0,\n            length: data.byteLength,\n            renderStateId: this.streamId,\n        }, [data]);\n    }\n\n    public override dispose() {\n        super.dispose();\n        worker!.postMessage({\n            type: 'release',\n            renderStateId: this.streamId,\n        });\n    }\n}\n\nexport function createTinyH264Wrapper(): Promise<TinyH264Wrapper> {\n    if (!worker) {\n        worker = new Worker(new URL('./worker.js', import.meta.url));\n        worker.addEventListener('message', (e) => {\n            const { data } = e;\n            switch (data.type) {\n                case 'decoderReady':\n                    workerReady = true;\n                    for (const resolver of pendingResolvers) {\n                        resolver.resolve(new TinyH264Wrapper(streamId));\n                        streamId += 1;\n                    }\n                    pendingResolvers.length = 0;\n                    break;\n                case 'pictureReady':\n                    PICTURE_READY_SUBSCRIPTIONS.get(data.renderStateId)?.(data);\n                    break;\n            }\n        });\n    }\n\n    if (!workerReady) {\n        const resolver = new PromiseResolver<TinyH264Wrapper>();\n        pendingResolvers.push(resolver);\n        return resolver.promise;\n    }\n\n    const decoder = new TinyH264Wrapper(streamId);\n    streamId += 1;\n    return Promise.resolve(decoder);\n}\n","import { PromiseResolver } from '@yume-chan/async';\nimport { WritableStream } from '@yume-chan/stream-extra';\n\nimport { AndroidCodecLevel, AndroidCodecProfile } from '../../codec.js';\nimport type { ScrcpyVideoStreamPacket } from '../../options/index.js';\nimport type { H264Configuration, H264Decoder } from '../types.js';\nimport { createTinyH264Wrapper, type TinyH264Wrapper } from './wrapper.js';\n\nlet cachedInitializePromise: Promise<{ YuvBuffer: typeof import('yuv-buffer'), YuvCanvas: typeof import('yuv-canvas').default; }> | undefined;\nfunction initialize() {\n    if (!cachedInitializePromise) {\n        cachedInitializePromise = Promise.all(\n            [import('yuv-buffer'), import('yuv-canvas')]\n        ).then(([YuvBuffer, { default: YuvCanvas }]) => ({\n            YuvBuffer, YuvCanvas\n        }));\n    }\n\n    return cachedInitializePromise;\n}\n\nexport class TinyH264Decoder implements H264Decoder {\n    public readonly maxProfile = AndroidCodecProfile.Baseline;\n\n    public readonly maxLevel = AndroidCodecLevel.Level4;\n\n    private _renderer: HTMLCanvasElement;\n    public get renderer() { return this._renderer; }\n\n    private _frameRendered = 0;\n    public get frameRendered() { return this._frameRendered; }\n\n    private _writable: WritableStream<ScrcpyVideoStreamPacket>;\n    public get writable() { return this._writable; }\n\n    private _yuvCanvas: import('yuv-canvas').default | undefined;\n    private _initializer: PromiseResolver<TinyH264Wrapper> | undefined;\n\n    public constructor() {\n        initialize();\n\n        this._renderer = document.createElement('canvas');\n\n        this._writable = new WritableStream<ScrcpyVideoStreamPacket>({\n            write: async (packet) => {\n                switch (packet.type) {\n                    case 'configuration':\n                        this.configure(packet.data);\n                        break;\n                    case 'frame':\n                        if (!this._initializer) {\n                            throw new Error('Decoder not initialized');\n                        }\n\n                        const wrapper = await this._initializer.promise;\n                        wrapper.feed(packet.data.slice().buffer);\n                        break;\n                }\n            }\n        });\n    }\n\n    private async configure(config: H264Configuration) {\n        this.dispose();\n\n        this._initializer = new PromiseResolver<TinyH264Wrapper>();\n        const { YuvBuffer, YuvCanvas } = await initialize();\n\n        if (!this._yuvCanvas) {\n            this._yuvCanvas = YuvCanvas.attach(this._renderer);;\n        }\n\n        const { encodedWidth, encodedHeight } = config;\n        const chromaWidth = encodedWidth / 2;\n        const chromaHeight = encodedHeight / 2;\n\n        this._renderer.width = config.croppedWidth;\n        this._renderer.height = config.croppedHeight;\n        const format = YuvBuffer.format({\n            width: encodedWidth,\n            height: encodedHeight,\n            chromaWidth,\n            chromaHeight,\n            cropLeft: config.cropLeft,\n            cropTop: config.cropTop,\n            cropWidth: config.croppedWidth,\n            cropHeight: config.croppedHeight,\n            displayWidth: config.croppedWidth,\n            displayHeight: config.croppedHeight,\n        });\n\n        const wrapper = await createTinyH264Wrapper();\n        this._initializer.resolve(wrapper);\n\n        const uPlaneOffset = encodedWidth * encodedHeight;\n        const vPlaneOffset = uPlaneOffset + chromaWidth * chromaHeight;\n        wrapper.onPictureReady(({ data }) => {\n            this._frameRendered += 1;\n            const array = new Uint8Array(data);\n            const frame = YuvBuffer.frame(format,\n                YuvBuffer.lumaPlane(format, array, encodedWidth, 0),\n                YuvBuffer.chromaPlane(format, array, chromaWidth, uPlaneOffset),\n                YuvBuffer.chromaPlane(format, array, chromaWidth, vPlaneOffset)\n            );\n            this._yuvCanvas!.drawFrame(frame);\n        });\n    }\n\n    public dispose(): void {\n        this._initializer?.promise.then(wrapper => wrapper.dispose());\n        this._initializer = undefined;\n    }\n}\n","import { WritableStream } from '@yume-chan/stream-extra';\n\nimport type { ScrcpyVideoStreamPacket } from '../../options/index.js';\nimport type { H264Configuration, H264Decoder } from '../types.js';\n\nfunction toHex(value: number) {\n    return value.toString(16).padStart(2, '0').toUpperCase();\n}\n\nexport class WebCodecsDecoder implements H264Decoder {\n    // Usually, browsers can decode most configurations,\n    // So let device choose best profile and level for itself.\n    public readonly maxProfile = undefined;\n    public readonly maxLevel = undefined;\n\n    private _writable: WritableStream<ScrcpyVideoStreamPacket>;\n    public get writable() { return this._writable; }\n\n    private _renderer: HTMLCanvasElement;\n    public get renderer() { return this._renderer; }\n\n    private _frameRendered = 0;\n    public get frameRendered() { return this._frameRendered; }\n\n    private context: CanvasRenderingContext2D;\n    private decoder: VideoDecoder;\n\n    // Limit FPS to system refresh rate\n    private lastFrame: VideoFrame | undefined;\n    private animationFrame: number = 0;\n\n    public constructor() {\n        this._renderer = document.createElement('canvas');\n\n        this.context = this._renderer.getContext('2d')!;\n        this.decoder = new VideoDecoder({\n            output: (frame) => {\n                if (this.lastFrame) {\n                    this.lastFrame.close();\n                }\n                this.lastFrame = frame;\n\n                if (!this.animationFrame) {\n                    // Start render loop on first frame\n                    this.render();\n                }\n            },\n            error() { },\n        });\n\n        this._writable = new WritableStream<ScrcpyVideoStreamPacket>({\n            write: async (packet) => {\n                switch (packet.type) {\n                    case 'configuration':\n                        this.configure(packet.data);\n                        break;\n                    case 'frame':\n                        this.decoder.decode(new EncodedVideoChunk({\n                            // Treat `undefined` as `key`, otherwise won't decode.\n                            type: packet.keyframe === false ? 'delta' : 'key',\n                            timestamp: 0,\n                            data: packet.data,\n                        }));\n                        break;\n                }\n            }\n        });\n    }\n\n    private render = () => {\n        if (this.lastFrame) {\n            this._frameRendered += 1;\n            this.context.drawImage(this.lastFrame, 0, 0);\n            this.lastFrame.close();\n            this.lastFrame = undefined;\n        }\n\n        this.animationFrame = requestAnimationFrame(this.render);\n    };\n\n    private configure(config: H264Configuration) {\n        const { profileIndex, constraintSet, levelIndex } = config;\n\n        this._renderer.width = config.croppedWidth;\n        this._renderer.height = config.croppedHeight;\n\n        // https://www.rfc-editor.org/rfc/rfc6381#section-3.3\n        // ISO Base Media File Format Name Space\n        const codec = `avc1.${[profileIndex, constraintSet, levelIndex].map(toHex).join('')}`;\n        this.decoder.configure({\n            codec: codec,\n            optimizeForLatency: true,\n        });\n    }\n\n    public dispose() {\n        cancelAnimationFrame(this.animationFrame);\n        this.decoder.close();\n    }\n}\n","export default '1.24';","import { CommandBar, Dialog, Dropdown, ICommandBarItemProps, Icon, IconButton, IDropdownOption, LayerHost, Position, ProgressIndicator, SpinButton, Stack, TextField, Toggle, TooltipHost } from \"@fluentui/react\";\nimport { useId } from \"@fluentui/react-hooks\";\nimport { makeStyles } from \"@griffel/react\";\nimport { action, autorun, makeAutoObservable, observable, runInAction } from \"mobx\";\nimport { observer } from \"mobx-react-lite\";\nimport { NextPage } from \"next\";\nimport Head from \"next/head\";\nimport { CSSProperties, ReactNode, useEffect, useState } from \"react\";\n\nimport { ADB_SYNC_MAX_PACKET_SIZE } from '@yume-chan/adb';\nimport { EventEmitter } from \"@yume-chan/event\";\nimport { AdbScrcpyClient, AdbScrcpyOptions1_22, AndroidKeyCode, AndroidKeyEventAction, AndroidMotionEventAction, CodecOptions, DEFAULT_SERVER_PATH, ScrcpyDeviceMessageType, ScrcpyLogLevel, ScrcpyOptions1_24, ScrcpyVideoOrientation, TinyH264Decoder, WebCodecsDecoder, type H264Decoder, type H264DecoderConstructor, type ScrcpyVideoStreamPacket } from \"@yume-chan/scrcpy\";\nimport SCRCPY_SERVER_VERSION from '@yume-chan/scrcpy/bin/version';\nimport { ChunkStream, InspectStream, ReadableStream, WritableStream } from '@yume-chan/stream-extra';\n\nimport { DemoModePanel, DeviceView, DeviceViewRef, ExternalLink } from \"../components\";\nimport { GlobalState } from \"../state\";\nimport { CommonStackTokens, formatSpeed, Icons, ProgressStream, RouteStackProps } from \"../utils\";\n\nconst SERVER_URL = new URL('@yume-chan/scrcpy/bin/scrcpy-server?url', import.meta.url);\n\nclass FetchWithProgress {\n    public readonly promise: Promise<Uint8Array>;\n\n    private _downloaded = 0;\n    public get downloaded() { return this._downloaded; }\n\n    private _total = 0;\n    public get total() { return this._total; }\n\n    private progressEvent = new EventEmitter<[download: number, total: number]>();\n    public get onProgress() { return this.progressEvent.event; }\n\n    public constructor(url: string | URL) {\n        this.promise = this.fetch(url);\n    }\n\n    private async fetch(url: string | URL) {\n        const response = await window.fetch(url);\n        this._total = Number.parseInt(response.headers.get('Content-Length') ?? '0', 10);\n        this.progressEvent.fire([this._downloaded, this._total]);\n\n        const reader = response.body!.getReader();\n        const chunks: Uint8Array[] = [];\n        while (true) {\n            const result = await reader.read();\n            if (result.done) {\n                break;\n            }\n            chunks.push(result.value);\n            this._downloaded += result.value.byteLength;\n            this.progressEvent.fire([this._downloaded, this._total]);\n        }\n\n        this._total = chunks.reduce((result, item) => result + item.byteLength, 0);\n        const result = new Uint8Array(this._total);\n        let position = 0;\n        for (const chunk of chunks) {\n            result.set(chunk, position);\n            position += chunk.byteLength;\n        }\n        return result;\n    }\n}\n\nlet cachedValue: FetchWithProgress | undefined;\nfunction fetchServer(onProgress?: (e: [downloaded: number, total: number]) => void) {\n    if (!cachedValue) {\n        cachedValue = new FetchWithProgress(SERVER_URL);\n        cachedValue.promise.catch((e) => {\n            cachedValue = undefined;\n        });\n    }\n\n    if (onProgress) {\n        cachedValue.onProgress(onProgress);\n        onProgress([cachedValue.downloaded, cachedValue.total]);\n    }\n\n    return cachedValue.promise;\n}\n\nfunction clamp(value: number, min: number, max: number): number {\n    if (value < min) {\n        return min;\n    }\n\n    if (value > max) {\n        return max;\n    }\n\n    return value;\n}\n\ninterface DecoderDefinition {\n    key: string;\n    name: string;\n    Constructor: H264DecoderConstructor;\n}\n\ninterface Settings {\n    maxSize: number;\n    bitRate: number;\n    tunnelForward?: boolean;\n    encoderName?: string;\n    decoder?: string;\n    ignoreDecoderCodecArgs?: boolean;\n    lockVideoOrientation?: ScrcpyVideoOrientation;\n    displayId?: number;\n    crop: string;\n}\n\ninterface SettingDefinitionBase {\n    key: keyof Settings;\n    type: string;\n    label: string;\n    labelExtra?: JSX.Element;\n    description?: string;\n}\n\ninterface TextSettingDefinition extends SettingDefinitionBase {\n    type: 'text';\n    placeholder?: string;\n}\n\ninterface DropdownSettingDefinition extends SettingDefinitionBase {\n    type: 'dropdown';\n    placeholder?: string;\n    options: IDropdownOption[];\n}\n\ninterface ToggleSettingDefinition extends SettingDefinitionBase {\n    type: 'toggle',\n}\n\ninterface NumberSettingDefinition extends SettingDefinitionBase {\n    type: 'number',\n    min?: number;\n    max?: number;\n    step?: number;\n}\n\ntype SettingDefinition =\n    TextSettingDefinition |\n    DropdownSettingDefinition |\n    ToggleSettingDefinition |\n    NumberSettingDefinition;\n\ninterface SettingItemProps {\n    definition: SettingDefinition;\n    settings: any;\n    onChange: (key: keyof Settings, value: any) => void;\n}\n\nconst useClasses = makeStyles({\n    labelRight: {\n        marginLeft: '4px',\n    },\n    video: {\n        transformOrigin: 'center center',\n    },\n});\n\nconst SettingItem = observer(function SettingItem({\n    definition,\n    settings,\n    onChange,\n}: SettingItemProps) {\n    const classes = useClasses();\n\n    let label: JSX.Element = (\n        <Stack horizontal verticalAlign=\"center\">\n            <span>{definition.label}</span>\n            {!!definition.description && (\n                <TooltipHost content={definition.description}>\n                    <Icon className={classes.labelRight} iconName={Icons.Info} />\n                </TooltipHost>\n            )}\n            {definition.labelExtra}\n        </Stack>\n    );\n\n    switch (definition.type) {\n        case 'text':\n            return (\n                <TextField\n                    label={label as any}\n                    placeholder={definition.placeholder}\n                    value={settings[definition.key]}\n                    onChange={(e, value) => onChange(definition.key, value)}\n                />\n            );\n        case 'dropdown':\n            return (\n                <Dropdown\n                    label={label as any}\n                    options={definition.options}\n                    placeholder={definition.placeholder}\n                    selectedKey={settings[definition.key]}\n                    onChange={(e, option) => onChange(definition.key, option!.key)}\n                />\n            );\n        case 'toggle':\n            return (\n                <Toggle\n                    label={label}\n                    checked={settings[definition.key]}\n                    onChange={(e, checked) => onChange(definition.key, checked)}\n                />\n            );\n        case 'number':\n            return (\n                <SpinButton\n                    label={definition.label}\n                    labelPosition={Position.top}\n                    min={definition.min}\n                    max={definition.max}\n                    step={definition.step}\n                    value={settings[definition.key].toString()}\n                    onChange={(e, value) => onChange(definition.key, Number.parseInt(value!, 10))}\n                />\n            );\n    }\n});\n\nclass ScrcpyPageState {\n    running = false;\n\n    deviceView: DeviceViewRef | null = null;\n    rendererContainer: HTMLDivElement | null = null;\n\n    logVisible = false;\n    log: string[] = [];\n    settingsVisible = false;\n    demoModeVisible = false;\n    navigationBarVisible = true;\n\n    width = 0;\n    height = 0;\n    rotate = 0;\n\n    get rotatedWidth() { return state.rotate & 1 ? state.height : state.width; }\n    get rotatedHeight() { return state.rotate & 1 ? state.width : state.height; }\n\n    client: AdbScrcpyClient | undefined = undefined;\n\n    async pushServer() {\n        const serverBuffer = await fetchServer();\n\n        await new ReadableStream<Uint8Array>({\n            start(controller) {\n                controller.enqueue(serverBuffer);\n                controller.close();\n            },\n        })\n            .pipeTo(AdbScrcpyClient.pushServer(GlobalState.device!));\n    }\n\n    encoders: string[] = [];\n    updateEncoders = async () => {\n        try {\n            await this.pushServer();\n\n            const encoders = await AdbScrcpyClient.getEncoders(\n                GlobalState.device!,\n                DEFAULT_SERVER_PATH,\n                SCRCPY_SERVER_VERSION,\n                new AdbScrcpyOptions1_22(new ScrcpyOptions1_24({\n                    logLevel: ScrcpyLogLevel.Debug,\n                    tunnelForward: this.settings.tunnelForward,\n                }))\n            );\n\n            runInAction(() => {\n                this.encoders = encoders;\n                if (!this.settings.encoderName ||\n                    !this.encoders.includes(this.settings.encoderName)) {\n                    this.settings.encoderName = this.encoders[0];\n                }\n            });\n        } catch (e: any) {\n            GlobalState.showErrorDialog(e);\n        }\n    };\n\n    decoders: DecoderDefinition[] = [{\n        key: 'tinyh264',\n        name: 'TinyH264 (Software)',\n        Constructor: TinyH264Decoder,\n    }];\n    decoder: H264Decoder | undefined = undefined;\n    fpsCounterIntervalId: any = undefined;\n    fps = 0;\n\n    displays: number[] = [];\n    updateDisplays = async () => {\n        try {\n            await this.pushServer();\n\n            const displays = await AdbScrcpyClient.getDisplays(\n                GlobalState.device!,\n                DEFAULT_SERVER_PATH,\n                SCRCPY_SERVER_VERSION,\n                new AdbScrcpyOptions1_22(new ScrcpyOptions1_24({\n                    logLevel: ScrcpyLogLevel.Debug,\n                    tunnelForward: this.settings.tunnelForward,\n                }))\n            );\n\n            runInAction(() => {\n                this.displays = displays;\n                if (!this.settings.displayId ||\n                    !this.displays.includes(this.settings.displayId)) {\n                    this.settings.displayId = this.displays[0];\n                }\n            });\n        } catch (e: any) {\n            GlobalState.showErrorDialog(e);\n        }\n    };\n\n    connecting = false;\n    serverTotalSize = 0;\n    serverDownloadedSize = 0;\n    debouncedServerDownloadedSize = 0;\n    serverDownloadSpeed = 0;\n    serverUploadedSize = 0;\n    debouncedServerUploadedSize = 0;\n    serverUploadSpeed = 0;\n\n    get commandBarItems() {\n        const result: ICommandBarItemProps[] = [];\n\n        if (!this.running) {\n            result.push({\n                key: 'start',\n                disabled: !GlobalState.device,\n                iconProps: { iconName: Icons.Play },\n                text: 'Start',\n                onClick: this.start as VoidFunction,\n            });\n        } else {\n            result.push({\n                key: 'stop',\n                iconProps: { iconName: Icons.Stop },\n                text: 'Stop',\n                onClick: this.stop as VoidFunction,\n            });\n        }\n\n        result.push({\n            key: 'fullscreen',\n            disabled: !this.running,\n            iconProps: { iconName: Icons.FullScreenMaximize },\n            iconOnly: true,\n            text: 'Fullscreen',\n            onClick: () => { this.deviceView?.enterFullscreen(); },\n        });\n\n        result.push({\n            key: 'rotateDevice',\n            disabled: !this.running,\n            iconProps: { iconName: Icons.Orientation },\n            iconOnly: true,\n            text: 'Rotate Device',\n            onClick: () => { this.client!.controlMessageSerializer!.rotateDevice(); },\n        });\n\n        result.push({\n            key: 'rotateVideoLeft',\n            disabled: !this.running,\n            iconProps: { iconName: Icons.RotateLeft },\n            iconOnly: true,\n            text: 'Rotate Video Left',\n            onClick: () => {\n                this.rotate -= 1;\n                if (this.rotate < 0) {\n                    this.rotate = 3;\n                }\n            }\n        });\n\n        result.push({\n            key: 'rotateVideoRight',\n            disabled: !this.running,\n            iconProps: { iconName: Icons.RotateRight },\n            iconOnly: true,\n            text: 'Rotate Video Right',\n            onClick: () => {\n                this.rotate = (this.rotate + 1) & 3;\n            },\n        });\n\n        if (this.running) {\n            result.push({\n                key: 'fps',\n                text: `FPS: ${this.fps}`,\n                disabled: true,\n            });\n        }\n\n        return result;\n    }\n\n    get commandBarFarItems(): ICommandBarItemProps[] {\n        return [\n            {\n                key: 'NavigationBar',\n                iconProps: { iconName: Icons.PanelBottom },\n                checked: this.navigationBarVisible,\n                text: 'Navigation Bar',\n                iconOnly: true,\n                onClick: action(() => {\n                    this.navigationBarVisible = !this.navigationBarVisible;\n                }),\n            },\n            {\n                key: 'Log',\n                iconProps: { iconName: Icons.TextGrammarError },\n                checked: this.logVisible,\n                text: 'Log',\n                iconOnly: true,\n                onClick: action(() => {\n                    this.logVisible = !this.logVisible;\n                }),\n            },\n            {\n                key: 'Settings',\n                iconProps: { iconName: Icons.Settings },\n                checked: this.settingsVisible,\n                text: 'Settings',\n                iconOnly: true,\n                onClick: action(() => {\n                    this.settingsVisible = !this.settingsVisible;\n                }),\n            },\n            {\n                key: 'DemoMode',\n                iconProps: { iconName: Icons.Wand },\n                checked: this.demoModeVisible,\n                text: 'Demo Mode',\n                iconOnly: true,\n                onClick: action(() => {\n                    this.demoModeVisible = !this.demoModeVisible;\n                }),\n            },\n            {\n                key: 'info',\n                iconProps: { iconName: Icons.Info },\n                iconOnly: true,\n                tooltipHostProps: {\n                    content: (\n                        <>\n                            <p>\n                                <ExternalLink href=\"https://github.com/Genymobile/scrcpy\" spaceAfter>Scrcpy</ExternalLink>\n                                developed by Genymobile can display the screen with low latency (1~2 frames) and control the device, all without root access.\n                            </p>\n                            <p>\n                                This is a TypeScript implementation of the client part. Paired with official pre-built server binary.\n                            </p>\n                        </>\n                    ),\n                    calloutProps: {\n                        calloutMaxWidth: 300,\n                    }\n                },\n            }\n        ];\n    }\n\n    settings: Settings = {\n        maxSize: 1080,\n        bitRate: 4_000_000,\n        lockVideoOrientation: ScrcpyVideoOrientation.Unlocked,\n        displayId: 0,\n        crop: '',\n    };\n\n    get settingDefinitions() {\n        const result: SettingDefinition[] = [];\n\n        result.push({\n            key: 'encoderName',\n            type: 'dropdown',\n            label: 'Encoder',\n            placeholder: 'Press refresh to update available encoders',\n            labelExtra: (\n                <IconButton\n                    iconProps={{ iconName: Icons.ArrowClockwise }}\n                    disabled={!GlobalState.device}\n                    text=\"Refresh\"\n                    onClick={this.updateEncoders}\n                />\n            ),\n            options: this.encoders.map(item => ({\n                key: item,\n                text: item,\n            })),\n        });\n\n        if (this.decoders.length > 1) {\n            result.push({\n                key: 'decoder',\n                type: 'dropdown',\n                label: 'Decoder',\n                options: this.decoders.map(item => ({\n                    key: item.key,\n                    text: item.name,\n                    data: item,\n                })),\n            });\n        }\n\n        result.push({\n            key: 'ignoreDecoderCodecArgs',\n            type: 'toggle',\n            label: `Ignore decoder's codec arguments`,\n            description: `Some decoders don't support all H.264 profile/levels, so they request the device to encode at their highest-supported codec. However, some super old devices may not support that codec so their encoders will fail to start. Use this option to let device choose the codec to be used.`,\n        });\n\n        result.push({\n            key: 'maxSize',\n            type: 'number',\n            label: 'Max Resolution (longer side, 0 = unlimited)',\n            min: 0,\n            max: 2560,\n            step: 50,\n        });\n\n        result.push({\n            key: 'bitRate',\n            type: 'number',\n            label: 'Max Bit Rate',\n            min: 100,\n            max: 100_000_000,\n            step: 100,\n        });\n\n        result.push({\n            key: 'tunnelForward',\n            type: 'toggle',\n            label: 'Use forward connection',\n            description: 'Android before version 9 has a bug that prevents reverse tunneling when using ADB over WiFi.'\n        });\n\n        result.push({\n            key: 'lockVideoOrientation',\n            type: 'dropdown',\n            label: 'Lock Video Orientation',\n            options: [\n                {\n                    key: ScrcpyVideoOrientation.Unlocked,\n                    text: 'Unlocked',\n                },\n                {\n                    key: ScrcpyVideoOrientation.Initial,\n                    text: 'Current',\n                },\n                {\n                    key: ScrcpyVideoOrientation.Portrait,\n                    text: 'Portrait',\n                },\n                {\n                    key: ScrcpyVideoOrientation.Landscape,\n                    text: 'Landscape',\n                },\n                {\n                    key: ScrcpyVideoOrientation.PortraitFlipped,\n                    text: 'Portrait (Flipped)',\n                },\n                {\n                    key: ScrcpyVideoOrientation.LandscapeFlipped,\n                    text: 'Landscape (Flipped)',\n                },\n            ],\n        });\n\n        result.push({\n            key: 'displayId',\n            type: 'dropdown',\n            label: 'Display',\n            placeholder: 'Press refresh to update available displays',\n            labelExtra: (\n                <IconButton\n                    iconProps={{ iconName: Icons.ArrowClockwise }}\n                    disabled={!GlobalState.device}\n                    text=\"Refresh\"\n                    onClick={this.updateDisplays}\n                />\n            ),\n            options: this.displays.map(item => ({\n                key: item,\n                text: item.toString(),\n            })),\n        });\n\n        result.push({\n            key: 'crop',\n            type: 'text',\n            label: 'Crop',\n            placeholder: 'W:H:X:Y',\n        });\n\n        return result;\n    }\n\n    constructor() {\n        makeAutoObservable(this, {\n            decoders: observable.shallow,\n            settings: observable.deep,\n            start: false,\n            stop: action.bound,\n            dispose: action.bound,\n            handleDeviceViewRef: action.bound,\n            handleRendererContainerRef: action.bound,\n            handleBackPointerDown: false,\n            handleBackPointerUp: false,\n            handleHomePointerDown: false,\n            handleHomePointerUp: false,\n            handleAppSwitchPointerDown: false,\n            handleAppSwitchPointerUp: false,\n            calculatePointerPosition: false,\n            injectTouch: false,\n            handlePointerDown: false,\n            handlePointerMove: false,\n            handlePointerUp: false,\n            handleWheel: false,\n            handleContextMenu: false,\n            handleKeyDown: false,\n        });\n\n        autorun(() => {\n            if (GlobalState.device) {\n                runInAction(() => {\n                    this.encoders = [];\n                    this.settings.encoderName = undefined;\n\n                    this.displays = [];\n                    this.settings.displayId = undefined;\n                });\n            } else {\n                this.dispose();\n            }\n        });\n\n        autorun(() => {\n            if (this.rendererContainer && this.decoder) {\n                while (this.rendererContainer.firstChild) {\n                    this.rendererContainer.firstChild.remove();\n                }\n                this.rendererContainer.appendChild(this.decoder.renderer);\n            }\n        });\n\n        autorun(() => {\n            this.settings.decoder = this.decoders[0].key;\n        });\n\n        if (typeof window !== 'undefined' && typeof window.VideoDecoder === 'function') {\n            setTimeout(action(() => {\n                this.decoders.unshift({\n                    key: 'webcodecs',\n                    name: 'WebCodecs',\n                    Constructor: WebCodecsDecoder,\n                });\n            }), 0);\n        }\n    }\n\n    start = async () => {\n        if (!GlobalState.device) {\n            return;\n        }\n\n        try {\n            if (!this.settings.decoder) {\n                throw new Error('No available decoder');\n            }\n\n            runInAction(() => {\n                this.serverTotalSize = 0;\n                this.serverDownloadedSize = 0;\n                this.debouncedServerDownloadedSize = 0;\n                this.serverUploadedSize = 0;\n                this.debouncedServerUploadedSize = 0;\n                this.connecting = true;\n            });\n\n            let intervalId = setInterval(action(() => {\n                this.serverDownloadSpeed = this.serverDownloadedSize - this.debouncedServerDownloadedSize;\n                this.debouncedServerDownloadedSize = this.serverDownloadedSize;\n            }), 1000);\n\n            let serverBuffer: Uint8Array;\n\n            try {\n                serverBuffer = await fetchServer(action(([downloaded, total]) => {\n                    this.serverDownloadedSize = downloaded;\n                    this.serverTotalSize = total;\n                }));\n                runInAction(() => {\n                    this.serverDownloadSpeed = this.serverDownloadedSize - this.debouncedServerDownloadedSize;\n                    this.debouncedServerDownloadedSize = this.serverDownloadedSize;\n                });\n            } finally {\n                clearInterval(intervalId);\n            }\n\n            intervalId = setInterval(action(() => {\n                this.serverUploadSpeed = this.serverUploadedSize - this.debouncedServerUploadedSize;\n                this.debouncedServerUploadedSize = this.serverUploadedSize;\n            }), 1000);\n\n            try {\n                await new ReadableStream<Uint8Array>({\n                    start(controller) {\n                        controller.enqueue(serverBuffer);\n                        controller.close();\n                    },\n                })\n                    .pipeThrough(new ChunkStream(ADB_SYNC_MAX_PACKET_SIZE))\n                    .pipeThrough(new ProgressStream(action((progress) => {\n                        this.serverUploadedSize = progress;\n                    })))\n                    .pipeTo(AdbScrcpyClient.pushServer(GlobalState.device!));\n\n                runInAction(() => {\n                    this.serverUploadSpeed = this.serverUploadedSize - this.debouncedServerUploadedSize;\n                    this.debouncedServerUploadedSize = this.serverUploadedSize;\n                });\n            } finally {\n                clearInterval(intervalId);\n            }\n\n            const decoderDefinition = this.decoders.find(x => x.key === this.settings.decoder) ?? this.decoders[0];\n            const decoder = new decoderDefinition.Constructor();\n\n            runInAction(() => {\n                this.decoder = decoder;\n\n                let lastFrameCount = 0;\n                this.fpsCounterIntervalId = setInterval(action(() => {\n                    this.fps = decoder.frameRendered - lastFrameCount;\n                    lastFrameCount = decoder.frameRendered;\n                }), 1000);\n            });\n\n            const options = new AdbScrcpyOptions1_22(new ScrcpyOptions1_24({\n                logLevel: ScrcpyLogLevel.Debug,\n                ...this.settings,\n                sendDeviceMeta: false,\n                sendDummyByte: false,\n                codecOptions: !this.settings.ignoreDecoderCodecArgs\n                    ? new CodecOptions({\n                        profile: decoder.maxProfile,\n                        level: decoder.maxLevel,\n                    })\n                    : undefined,\n            }));\n\n            runInAction(() => {\n                this.log = [];\n                this.log.push(`[client] Server version: ${SCRCPY_SERVER_VERSION}`);\n                this.log.push(`[client] Server arguments: ${options.formatServerArguments().join(' ')}`);\n            });\n\n            const client = await AdbScrcpyClient.start(\n                GlobalState.device!,\n                DEFAULT_SERVER_PATH,\n                SCRCPY_SERVER_VERSION,\n                options\n            );\n\n            client.stdout.pipeTo(new WritableStream<string>({\n                write: action((line) => {\n                    this.log.push(line);\n                }),\n            }));\n\n            client.videoStream\n                .pipeThrough(new InspectStream(action((packet: ScrcpyVideoStreamPacket) => {\n                    if (packet.type === 'configuration') {\n                        const { croppedWidth, croppedHeight, } = packet.data;\n                        this.log.push(`[client] Video size changed: ${croppedWidth}x${croppedHeight}`);\n\n                        this.width = croppedWidth;\n                        this.height = croppedHeight;\n                    }\n                })))\n                .pipeTo(decoder.writable)\n                .catch(() => { });\n\n            client.exit.then(this.dispose);\n\n            client.deviceMessageStream!.pipeTo(new WritableStream({\n                write(message) {\n                    switch (message.type) {\n                        case ScrcpyDeviceMessageType.Clipboard:\n                            window.navigator.clipboard.writeText(message.content);\n                            break;\n                    }\n                }\n            })).catch(() => { });\n\n            runInAction(() => {\n                this.client = client;\n                this.running = true;\n            });\n        } catch (e: any) {\n            GlobalState.showErrorDialog(e);\n        } finally {\n            runInAction(() => {\n                this.connecting = false;\n            });\n        }\n    };\n\n    async stop() {\n        // Request to close client first\n        await this.client?.close();\n        this.dispose();\n    }\n\n    dispose() {\n        // Otherwise some packets may still arrive at decoder\n        this.decoder?.dispose();\n        this.decoder = undefined;\n\n        this.fps = 0;\n        clearTimeout(this.fpsCounterIntervalId);\n\n        this.client = undefined;\n        this.running = false;\n    }\n\n    handleDeviceViewRef(element: DeviceViewRef | null) {\n        this.deviceView = element;\n    }\n\n    handleRendererContainerRef(element: HTMLDivElement | null) {\n        this.rendererContainer = element;\n        this.rendererContainer?.addEventListener('wheel', this.handleWheel, { passive: false });\n    };\n\n    handleBackPointerDown = (e: React.PointerEvent<HTMLDivElement>) => {\n        if (!this.client) {\n            return;\n        }\n\n        if (e.button !== 0) {\n            return;\n        }\n        e.currentTarget.setPointerCapture(e.pointerId);\n\n        this.client!.controlMessageSerializer!.backOrScreenOn(AndroidKeyEventAction.Down);\n    };\n\n    handleBackPointerUp = (e: React.PointerEvent<HTMLDivElement>) => {\n        if (!this.client) {\n            return;\n        }\n\n        if (e.button !== 0) {\n            return;\n        }\n\n        this.client!.controlMessageSerializer!.backOrScreenOn(AndroidKeyEventAction.Up);\n    };\n\n    handleHomePointerDown = (e: React.PointerEvent<HTMLDivElement>) => {\n        if (!this.client) {\n            return;\n        }\n\n        if (e.button !== 0) {\n            return;\n        }\n        e.currentTarget.setPointerCapture(e.pointerId);\n\n        this.client!.controlMessageSerializer!.injectKeyCode({\n            action: AndroidKeyEventAction.Down,\n            keyCode: AndroidKeyCode.Home,\n            repeat: 0,\n            metaState: 0,\n        });\n    };\n\n    handleHomePointerUp = (e: React.PointerEvent<HTMLDivElement>) => {\n        if (!this.client) {\n            return;\n        }\n\n        if (e.button !== 0) {\n            return;\n        }\n\n        this.client!.controlMessageSerializer!.injectKeyCode({\n            action: AndroidKeyEventAction.Up,\n            keyCode: AndroidKeyCode.Home,\n            repeat: 0,\n            metaState: 0,\n        });\n    };\n\n    handleAppSwitchPointerDown = async (e: React.PointerEvent<HTMLDivElement>) => {\n        if (!this.client) {\n            return;\n        }\n\n        if (e.button !== 0) {\n            return;\n        }\n        e.currentTarget.setPointerCapture(e.pointerId);\n\n        this.client!.controlMessageSerializer!.injectKeyCode({\n            action: AndroidKeyEventAction.Down,\n            keyCode: AndroidKeyCode.AppSwitch,\n            repeat: 0,\n            metaState: 0,\n        });\n    };\n\n    handleAppSwitchPointerUp = async (e: React.PointerEvent<HTMLDivElement>) => {\n        if (!this.client) {\n            return;\n        }\n\n        if (e.button !== 0) {\n            return;\n        }\n\n        this.client!.controlMessageSerializer!.injectKeyCode({\n            action: AndroidKeyEventAction.Up,\n            keyCode: AndroidKeyCode.AppSwitch,\n            repeat: 0,\n            metaState: 0,\n        });\n    };\n\n    calculatePointerPosition(clientX: number, clientY: number) {\n        const viewRect = this.rendererContainer!.getBoundingClientRect();\n        let pointerViewX = clamp((clientX - viewRect.x) / viewRect.width, 0, 1);\n        let pointerViewY = clamp((clientY - viewRect.y) / viewRect.height, 0, 1);\n\n        if (this.rotate & 1) {\n            ([pointerViewX, pointerViewY] = [pointerViewY, pointerViewX]);\n        }\n        switch (this.rotate) {\n            case 1:\n                pointerViewY = 1 - pointerViewY;\n                break;\n            case 2:\n                pointerViewX = 1 - pointerViewX;\n                pointerViewY = 1 - pointerViewY;\n                break;\n            case 3:\n                pointerViewX = 1 - pointerViewX;\n                break;\n        }\n\n        return {\n            x: pointerViewX * this.width,\n            y: pointerViewY * this.height,\n        };\n    }\n\n    injectTouch = (\n        action: AndroidMotionEventAction,\n        e: React.PointerEvent<HTMLDivElement>\n    ) => {\n        if (!this.client) {\n            return;\n        }\n\n        const { x, y } = this.calculatePointerPosition(e.clientX, e.clientY);\n        this.client!.controlMessageSerializer!.injectTouch({\n            action,\n            pointerId: e.pointerType === \"mouse\" ? BigInt(-1) : BigInt(e.pointerId),\n            screenWidth: this.client!.screenWidth!,\n            screenHeight: this.client!.screenHeight!,\n            pointerX: x,\n            pointerY: y,\n            pressure: e.pressure * 65535,\n            buttons: e.buttons,\n        });\n    };\n\n    handlePointerDown = (e: React.PointerEvent<HTMLDivElement>) => {\n        this.rendererContainer!.focus();\n        e.preventDefault();\n        e.currentTarget.setPointerCapture(e.pointerId);\n        this.injectTouch(AndroidMotionEventAction.Down, e);\n    };\n\n    handlePointerMove = (e: React.PointerEvent<HTMLDivElement>) => {\n        this.injectTouch(\n            e.buttons === 0 ? AndroidMotionEventAction.HoverMove : AndroidMotionEventAction.Move,\n            e\n        );\n    };\n\n    handlePointerUp = (e: React.PointerEvent<HTMLDivElement>) => {\n        this.injectTouch(AndroidMotionEventAction.Up, e);\n    };\n\n    handleWheel = (e: WheelEvent) => {\n        if (!this.client) {\n            return;\n        }\n\n        e.preventDefault();\n        e.stopPropagation();\n\n        const { x, y } = this.calculatePointerPosition(e.clientX, e.clientY);\n        this.client!.controlMessageSerializer!.injectScroll({\n            screenWidth: this.client!.screenWidth!,\n            screenHeight: this.client!.screenHeight!,\n            pointerX: x,\n            pointerY: y,\n            scrollX: -Math.sign(e.deltaX),\n            scrollY: -Math.sign(e.deltaY),\n            buttons: 0,\n        });\n    };\n\n    handleContextMenu = (e: React.MouseEvent<HTMLDivElement>) => {\n        e.preventDefault();\n    };\n\n    handleKeyDown = async (e: React.KeyboardEvent<HTMLDivElement>) => {\n        if (!this.client) {\n            return;\n        }\n\n        const { key, code } = e;\n        if (key.match(/^[!-`{-~]$/i)) {\n            this.client!.controlMessageSerializer!.injectText(key);\n            return;\n        }\n\n        const keyCode = ({\n            Backspace: AndroidKeyCode.Delete,\n            Space: AndroidKeyCode.Space,\n            Enter: AndroidKeyCode.Enter,\n        } as Record<string, AndroidKeyCode | undefined>)[code];\n\n        if (keyCode) {\n            this.client!.controlMessageSerializer!.injectKeyCode({\n                action: AndroidKeyEventAction.Down,\n                keyCode,\n                metaState: 0,\n                repeat: 0,\n            });\n            this.client!.controlMessageSerializer!.injectKeyCode({\n                action: AndroidKeyEventAction.Up,\n                keyCode,\n                metaState: 0,\n                repeat: 0,\n            });\n        }\n    };\n}\n\nconst state = new ScrcpyPageState();\n\nconst ConnectionDialog = observer(() => {\n    const layerHostId = useId('layerHost');\n\n    const [isClient, setIsClient] = useState(false);\n\n    useEffect(() => {\n        setIsClient(true);\n    }, []);\n\n    if (!isClient) {\n        return null;\n    }\n\n    return (\n        <>\n            <LayerHost id={layerHostId} style={{ position: 'absolute', top: 0, bottom: 0, left: 0, right: 0, margin: 0, pointerEvents: 'none' }} />\n\n            <Dialog\n                hidden={!state.connecting}\n                modalProps={{ layerProps: { hostId: layerHostId } }}\n                dialogContentProps={{ title: 'Connecting...' }}\n            >\n                <Stack tokens={CommonStackTokens}>\n                    <ProgressIndicator\n                        label=\"1. Downloading scrcpy server...\"\n                        percentComplete={state.serverTotalSize ? state.serverDownloadedSize / state.serverTotalSize : undefined}\n                        description={formatSpeed(state.debouncedServerDownloadedSize, state.serverTotalSize, state.serverDownloadSpeed)}\n                    />\n\n                    <ProgressIndicator\n                        label=\"2. Pushing scrcpy server to device...\"\n                        progressHidden={state.serverTotalSize === 0 || state.serverDownloadedSize !== state.serverTotalSize}\n                        percentComplete={state.serverUploadedSize / state.serverTotalSize}\n                        description={formatSpeed(state.debouncedServerUploadedSize, state.serverTotalSize, state.serverUploadSpeed)}\n                    />\n\n                    <ProgressIndicator\n                        label=\"3. Starting scrcpy server on device...\"\n                        progressHidden={state.serverTotalSize === 0 || state.serverUploadedSize !== state.serverTotalSize}\n                    />\n                </Stack>\n            </Dialog>\n        </>\n    );\n});\n\nconst NavigationBar = observer(function NavigationBar({\n    className,\n    style,\n    children\n}: {\n    className: string;\n    style: CSSProperties;\n    children: ReactNode;\n    }) {\n    if (!state.navigationBarVisible) {\n        return (\n            <div className={className} style={style}>{children}</div>\n        );\n    }\n\n    return (\n        <Stack className={className} verticalFill horizontalAlign=\"center\" style={{ height: '40px', background: '#999', ...style }}>\n            {children}\n            <Stack verticalFill horizontal style={{ width: '100%', maxWidth: 300 }} horizontalAlign=\"space-evenly\" verticalAlign=\"center\">\n                <IconButton\n                    iconProps={{ iconName: Icons.Play }}\n                    style={{ transform: 'rotate(180deg)', color: 'white' }}\n                    onPointerDown={state.handleBackPointerDown}\n                    onPointerUp={state.handleBackPointerUp}\n                />\n                <IconButton\n                    iconProps={{ iconName: Icons.Circle }}\n                    style={{ color: 'white' }}\n                    onPointerDown={state.handleHomePointerDown}\n                    onPointerUp={state.handleHomePointerUp}\n                />\n                <IconButton\n                    iconProps={{ iconName: Icons.Stop }}\n                    style={{ color: 'white' }}\n                    onPointerDown={state.handleAppSwitchPointerDown}\n                    onPointerUp={state.handleAppSwitchPointerUp}\n                />\n            </Stack>\n        </Stack>\n    );\n});\n\nconst Scrcpy: NextPage = () => {\n    const classes = useClasses();\n\n    return (\n        <Stack {...RouteStackProps}>\n            <Head>\n                <title>Scrcpy - Android Web Toolbox</title>\n            </Head>\n\n            <CommandBar items={state.commandBarItems} farItems={state.commandBarFarItems} />\n\n            <Stack horizontal grow styles={{ root: { height: 0 } }}>\n                <DeviceView\n                    ref={state.handleDeviceViewRef}\n                    width={state.rotatedWidth}\n                    height={state.rotatedHeight}\n                    BottomElement={NavigationBar}\n                >\n                    <div\n                        ref={state.handleRendererContainerRef}\n                        tabIndex={-1}\n                        className={classes.video}\n                        style={{\n                            width: state.width,\n                            height: state.height,\n                            transform: `translate(${(state.rotatedWidth - state.width) / 2}px, ${(state.rotatedHeight - state.height) / 2}px) rotate(${state.rotate * 90}deg)`\n                        }}\n                        onPointerDown={state.handlePointerDown}\n                        onPointerMove={state.handlePointerMove}\n                        onPointerUp={state.handlePointerUp}\n                        onPointerCancel={state.handlePointerUp}\n                        onKeyDown={state.handleKeyDown}\n                        onContextMenu={state.handleContextMenu}\n                    />\n                </DeviceView>\n\n                <div style={{\n                    padding: 12,\n                    overflow: 'hidden auto',\n                    display: state.logVisible ? 'block' : 'none',\n                    width: 500,\n                    fontFamily: 'monospace',\n                    overflowY: 'auto',\n                    whiteSpace: 'pre-wrap',\n                    wordWrap: 'break-word',\n                }}>\n                    {state.log.map((line, index) => (\n                        <div key={index}>\n                            {line}\n                        </div>\n                    ))}\n                </div>\n\n                <div style={{ padding: 12, overflow: 'hidden auto', display: state.settingsVisible ? 'block' : 'none', width: 300 }}>\n                    <div>Changes will take effect on next connection</div>\n\n                    {state.settingDefinitions.map(definition => (\n                        <SettingItem\n                            key={definition.key}\n                            definition={definition}\n                            settings={state.settings}\n                            onChange={action((key, value) => (state.settings as any)[key] = value)}\n                        />\n                    ))}\n                </div>\n\n                <DemoModePanel\n                    style={{ display: state.demoModeVisible ? 'block' : 'none' }}\n                />\n\n                <ConnectionDialog />\n            </Stack>\n        </Stack>\n    );\n};\n\nexport default observer(Scrcpy);\n"],"names":["window","__NEXT_P","push","LayerHost","props","className","layerHostId","getId","hostId","layerHostRef","rootRef","notifyLayersChanged","componentRef","current","useUnmount","css","ref","AdbScrcpyConnection","adb","options","this","initialize","dispose","AdbScrcpyForwardConnection","connect","createSocket","async","i","e","Error","readable","videoStream","connectAndRetry","sendDummyByte","reader","getReader","done","value","read","byteLength","releaseLock","connectVideoStream","controlStream","control","sendDeviceMeta","AdbScrcpyReverseConnection","streams","address","reverse","remove","catch","queue","TransformStream","writer","writable","getWriter","add","socket","write","accept","AdbScrcpyOptions1_22","raw","getDefaultValue","formatServerArguments","getOutputEncoderNameRegex","createVideoStreamTransformer","getControlMessageTypes","serializeBackOrScreenOnControlMessage","message","serializeInjectScrollControlMessage","createConnection","tunnelForward","ScrcpyControlMessageType","AndroidKeyEventAction","AndroidKeyCode","ScrcpyInjectKeyCodeControlMessage","uint8","InjectKeyCode","uint32","ScrcpyInjectTextControlMessage","InjectText","string","lengthField","AndroidMotionEventAction","ScrcpyInjectTouchControlMessage","InjectTouch","uint64","uint16","ScrcpyRotateDeviceControlMessage","RotateDevice","ScrcpyControlMessageSerializer","types","stream","getTypeValue","type","indexOf","injectKeyCode","serialize","injectText","text","injectTouch","injectScroll","InjectScroll","action","buffer","BackOrScreenOn","rotateDevice","close","ScrcpyDeviceMessageType","ScrcpyClipboardDeviceMessage","extra","Clipboard","ScrcpyDeviceMessageDeserializeStream","constructor","super","deserialize","CODEC_OPTION_TYPES","repeatPreviousFrameAfter","maxPtsGapToEncoder","CodecOptions","toOptionValue","entries","Object","filter","key","undefined","length","map","input","replace","toLowerCase","join","DEFAULT_SERVER_PATH","toScrcpyOptionValue","empty","isScrcpyOptionValue","BitReader","bytePosition","bitPosition","result","next","decodeExponentialGolombNumber","parse_sequence_parameter_set","nalu","start","writeIndex","zeroCount","inEmulation","byte","lastZeroCount","subarray","iterateNalu","Uint8Array","nal_ref_idc","profile_idc","constraint_set","constraint_set_reader","constraint_set0_flag","constraint_set1_flag","constraint_set2_flag","constraint_set3_flag","constraint_set4_flag","constraint_set5_flag","level_idc","seq_parameter_set_id","chroma_format_idc","seq_scaling_list_present_flag","pic_order_cnt_type","num_ref_frames_in_pic_order_cnt_cycle","offset_for_ref_frame","pic_width_in_mbs_minus1","pic_height_in_map_units_minus1","frame_mbs_only_flag","frame_cropping_flag","frame_crop_left_offset","frame_crop_right_offset","frame_crop_top_offset","frame_crop_bottom_offset","ScrcpyLogLevel","ScrcpyVideoOrientation","VideoPacket","uint8Array","NO_PTS","BigInt","ScrcpyBackOrScreenOnControlMessage1_16","ScrcpyInjectScrollControlMessage1_16","int32","ScrcpyOptions1_16","logLevel","Verbose","Debug","lockVideoOrientation","Initial","Unlocked","getArgumentOrder","maxSize","bitRate","maxFps","crop","sendFrameMeta","displayId","showTouches","stayAwake","codecOptions","encoderName","defaults","transform","chunk","controller","enqueue","data","header","deserializeStream","pipeThrough","packet","pts","sequenceParameterSet","slice","profileIndex","constraintSet","levelIndex","encodedWidth","encodedHeight","cropLeft","cropRight","cropTop","cropBottom","croppedWidth","croppedHeight","frameData","set","ExpandNotificationPanel","CollapseNotificationPanel","GetClipboard","SetClipboard","SetScreenPowerMode","Down","ScrcpyBackOrScreenOnControlMessage1_18","fields","ScrcpyOptions1_18","concat","powerOffOnClose","splice","ExpandSettingPanel","ScrcpyOptions1_21","init","clipboardAutosync","pair","ScrcpyInjectScrollControlMessage1_22","ScrcpyOptions1_22","rawVideoStream","downsizeOnError","KEYFRAME_PTS","ScrcpyOptions1_23","cleanup","superStream","keyframe","ScrcpyOptions1_24","powerOn","ArrayToStream","array","index","Promise","resolve","pull","ConcatStream","advance","AdbScrcpyClient","static","path","sync","version","connection","process","subprocess","spawn","protocols","stdout","output","abortController","AbortController","pipe","pipeTo","signal","preventCancel","race","exit","getStreams","error","abort","kill","client","encoderNameRegex","encoders","line","match","displayIdRegex","displays","Number","parseInt","_stdout","_screenWidth","screenWidth","_screenHeight","screenHeight","_videoStream","_controlMessageSerializer","controlMessageSerializer","_deviceMessageStream","deviceMessageStream","AndroidCodecProfile","AndroidCodecLevel","worker","workerReady","pendingResolvers","streamId","PICTURE_READY_SUBSCRIPTIONS","Map","TinyH264Wrapper","pictureReadyEvent","onPictureReady","event","addDisposable","handler","delete","subscribePictureReady","handlePictureReady","fire","feed","postMessage","offset","renderStateId","cachedInitializePromise","all","then","YuvBuffer","default","YuvCanvas","TinyH264Decoder","maxProfile","Baseline","maxLevel","Level4","_renderer","renderer","_frameRendered","frameRendered","_writable","_yuvCanvas","_initializer","document","createElement","configure","promise","config","attach","chromaWidth","chromaHeight","width","height","format","cropWidth","cropHeight","displayWidth","displayHeight","wrapper","Worker","URL","addEventListener","resolver","get","decoder","createTinyH264Wrapper","uPlaneOffset","vPlaneOffset","frame","lumaPlane","chromaPlane","drawFrame","toHex","toString","padStart","toUpperCase","WebCodecsDecoder","context","lastFrame","animationFrame","getContext","VideoDecoder","render","decode","EncodedVideoChunk","timestamp","drawImage","requestAnimationFrame","codec","optimizeForLatency","cancelAnimationFrame","cachedValue","SERVER_URL","FetchWithProgress","url","_downloaded","_total","progressEvent","EventEmitter","fetch","response","chunks","position","headers","body","reduce","item","downloaded","total","onProgress","fetchServer","clamp","min","max","useClasses","makeStyles","labelRight","marginLeft","video","transformOrigin","SettingItem","observer","definition","settings","onChange","classes","label","Stack","horizontal","verticalAlign","span","description","TooltipHost","content","Icon","iconName","Icons","labelExtra","TextField","placeholder","Dropdown","selectedKey","option","Toggle","checked","SpinButton","labelPosition","Position","step","ScrcpyPageState","running","deviceView","rendererContainer","logVisible","log","settingsVisible","demoModeVisible","navigationBarVisible","rotate","updateEncoders","pushServer","getEncoders","GlobalState","SCRCPY_SERVER_VERSION","runInAction","includes","decoders","name","Constructor","fpsCounterIntervalId","fps","updateDisplays","getDisplays","connecting","serverTotalSize","serverDownloadedSize","debouncedServerDownloadedSize","serverDownloadSpeed","serverUploadedSize","debouncedServerUploadedSize","serverUploadSpeed","intervalId","serverBuffer","decoderDefinition","setInterval","clearInterval","ReadableStream","ChunkStream","ADB_SYNC_MAX_PACKET_SIZE","ProgressStream","progress","find","x","lastFrameCount","ignoreDecoderCodecArgs","profile","level","WritableStream","InspectStream","navigator","clipboard","writeText","handleBackPointerDown","button","currentTarget","setPointerCapture","pointerId","backOrScreenOn","handleBackPointerUp","Up","handleHomePointerDown","keyCode","Home","repeat","metaState","handleHomePointerUp","handleAppSwitchPointerDown","AppSwitch","handleAppSwitchPointerUp","calculatePointerPosition","clientX","clientY","y","pointerType","pointerX","pointerY","pressure","buttons","handlePointerDown","focus","preventDefault","handlePointerMove","HoverMove","Move","handlePointerUp","handleWheel","stopPropagation","scrollX","Math","sign","deltaX","scrollY","deltaY","handleContextMenu","handleKeyDown","code","Backspace","Delete","Space","Enter","makeAutoObservable","observable","stop","handleDeviceViewRef","handleRendererContainerRef","autorun","firstChild","appendChild","setTimeout","unshift","clearTimeout","element","passive","viewRect","getBoundingClientRect","pointerViewX","pointerViewY","rotatedWidth","state","rotatedHeight","commandBarItems","iconProps","onClick","disabled","iconOnly","enterFullscreen","commandBarFarItems","tooltipHostProps","p","ExternalLink","href","spaceAfter","calloutProps","calloutMaxWidth","settingDefinitions","IconButton","Portrait","Landscape","PortraitFlipped","LandscapeFlipped","ConnectionDialog","useId","useState","useEffect","setIsClient","isClient","id","style","top","bottom","left","right","margin","pointerEvents","Dialog","hidden","modalProps","layerProps","dialogContentProps","title","tokens","CommonStackTokens","ProgressIndicator","percentComplete","formatSpeed","progressHidden","NavigationBar","children","verticalFill","horizontalAlign","background","maxWidth","color","onPointerDown","onPointerUp","div","RouteStackProps","Head","CommandBar","items","farItems","grow","styles","root","DeviceView","BottomElement","tabIndex","onPointerMove","onPointerCancel","onKeyDown","onContextMenu","padding","overflow","display","fontFamily","overflowY","whiteSpace","wordWrap","DemoModePanel"],"sourceRoot":""}