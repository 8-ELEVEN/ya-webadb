{"version":3,"file":"static/chunks/pages/chrome-devtools-6e9d55ca17d0d89e.js","mappings":"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","sources":["webpack://_N_E/?e79a","webpack://_N_E/./src/pages/chrome-devtools.tsx","webpack://_N_E/<anon>"],"sourcesContent":["\n    (window.__NEXT_P = window.__NEXT_P || []).push([\n      \"/chrome-devtools\",\n      function () {\n        return require(\"private-next-pages/chrome-devtools.tsx\");\n      }\n    ]);\n    if(module.hot) {\n      module.hot.dispose(function () {\n        window.__NEXT_P.push([\"/chrome-devtools\"])\n      });\n    }\n  ","import { Link, Stack } from \"@fluentui/react\";\nimport { makeStyles } from \"@griffel/react\";\nimport { AdbSocket } from \"@yume-chan/adb\";\nimport {\n    Consumable,\n    ReadableStreamDefaultReader,\n    WritableStreamDefaultWriter,\n} from \"@yume-chan/stream-extra\";\nimport {\n    Agent,\n    Client,\n    Duplex,\n    Pool,\n    Symbols,\n    WebSocket,\n    request,\n    setGlobalDispatcher,\n} from \"@yume-chan/undici-browser\";\nimport {\n    action,\n    makeAutoObservable,\n    observable,\n    reaction,\n    runInAction,\n} from \"mobx\";\nimport { observer } from \"mobx-react-lite\";\nimport { NextPage } from \"next\";\nimport getConfig from \"next/config\";\nimport Head from \"next/head\";\nimport type { Socket } from \"node:net\";\nimport { useCallback, useEffect } from \"react\";\nimport { GLOBAL_STATE } from \"../state\";\nimport { RouteStackProps } from \"../utils\";\n\nclass AdbUndiciSocket extends Duplex {\n    private _socket: AdbSocket;\n    private _reader: ReadableStreamDefaultReader<Uint8Array>;\n    private _writer: WritableStreamDefaultWriter<Consumable<Uint8Array>>;\n\n    constructor(socket: AdbSocket) {\n        super();\n        this._socket = socket;\n        this._reader = this._socket.readable.getReader();\n        this._writer = this._socket.writable.getWriter();\n        this._socket.end.then(() => this.emit(\"end\"));\n    }\n\n    async _read(size: number): Promise<void> {\n        const result = await this._reader.read();\n        if (result.done) {\n            this.emit(\"end\");\n        } else {\n            this.push(result.value);\n        }\n    }\n\n    async _write(\n        chunk: any,\n        encoding: BufferEncoding,\n        callback: (error?: Error | null | undefined) => void\n    ): Promise<void> {\n        const consumable = new Consumable(chunk);\n        try {\n            await this._writer.write(consumable);\n            callback();\n        } catch (e) {\n            callback(e as Error);\n        }\n    }\n\n    async _final(\n        callback: (error?: Error | null | undefined) => void\n    ): Promise<void> {\n        await this._socket.close();\n        callback();\n    }\n\n    async _destroy(\n        error: Error | null,\n        callback: (error: Error | null) => void\n    ): Promise<void> {\n        await this._socket.close();\n        callback(error);\n    }\n}\n\nconst agent = new Agent({\n    factory(origin, opts) {\n        const pool = new Pool(origin, {\n            ...opts,\n            factory(origin, opts) {\n                const client = new Client(origin, opts);\n                // Remote debugging validates `Host` header to defend against DNS rebinding attacks.\n                // But we can only pass socket name using hostname, so we need to override it.\n                (client as any)[Symbols.kHostHeader] = \"Host: localhost\\r\\n\";\n                return client;\n            },\n        });\n        return pool;\n    },\n    async connect(options, callback) {\n        const socket = await GLOBAL_STATE.device!.createSocket(\n            \"localabstract:\" + options.hostname\n        );\n        callback(null, new AdbUndiciSocket(socket) as unknown as Socket);\n    },\n});\n// WebSocket only uses global dispatcher\nsetGlobalDispatcher(agent);\n\ninterface Page {\n    description: string;\n    devtoolsFrontendUrl: string;\n    id: string;\n    title: string;\n    type: string;\n    url: string;\n    webSocketDebuggerUrl: string;\n}\n\ninterface Version {\n    \"Android-Package\": string;\n    Browser: string;\n    \"Protocol-Version\": string;\n    \"User-Agent\": string;\n    \"V8-Version\": string;\n    \"WebKit-Version\": string;\n    webSocketDebuggerUrl: string;\n}\n\n// https://source.chromium.org/chromium/chromium/src/+/refs/heads/main:chrome/browser/devtools/device/devtools_device_discovery.cc;l=36;drc=4651cec294d1542d6673a89190e192e20de03240\n\nasync function getPages(socket: string) {\n    const response = await request(`http://${socket}/json`);\n    const body = await response.body.json();\n    return body as Page[];\n}\n\nasync function getVersion(socket: string) {\n    const response = await request(`http://${socket}/json/version`);\n    const body = await response.body.json();\n    return body as Version;\n}\n\nasync function focusPage(socket: string, page: Page) {\n    await request(`http://${socket}/json/activate/${page.id}`);\n}\n\nasync function closePage(socket: string, page: Page) {\n    await request(`http://${socket}/json/close/${page.id}`);\n}\n\nconst {\n    publicRuntimeConfig: { basePath },\n} = getConfig();\n\nfunction getPopupParams(page: Page) {\n    const frontendUrl = page.devtoolsFrontendUrl;\n    const [frontendBase, params] = frontendUrl.split(\"?\");\n    let frontendScript: string;\n    if (\n        frontendBase.startsWith(\"https://aka.ms/docs-landing-page/serve_rev/\")\n    ) {\n        // Edge\n        frontendScript = frontendBase\n            .replace(\n                \"https://aka.ms/docs-landing-page/serve_rev/\",\n                \"https://devtools.azureedge.net/serve_file/\"\n            )\n            .replace(\"inspector.html\", \"entrypoints/inspector/inspector.js\");\n    } else if (frontendBase.startsWith(\"https://devtools.opera.com/\")) {\n        // Opera doesn't host its DevTools\n        // use Edge's instead\n        frontendScript =\n            \"https://devtools.azureedge.net/serve_file/@de5387e0c9d4198cd2d786b4eb445a1fb74a3d18/entrypoints/inspector/inspector.js\";\n    } else {\n        // Chrome\n        frontendScript = frontendBase.replace(\n            \"inspector.html\",\n            \"front_end/entrypoints/inspector/inspector.js\"\n        );\n    }\n    return { script: frontendScript, params };\n}\n\ninterface Browser {\n    socket: string;\n    version: Version;\n    pages: Page[];\n}\n\nconst STATE = makeAutoObservable(\n    {\n        browsers: [] as Browser[],\n        intervalId: null as NodeJS.Timeout | null,\n        visible: false,\n    },\n    {\n        browsers: observable.deep,\n    }\n);\n\nasync function getBrowsers() {\n    const device = GLOBAL_STATE.device!;\n    const sockets = await device.subprocess.spawnAndWaitLegacy(\n        `cat /proc/net/unix | grep -E \"@chrome_devtools_remote|@chrome_devtools_remote_[0-9]+|@com.opera.browser.devtools\" | awk '{print substr($8, 2)}'`\n    );\n    const browsers: Browser[] = [];\n    for (const socket of sockets.split(\"\\n\").filter(Boolean)) {\n        if (browsers.some((browser) => browser.socket == socket)) {\n            continue;\n        }\n\n        try {\n            const version = await getVersion(socket);\n            const pages = await getPages(socket);\n            console.log(socket, version, pages);\n            browsers.push({ socket, version, pages });\n        } catch (e) {\n            console.error(socket, e);\n        }\n    }\n    runInAction(() => {\n        STATE.browsers = browsers;\n    });\n}\n\nreaction(\n    () => [GLOBAL_STATE.device, STATE.visible] as const,\n    ([device, visible]) => {\n        if (!device || !visible) {\n            STATE.browsers = [];\n            if (STATE.intervalId) {\n                clearInterval(STATE.intervalId);\n                STATE.intervalId = null;\n            }\n            return;\n        }\n\n        STATE.intervalId = setInterval(() => {\n            getBrowsers();\n        }, 5000);\n\n        getBrowsers();\n    }\n);\n\nfunction getBrowserName(version: Version) {\n    const [name, versionNumber] = version.Browser.split(\"/\");\n    return `${name} (${versionNumber})`;\n}\n\nconst useClasses = makeStyles({\n    header: {\n        marginTop: \"4px\",\n        marginBottom: \"4px\",\n    },\n    url: {\n        marginLeft: \"8px\",\n        color: \"#999\",\n    },\n    link: {\n        marginRight: \"12px\",\n    },\n});\n\nconst ChromeDevToolsPage: NextPage = observer(function ChromeDevTools() {\n    const classes = useClasses();\n\n    useEffect(() => {\n        runInAction(() => {\n            STATE.visible = true;\n        });\n\n        return action(() => {\n            STATE.visible = false;\n        });\n    }, []);\n\n    const handleInspectClick = useCallback((socket: string, page: Page) => {\n        const { script, params } = getPopupParams(page);\n        const childWindow = window.open(\n            `${basePath}/chrome-devtools-frame?script=${script}&${params}`,\n            \"_blank\",\n            \"popup\"\n        )!;\n        childWindow.addEventListener(\"message\", (e) => {\n            if (\n                typeof e.data !== \"object\" ||\n                !\"type in e.data\" ||\n                e.data.type !== \"AdbWebSocket\"\n            ) {\n                return;\n            }\n\n            const url = new URL(e.data.url as string);\n            url.host = socket;\n\n            const port = e.ports[0];\n\n            const ws = new WebSocket(url);\n            ws.binaryType = \"arraybuffer\";\n            ws.onopen = () => {\n                port.postMessage({ type: \"open\" });\n            };\n            ws.onclose = () => {\n                port.postMessage({ type: \"close\" });\n                port.close();\n            };\n            ws.onmessage = (e) => {\n                const { data } = e;\n                port.postMessage({\n                    type: \"message\",\n                    message: data,\n                });\n            };\n\n            port.onmessage = (e) => {\n                switch (e.data.type) {\n                    case \"message\":\n                        ws.send(e.data.message);\n                        break;\n                    case \"close\":\n                        ws.close();\n                        break;\n                }\n            };\n\n            childWindow.addEventListener(\"close\", () => {\n                ws.close();\n            });\n\n            window.addEventListener(\"beforeunload\", () => {\n                port.postMessage({ type: \"close\" });\n                port.close();\n            });\n        });\n    }, []);\n\n    const handleFocusClick = useCallback((socket: string, page: Page) => {\n        focusPage(socket, page);\n    }, []);\n\n    const handleCloseClick = useCallback((socket: string, page: Page) => {\n        closePage(socket, page);\n        getBrowsers();\n    }, []);\n\n    return (\n        <Stack {...RouteStackProps}>\n            <Head>\n                <title>Chrome Remote Debugging - Tango</title>\n            </Head>\n\n            {STATE.browsers.map((browser) => (\n                <>\n                    {browser.version && (\n                        <h3 className={classes.header}>\n                            {getBrowserName(browser.version)}\n                        </h3>\n                    )}\n\n                    {browser.pages.map((page) => (\n                        <div key={page.id}>\n                            <div>\n                                {page.title ? (\n                                    <span\n                                        dangerouslySetInnerHTML={{\n                                            __html: page.title,\n                                        }}\n                                    />\n                                ) : (\n                                    <i>No Title</i>\n                                )}\n\n                                <span className={classes.url}>\n                                    {page.url || <i>No URL</i>}\n                                </span>\n                            </div>\n                            <div>\n                                <Link\n                                    className={classes.link}\n                                    onClick={() =>\n                                        handleInspectClick(browser.socket, page)\n                                    }\n                                >\n                                    Inspect\n                                </Link>\n                                <Link\n                                    className={classes.link}\n                                    onClick={() =>\n                                        handleFocusClick(browser.socket, page)\n                                    }\n                                >\n                                    Focus\n                                </Link>\n                                <Link\n                                    className={classes.link}\n                                    onClick={() =>\n                                        handleCloseClick(browser.socket, page)\n                                    }\n                                >\n                                    Close\n                                </Link>\n                            </div>\n                        </div>\n                    ))}\n                </>\n            ))}\n        </Stack>\n    );\n});\n\nexport default ChromeDevToolsPage;\n"],"names":["window","__NEXT_P","push","__webpack_require__","AdbUndiciSocket","Duplex","_read","size","result","_reader","read","done","emit","value","_write","chunk","encoding","callback","consumable","Consumable","_writer","write","e","_final","_socket","close","_destroy","error","constructor","socket","readable","getReader","writable","getWriter","end","then","agent","Agent","factory","origin","opts","pool","Pool","client","Client","Symbols","connect","options","GLOBAL_STATE","hostname","getPages","response","request","concat","body","json","getVersion","focusPage","page","id","closePage","setGlobalDispatcher","publicRuntimeConfig","basePath","getConfig","STATE","makeAutoObservable","browsers","intervalId","visible","observable","getBrowsers","device","sockets","subprocess","spawnAndWaitLegacy","split","filter","Boolean","some","browser","version","pages","console","log","runInAction","reaction","param","clearInterval","setInterval","useClasses","makeStyles","header","marginTop","marginBottom","url","marginLeft","color","link","marginRight","ChromeDevToolsPage","observer","classes","useEffect","action","handleInspectClick","useCallback","script","params","getPopupParams","frontendUrl","devtoolsFrontendUrl","frontendBase","startsWith","replace","childWindow","open","addEventListener","data","type","URL","host","port","ports","ws","WebSocket","binaryType","onopen","postMessage","onclose","onmessage","message","send","handleFocusClick","handleCloseClick","react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__","jsxs","Stack","RouteStackProps","jsx","Head","title","map","Fragment","h3","className","getBrowserName","name","versionNumber","Browser","div","span","dangerouslySetInnerHTML","__html","i","Link","onClick","__webpack_exports__"],"sourceRoot":""}