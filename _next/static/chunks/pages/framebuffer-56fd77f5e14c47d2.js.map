{"version":3,"file":"static/chunks/pages/framebuffer-56fd77f5e14c47d2.js","mappings":"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","sources":["webpack://_N_E/?d6a7","webpack://_N_E/./pages/framebuffer.tsx","webpack://_N_E/../../common/temp/node_modules/.pnpm/next@12.0.7_react-dom@17.0.2+react@17.0.2/node_modules/next/head.js"],"sourcesContent":["\n    (window.__NEXT_P = window.__NEXT_P || []).push([\n      \"/framebuffer\",\n      function () {\n        return require(\"private-next-pages/framebuffer.tsx\");\n      }\n    ]);\n    if(module.hot) {\n      module.hot.dispose(function () {\n        window.__NEXT_P.push([\"/framebuffer\"])\n      });\n    }\n  ","import { ICommandBarItemProps, Stack } from '@fluentui/react';\nimport { AdbFrameBuffer } from \"@yume-chan/adb\";\nimport { action, autorun, computed, makeAutoObservable } from \"mobx\";\nimport { observer } from \"mobx-react-lite\";\nimport { NextPage } from \"next\";\nimport Head from \"next/head\";\nimport React, { useCallback, useContext, useEffect, useRef } from 'react';\nimport { CommandBar, DemoMode, DeviceView } from '../components';\nimport { global } from \"../state\";\nimport { RouteStackProps } from \"../utils\";\n\nclass FrameBufferState {\n    width = 0;\n    height = 0;\n    imageData: ImageData | undefined;\n    demoModeVisible = false;\n\n    constructor() {\n        makeAutoObservable(this, {\n            toggleDemoModeVisible: action.bound,\n        });\n    }\n\n    setImage(image: AdbFrameBuffer) {\n        this.width = image.width;\n        this.height = image.height;\n        this.imageData = new ImageData(image.data, image.width, image.height);\n    }\n\n    toggleDemoModeVisible() {\n        this.demoModeVisible = !this.demoModeVisible;\n    }\n}\n\nconst state = new FrameBufferState();\n\nconst FrameBuffer: NextPage = (): JSX.Element | null => {\n    const canvasRef = useRef<HTMLCanvasElement | null>(null);\n\n    const capture = useCallback(async () => {\n        if (!global.device) {\n            return;\n        }\n\n        try {\n            const start = window.performance.now();\n            const framebuffer = await global.device.framebuffer();\n            const end = window.performance.now();\n            state.setImage(framebuffer);\n        } catch (e) {\n            global.showErrorDialog(e instanceof Error ? e.message : `${e}`);\n        }\n    }, []);\n\n    useEffect(() => {\n        return autorun(() => {\n            const canvas = canvasRef.current;\n            if (canvas && state.imageData) {\n                canvas.width = state.width;\n                canvas.height = state.height;\n                const context = canvas.getContext(\"2d\")!;\n                context.putImageData(state.imageData, 0, 0);\n            }\n        });\n    }, []);\n\n    const commandBarItems = computed(() => [\n        {\n            key: 'start',\n            disabled: !global.device,\n            iconProps: { iconName: 'Camera' },\n            text: 'Capture',\n            onClick: capture,\n        },\n        {\n            key: 'Save',\n            disabled: !state.imageData,\n            iconProps: { iconName: 'Save' },\n            text: 'Save',\n            onClick: () => {\n                const canvas = canvasRef.current;\n                if (!canvas) {\n                    return;\n                }\n\n                const url = canvas.toDataURL();\n                const a = document.createElement('a');\n                a.href = url;\n                a.download = `Screenshot of ${global.device!.name}.png`;\n                a.click();\n            },\n        },\n    ]);\n\n    const commandBarFarItems = computed((): ICommandBarItemProps[] => [\n        {\n            key: 'DemoMode',\n            iconProps: { iconName: 'Personalize' },\n            checked: state.demoModeVisible,\n            text: 'Demo Mode Settings',\n            onClick: state.toggleDemoModeVisible,\n        },\n        {\n            key: 'info',\n            iconProps: { iconName: 'Info' },\n            iconOnly: true,\n            tooltipHostProps: {\n                content: 'Use ADB FrameBuffer command to capture a full-size, high-resolution screenshot.',\n                calloutProps: {\n                    calloutMaxWidth: 250,\n                }\n            },\n        }\n    ]);\n\n    return (\n        <Stack {...RouteStackProps}>\n            <Head>\n                <title>Screen Capture - WebADB</title>\n            </Head>\n\n            <CommandBar items={commandBarItems.get()} farItems={commandBarFarItems.get()} />\n            <Stack horizontal grow styles={{ root: { height: 0 } }}>\n                <DeviceView width={state.width} height={state.height}>\n                    <canvas ref={canvasRef} style={{ display: 'block' }} />\n                </DeviceView>\n\n                <DemoMode style={{ display: state.demoModeVisible ? 'block' : 'none' }} />\n            </Stack>\n        </Stack>\n    );\n};\n\nexport default observer(FrameBuffer);\n","module.exports = require('./dist/shared/lib/head')\n"],"names":["window","__NEXT_P","push","state","FrameBufferState","width","height","demoModeVisible","makeAutoObservable","this","toggleDemoModeVisible","action","setImage","image","imageData","ImageData","data","observer","canvasRef","useRef","capture","useCallback","framebuffer","global","performance","now","Error","message","useEffect","autorun","canvas","current","getContext","putImageData","commandBarItems","computed","key","disabled","iconProps","iconName","text","onClick","url","toDataURL","a","document","createElement","href","download","click","commandBarFarItems","checked","iconOnly","tooltipHostProps","content","calloutProps","calloutMaxWidth","Stack","RouteStackProps","Head","title","CommandBar","items","get","farItems","horizontal","grow","styles","root","DeviceView","ref","style","display","DemoMode","module","exports"],"sourceRoot":""}