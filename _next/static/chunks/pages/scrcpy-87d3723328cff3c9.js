(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[533],{7718:function(e,t,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/scrcpy",function(){return r(7746)}])},7746:function(e,t,r){"use strict";let i,n,o;r.r(t),r.d(t,{default:function(){return ta}});var s,a,l,c,d,h,p,u,g,w,m,v,y,f,b,S,x,P,D,k,C,z,M=r(4471),E=r(1647),L=r(4880),V=r(1420),j=r(1910),T=r(563),O=r(4245),I=r(4514),U=r(2133),N=r(4346),_=r(3499),R=r(3370),H=r(4678),F=r(7893),B=r(4551),A=r(2669),W=function(e){var t=e.className,r=R.useState(function(){return(0,F.z)()})[0],i=e.id,n=void 0===i?r:i,o=R.useRef({hostId:n,rootRef:R.useRef(null),notifyLayersChanged:function(){}});return R.useImperativeHandle(e.componentRef,function(){return o.current}),R.useEffect(function(){(0,A._Y)(n,o.current),(0,A.EQ)(n)},[]),(0,H.k)(function(){(0,A.nw)(n,o.current),(0,A.EQ)(n)}),R.createElement("div",(0,_.pi)({},e,{className:(0,B.i)("ms-LayerHost",t),ref:o.current.rootRef}))},G=r(4293),K=r(4893),J=r(4096),Y=r(4373),X=r(9622),q=r(6323),Z=r(6779),$=r(7417),Q=r.n($),ee=r(5616),et=r(2469),er=r(6789),ei=r(6261);class en{adb;options;constructor(e,t){this.adb=e,this.options=t}initialize(){}dispose(){}}class eo extends en{connect(){return this.adb.createSocket("localabstract:scrcpy")}async connectAndRetry(){for(let e=0;e<100;e+=1)try{return await this.connect()}catch(t){await (0,er.gw)(100)}throw Error("Can't connect to server after 100 retries")}async connectVideoStream(){let{readable:e}=await this.connectAndRetry();if(this.options.sendDummyByte){let t=e.getReader(),{done:r,value:i}=await t.read();if(r||1!==i.byteLength||0!==i[0])throw Error("Unexpected response from server");t.releaseLock()}return e}async getStreams(){let e;let t=await this.connectVideoStream();if(this.options.control&&(e=await this.connectAndRetry()),this.options.sendDeviceMeta){let r=t.getReader(),{done:i,value:n}=await r.read();if(i||68!==n.byteLength)throw Error("Unexpected response from server");r.releaseLock()}return[t,e]}}class es extends en{streams;address;async initialize(){await this.adb.reverse.remove("localabstract:scrcpy").catch(e=>{});let e=new ei.GJ;this.streams=e.readable.getReader();let t=e.writable.getWriter();this.address=await this.adb.reverse.add("localabstract:scrcpy","tcp:27183",e=>(t.write(e),!0))}async accept(){return(await this.streams.read()).value}async getStreams(){let e;let{readable:t}=await this.accept();if(this.options.control&&(e=await this.accept()),this.options.sendDeviceMeta){let r=t.getReader(),{done:i,value:n}=await r.read();if(i||68!==n.byteLength)throw Error("Unexpected response from server");r.releaseLock()}return[t,e]}dispose(){this.adb.reverse.remove(this.address).catch(e=>{})}}class ea{raw;get value(){return this.raw.value}set value(e){this.raw.value=e}constructor(e){this.raw=e}getDefaultValue(){return this.raw.getDefaultValue()}formatServerArguments(){return this.raw.formatServerArguments()}getOutputEncoderNameRegex(){return this.raw.getOutputEncoderNameRegex()}createVideoStreamTransformer(){return this.raw.createVideoStreamTransformer()}getControlMessageTypes(){return this.raw.getControlMessageTypes()}serializeBackOrScreenOnControlMessage(e){return this.raw.serializeBackOrScreenOnControlMessage(e)}getScrollController(){return this.raw.getScrollController()}}class el extends ea{createConnection(e){let t={control:!0,sendDummyByte:!0,sendDeviceMeta:!0};return this.value.tunnelForward?new eo(e,t):new es(e,t)}}class ec extends el{createConnection(e){let t={...this.getDefaultValue(),...this.value};return this.value.tunnelForward?new eo(e,t):new es(e,t)}}var ed=r(9229);(s=v=v||(v={}))[s.InjectKeyCode=0]="InjectKeyCode",s[s.InjectText=1]="InjectText",s[s.InjectTouch=2]="InjectTouch",s[s.InjectScroll=3]="InjectScroll",s[s.BackOrScreenOn=4]="BackOrScreenOn",s[s.ExpandNotificationPanel=5]="ExpandNotificationPanel",s[s.ExpandSettingPanel=6]="ExpandSettingPanel",s[s.CollapseNotificationPanel=7]="CollapseNotificationPanel",s[s.GetClipboard=8]="GetClipboard",s[s.SetClipboard=9]="SetClipboard",s[s.SetScreenPowerMode=10]="SetScreenPowerMode",s[s.RotateDevice=11]="RotateDevice",(a=y=y||(y={}))[a.Down=0]="Down",a[a.Up=1]="Up",(l=f=f||(f={}))[l.Home=3]="Home",l[l.Back=4]="Back",l[l.DPadUp=19]="DPadUp",l[l.DPadDown=20]="DPadDown",l[l.DPadLeft=21]="DPadLeft",l[l.DPadRight=22]="DPadRight",l[l.VolumeUp=24]="VolumeUp",l[l.VolumeDown=25]="VolumeDown",l[l.A=29]="A",l[l.B=30]="B",l[l.C=31]="C",l[l.D=32]="D",l[l.E=33]="E",l[l.F=34]="F",l[l.G=35]="G",l[l.H=36]="H",l[l.I=37]="I",l[l.J=38]="J",l[l.K=39]="K",l[l.L=40]="L",l[l.M=41]="M",l[l.N=42]="N",l[l.O=43]="O",l[l.P=44]="P",l[l.Q=45]="Q",l[l.R=46]="R",l[l.S=47]="S",l[l.T=48]="T",l[l.U=49]="U",l[l.V=50]="V",l[l.W=51]="W",l[l.X=52]="X",l[l.Y=53]="Y",l[l.Z=54]="Z",l[l.Tab=61]="Tab",l[l.Space=62]="Space",l[l.Enter=66]="Enter",l[l.Delete=67]="Delete",l[l.Escape=111]="Escape",l[l.ForwardDelete=112]="ForwardDelete",l[l.MoveHome=122]="MoveHome",l[l.MoveEnd=123]="MoveEnd",l[l.VolumeMute=164]="VolumeMute",l[l.AppSwitch=187]="AppSwitch";let eh=new ed.ZP().uint8("type",v.InjectKeyCode).uint8("action",(0,ed.W$)()).uint32("keyCode").uint32("repeat").uint32("metaState"),ep=new ed.ZP().uint8("type",v.InjectText).uint32("length").string("text",{lengthField:"length"});(c=b=b||(b={}))[c.Down=0]="Down",c[c.Up=1]="Up",c[c.Move=2]="Move",c[c.Cancel=3]="Cancel",c[c.Outside=4]="Outside",c[c.PointerDown=5]="PointerDown",c[c.PointerUp=6]="PointerUp",c[c.HoverMove=7]="HoverMove",c[c.Scroll=8]="Scroll",c[c.HoverEnter=9]="HoverEnter",c[c.HoverExit=10]="HoverExit",c[c.ButtonPress=11]="ButtonPress",c[c.ButtonRelease=12]="ButtonRelease",(d=S=S||(S={})).Mouse=BigInt(-1),d.Finger=BigInt(-2),d.VirtualMouse=BigInt(-3),d.VirtualFinger=BigInt(-4);let eu=new ed.Pl({size:2,signed:!1,deserialize(e,t){let r=ed.ek.Uint16.deserialize(e,t);return r/65535},serialize(e,t,r,i){r*=65535,ed.ek.Uint16.serialize(e,t,r,i)}}),eg=new ed.ZP().uint8("type",v.InjectTouch).uint8("action",(0,ed.W$)()).uint64("pointerId").uint32("pointerX").uint32("pointerY").uint16("screenWidth").uint16("screenHeight").field("pressure",eu).uint32("buttons"),ew=new ed.ZP().uint8("type",v.RotateDevice);(h=x=x||(x={}))[h.Off=0]="Off",h[h.Normal=2]="Normal";let em=new ed.ZP().uint8("type",v.SetScreenPowerMode).uint8("mode",(0,ed.W$)());class ev{options;types;writer;scrollController;constructor(e,t){this.writer=e.getWriter(),this.options=t,this.types=t.getControlMessageTypes(),this.scrollController=t.getScrollController()}getTypeValue(e){let t=this.types.indexOf(e);if(-1===t)throw Error("Not supported");return t}injectKeyCode(e){return this.writer.write(eh.serialize({...e,type:this.getTypeValue(v.InjectKeyCode)}))}injectText(e){return this.writer.write(ep.serialize({text:e,type:this.getTypeValue(v.InjectText)}))}injectTouch(e){return this.writer.write(eg.serialize({...e,type:this.getTypeValue(v.InjectTouch)}))}injectScroll(e){e.type=this.getTypeValue(v.InjectScroll);let t=this.scrollController.serializeScrollMessage(e);if(t)return this.writer.write(t)}async backOrScreenOn(e){let t=this.options.serializeBackOrScreenOnControlMessage({action:e,type:this.getTypeValue(v.BackOrScreenOn)});if(t)return await this.writer.write(t)}setScreenPowerMode(e){return this.writer.write(em.serialize({mode:e,type:this.getTypeValue(v.SetScreenPowerMode)}))}rotateDevice(){return this.writer.write(ew.serialize({type:this.getTypeValue(v.RotateDevice)}))}close(){return this.writer.close()}}(p=P=P||(P={}))[p.Clipboard=0]="Clipboard",p[p.AckClipboard=1]="AckClipboard";let ey=new ed.ZP().uint32("length").string("content",{lengthField:"length"}).extra({type:P.Clipboard});class ef extends ei.pC{constructor(){super(async e=>{let t=await e.read(1);if(0===t[0])return await ey.deserialize(e);throw Error("unknown control message type")})}}let eb={repeatPreviousFrameAfter:"long",maxPtsGapToEncoder:"long"};class eS{value;constructor(e){this.value=e}toOptionValue(){let e=Object.entries(this.value).filter(([,e])=>void 0!==e);if(0!==e.length)return e.map(([e,t])=>{let r=eb[e];return`${e.replace(/([A-Z])/g,"-$1").toLowerCase()}${r?`:${r}`:""}=${t}`}).join(",")}}let ex="/data/local/tmp/scrcpy-server.jar";function eP(e,t){var r;return"object"==typeof(r=e)&&null!==r&&"toOptionValue"in r&&"function"==typeof r.toOptionValue&&(e=e.toOptionValue()),void 0===e?t:String(e)}let eD=new ed.ZP().uint8("type",v.InjectScroll).uint32("pointerX").uint32("pointerY").uint16("screenWidth").uint16("screenHeight").int32("scrollX").int32("scrollY");class ek{accumulatedX=0;accumulatedY=0;processMessage(e){this.accumulatedX+=e.scrollX,this.accumulatedY+=e.scrollY;let t=0,r=0;if(this.accumulatedX>=1?(t=1,this.accumulatedX-=1):this.accumulatedX<=-1&&(t=-1,this.accumulatedX+=1),this.accumulatedY>=1?(r=1,this.accumulatedY-=1):this.accumulatedY<=-1&&(r=-1,this.accumulatedY+=1),0!==t||0!==r)return e.scrollX=t,e.scrollY=r,e}serializeScrollMessage(e){let t=this.processMessage(e);if(t)return eD.serialize(t)}}class eC{buffer;bytePosition=0;bitPosition=0;constructor(e){this.buffer=e}read(e){let t=0;for(let r=0;r<e;r+=1)t=t<<1|this.next();return t}next(){let e=this.buffer[this.bytePosition]>>7-this.bitPosition&1;return this.bitPosition+=1,8===this.bitPosition&&(this.bytePosition+=1,this.bitPosition=0),e}decodeExponentialGolombNumber(){let e=0;for(;0===this.next();)e+=1;return 0===e?0:(1<<e|this.read(e))-1}}(u=D=D||(D={})).Verbose="verbose",u.Debug="debug",u.Info="info",u.Warn="warn",u.Error="error",(g=k=k||(k={}))[g.Initial=-2]="Initial",g[g.Unlocked=-1]="Unlocked",g[g.Portrait=0]="Portrait",g[g.Landscape=1]="Landscape",g[g.PortraitFlipped=2]="PortraitFlipped",g[g.LandscapeFlipped=3]="LandscapeFlipped";let ez=new ed.ZP().uint64("pts").uint32("size").uint8Array("data",{lengthField:"size"}),eM=BigInt(1)<<BigInt(63),eE=new ed.ZP().uint8("type",v.BackOrScreenOn);class eL{value;constructor(e){new.target===eL&&e.logLevel===D.Verbose&&(e.logLevel=D.Debug),new.target===eL&&e.lockVideoOrientation===k.Initial&&(e.lockVideoOrientation=k.Unlocked),this.value=e}getArgumentOrder(){return["logLevel","maxSize","bitRate","maxFps","lockVideoOrientation","tunnelForward","crop","sendFrameMeta","control","displayId","showTouches","stayAwake","codecOptions","encoderName"]}getDefaultValue(){return{logLevel:D.Debug,maxSize:0,bitRate:8e6,maxFps:0,lockVideoOrientation:k.Unlocked,tunnelForward:!1,crop:"-",sendFrameMeta:!0,control:!0,displayId:0,showTouches:!1,stayAwake:!1,codecOptions:new eS({}),encoderName:"-"}}formatServerArguments(){let e=this.getDefaultValue();return this.getArgumentOrder().map(t=>eP(this.value[t]||e[t],"-"))}getOutputEncoderNameRegex(){return/\s+scrcpy --encoder-name '(.*?)'/}createVideoStreamTransformer(){let e;if(!1===this.value.sendFrameMeta)return new ei.GJ({transform(e,t){t.enqueue({type:"frame",data:e})}});let t=new ei.gL(ez);return{writable:t.writable,readable:t.readable.pipeThrough(new ei.GJ({transform(t,r){let i;if(t.pts===eM){let n=function(e){for(let t of function*(e){let t=-1,r=0,i=0,n=!1;for(let o of e){if(e[r]=o,r+=1,n){if(o>3)throw Error("Invalid data");n=!1;continue}if(0==o){i+=1;continue}let s=i;if(i=0,-1===t){if(s>=2&&1===o){r=0,t=0;continue}throw Error("Invalid data")}if(!(s<2)){if(1===o){yield e.subarray(t,r-=s+1),t=r;continue}if(s>2)throw Error("Invalid data");switch(o){case 2:throw Error("Invalid data");case 3:r-=1,n=!0}}}if(n||0!==i)throw Error("Invalid data");yield e.subarray(t,r)}(new Uint8Array(e))){let r,i,n,o;let s=new eC(t);if(0!==s.next())break;let a=s.read(2),l=s.read(5);if(7!==l)continue;if(0===a)break;let c=s.read(8),d=s.read(8),h=new eC(new Uint8Array([d])),p=!!h.next(),u=!!h.next(),g=!!h.next(),w=!!h.next(),m=!!h.next(),v=!!h.next();if(0!==h.read(2))break;let y=s.read(8),f=s.decodeExponentialGolombNumber();if(100===c||110===c||122===c||244===c||44===c||83===c||86===c||118===c||128===c||138===c||139===c||134===c){let b=s.decodeExponentialGolombNumber();3===b&&s.next(),s.decodeExponentialGolombNumber(),s.decodeExponentialGolombNumber(),s.next();let S=!!s.next();if(S){let x=[];for(let P=0;P<(3!==b?8:12);P+=1)x[P]=!!s.next(),x[P]}}s.decodeExponentialGolombNumber();let D=s.decodeExponentialGolombNumber();if(0===D)s.decodeExponentialGolombNumber();else if(1===D){s.next(),s.decodeExponentialGolombNumber(),s.decodeExponentialGolombNumber();let k=s.decodeExponentialGolombNumber(),C=[];for(let z=0;z<k;z+=1)C[z]=s.decodeExponentialGolombNumber()}s.decodeExponentialGolombNumber(),s.next();let M=s.decodeExponentialGolombNumber(),E=s.decodeExponentialGolombNumber(),L=s.next();L||s.next(),s.next();let V=!!s.next();return V?(r=s.decodeExponentialGolombNumber(),i=s.decodeExponentialGolombNumber(),n=s.decodeExponentialGolombNumber(),o=s.decodeExponentialGolombNumber()):(r=0,i=0,n=0,o=0),s.next(),{profile_idc:c,constraint_set:d,constraint_set0_flag:p,constraint_set1_flag:u,constraint_set2_flag:g,constraint_set3_flag:w,constraint_set4_flag:m,constraint_set5_flag:v,level_idc:y,seq_parameter_set_id:f,pic_width_in_mbs_minus1:M,pic_height_in_map_units_minus1:E,frame_mbs_only_flag:L,frame_cropping_flag:V,frame_crop_left_offset:r,frame_crop_right_offset:i,frame_crop_top_offset:n,frame_crop_bottom_offset:o}}throw Error("Invalid data")}(t.data.slice().buffer),{profile_idc:o,constraint_set:s,level_idc:a,pic_width_in_mbs_minus1:l,pic_height_in_map_units_minus1:c,frame_mbs_only_flag:d,frame_crop_left_offset:h,frame_crop_right_offset:p,frame_crop_top_offset:u,frame_crop_bottom_offset:g}=n,w=(l+1)*16,m=(c+1)*(2-d)*16,v=2*h,y=2*p,f=2*u,b=2*g;e=t.data,r.enqueue({type:"configuration",data:{profileIndex:o,constraintSet:s,levelIndex:a,encodedWidth:w,encodedHeight:m,cropLeft:v,cropRight:y,cropTop:f,cropBottom:b,croppedWidth:w-v-y,croppedHeight:m-f-b}});return}e?((i=new Uint8Array(e.byteLength+t.data.byteLength)).set(e),i.set(t.data,e.byteLength),e=void 0):i=t.data,r.enqueue({type:"frame",pts:t.pts,data:i})}}))}}getControlMessageTypes(){return[v.InjectKeyCode,v.InjectText,v.InjectTouch,v.InjectScroll,v.BackOrScreenOn,v.ExpandNotificationPanel,v.CollapseNotificationPanel,v.GetClipboard,v.SetClipboard,v.SetScreenPowerMode,v.RotateDevice]}serializeBackOrScreenOnControlMessage(e){if(e.action===y.Down)return eE.serialize(e)}getScrollController(){return new ek}}let eV=new ed.ZP().fields(eE).uint8("action",(0,ed.W$)());class ej extends eL{constructor(e){super(e)}getArgumentOrder(){return super.getArgumentOrder().concat(["powerOffOnClose"])}getDefaultValue(){return{...super.getDefaultValue(),powerOffOnClose:!1}}getOutputEncoderNameRegex(){return/\s+scrcpy --encoder '(.*?)'/}getControlMessageTypes(){let e=super.getControlMessageTypes();return e.splice(6,0,v.ExpandSettingPanel),e}serializeBackOrScreenOnControlMessage(e){return eV.serialize(e)}}class eT extends ej{constructor(e){super(e)}getDefaultValue(){return{...super.getDefaultValue(),clipboardAutosync:!0}}formatServerArguments(){return Object.entries(this.value).map(([e,t])=>[e,eP(t,void 0)]).filter(e=>void 0!==e[1]).map(([e,t])=>`${e.replace(/([A-Z])/g,"_$1").toLowerCase()}=${t}`)}}let eO=new ed.ZP().fields(eD).int32("buttons");class eI extends ek{serializeScrollMessage(e){let t=this.processMessage(e);if(t)return eO.serialize(t)}}class eU extends eT{constructor(e){e.rawVideoStream&&(e.sendDeviceMeta=!1,e.sendFrameMeta=!1,e.sendDummyByte=!1),super(e)}getDefaultValue(){return{...super.getDefaultValue(),downsizeOnError:!0,sendDeviceMeta:!0,sendDummyByte:!0,rawVideoStream:!1}}getScrollController(){return new eI}}let eN=BigInt(1)<<BigInt(62);class e_ extends eU{constructor(e){super(e)}getDefaultValue(){return{...super.getDefaultValue(),cleanup:!0}}createVideoStreamTransformer(){let e=super.createVideoStreamTransformer();return{writable:e.writable,readable:e.readable.pipeThrough(new ei.GJ({transform(e,t){if("frame"!==e.type){t.enqueue(e);return}void 0!==e.pts&&e.pts&eN&&(e.keyframe=!0,e.pts&=~eN),t.enqueue(e)}}))}}}class eR extends e_{constructor(e){super(e)}getDefaultValue(){return{...super.getDefaultValue(),powerOn:!0}}}let eH=new ed.Pl({size:2,signed:!0,deserialize(e,t){let r=ed.ek.Int16.deserialize(e,t);return r/32767},serialize(e,t,r,i){r*=32767,ed.ek.Int16.serialize(e,t,r,i)}}),eF=new ed.ZP().uint8("type",v.InjectScroll).uint32("pointerX").uint32("pointerY").uint16("screenWidth").uint16("screenHeight").field("scrollX",eH).field("scrollY",eH).int32("buttons");class eB{serializeScrollMessage(e){return eF.serialize(e)}}class eA extends eR{getScrollController(){return new eB}}class eW extends ei.Pz{array;index=0;constructor(e){super({start:async()=>{await Promise.resolve(),this.array=e},pull:e=>{this.index<this.array.length?(e.enqueue(this.array[this.index]),this.index+=1):e.close()}})}}class eG extends ei.Pz{streams;index=0;reader;constructor(...e){super({start:async t=>{await Promise.resolve(),this.streams=e,this.advance(t)},pull:async e=>{let t=await this.reader.read();if(!t.done){e.enqueue(t.value);return}this.advance(e)}})}advance(e){this.index<this.streams.length?(this.reader=this.streams[this.index].getReader(),this.index+=1):e.close()}}class eK extends Error{output;constructor(e){super("scrcpy server exited prematurely"),this.output=e}}class eJ{static pushServer(e,t=ex){let r;return new ei.BF({start:async()=>(r=await e.sync()).write(t),async close(){await r.dispose()}})}static async start(e,t,r,i){let n;let o=i.createConnection(e);try{await o.initialize(),n=await e.subprocess.spawn([`CLASSPATH=${t}`,"app_process","/","com.genymobile.scrcpy.Server",r,...i.formatServerArguments()],{protocols:[ee.vf]});let s=n.stdout.pipeThrough(new ei.xU).pipeThrough(new ei.Jb("\n")),a=[],l=new ei.HS,c=s.pipeTo(new ei.Vj({write(e){a.push(e)}}),{signal:l.signal,preventCancel:!0}).catch(e=>{}),d=await Promise.race([n.exit,o.getStreams()]);if("number"==typeof d)throw new eK(a);l.abort(),await c;let[h,p]=d;return new eJ(i,n,new eG(new eW(a),s),h,p)}catch(u){throw await n?.kill(),u}finally{o.dispose()}}static async getEncoders(e,t,r,i){Object.assign(i.value,{encoderName:"_",control:!1,sendDeviceMeta:!1,sendDummyByte:!1});let n=await eJ.start(e,t,r,i),o=i.getOutputEncoderNameRegex(),s=[];return await n.stdout.pipeTo(new ei.Vj({write(e){let t=e.match(o);t&&s.push(t[1])}})),s}static async getDisplays(e,t,r,i){Object.assign(i.value,{displayId:-1,control:!1,sendDeviceMeta:!1,sendDummyByte:!1});try{await eJ.start(e,t,r,i)}catch(l){if(l instanceof eK){let n=/\s+scrcpy --display (\d+)/,o=[];for(let s of l.output){let a=s.match(n);a&&o.push(Number.parseInt(a[1],10))}return o}}throw Error("failed to get displays")}process;_stdout;get stdout(){return this._stdout}get exit(){return this.process.exit}_screenWidth;get screenWidth(){return this._screenWidth}_screenHeight;get screenHeight(){return this._screenHeight}_videoStream;get videoStream(){return this._videoStream}_controlMessageSerializer;get controlMessageSerializer(){return this._controlMessageSerializer}_deviceMessageStream;get deviceMessageStream(){return this._deviceMessageStream}constructor(e,t,r,i,n){this.process=t,this._stdout=r,this._videoStream=i.pipeThrough(e.createVideoStreamTransformer()).pipeThrough(new ei.N7(e=>{"configuration"===e.type&&(this._screenWidth=e.data.croppedWidth,this._screenHeight=e.data.croppedHeight)})),n&&(this._controlMessageSerializer=new ev(n.writable,e),this._deviceMessageStream=n.readable.pipeThrough(new ef))}async close(){await this.process.kill()}}(w=C=C||(C={}))[w.Baseline=1]="Baseline",w[w.Main=2]="Main",w[w.Extended=4]="Extended",w[w.High=8]="High",w[w.High10=16]="High10",w[w.High422=32]="High422",w[w.High444=64]="High444",w[w.ConstrainedBaseline=65536]="ConstrainedBaseline",w[w.ConstrainedHigh=524288]="ConstrainedHigh",(m=z=z||(z={}))[m.Level1=1]="Level1",m[m.Level1b=2]="Level1b",m[m.Level11=4]="Level11",m[m.Level12=8]="Level12",m[m.Level13=16]="Level13",m[m.Level2=32]="Level2",m[m.Level21=64]="Level21",m[m.Level22=128]="Level22",m[m.Level3=256]="Level3",m[m.Level31=512]="Level31",m[m.Level32=1024]="Level32",m[m.Level4=2048]="Level4",m[m.Level41=4096]="Level41",m[m.Level42=8192]="Level42",m[m.Level5=16384]="Level5",m[m.Level51=32768]="Level51",m[m.Level52=65536]="Level52",m[m.Level6=131072]="Level6",m[m.Level61=262144]="Level61",m[m.Level62=524288]="Level62";let eY=!1,eX=[],eq=0,eZ=new Map;class e$ extends et.Xn{streamId;pictureReadyEvent=new et.vp;get onPictureReady(){return this.pictureReadyEvent.event}constructor(e){var t;super(),this.streamId=e,this.addDisposable((t=this.handlePictureReady,eZ.set(e,t),{dispose(){eZ.delete(e)}}))}handlePictureReady=e=>{this.pictureReadyEvent.fire(e)};feed(e){i.postMessage({type:"decode",data:e,offset:0,length:e.byteLength,renderStateId:this.streamId},[e])}dispose(){super.dispose(),i.postMessage({type:"release",renderStateId:this.streamId})}}function eQ(){return n||(n=Promise.all([r.e(118).then(r.t.bind(r,6118,19)),r.e(337).then(r.t.bind(r,6337,19))]).then(([e,{default:t}])=>({YuvBuffer:e,YuvCanvas:t}))),n}class e0{maxProfile=C.Baseline;maxLevel=z.Level4;_renderer;get renderer(){return this._renderer}_frameRendered=0;get frameRendered(){return this._frameRendered}_writable;get writable(){return this._writable}_yuvCanvas;_initializer;constructor(){eQ(),this._renderer=document.createElement("canvas"),this._writable=new ei.Vj({write:async e=>{switch(e.type){case"configuration":this.configure(e.data);break;case"frame":{if(!this._initializer)throw Error("Decoder not configured");let t=await this._initializer.promise;t.feed(e.data.slice().buffer)}}}})}async configure(e){this.dispose(),this._initializer=new er.hP;let{YuvBuffer:t,YuvCanvas:n}=await eQ();this._yuvCanvas||(this._yuvCanvas=n.attach(this._renderer));let{encodedWidth:o,encodedHeight:s}=e,a=o/2,l=s/2;this._renderer.width=e.croppedWidth,this._renderer.height=e.croppedHeight;let c=t.format({width:o,height:s,chromaWidth:a,chromaHeight:l,cropLeft:e.cropLeft,cropTop:e.cropTop,cropWidth:e.croppedWidth,cropHeight:e.croppedHeight,displayWidth:e.croppedWidth,displayHeight:e.croppedHeight}),d=await function(){if(i||(i=new Worker(r.tu(new URL(r.p+r.u(292),r.b)))).addEventListener("message",({data:e})=>{switch(e.type){case"decoderReady":for(let t of(eY=!0,eX))t.resolve(new e$(eq)),eq+=1;eX.length=0;break;case"pictureReady":eZ.get(e.renderStateId)?.(e)}}),!eY){let e=new er.hP;return eX.push(e),e.promise}let t=new e$(eq);return eq+=1,Promise.resolve(t)}();this._initializer.resolve(d);let h=o*s,p=h+a*l;d.onPictureReady(({data:e})=>{this._frameRendered+=1;let r=new Uint8Array(e),i=t.frame(c,t.lumaPlane(c,r,o,0),t.chromaPlane(c,r,a,h),t.chromaPlane(c,r,a,p));this._yuvCanvas.drawFrame(i)})}dispose(){this._initializer?.promise.then(e=>e.dispose()).catch(e=>{}),this._initializer=void 0}}function e1(e){return e.toString(16).padStart(2,"0").toUpperCase()}class e2{maxProfile=void 0;maxLevel=void 0;_writable;get writable(){return this._writable}_renderer;get renderer(){return this._renderer}_frameRendered=0;get frameRendered(){return this._frameRendered}context;decoder;lastFrame;animationFrame=0;constructor(){this._renderer=document.createElement("canvas"),this.context=this._renderer.getContext("2d"),this.decoder=new VideoDecoder({output:e=>{this.lastFrame&&this.lastFrame.close(),this.lastFrame=e,this.animationFrame||this.render()},error(e){}}),this._writable=new ei.Vj({write:e=>{switch(e.type){case"configuration":this.configure(e.data);break;case"frame":this.decoder.decode(new EncodedVideoChunk({type:!1===e.keyframe?"delta":"key",timestamp:0,data:e.data}))}}})}render=()=>{this.lastFrame&&(this._frameRendered+=1,this.context.drawImage(this.lastFrame,0,0),this.lastFrame.close(),this.lastFrame=void 0),this.animationFrame=requestAnimationFrame(this.render)};configure(e){let{profileIndex:t,constraintSet:r,levelIndex:i}=e;this._renderer.width=e.croppedWidth,this._renderer.height=e.croppedHeight;let n=`avc1.${[t,r,i].map(e1).join("")}`;this.decoder.configure({codec:n,optimizeForLatency:!0})}dispose(){cancelAnimationFrame(this.animationFrame),this.decoder.close()}}var e3="1.25",e4=r(8763),e6=r(1436),e8=r(291);let e7=new r.U(r(4439));class e5{get downloaded(){return this._downloaded}get total(){return this._total}get onProgress(){return this.progressEvent.event}async fetch(e){var t;let r=await window.fetch(e);this._total=Number.parseInt(null!==(t=r.headers.get("Content-Length"))&&void 0!==t?t:"0",10),this.progressEvent.fire([this._downloaded,this._total]);let i=r.body.getReader(),n=[];for(;;){let o=await i.read();if(o.done)break;n.push(o.value),this._downloaded+=o.value.byteLength,this.progressEvent.fire([this._downloaded,this._total])}this._total=n.reduce((e,t)=>e+t.byteLength,0);let s=new Uint8Array(this._total),a=0;for(let l of n)s.set(l,a),a+=l.byteLength;return s}constructor(e){this._downloaded=0,this._total=0,this.progressEvent=new et.vp,this.promise=this.fetch(e)}}function e9(e){return o||(o=new e5(e7)).promise.catch(e=>{o=void 0}),e&&(o.onProgress(e),e([o.downloaded,o.total])),o.promise}let te=(0,X.Z)({labelRight:{marginLeft:"4px"},video:{transformOrigin:"center center"}}),tt=(0,Z.Pi)(function(e){let{definition:t,settings:r,onChange:i}=e,n=te(),o=(0,M.jsxs)(E.K,{horizontal:!0,verticalAlign:"center",children:[(0,M.jsx)("span",{children:t.label}),!!t.description&&(0,M.jsx)(L.G,{content:t.description,children:(0,M.jsx)(V.J,{className:n.labelRight,iconName:e8.PJ.Info})}),t.labelExtra]});switch(t.type){case"text":return(0,M.jsx)(j.n,{label:o,placeholder:t.placeholder,value:r[t.key],onChange:(e,r)=>i(t.key,r)});case"dropdown":return(0,M.jsx)(T.L,{label:o,options:t.options,placeholder:t.placeholder,selectedKey:r[t.key],onChange:(e,r)=>i(t.key,r.key)});case"toggle":return(0,M.jsx)(O.Z,{label:o,checked:r[t.key],onChange:(e,r)=>i(t.key,r)});case"number":return(0,M.jsx)(I.k,{label:t.label,labelPosition:U.L.top,min:t.min,max:t.max,step:t.step,value:r[t.key].toString(),onChange:(e,r)=>i(t.key,Number.parseInt(r,10))})}}),tr={Enter:f.Enter,Escape:f.Escape,Backspace:f.Delete,Tab:f.Tab,Delete:f.ForwardDelete,Home:f.MoveHome,End:f.MoveEnd,Space:f.Space,ArrowUp:f.DPadUp,ArrowDown:f.DPadDown,ArrowLeft:f.DPadLeft,ArrowRight:f.DPadRight},ti=new class{get rotatedWidth(){return 1&ti.rotate?ti.height:ti.width}get rotatedHeight(){return 1&ti.rotate?ti.width:ti.height}async pushServer(){let e=await e9();await new ei.Pz({start(t){t.enqueue(e),t.close()}}).pipeTo(eJ.pushServer(e6.q.device))}get commandBarItems(){let e=[];return this.running?e.push({key:"stop",iconProps:{iconName:e8.PJ.Stop},text:"Stop",onClick:this.stop}):e.push({key:"start",disabled:!e6.q.device,iconProps:{iconName:e8.PJ.Play},text:"Start",onClick:this.start}),e.push({key:"fullscreen",disabled:!this.running,iconProps:{iconName:e8.PJ.FullScreenMaximize},iconOnly:!0,text:"Fullscreen",onClick:()=>{var e;null===(e=this.deviceView)||void 0===e||e.enterFullscreen()}}),e.push({key:"volumeUp",disabled:!this.running,iconProps:{iconName:e8.PJ.Speaker2},iconOnly:!0,text:"Volume Up",onClick:async()=>{var e,t;await (null===(e=this.client)||void 0===e?void 0:e.controlMessageSerializer.injectKeyCode({action:y.Down,keyCode:f.VolumeUp,repeat:0,metaState:0})),await (null===(t=this.client)||void 0===t?void 0:t.controlMessageSerializer.injectKeyCode({action:y.Up,keyCode:f.VolumeUp,repeat:0,metaState:0}))}},{key:"volumeDown",disabled:!this.running,iconProps:{iconName:e8.PJ.Speaker1},iconOnly:!0,text:"Volume Down",onClick:async()=>{var e,t;await (null===(e=this.client)||void 0===e?void 0:e.controlMessageSerializer.injectKeyCode({action:y.Down,keyCode:f.VolumeDown,repeat:0,metaState:0})),await (null===(t=this.client)||void 0===t?void 0:t.controlMessageSerializer.injectKeyCode({action:y.Up,keyCode:f.VolumeDown,repeat:0,metaState:0}))}},{key:"volumeMute",disabled:!this.running,iconProps:{iconName:e8.PJ.SpeakerOff},iconOnly:!0,text:"Toggle Mute",onClick:async()=>{var e,t;await (null===(e=this.client)||void 0===e?void 0:e.controlMessageSerializer.injectKeyCode({action:y.Down,keyCode:f.VolumeMute,repeat:0,metaState:0})),await (null===(t=this.client)||void 0===t?void 0:t.controlMessageSerializer.injectKeyCode({action:y.Up,keyCode:f.VolumeMute,repeat:0,metaState:0}))}}),e.push({key:"rotateDevice",disabled:!this.running,iconProps:{iconName:e8.PJ.Orientation},iconOnly:!0,text:"Rotate Device",onClick:()=>{this.client.controlMessageSerializer.rotateDevice()}},{key:"rotateVideoLeft",disabled:!this.running,iconProps:{iconName:e8.PJ.RotateLeft},iconOnly:!0,text:"Rotate Video Left",onClick:(0,q.aD)(()=>{this.rotate-=1,this.rotate<0&&(this.rotate=3)})},{key:"rotateVideoRight",disabled:!this.running,iconProps:{iconName:e8.PJ.RotateRight},iconOnly:!0,text:"Rotate Video Right",onClick:(0,q.aD)(()=>{this.rotate=this.rotate+1&3})}),e.push({key:"turnScreenOff",disabled:!this.running,iconProps:{iconName:e8.PJ.Lightbulb},iconOnly:!0,text:"Turn Screen Off",onClick:()=>{this.client.controlMessageSerializer.setScreenPowerMode(x.Off)}},{key:"turnScreenOn",disabled:!this.running,iconProps:{iconName:e8.PJ.LightbulbFilament},iconOnly:!0,text:"Turn Screen On",onClick:()=>{this.client.controlMessageSerializer.setScreenPowerMode(x.Normal)}}),this.running&&e.push({key:"fps",text:"FPS: ".concat(this.fps),disabled:!0}),e}get commandBarFarItems(){return[{key:"NavigationBar",iconProps:{iconName:e8.PJ.PanelBottom},checked:this.navigationBarVisible,text:"Navigation Bar",iconOnly:!0,onClick:(0,q.aD)(()=>{this.navigationBarVisible=!this.navigationBarVisible})},{key:"Log",iconProps:{iconName:e8.PJ.TextGrammarError},checked:this.logVisible,text:"Log",iconOnly:!0,onClick:(0,q.aD)(()=>{this.logVisible=!this.logVisible})},{key:"Settings",iconProps:{iconName:e8.PJ.Settings},checked:this.settingsVisible,text:"Settings",iconOnly:!0,onClick:(0,q.aD)(()=>{this.settingsVisible=!this.settingsVisible})},{key:"DemoMode",iconProps:{iconName:e8.PJ.Wand},checked:this.demoModeVisible,text:"Demo Mode",iconOnly:!0,onClick:(0,q.aD)(()=>{this.demoModeVisible=!this.demoModeVisible})},{key:"info",iconProps:{iconName:e8.PJ.Info},iconOnly:!0,tooltipHostProps:{content:(0,M.jsxs)(M.Fragment,{children:[(0,M.jsxs)("p",{children:[(0,M.jsx)(e4.dL,{href:"https://github.com/Genymobile/scrcpy",spaceAfter:!0,children:"Scrcpy"}),"developed by Genymobile can display the screen with low latency (1~2 frames) and control the device, all without root access."]}),(0,M.jsx)("p",{children:"This is a TypeScript implementation of the client part. Paired with official pre-built server binary."})]}),calloutProps:{calloutMaxWidth:300}}}]}get settingDefinitions(){let e=[];return e.push({key:"powerOn",type:"toggle",label:"Turn device on when starting"},{key:"turnScreenOff",type:"toggle",label:"Turn screen off when starting"},{key:"stayAwake",type:"toggle",label:"Stay awake (if plugged in)"},{key:"powerOffOnClose",type:"toggle",label:"Turn device off when exiting"}),e.push({key:"displayId",type:"dropdown",label:"Display",placeholder:"Press refresh to update available displays",labelExtra:(0,M.jsx)(N.h,{iconProps:{iconName:e8.PJ.ArrowClockwise},disabled:!e6.q.device,text:"Refresh",onClick:this.updateDisplays}),options:this.displays.map(e=>({key:e,text:e.toString()}))}),e.push({key:"crop",type:"text",label:"Crop",placeholder:"W:H:X:Y"}),e.push({key:"maxSize",type:"number",label:"Max Resolution (longer side, 0 = unlimited)",min:0,max:2560,step:50}),e.push({key:"bitRate",type:"number",label:"Max Bit Rate",min:100,max:1e8,step:100}),e.push({key:"lockVideoOrientation",type:"dropdown",label:"Lock Video Orientation",options:[{key:k.Unlocked,text:"Unlocked"},{key:k.Initial,text:"Current"},{key:k.Portrait,text:"Portrait"},{key:k.Landscape,text:"Landscape"},{key:k.PortraitFlipped,text:"Portrait (Flipped)"},{key:k.LandscapeFlipped,text:"Landscape (Flipped)"}]}),e.push({key:"encoderName",type:"dropdown",label:"Encoder",placeholder:"Press refresh to update available encoders",labelExtra:(0,M.jsx)(N.h,{iconProps:{iconName:e8.PJ.ArrowClockwise},disabled:!e6.q.device,text:"Refresh",onClick:this.updateEncoders}),options:this.encoders.map(e=>({key:e,text:e}))}),this.decoders.length>1&&e.push({key:"decoder",type:"dropdown",label:"Decoder",options:this.decoders.map(e=>({key:e.key,text:e.name,data:e}))}),e.push({key:"ignoreDecoderCodecArgs",type:"toggle",label:"Ignore decoder's codec arguments",description:"Some decoders don't support all H.264 profile/levels, so they request the device to encode at their highest-supported codec. However, some super old devices may not support that codec so their encoders will fail to start. Use this option to let device choose the codec to be used."}),e.push({key:"tunnelForward",type:"toggle",label:"Use forward connection",description:"Android before version 9 has a bug that prevents reverse tunneling when using ADB over WiFi."}),e}async stop(){var e;await (null===(e=this.client)||void 0===e?void 0:e.close()),this.dispose()}dispose(){var e;null===(e=this.decoder)||void 0===e||e.dispose(),this.decoder=void 0,this.fps=0,clearTimeout(this.fpsCounterIntervalId),this.client=void 0,this.running=!1}handleDeviceViewRef(e){this.deviceView=e}handleRendererContainerRef(e){var t;this.rendererContainer=e,null===(t=this.rendererContainer)||void 0===t||t.addEventListener("wheel",this.handleWheel,{passive:!1})}calculatePointerPosition(e,t){var r,i;let n=this.rendererContainer.getBoundingClientRect(),o=(r=(e-n.x)/n.width)<0?0:r>1?1:r,s=(i=(t-n.y)/n.height)<0?0:i>1?1:i;switch(1&this.rotate&&([o,s]=[s,o]),this.rotate){case 1:s=1-s;break;case 2:o=1-o,s=1-s;break;case 3:o=1-o}return{x:o*this.width,y:s*this.height}}constructor(){this.running=!1,this.deviceView=null,this.rendererContainer=null,this.logVisible=!1,this.log=[],this.settingsVisible=!1,this.demoModeVisible=!1,this.navigationBarVisible=!0,this.width=0,this.height=0,this.rotate=0,this.client=void 0,this.encoders=[],this.updateEncoders=async()=>{try{await this.pushServer();let e=await eJ.getEncoders(e6.q.device,ex,e3,new ec(new eA({logLevel:D.Debug,tunnelForward:this.settings.tunnelForward})));(0,q.z)(()=>{this.encoders=e,this.settings.encoderName&&this.encoders.includes(this.settings.encoderName)||(this.settings.encoderName=this.encoders[0])})}catch(t){e6.q.showErrorDialog(t)}},this.decoders=[{key:"tinyh264",name:"TinyH264 (Software)",Constructor:e0}],this.decoder=void 0,this.fpsCounterIntervalId=void 0,this.fps=0,this.displays=[],this.updateDisplays=async()=>{try{await this.pushServer();let e=await eJ.getDisplays(e6.q.device,ex,e3,new ec(new eA({logLevel:D.Debug,tunnelForward:this.settings.tunnelForward})));(0,q.z)(()=>{this.displays=e,this.settings.displayId&&this.displays.includes(this.settings.displayId)||(this.settings.displayId=this.displays[0])})}catch(t){e6.q.showErrorDialog(t)}},this.connecting=!1,this.serverTotalSize=0,this.serverDownloadedSize=0,this.debouncedServerDownloadedSize=0,this.serverDownloadSpeed=0,this.serverUploadedSize=0,this.debouncedServerUploadedSize=0,this.serverUploadSpeed=0,this.settings={maxSize:1080,bitRate:4e6,lockVideoOrientation:k.Unlocked,displayId:0,crop:"",powerOn:!0},this.start=async()=>{if(e6.q.device)try{var e;let t;if(!this.settings.decoder)throw Error("No available decoder");(0,q.z)(()=>{this.serverTotalSize=0,this.serverDownloadedSize=0,this.debouncedServerDownloadedSize=0,this.serverUploadedSize=0,this.debouncedServerUploadedSize=0,this.connecting=!0});let r=setInterval((0,q.aD)(()=>{this.serverDownloadSpeed=this.serverDownloadedSize-this.debouncedServerDownloadedSize,this.debouncedServerDownloadedSize=this.serverDownloadedSize}),1e3);try{t=await e9((0,q.aD)(e=>{let[t,r]=e;this.serverDownloadedSize=t,this.serverTotalSize=r})),(0,q.z)(()=>{this.serverDownloadSpeed=this.serverDownloadedSize-this.debouncedServerDownloadedSize,this.debouncedServerDownloadedSize=this.serverDownloadedSize})}finally{clearInterval(r)}r=setInterval((0,q.aD)(()=>{this.serverUploadSpeed=this.serverUploadedSize-this.debouncedServerUploadedSize,this.debouncedServerUploadedSize=this.serverUploadedSize}),1e3);try{await new ei.Pz({start(e){e.enqueue(t),e.close()}}).pipeThrough(new ei.Cc(ee.j4)).pipeThrough(new e8.hK((0,q.aD)(e=>{this.serverUploadedSize=e}))).pipeTo(eJ.pushServer(e6.q.device)),(0,q.z)(()=>{this.serverUploadSpeed=this.serverUploadedSize-this.debouncedServerUploadedSize,this.debouncedServerUploadedSize=this.serverUploadedSize})}finally{clearInterval(r)}let i=null!==(e=this.decoders.find(e=>e.key===this.settings.decoder))&&void 0!==e?e:this.decoders[0],n=new i.Constructor;(0,q.z)(()=>{this.decoder=n;let e=0;this.fpsCounterIntervalId=setInterval((0,q.aD)(()=>{this.fps=n.frameRendered-e,e=n.frameRendered}),1e3)});let o=new ec(new eA({logLevel:D.Debug,...this.settings,sendDeviceMeta:!1,sendDummyByte:!1,codecOptions:this.settings.ignoreDecoderCodecArgs?void 0:new eS({profile:n.maxProfile,level:n.maxLevel})}));(0,q.z)(()=>{this.log=[],this.log.push("[client] Server version: ".concat(e3)),this.log.push("[client] Server arguments: ".concat(o.formatServerArguments().join(" ")))});let s=await eJ.start(e6.q.device,ex,e3,o);s.stdout.pipeTo(new ei.Vj({write:(0,q.aD)(e=>{this.log.push(e)})})),s.videoStream.pipeThrough(new ei.N7((0,q.aD)(e=>{if("configuration"===e.type){let{croppedWidth:t,croppedHeight:r}=e.data;this.log.push("[client] Video size changed: ".concat(t,"x").concat(r)),this.width=t,this.height=r}}))).pipeTo(n.writable).catch(()=>{}),s.exit.then(this.dispose),s.deviceMessageStream.pipeTo(new ei.Vj({write(e){e.type===P.Clipboard&&window.navigator.clipboard.writeText(e.content)}})).catch(()=>{}),this.settings.turnScreenOff&&await s.controlMessageSerializer.setScreenPowerMode(x.Off),(0,q.z)(()=>{this.client=s,this.running=!0})}catch(a){e6.q.showErrorDialog(a)}finally{(0,q.z)(()=>{this.connecting=!1})}},this.handleBackPointerDown=e=>{this.client&&0===e.button&&(e.currentTarget.setPointerCapture(e.pointerId),this.client.controlMessageSerializer.backOrScreenOn(y.Down))},this.handleBackPointerUp=e=>{this.client&&0===e.button&&this.client.controlMessageSerializer.backOrScreenOn(y.Up)},this.handleHomePointerDown=e=>{this.client&&0===e.button&&(e.currentTarget.setPointerCapture(e.pointerId),this.client.controlMessageSerializer.injectKeyCode({action:y.Down,keyCode:f.Home,repeat:0,metaState:0}))},this.handleHomePointerUp=e=>{this.client&&0===e.button&&this.client.controlMessageSerializer.injectKeyCode({action:y.Up,keyCode:f.Home,repeat:0,metaState:0})},this.handleAppSwitchPointerDown=async e=>{this.client&&0===e.button&&(e.currentTarget.setPointerCapture(e.pointerId),this.client.controlMessageSerializer.injectKeyCode({action:y.Down,keyCode:f.AppSwitch,repeat:0,metaState:0}))},this.handleAppSwitchPointerUp=async e=>{this.client&&0===e.button&&this.client.controlMessageSerializer.injectKeyCode({action:y.Up,keyCode:f.AppSwitch,repeat:0,metaState:0})},this.injectTouch=(e,t)=>{let r;if(!this.client)return;let{pointerType:i}=t,{pressure:n}=t;"mouse"===i?(r=S.Finger,n=0===n?0:1):r=BigInt(t.pointerId);let{x:o,y:s}=this.calculatePointerPosition(t.clientX,t.clientY);this.client.controlMessageSerializer.injectTouch({action:e,pointerId:r,screenWidth:this.client.screenWidth,screenHeight:this.client.screenHeight,pointerX:o,pointerY:s,pressure:n,buttons:t.buttons})},this.handlePointerDown=e=>{this.rendererContainer.focus(),e.preventDefault(),e.currentTarget.setPointerCapture(e.pointerId),this.injectTouch(b.Down,e)},this.handlePointerMove=e=>{this.injectTouch(0===e.buttons?b.HoverMove:b.Move,e)},this.handlePointerUp=e=>{this.injectTouch(b.Up,e)},this.handleWheel=e=>{if(!this.client)return;e.preventDefault(),e.stopPropagation();let{x:t,y:r}=this.calculatePointerPosition(e.clientX,e.clientY);this.client.controlMessageSerializer.injectScroll({screenWidth:this.client.screenWidth,screenHeight:this.client.screenHeight,pointerX:t,pointerY:r,scrollX:e.deltaX/100,scrollY:e.deltaY/100,buttons:0})},this.handleContextMenu=e=>{e.preventDefault()},this.handleKeyDown=async e=>{if(!this.client)return;let{key:t,code:r}=e;if(t.match(/^[!-`{-~]$/i)){this.client.controlMessageSerializer.injectText(t);return}let i=tr[r];i&&(e.preventDefault(),e.stopPropagation(),this.client.controlMessageSerializer.injectKeyCode({action:y.Down,keyCode:i,metaState:0,repeat:0}),this.client.controlMessageSerializer.injectKeyCode({action:y.Up,keyCode:i,metaState:0,repeat:0}))},(0,q.ky)(this,{decoders:q.LO.shallow,settings:q.LO.deep,start:!1,stop:q.aD.bound,dispose:q.aD.bound,handleDeviceViewRef:q.aD.bound,handleRendererContainerRef:q.aD.bound,handleBackPointerDown:!1,handleBackPointerUp:!1,handleHomePointerDown:!1,handleHomePointerUp:!1,handleAppSwitchPointerDown:!1,handleAppSwitchPointerUp:!1,calculatePointerPosition:!1,injectTouch:!1,handlePointerDown:!1,handlePointerMove:!1,handlePointerUp:!1,handleWheel:!1,handleContextMenu:!1,handleKeyDown:!1}),(0,q.EH)(()=>{e6.q.device?(0,q.z)(()=>{this.encoders=[],this.settings.encoderName=void 0,this.displays=[],this.settings.displayId=void 0}):this.dispose()}),(0,q.EH)(()=>{if(this.rendererContainer&&this.decoder){for(;this.rendererContainer.firstChild;)this.rendererContainer.firstChild.remove();this.rendererContainer.appendChild(this.decoder.renderer)}}),(0,q.EH)(()=>{this.settings.decoder=this.decoders[0].key})}},tn=(0,Z.Pi)(()=>{let e=(0,Y.M)("layerHost"),[t,r]=(0,R.useState)(!1);return((0,R.useEffect)(()=>{r(!0)},[]),t)?(0,M.jsxs)(M.Fragment,{children:[(0,M.jsx)(W,{id:e,style:{position:"absolute",top:0,bottom:0,left:0,right:0,margin:0,pointerEvents:"none"}}),(0,M.jsx)(G.V,{hidden:!ti.connecting,modalProps:{layerProps:{hostId:e}},dialogContentProps:{title:"Connecting..."},children:(0,M.jsxs)(E.K,{tokens:e8.WT,children:[(0,M.jsx)(K.Y,{label:"1. Downloading scrcpy server...",percentComplete:ti.serverTotalSize?ti.serverDownloadedSize/ti.serverTotalSize:void 0,description:(0,e8.CY)(ti.debouncedServerDownloadedSize,ti.serverTotalSize,ti.serverDownloadSpeed)}),(0,M.jsx)(K.Y,{label:"2. Pushing scrcpy server to device...",progressHidden:0===ti.serverTotalSize||ti.serverDownloadedSize!==ti.serverTotalSize,percentComplete:ti.serverUploadedSize/ti.serverTotalSize,description:(0,e8.CY)(ti.debouncedServerUploadedSize,ti.serverTotalSize,ti.serverUploadSpeed)}),(0,M.jsx)(K.Y,{label:"3. Starting scrcpy server on device...",progressHidden:0===ti.serverTotalSize||ti.serverUploadedSize!==ti.serverTotalSize})]})})]}):null}),to=(0,Z.Pi)(function(e){let{className:t,style:r,children:i}=e;return ti.navigationBarVisible?(0,M.jsxs)(E.K,{className:t,verticalFill:!0,horizontalAlign:"center",style:{height:"40px",background:"#999",...r},children:[i,(0,M.jsxs)(E.K,{verticalFill:!0,horizontal:!0,style:{width:"100%",maxWidth:300},horizontalAlign:"space-evenly",verticalAlign:"center",children:[(0,M.jsx)(N.h,{iconProps:{iconName:e8.PJ.Play},style:{transform:"rotate(180deg)",color:"white"},onPointerDown:ti.handleBackPointerDown,onPointerUp:ti.handleBackPointerUp}),(0,M.jsx)(N.h,{iconProps:{iconName:e8.PJ.Circle},style:{color:"white"},onPointerDown:ti.handleHomePointerDown,onPointerUp:ti.handleHomePointerUp}),(0,M.jsx)(N.h,{iconProps:{iconName:e8.PJ.Stop},style:{color:"white"},onPointerDown:ti.handleAppSwitchPointerDown,onPointerUp:ti.handleAppSwitchPointerUp})]})]}):(0,M.jsx)("div",{className:t,style:r,children:i})}),ts=()=>{let e=te();return(0,R.useEffect)(()=>{1===ti.decoders.length&&"function"==typeof window.VideoDecoder&&(0,q.z)(()=>{ti.decoders.unshift({key:"webcodecs",name:"WebCodecs",Constructor:e2})})},[]),(0,M.jsxs)(E.K,{...e8.LE,children:[(0,M.jsx)(Q(),{children:(0,M.jsx)("title",{children:"Scrcpy - Android Web Toolbox"})}),(0,M.jsx)(J.X,{items:ti.commandBarItems,farItems:ti.commandBarFarItems}),(0,M.jsxs)(E.K,{horizontal:!0,grow:!0,styles:{root:{height:0}},children:[(0,M.jsx)(e4.wM,{ref:ti.handleDeviceViewRef,width:ti.rotatedWidth,height:ti.rotatedHeight,BottomElement:to,children:(0,M.jsx)("div",{ref:ti.handleRendererContainerRef,tabIndex:-1,className:e.video,style:{width:ti.width,height:ti.height,transform:"translate(".concat((ti.rotatedWidth-ti.width)/2,"px, ").concat((ti.rotatedHeight-ti.height)/2,"px) rotate(").concat(90*ti.rotate,"deg)")},onPointerDown:ti.handlePointerDown,onPointerMove:ti.handlePointerMove,onPointerUp:ti.handlePointerUp,onPointerCancel:ti.handlePointerUp,onKeyDown:ti.handleKeyDown,onContextMenu:ti.handleContextMenu})}),(0,M.jsx)("div",{style:{padding:12,overflow:"hidden auto",display:ti.logVisible?"block":"none",width:500,fontFamily:"monospace",overflowY:"auto",whiteSpace:"pre-wrap",wordWrap:"break-word"},children:ti.log.map((e,t)=>(0,M.jsx)("div",{children:e},t))}),(0,M.jsxs)("div",{style:{padding:12,overflow:"hidden auto",display:ti.settingsVisible?"block":"none",width:300},children:[(0,M.jsx)("div",{children:"Changes will take effect on next connection"}),ti.settingDefinitions.map(e=>(0,M.jsx)(tt,{definition:e,settings:ti.settings,onChange:(0,q.aD)((e,t)=>ti.settings[e]=t)},e.key))]}),(0,M.jsx)(e4.bq,{style:{display:ti.demoModeVisible?"block":"none"}}),(0,M.jsx)(tn,{})]})]})};var ta=(0,Z.Pi)(ts)},4439:function(e,t,r){"use strict";e.exports=r.p+"static/chunks/scrcpy-server.50786887a0e88460"}},function(e){e.O(0,[910,774,888,179],function(){return e(e.s=7718)}),_N_E=e.O()}]);
//# sourceMappingURL=scrcpy-87d3723328cff3c9.js.map