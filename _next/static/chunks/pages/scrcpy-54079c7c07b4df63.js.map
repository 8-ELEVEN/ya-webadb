{"version":3,"file":"static/chunks/pages/scrcpy-54079c7c07b4df63.js","mappings":"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","sources":["webpack://_N_E/?51bc","webpack://_N_E/../../libraries/scrcpy-decoder-webcodecs/src/index.ts","webpack://_N_E/../../libraries/scrcpy/src/adb/connection.ts","webpack://_N_E/../../libraries/scrcpy/src/adb/options/types.ts","webpack://_N_E/../../libraries/scrcpy/src/adb/options/1_16.ts","webpack://_N_E/../../libraries/scrcpy/src/adb/options/1_22.ts","webpack://_N_E/../../libraries/scrcpy/src/adb/options/index.ts","webpack://_N_E/../../libraries/scrcpy/src/control/type.ts","webpack://_N_E/../../libraries/scrcpy/src/control/inject-touch.ts","webpack://_N_E/../../libraries/scrcpy/src/control/hover-helper.ts","webpack://_N_E/../../libraries/scrcpy/src/control/inject-keycode.ts","webpack://_N_E/../../libraries/scrcpy/src/control/inject-text.ts","webpack://_N_E/../../libraries/scrcpy/src/control/rotate-device.ts","webpack://_N_E/../../libraries/scrcpy/src/control/set-screen-power-mode.ts","webpack://_N_E/../../libraries/scrcpy/src/control/serializer.ts","webpack://_N_E/../../libraries/scrcpy/src/control/index.ts","webpack://_N_E/../../libraries/scrcpy/src/device-message/type.ts","webpack://_N_E/../../libraries/scrcpy/src/device-message/ack-clipboard.ts","webpack://_N_E/../../libraries/scrcpy/src/device-message/clipboard.ts","webpack://_N_E/../../libraries/scrcpy/src/device-message/stream.ts","webpack://_N_E/../../libraries/scrcpy/src/device-message/index.ts","webpack://_N_E/../../libraries/scrcpy/src/options/1_16/codec-options.ts","webpack://_N_E/../../libraries/scrcpy/src/options/1_16/h264-configuration.ts","webpack://_N_E/../../libraries/scrcpy/src/options/types.ts","webpack://_N_E/../../libraries/scrcpy/src/options/1_16/scroll.ts","webpack://_N_E/../../libraries/scrcpy/src/options/1_16/options.ts","webpack://_N_E/../../libraries/scrcpy/src/options/1_16/index.ts","webpack://_N_E/../../libraries/scrcpy/src/options/1_18.ts","webpack://_N_E/../../libraries/scrcpy/src/options/1_21.ts","webpack://_N_E/../../libraries/scrcpy/src/options/1_22/scroll.ts","webpack://_N_E/../../libraries/scrcpy/src/options/1_22/options.ts","webpack://_N_E/../../libraries/scrcpy/src/options/1_22/index.ts","webpack://_N_E/../../libraries/scrcpy/src/options/1_23.ts","webpack://_N_E/../../libraries/scrcpy/src/options/1_24.ts","webpack://_N_E/../../libraries/scrcpy/src/options/1_25/scroll.ts","webpack://_N_E/../../libraries/scrcpy/src/options/1_25/options.ts","webpack://_N_E/../../libraries/scrcpy/src/options/1_25/index.ts","webpack://_N_E/../../libraries/scrcpy/src/options/index.ts","webpack://_N_E/../../libraries/scrcpy/src/adb/client.ts","webpack://_N_E/../../libraries/scrcpy/src/adb/index.ts","webpack://_N_E/../../libraries/scrcpy/src/codec.ts","webpack://_N_E/../../libraries/scrcpy/src/index.ts","webpack://_N_E/./src/components/scrcpy/command-bar-spacer-item.tsx","webpack://_N_E/./src/components/scrcpy/recorder.ts","webpack://_N_E/../../libraries/scrcpy-decoder-tinyh264/src/wrapper.ts","webpack://_N_E/../../libraries/scrcpy-decoder-tinyh264/src/index.ts","webpack://_N_E/../../libraries/scrcpy/bin/version.js","webpack://_N_E/./src/components/scrcpy/fetch-server.ts","webpack://_N_E/./src/components/scrcpy/state.tsx","webpack://_N_E/./src/components/scrcpy/settings.tsx","webpack://_N_E/./src/components/scrcpy/command-bar.tsx","webpack://_N_E/./src/components/scrcpy/navigation-bar.tsx","webpack://_N_E/./src/components/scrcpy/video-container.tsx","webpack://_N_E/./src/components/scrcpy/index.ts","webpack://_N_E/./src/pages/scrcpy.tsx","webpack://_N_E/<anon>"],"sourcesContent":["\n    (window.__NEXT_P = window.__NEXT_P || []).push([\n      \"/scrcpy\",\n      function () {\n        return require(\"private-next-pages/scrcpy.tsx\");\n      }\n    ]);\n    if(module.hot) {\n      module.hot.dispose(function () {\n        window.__NEXT_P.push([\"/scrcpy\"])\n      });\n    }\n  ","import {\n    type H264Configuration,\n    type ScrcpyVideoStreamPacket,\n} from \"@yume-chan/scrcpy\";\nimport { WritableStream } from \"@yume-chan/stream-extra\";\n\nfunction toHex(value: number) {\n    return value.toString(16).padStart(2, \"0\").toUpperCase();\n}\n\nexport class WebCodecsDecoder {\n    // Usually, browsers can decode most configurations,\n    // So let device choose best profile and level for itself.\n    public readonly maxProfile = undefined;\n    public readonly maxLevel = undefined;\n\n    private _writable: WritableStream<ScrcpyVideoStreamPacket>;\n    public get writable() {\n        return this._writable;\n    }\n\n    private _renderer: HTMLCanvasElement;\n    public get renderer() {\n        return this._renderer;\n    }\n\n    private _frameRendered = 0;\n    public get frameRendered() {\n        return this._frameRendered;\n    }\n\n    private _frameSkipped = 0;\n    public get frameSkipped() {\n        return this._frameSkipped;\n    }\n\n    private context: CanvasRenderingContext2D;\n    private decoder: VideoDecoder;\n\n    private currentFrameRendered = false;\n    private animationFrameId = 0;\n\n    public constructor() {\n        this._renderer = document.createElement(\"canvas\");\n\n        this.context = this._renderer.getContext(\"2d\")!;\n        this.decoder = new VideoDecoder({\n            output: (frame) => {\n                if (this.currentFrameRendered) {\n                    this._frameSkipped += 1;\n                } else {\n                    this.currentFrameRendered = true;\n                    this._frameRendered += 1;\n                }\n\n                // PERF: H.264 renderer may draw multiple frames in one vertical sync interval to minimize latency.\n                // When multiple frames are drawn in one vertical sync interval,\n                // only the last one is visible to users.\n                // But this ensures users can always see the most up-to-date screen.\n                // This is also the behavior of official Scrcpy client.\n                // https://github.com/Genymobile/scrcpy/issues/3679\n                this.context.drawImage(frame, 0, 0);\n                frame.close();\n            },\n            error(e) {\n                void e;\n            },\n        });\n\n        this._writable = new WritableStream<ScrcpyVideoStreamPacket>({\n            write: (packet) => {\n                switch (packet.type) {\n                    case \"configuration\":\n                        this.configure(packet.data);\n                        break;\n                    case \"frame\":\n                        this.decoder.decode(\n                            new EncodedVideoChunk({\n                                // Treat `undefined` as `key`, otherwise won't decode.\n                                type:\n                                    packet.keyframe === false ? \"delta\" : \"key\",\n                                timestamp: 0,\n                                data: packet.data,\n                            })\n                        );\n                        break;\n                }\n            },\n        });\n\n        this.onFramePresented();\n    }\n\n    private onFramePresented = () => {\n        this.currentFrameRendered = false;\n        this.animationFrameId = requestAnimationFrame(this.onFramePresented);\n    };\n\n    private configure(config: H264Configuration) {\n        const { profileIndex, constraintSet, levelIndex } = config;\n\n        this._renderer.width = config.croppedWidth;\n        this._renderer.height = config.croppedHeight;\n\n        // https://www.rfc-editor.org/rfc/rfc6381#section-3.3\n        // ISO Base Media File Format Name Space\n        const codec = `avc1.${[profileIndex, constraintSet, levelIndex]\n            .map(toHex)\n            .join(\"\")}`;\n        this.decoder.configure({\n            codec: codec,\n            optimizeForLatency: true,\n        });\n    }\n\n    public dispose() {\n        cancelAnimationFrame(this.animationFrameId);\n        this.decoder.close();\n    }\n}\n","import { AdbReverseNotSupportedError, type Adb } from \"@yume-chan/adb\";\nimport { delay } from \"@yume-chan/async\";\nimport { type Disposable } from \"@yume-chan/event\";\nimport {\n    TransformStream,\n    type ReadableStream,\n    type ReadableStreamDefaultReader,\n    type ReadableWritablePair,\n} from \"@yume-chan/stream-extra\";\nimport { type ValueOrPromise } from \"@yume-chan/struct\";\n\nexport interface AdbScrcpyConnectionOptions {\n    control: boolean;\n\n    /**\n     * Write a byte on start to detect connection issues\n     */\n    sendDummyByte: boolean;\n\n    /**\n     * Send device name and size\n     */\n    sendDeviceMeta: boolean;\n}\n\nexport abstract class AdbScrcpyConnection implements Disposable {\n    protected adb: Adb;\n\n    protected options: AdbScrcpyConnectionOptions;\n\n    public constructor(adb: Adb, options: AdbScrcpyConnectionOptions) {\n        this.adb = adb;\n        this.options = options;\n    }\n\n    public initialize(): ValueOrPromise<void> {\n        // do nothing\n    }\n\n    public abstract getStreams(): ValueOrPromise<\n        [\n            videoSteam: ReadableStream<Uint8Array>,\n            controlStream:\n                | ReadableWritablePair<Uint8Array, Uint8Array>\n                | undefined\n        ]\n    >;\n\n    public dispose(): void {\n        // do nothing\n    }\n}\n\nexport class AdbScrcpyForwardConnection extends AdbScrcpyConnection {\n    private _disposed = false;\n\n    private connect(): Promise<ReadableWritablePair<Uint8Array, Uint8Array>> {\n        return this.adb.createSocket(\"localabstract:scrcpy\");\n    }\n\n    private async connectAndRetry(): Promise<\n        ReadableWritablePair<Uint8Array, Uint8Array>\n    > {\n        for (let i = 0; !this._disposed && i < 100; i += 1) {\n            try {\n                return await this.connect();\n            } catch (e) {\n                await delay(100);\n            }\n        }\n        throw new Error(`Can't connect to server after 100 retries`);\n    }\n\n    private async connectVideoStream(): Promise<ReadableStream<Uint8Array>> {\n        const { readable: videoStream } = await this.connectAndRetry();\n        if (this.options.sendDummyByte) {\n            const reader = videoStream.getReader();\n            const { done, value } = await reader.read();\n            // server will write a `0` to signal connection success\n            if (done || value.byteLength !== 1 || value[0] !== 0) {\n                throw new Error(\"Unexpected response from server\");\n            }\n            reader.releaseLock();\n        }\n        return videoStream;\n    }\n\n    public override async getStreams(): Promise<\n        [\n            videoSteam: ReadableStream<Uint8Array>,\n            controlStream:\n                | ReadableWritablePair<Uint8Array, Uint8Array>\n                | undefined\n        ]\n    > {\n        const videoStream = await this.connectVideoStream();\n\n        let controlStream:\n            | ReadableWritablePair<Uint8Array, Uint8Array>\n            | undefined;\n        if (this.options.control) {\n            controlStream = await this.connectAndRetry();\n        }\n\n        // Server only writes device meta after control socket is connected (if enabled)\n        if (this.options.sendDeviceMeta) {\n            const reader = videoStream.getReader();\n            const { done, value } = await reader.read();\n            // 64 bytes device name + 2 bytes video width + 2 bytes video height\n            if (done || value.byteLength !== 64 + 2 + 2) {\n                throw new Error(\"Unexpected response from server\");\n            }\n            reader.releaseLock();\n        }\n\n        return [videoStream, controlStream];\n    }\n\n    public override dispose(): void {\n        super.dispose();\n        this._disposed = true;\n    }\n}\n\nexport class AdbScrcpyReverseConnection extends AdbScrcpyConnection {\n    private streams!: ReadableStreamDefaultReader<\n        ReadableWritablePair<Uint8Array, Uint8Array>\n    >;\n\n    private address!: string;\n\n    public override async initialize(): Promise<void> {\n        try {\n            // try to unbind first\n            await this.adb.reverse.remove(\"localabstract:scrcpy\");\n        } catch (e) {\n            if (e instanceof AdbReverseNotSupportedError) {\n                throw e;\n            }\n\n            // Ignore other errors when unbinding\n        }\n\n        const queue = new TransformStream<\n            ReadableWritablePair<Uint8Array, Uint8Array>,\n            ReadableWritablePair<Uint8Array, Uint8Array>\n        >();\n        this.streams = queue.readable.getReader();\n        const writer = queue.writable.getWriter();\n        this.address = await this.adb.reverse.add(\n            \"localabstract:scrcpy\",\n            \"tcp:27183\",\n            (socket) => {\n                void writer.write(socket);\n                return true;\n            }\n        );\n    }\n\n    private async accept(): Promise<\n        ReadableWritablePair<Uint8Array, Uint8Array>\n    > {\n        return (await this.streams.read()).value!;\n    }\n\n    public async getStreams(): Promise<\n        [\n            videoSteam: ReadableStream<Uint8Array>,\n            controlStream:\n                | ReadableWritablePair<Uint8Array, Uint8Array>\n                | undefined\n        ]\n    > {\n        const { readable: videoStream } = await this.accept();\n\n        let controlStream:\n            | ReadableWritablePair<Uint8Array, Uint8Array>\n            | undefined;\n        if (this.options.control) {\n            controlStream = await this.accept();\n        }\n\n        // Server only writes device meta after control socket is connected (if enabled)\n        if (this.options.sendDeviceMeta) {\n            const reader = videoStream.getReader();\n            const { done, value } = await reader.read();\n            // 64 bytes device name + 2 bytes video width + 2 bytes video height\n            if (done || value.byteLength !== 64 + 2 + 2) {\n                throw new Error(\"Unexpected response from server\");\n            }\n            reader.releaseLock();\n        }\n\n        return [videoStream, controlStream];\n    }\n\n    public override dispose() {\n        // Don't await this!\n        // `reverse.remove`'s response will never arrive\n        // before we read all pending data from `videoStream`\n        this.adb.reverse.remove(this.address).catch((e) => {\n            void e;\n        });\n    }\n}\n","import { type Adb } from \"@yume-chan/adb\";\nimport { type TransformStream } from \"@yume-chan/stream-extra\";\n\nimport {\n    type ScrcpyBackOrScreenOnControlMessage,\n    type ScrcpyControlMessageType,\n    type ScrcpySetClipboardControlMessage,\n} from \"../../control/index.js\";\nimport {\n    type ScrcpyOptions,\n    type ScrcpyVideoStreamPacket,\n} from \"../../options/index.js\";\nimport { type AdbScrcpyConnection } from \"../connection.js\";\n\nexport interface AdbScrcpyOptions<T extends object> extends ScrcpyOptions<T> {\n    createConnection(adb: Adb): AdbScrcpyConnection;\n}\n\nexport abstract class AdbScrcpyOptionsBase<T extends object>\n    implements ScrcpyOptions<T>\n{\n    private raw: ScrcpyOptions<T>;\n\n    public get value(): Partial<T> {\n        return this.raw.value;\n    }\n    public set value(value: Partial<T>) {\n        this.raw.value = value;\n    }\n\n    public constructor(raw: ScrcpyOptions<T>) {\n        this.raw = raw;\n    }\n\n    public getDefaultValue(): T {\n        return this.raw.getDefaultValue();\n    }\n\n    public formatServerArguments(): string[] {\n        return this.raw.formatServerArguments();\n    }\n\n    public getOutputEncoderNameRegex(): RegExp {\n        return this.raw.getOutputEncoderNameRegex();\n    }\n\n    public createVideoStreamTransformer(): TransformStream<\n        Uint8Array,\n        ScrcpyVideoStreamPacket\n    > {\n        return this.raw.createVideoStreamTransformer();\n    }\n\n    public getControlMessageTypes(): ScrcpyControlMessageType[] {\n        return this.raw.getControlMessageTypes();\n    }\n\n    public serializeBackOrScreenOnControlMessage(\n        message: ScrcpyBackOrScreenOnControlMessage\n    ): Uint8Array | undefined {\n        return this.raw.serializeBackOrScreenOnControlMessage(message);\n    }\n\n    public serializeSetClipboardControlMessage(\n        message: ScrcpySetClipboardControlMessage\n    ): Uint8Array {\n        return this.raw.serializeSetClipboardControlMessage(message);\n    }\n\n    public getScrollController() {\n        return this.raw.getScrollController();\n    }\n\n    public abstract createConnection(adb: Adb): AdbScrcpyConnection;\n}\n","import { type Adb } from \"@yume-chan/adb\";\n\nimport { type ScrcpyOptionsInit1_16 } from \"../../options/index.js\";\nimport {\n    AdbScrcpyForwardConnection,\n    AdbScrcpyReverseConnection,\n    type AdbScrcpyConnection,\n    type AdbScrcpyConnectionOptions,\n} from \"../connection.js\";\n\nimport { AdbScrcpyOptionsBase } from \"./types.js\";\n\nexport class AdbScrcpyOptions1_16<\n    T extends ScrcpyOptionsInit1_16 = ScrcpyOptionsInit1_16\n> extends AdbScrcpyOptionsBase<T> {\n    public override createConnection(adb: Adb): AdbScrcpyConnection {\n        const options: AdbScrcpyConnectionOptions = {\n            // Old versions always have control stream no matter what the option is\n            // Pass `control: false` to `Connection` will disable the control stream\n            control: true,\n            sendDummyByte: true,\n            sendDeviceMeta: true,\n        };\n        if (this.value.tunnelForward) {\n            return new AdbScrcpyForwardConnection(adb, options);\n        } else {\n            return new AdbScrcpyReverseConnection(adb, options);\n        }\n    }\n}\n","import { type Adb } from \"@yume-chan/adb\";\n\nimport { type ScrcpyOptionsInit1_22 } from \"../../options/index.js\";\nimport {\n    AdbScrcpyForwardConnection,\n    AdbScrcpyReverseConnection,\n    type AdbScrcpyConnection,\n} from \"../connection.js\";\n\nimport { AdbScrcpyOptions1_16 } from \"./1_16.js\";\n\nexport class AdbScrcpyOptions1_22<\n    T extends ScrcpyOptionsInit1_22 = ScrcpyOptionsInit1_22\n> extends AdbScrcpyOptions1_16<T> {\n    public override createConnection(adb: Adb): AdbScrcpyConnection {\n        const options = {\n            ...this.getDefaultValue(),\n            ...this.value,\n        };\n        if (this.value.tunnelForward) {\n            return new AdbScrcpyForwardConnection(adb, options);\n        } else {\n            return new AdbScrcpyReverseConnection(adb, options);\n        }\n    }\n}\n","export * from './1_16.js';\nexport * from './1_22.js';\nexport * from './types.js';\n","// https://github.com/Genymobile/scrcpy/blob/fa5b2a29e983a46b49531def9cf3d80c40c3de37/app/src/control_msg.h#L23\n// For their message bodies, see https://github.com/Genymobile/scrcpy/blob/5c62f3419d252d10cd8c9cbb7c918b358b81f2d0/app/src/control_msg.c#L92\n// Their IDs change between versions, so always use `options.getControlMessageTypes()`\nexport enum ScrcpyControlMessageType {\n    InjectKeyCode,\n    InjectText,\n    InjectTouch,\n    InjectScroll,\n    BackOrScreenOn,\n    ExpandNotificationPanel,\n    ExpandSettingPanel,\n    CollapseNotificationPanel,\n    GetClipboard,\n    SetClipboard,\n    SetScreenPowerMode,\n    RotateDevice,\n}\n","import Struct, {\n    NumberFieldDefinition,\n    NumberFieldType,\n    placeholder,\n} from \"@yume-chan/struct\";\n\nimport { ScrcpyControlMessageType } from \"./type.js\";\n\n// https://developer.android.com/reference/android/view/MotionEvent#constants_1\nexport enum AndroidMotionEventAction {\n    Down,\n    Up,\n    Move,\n    Cancel,\n    Outside,\n    PointerDown,\n    PointerUp,\n    HoverMove,\n    Scroll,\n    HoverEnter,\n    HoverExit,\n    ButtonPress,\n    ButtonRelease,\n}\n\n// eslint-disable-next-line @typescript-eslint/no-namespace\nexport namespace ScrcpyPointerId {\n    export const Mouse = BigInt(-1);\n    export const Finger = BigInt(-2);\n    export const VirtualMouse = BigInt(-3);\n    export const VirtualFinger = BigInt(-4);\n}\n\nexport function clamp(value: number, min: number, max: number): number {\n    if (value < min) {\n        return min;\n    }\n\n    if (value > max) {\n        return max;\n    }\n\n    return value;\n}\n\nexport const ScrcpyFloatToUint16NumberType: NumberFieldType = {\n    size: 2,\n    signed: false,\n    deserialize(array, littleEndian) {\n        const value = NumberFieldType.Uint16.deserialize(array, littleEndian);\n        // https://github.com/Genymobile/scrcpy/blob/1f138aef41de651668043b32c4effc2d4adbfc44/server/src/main/java/com/genymobile/scrcpy/Binary.java#L22\n        return value === 0xffff ? 1 : value / 0x10000;\n    },\n    serialize(dataView, offset, value, littleEndian) {\n        // https://github.com/Genymobile/scrcpy/blob/1f138aef41de651668043b32c4effc2d4adbfc44/app/src/util/binary.h#L51\n        value = clamp(value, -1, 1);\n        value = value === 1 ? 0xffff : value * 0x10000;\n        NumberFieldType.Uint16.serialize(dataView, offset, value, littleEndian);\n    },\n};\n\nconst ScrcpyFloatToUint16FieldDefinition = new NumberFieldDefinition(\n    ScrcpyFloatToUint16NumberType\n);\n\nexport const ScrcpyInjectTouchControlMessage = new Struct()\n    .uint8(\"type\", ScrcpyControlMessageType.InjectTouch as const)\n    .uint8(\"action\", placeholder<AndroidMotionEventAction>())\n    .uint64(\"pointerId\")\n    .uint32(\"pointerX\")\n    .uint32(\"pointerY\")\n    .uint16(\"screenWidth\")\n    .uint16(\"screenHeight\")\n    .field(\"pressure\", ScrcpyFloatToUint16FieldDefinition)\n    .uint32(\"buttons\");\n\nexport type ScrcpyInjectTouchControlMessage =\n    typeof ScrcpyInjectTouchControlMessage[\"TInit\"];\n","import {\n    AndroidMotionEventAction,\n    type ScrcpyInjectTouchControlMessage,\n} from \"./inject-touch.js\";\nimport { ScrcpyControlMessageType } from \"./type.js\";\n\n/**\n * On both Android and Windows, while both mouse and touch are supported input devices,\n * only one of them can be active at a time. Touch the screen with a finger will deactivate mouse,\n * and move the mouse will deactivate touch.\n *\n * On Android, this is achieved by dispatching a `MotionEvent.ACTION_UP` event for the previous input type.\n * But on Chrome, there is no such event, causing both mouse and touch to be active at the same time.\n * This can cause the new input to appear as \"ignored\".\n *\n * This helper class synthesis `ACTION_UP` events when a different pointer type appears,\n * so Scrcpy server can remove the previously hovering pointer.\n */\nexport class ScrcpyHoverHelper {\n    // AFAIK, only mouse and pen can have hover state\n    // and you can't have two mouses or pens.\n    // So remember the last hovering pointer is enough.\n    private lastHoverMessage: ScrcpyInjectTouchControlMessage | undefined;\n\n    public process(\n        message: Omit<ScrcpyInjectTouchControlMessage, \"type\">\n    ): ScrcpyInjectTouchControlMessage[] {\n        const result: ScrcpyInjectTouchControlMessage[] = [];\n\n        // A different pointer appeared,\n        // Cancel previously hovering pointer so Scrcpy server can free up the pointer ID.\n        if (\n            this.lastHoverMessage &&\n            this.lastHoverMessage.pointerId !== message.pointerId\n        ) {\n            // TODO: Inject MotionEvent.ACTION_HOVER_EXIT\n            // From testing, it seems no App cares about this event.\n            result.push({\n                ...this.lastHoverMessage,\n                action: AndroidMotionEventAction.Up,\n            });\n            this.lastHoverMessage = undefined;\n        }\n\n        if (message.action === AndroidMotionEventAction.HoverMove) {\n            // TODO: Inject MotionEvent.ACTION_HOVER_ENTER\n            this.lastHoverMessage = message as ScrcpyInjectTouchControlMessage;\n        }\n\n        (message as ScrcpyInjectTouchControlMessage).type =\n            ScrcpyControlMessageType.InjectTouch;\n        result.push(message as ScrcpyInjectTouchControlMessage);\n\n        return result;\n    }\n}\n","import Struct, { placeholder } from \"@yume-chan/struct\";\n\nimport { ScrcpyControlMessageType } from \"./type.js\";\n\nexport enum AndroidKeyEventAction {\n    Down = 0,\n    Up = 1,\n}\n\nexport enum AndroidKeyEventMeta {\n    AltOn = 0x02,\n    CtrlOn = 0x1000,\n    ShiftOn = 0x01,\n    MetaOn = 0x10000,\n}\n\n// https://cs.android.com/android/platform/superproject/+/master:frameworks/base/core/java/android/view/KeyEvent.java;l=97;drc=95c1165bb895dd844e1793460710f7163dd330a3\n// Most name follows Web API `KeyboardEvent.code`,\n// Android-only (not exist in HID keyboard standard) keys are prefixed by `Android`.\nexport enum AndroidKeyCode {\n    AndroidHome = 3,\n    AndroidBack = 4,\n    AndroidCall,\n    AndroidEndCall,\n\n    Digit0,\n    Digit1,\n    Digit2,\n    Digit3,\n    Digit4,\n    Digit5,\n    Digit6,\n    Digit7,\n    Digit8,\n    Digit9,\n    /**\n     * '*' key.\n     */\n    Star, // Name not verified\n    /**\n     * '#' key.\n     */\n    Pound, // Name not verified\n\n    /**\n     * Directional Pad Up key.\n     */\n    ArrowUp,\n    /**\n     * Directional Pad Down key.\n     */\n    ArrowDown,\n    /**\n     * Directional Pad Left key.\n     */\n    ArrowLeft,\n    /**\n     * Directional Pad Right key.\n     */\n    ArrowRight,\n    /**\n     * Directional Pad Center key.\n     */\n    AndroidDPadCenter,\n\n    VolumeUp, // Name not verified\n    VolumeDown, // Name not verified\n    Power, // Name not verified\n    AndroidCamera,\n    Clear, // Name not verified\n\n    KeyA,\n    KeyB,\n    KeyC,\n    KeyD,\n    KeyE,\n    KeyF,\n    KeyG,\n    KeyH,\n    KeyI,\n    KeyJ,\n    KeyK,\n    KeyL,\n    KeyM,\n    KeyN,\n    KeyO,\n    KeyP,\n    KeyQ,\n    KeyR,\n    KeyS,\n    KeyT,\n    KeyU,\n    KeyV,\n    KeyW,\n    KeyX,\n    KeyY,\n    KeyZ,\n    Comma,\n    Period,\n    AltLeft,\n    AltRight,\n    ShiftLeft,\n    ShiftRight,\n    Tab,\n    Space,\n    AndroidSymbol,\n    AndroidExplorer,\n    AndroidEnvelope,\n    Enter,\n    Backspace,\n    Backquote,\n    Minus,\n    Equal,\n    BracketLeft,\n    BracketRight,\n    Backslash,\n    Semicolon,\n    Quote,\n    Slash,\n    At, // Name not verified\n\n    AndroidNum,\n    AndroidHeadsetHook,\n    /**\n     * Camera Focus key。\n     */\n    AndroidFocus,\n\n    Plus, // Name not verified\n    Menu, // Name not verified\n    AndroidNotification,\n    AndroidSearch,\n\n    PageUp = 92,\n    PageDown,\n\n    Escape = 111,\n    Delete,\n    ControlLeft,\n    ControlRight,\n    CapsLock,\n    ScrollLock,\n    MetaLeft,\n    MetaRight,\n    AndroidFunction,\n    PrintScreen,\n    Pause,\n\n    Home,\n    End,\n    Insert,\n    AndroidForward,\n\n    F1 = 131,\n    F2,\n    F3,\n    F4,\n    F5,\n    F6,\n    F7,\n    F8,\n    F9,\n    F10,\n    F11,\n    F12,\n\n    NumLock,\n    Numpad0,\n    Numpad1,\n    Numpad2,\n    Numpad3,\n    Numpad4,\n    Numpad5,\n    Numpad6,\n    Numpad7,\n    Numpad8,\n    Numpad9,\n    NumpadDivide,\n    NumpadMultiply,\n    NumpadSubtract,\n    NumpadAdd,\n    NumpadDecimal,\n    NumpadComma, // Name not verified\n    NumpadEnter,\n    NumpadEquals, // Name not verified\n    NumpadLeftParen, // Name not verified\n    NumpadRightParen, // Name not verified\n\n    VolumeMute = 164, // Name not verified\n    AndroidAppSwitch = 187,\n\n    AndroidCut = 277,\n    AndroidCopy,\n    AndroidPaste,\n}\n\nexport const ScrcpyInjectKeyCodeControlMessage = new Struct()\n    .uint8(\"type\", ScrcpyControlMessageType.InjectKeyCode as const)\n    .uint8(\"action\", placeholder<AndroidKeyEventAction>())\n    .uint32(\"keyCode\")\n    .uint32(\"repeat\")\n    .uint32(\"metaState\");\n\nexport type ScrcpyInjectKeyCodeControlMessage =\n    typeof ScrcpyInjectKeyCodeControlMessage[\"TInit\"];\n","import Struct from '@yume-chan/struct';\n\nimport { ScrcpyControlMessageType } from './type.js';\n\nexport const ScrcpyInjectTextControlMessage =\n    new Struct()\n        .uint8('type', ScrcpyControlMessageType.InjectText as const)\n        .uint32('length')\n        .string('text', { lengthField: 'length' });\n\nexport type ScrcpyInjectTextControlMessage =\n    typeof ScrcpyInjectTextControlMessage['TInit'];\n","import Struct from '@yume-chan/struct';\n\nimport { ScrcpyControlMessageType } from './type.js';\n\nexport const ScrcpyRotateDeviceControlMessage =\n    new Struct()\n        .uint8('type', ScrcpyControlMessageType.RotateDevice as const)\n\nexport type ScrcpyRotateDeviceControlMessage =\n    typeof ScrcpyRotateDeviceControlMessage['TInit'];\n","import Struct, { placeholder } from '@yume-chan/struct';\n\nimport { ScrcpyControlMessageType } from './type.js';\n\n// https://cs.android.com/android/platform/superproject/+/master:frameworks/base/core/java/android/view/SurfaceControl.java;l=659;drc=20303e05bf73796124ab70a279cf849b61b97905\nexport enum AndroidScreenPowerMode {\n    Off = 0,\n    Normal = 2\n}\n\nexport const ScrcpySetScreenPowerModeControlMessage =\n    new Struct()\n        .uint8('type', ScrcpyControlMessageType.SetScreenPowerMode as const)\n        .uint8('mode', placeholder<AndroidScreenPowerMode>());\n\nexport type ScrcpySetScreenPowerModeControlMessage =\n    typeof ScrcpySetScreenPowerModeControlMessage['TInit'];\n","import {\n    type WritableStream,\n    type WritableStreamDefaultWriter,\n} from \"@yume-chan/stream-extra\";\n\nimport {\n    type ScrcpyOptions,\n    type ScrcpyOptionsInit1_16,\n    type ScrcpyScrollController,\n} from \"../options/index.js\";\n\nimport {\n    ScrcpyInjectKeyCodeControlMessage,\n    type AndroidKeyEventAction,\n} from \"./inject-keycode.js\";\nimport { type ScrcpyInjectScrollControlMessage } from \"./inject-scroll.js\";\nimport { ScrcpyInjectTextControlMessage } from \"./inject-text.js\";\nimport { ScrcpyInjectTouchControlMessage } from \"./inject-touch.js\";\nimport { ScrcpyRotateDeviceControlMessage } from \"./rotate-device.js\";\nimport {\n    ScrcpySetScreenPowerModeControlMessage,\n    type AndroidScreenPowerMode,\n} from \"./set-screen-power-mode.js\";\nimport { ScrcpyControlMessageType } from \"./type.js\";\n\nexport class ScrcpyControlMessageSerializer {\n    private options: ScrcpyOptions<ScrcpyOptionsInit1_16>;\n    /** Control message type values for current version of server */\n    private types: ScrcpyControlMessageType[];\n    private writer: WritableStreamDefaultWriter<Uint8Array>;\n    private scrollController: ScrcpyScrollController;\n\n    public constructor(\n        stream: WritableStream<Uint8Array>,\n        options: ScrcpyOptions<ScrcpyOptionsInit1_16>\n    ) {\n        this.writer = stream.getWriter();\n\n        this.options = options;\n        this.types = options.getControlMessageTypes();\n        this.scrollController = options.getScrollController();\n    }\n\n    public getActualMessageType(type: ScrcpyControlMessageType): number {\n        const value = this.types.indexOf(type);\n        if (value === -1) {\n            throw new Error(\"Not supported\");\n        }\n        return value;\n    }\n\n    public addMessageType<T extends { type: ScrcpyControlMessageType }>(\n        message: Omit<T, \"type\">,\n        type: T[\"type\"]\n    ): T {\n        (message as T).type = this.getActualMessageType(type);\n        return message as T;\n    }\n\n    public injectKeyCode(\n        message: Omit<ScrcpyInjectKeyCodeControlMessage, \"type\">\n    ) {\n        return this.writer.write(\n            ScrcpyInjectKeyCodeControlMessage.serialize(\n                this.addMessageType(\n                    message,\n                    ScrcpyControlMessageType.InjectKeyCode\n                )\n            )\n        );\n    }\n\n    public injectText(text: string) {\n        return this.writer.write(\n            ScrcpyInjectTextControlMessage.serialize({\n                text,\n                type: this.getActualMessageType(\n                    ScrcpyControlMessageType.InjectText\n                ),\n            })\n        );\n    }\n\n    /**\n     * `pressure` is a float value between 0 and 1.\n     */\n    public injectTouch(message: Omit<ScrcpyInjectTouchControlMessage, \"type\">) {\n        return this.writer.write(\n            ScrcpyInjectTouchControlMessage.serialize(\n                this.addMessageType(\n                    message,\n                    ScrcpyControlMessageType.InjectTouch\n                )\n            )\n        );\n    }\n\n    /**\n     * `scrollX` and `scrollY` are float values between 0 and 1.\n     */\n    public injectScroll(\n        message: Omit<ScrcpyInjectScrollControlMessage, \"type\">\n    ) {\n        const data = this.scrollController.serializeScrollMessage(\n            this.addMessageType(message, ScrcpyControlMessageType.InjectScroll)\n        );\n\n        if (!data) {\n            return;\n        }\n\n        return this.writer.write(data);\n    }\n\n    public async backOrScreenOn(action: AndroidKeyEventAction) {\n        const buffer = this.options.serializeBackOrScreenOnControlMessage({\n            action,\n            type: this.getActualMessageType(\n                ScrcpyControlMessageType.BackOrScreenOn\n            ),\n        });\n\n        if (buffer) {\n            return await this.writer.write(buffer);\n        }\n    }\n\n    public setScreenPowerMode(mode: AndroidScreenPowerMode) {\n        return this.writer.write(\n            ScrcpySetScreenPowerModeControlMessage.serialize({\n                mode,\n                type: this.getActualMessageType(\n                    ScrcpyControlMessageType.SetScreenPowerMode\n                ),\n            })\n        );\n    }\n\n    public rotateDevice() {\n        return this.writer.write(\n            ScrcpyRotateDeviceControlMessage.serialize({\n                type: this.getActualMessageType(\n                    ScrcpyControlMessageType.RotateDevice\n                ),\n            })\n        );\n    }\n\n    public close() {\n        return this.writer.close();\n    }\n}\n","export * from \"./back-or-screen-on.js\";\nexport * from \"./hover-helper.js\";\nexport * from \"./inject-keycode.js\";\nexport * from \"./inject-scroll.js\";\nexport * from \"./inject-text.js\";\nexport * from \"./inject-touch.js\";\nexport * from \"./rotate-device.js\";\nexport * from \"./serializer.js\";\nexport * from \"./set-clipboard.js\";\nexport * from \"./set-screen-power-mode.js\";\nexport * from \"./type.js\";\n","// https://github.com/Genymobile/scrcpy/blob/41abe021e2a73efd4899b0efcd0b9eef9ec68c9b/server/src/main/java/com/genymobile/scrcpy/DeviceMessage.java#L5\nexport enum ScrcpyDeviceMessageType {\n    Clipboard,\n    AckClipboard,\n}\n","import Struct from \"@yume-chan/struct\";\n\nimport { ScrcpyDeviceMessageType } from \"./type.js\";\n\nexport const ScrcpyAckClipboardDeviceMessage = new Struct()\n    .uint64(\"sequence\")\n    .extra({ type: ScrcpyDeviceMessageType.AckClipboard as const });\n\nexport type ScrcpyAckClipboardDeviceMessage =\n    typeof ScrcpyAckClipboardDeviceMessage[\"TDeserializeResult\"];\n","import Struct from \"@yume-chan/struct\";\n\nimport { ScrcpyDeviceMessageType } from \"./type.js\";\n\nexport const ScrcpyClipboardDeviceMessage = new Struct()\n    .uint32(\"length\")\n    .string(\"content\", { lengthField: \"length\" })\n    .extra({ type: ScrcpyDeviceMessageType.Clipboard as const });\n\nexport type ScrcpyClipboardDeviceMessage =\n    typeof ScrcpyClipboardDeviceMessage[\"TDeserializeResult\"];\n","import { BufferedTransformStream } from \"@yume-chan/stream-extra\";\n\nimport { ScrcpyAckClipboardDeviceMessage } from \"./ack-clipboard.js\";\nimport { ScrcpyClipboardDeviceMessage } from \"./clipboard.js\";\nimport { ScrcpyDeviceMessageType } from \"./type.js\";\n\nexport type ScrcpyDeviceMessage =\n    | ScrcpyClipboardDeviceMessage\n    | ScrcpyAckClipboardDeviceMessage;\n\nexport class ScrcpyDeviceMessageDeserializeStream extends BufferedTransformStream<ScrcpyDeviceMessage> {\n    constructor() {\n        super(async (stream) => {\n            const type = await stream.read(1);\n            switch (type[0]) {\n                case ScrcpyDeviceMessageType.Clipboard:\n                    return await ScrcpyClipboardDeviceMessage.deserialize(\n                        stream\n                    );\n                case ScrcpyDeviceMessageType.AckClipboard:\n                    return await ScrcpyAckClipboardDeviceMessage.deserialize(\n                        stream\n                    );\n                default:\n                    throw new Error(\"unknown control message type\");\n            }\n        });\n    }\n}\n","export * from \"./ack-clipboard.js\";\nexport * from \"./clipboard.js\";\nexport * from \"./stream.js\";\nexport * from \"./type.js\";\n","import {\n    type AndroidCodecLevel,\n    type AndroidCodecProfile,\n} from \"../../codec.js\";\nimport { type ScrcpyOptionValue } from \"../types.js\";\n\n/**\n * If the option you need is not in this type,\n * please file an issue on GitHub.\n */\nexport interface CodecOptionsInit {\n    profile: AndroidCodecProfile;\n    level: AndroidCodecLevel;\n\n    iFrameInterval: number;\n    maxBframes: number;\n    repeatPreviousFrameAfter: number;\n    maxPtsGapToEncoder: number;\n    intraRefreshPeriod: number;\n}\n\nfunction toDashCase(input: string) {\n    return input.replace(/([A-Z])/g, \"-$1\").toLowerCase();\n}\n\nconst CODEC_OPTION_TYPES: Partial<\n    Record<keyof CodecOptionsInit, \"long\" | \"float\" | \"string\">\n> = {\n    repeatPreviousFrameAfter: \"long\",\n    maxPtsGapToEncoder: \"long\",\n};\n\nexport class CodecOptions implements ScrcpyOptionValue {\n    public value: Partial<CodecOptionsInit>;\n\n    public constructor(value: Partial<CodecOptionsInit> = {}) {\n        this.value = value;\n    }\n\n    public toOptionValue(): string | undefined {\n        const entries = Object.entries(this.value).filter(\n            ([, value]) => value !== undefined\n        );\n\n        if (entries.length === 0) {\n            return undefined;\n        }\n\n        return entries\n            .map(([key, value]) => {\n                const type = CODEC_OPTION_TYPES[key as keyof CodecOptionsInit];\n                return `${toDashCase(key)}${type ? `:${type}` : \"\"}=${value}`;\n            })\n            .join(\",\");\n    }\n}\n","// cspell: ignore golomb\n// cspell: ignore qpprime\n// cspell: ignore colour\n\n// H.264 has two standards: ITU-T H.264 and ISO/IEC 14496-10\n// they have the same content, and refer themselves as \"H.264\".\n// The name \"AVC\" (Advanced Video Coding) is only used in ISO spec name,\n// and other ISO specs referring to H.264.\n// Because this module parses H.264 Annex B format,\n// it's named \"h264\" instead of \"avc\".\n\nclass BitReader {\n    private buffer: Uint8Array;\n\n    private bytePosition = 0;\n\n    private bitPosition = 0;\n\n    public constructor(buffer: Uint8Array) {\n        this.buffer = buffer;\n    }\n\n    public read(length: number): number {\n        let result = 0;\n        for (let i = 0; i < length; i += 1) {\n            result = (result << 1) | this.next();\n        }\n        return result;\n    }\n\n    public next(): number {\n        const value =\n            (this.buffer[this.bytePosition]! >> (7 - this.bitPosition)) & 1;\n        this.bitPosition += 1;\n        if (this.bitPosition === 8) {\n            this.bytePosition += 1;\n            this.bitPosition = 0;\n        }\n        return value;\n    }\n\n    public decodeExponentialGolombNumber(): number {\n        let length = 0;\n        while (this.next() === 0) {\n            length += 1;\n        }\n        if (length === 0) {\n            return 0;\n        }\n        return ((1 << length) | this.read(length)) - 1;\n    }\n}\n\n/**\n * Split NAL units from a H.264 Annex B stream.\n *\n * The input is not modified.\n * The returned NAL units are views of the input (no memory allocation nor copy),\n * and still contains emulation prevention bytes.\n *\n * This methods returns a generator, so it can be stopped immediately\n * after the interested NAL unit is found.\n */\nexport function* splitH264Stream(buffer: Uint8Array): Generator<Uint8Array> {\n    // -1 means we haven't found the first start code\n    let start = -1;\n    // How many `0x00`s in a row we have counted\n    let zeroCount = 0;\n    let inEmulation = false;\n\n    for (let i = 0; i < buffer.length; i += 1) {\n        const byte = buffer[i]!;\n\n        if (inEmulation) {\n            if (byte > 0x03) {\n                // `0x00000304` or larger are invalid\n                throw new Error(\"Invalid data\");\n            }\n\n            inEmulation = false;\n            continue;\n        }\n\n        if (byte === 0x00) {\n            zeroCount += 1;\n            continue;\n        }\n\n        const prevZeroCount = zeroCount;\n        zeroCount = 0;\n\n        if (start === -1) {\n            // 0x000001 is the start code\n            // But it can be preceded by any number of zeros\n            // So 2 is the minimal\n            if (prevZeroCount >= 2 && byte === 0x01) {\n                // Found start of first NAL unit\n                start = i + 1;\n                continue;\n            }\n\n            // Not begin with start code\n            throw new Error(\"Invalid data\");\n        }\n\n        if (prevZeroCount < 2) {\n            // zero or one `0x00`s are acceptable\n            continue;\n        }\n\n        if (byte === 0x01) {\n            // Found another NAL unit\n            yield buffer.subarray(start, i - prevZeroCount);\n\n            start = i + 1;\n            continue;\n        }\n\n        if (prevZeroCount > 2) {\n            // Too much `0x00`s\n            throw new Error(\"Invalid data\");\n        }\n\n        switch (byte) {\n            case 0x02:\n                // Didn't find why, but 7.4.1 NAL unit semantics forbids `0x000002` appearing in NAL units\n                throw new Error(\"Invalid data\");\n            case 0x03:\n                // `0x000003` is the \"emulation_prevention_three_byte\"\n                // `0x00000300`, `0x00000301`, `0x00000302` and `0x00000303` represent\n                // `0x000000`, `0x000001`, `0x000002` and `0x000003` respectively\n                inEmulation = true;\n                break;\n            default:\n                // `0x000004` or larger are as-is\n                break;\n        }\n    }\n\n    if (inEmulation) {\n        throw new Error(\"Invalid data\");\n    }\n\n    yield buffer.subarray(start, buffer.length);\n}\n\n/**\n * Remove emulation prevention bytes from a H.264 NAL Unit.\n *\n * The input is not modified.\n * If the input doesn't contain any emulation prevention bytes,\n * the input is returned as-is.\n * Otherwise, a new `Uint8Array` is created and returned.\n */\nexport function removeH264Emulation(buffer: Uint8Array) {\n    // output will be created when first emulation prevention byte is found\n    let output: Uint8Array | undefined;\n    let outputOffset = 0;\n\n    let zeroCount = 0;\n    let inEmulation = false;\n\n    let i = 0;\n    scan: for (; i < buffer.length; i += 1) {\n        const byte = buffer[i]!;\n\n        if (byte === 0x00) {\n            zeroCount += 1;\n            continue;\n        }\n\n        // Current byte is not zero\n        const prevZeroCount = zeroCount;\n        zeroCount = 0;\n\n        if (prevZeroCount < 2) {\n            // zero or one `0x00`s are acceptable\n            continue;\n        }\n\n        if (byte === 0x01) {\n            // Unexpected start code\n            throw new Error(\"Invalid data\");\n        }\n\n        if (prevZeroCount > 2) {\n            // Too much `0x00`s\n            throw new Error(\"Invalid data\");\n        }\n\n        switch (byte) {\n            case 0x02:\n                // Didn't find why, but 7.4.1 NAL unit semantics forbids `0x000002` appearing in NAL units\n                throw new Error(\"Invalid data\");\n            case 0x03:\n                // `0x000003` is the \"emulation_prevention_three_byte\"\n                // `0x00000300`, `0x00000301`, `0x00000302` and `0x00000303` represent\n                // `0x000000`, `0x000001`, `0x000002` and `0x000003` respectively\n                inEmulation = true;\n\n                // Create output and copy the data before the emulation prevention byte\n                // Output size is unknown, so we use the input size as an upper bound\n                output = new Uint8Array(buffer.length - 1);\n                output.set(buffer.subarray(0, i - prevZeroCount));\n                outputOffset = i - prevZeroCount + 1;\n                break scan;\n            default:\n                // `0x000004` or larger are as-is\n                break;\n        }\n    }\n\n    if (!output) {\n        return buffer;\n    }\n\n    // Continue at the byte after the emulation prevention byte\n    for (; i < buffer.length; i += 1) {\n        const byte = buffer[i]!;\n\n        output[outputOffset] = byte;\n        outputOffset += 1;\n\n        if (inEmulation) {\n            if (byte > 0x03) {\n                // `0x00000304` or larger are invalid\n                throw new Error(\"Invalid data\");\n            }\n\n            inEmulation = false;\n            continue;\n        }\n\n        if (byte === 0x00) {\n            zeroCount += 1;\n            continue;\n        }\n\n        const prevZeroCount = zeroCount;\n        zeroCount = 0;\n\n        if (prevZeroCount < 2) {\n            // zero or one `0x00`s are acceptable\n            continue;\n        }\n\n        if (byte === 0x01) {\n            // Unexpected start code\n            throw new Error(\"Invalid data\");\n        }\n\n        if (prevZeroCount > 2) {\n            // Too much `0x00`s\n            throw new Error(\"Invalid data\");\n        }\n\n        switch (byte) {\n            case 0x02:\n                // Didn't find why, but 7.4.1 NAL unit semantics forbids `0x000002` appearing in NAL units\n                throw new Error(\"Invalid data\");\n            case 0x03:\n                // `0x000003` is the \"emulation_prevention_three_byte\"\n                // `0x00000300`, `0x00000301`, `0x00000302` and `0x00000303` represent\n                // `0x000000`, `0x000001`, `0x000002` and `0x000003` respectively\n                inEmulation = true;\n\n                // Remove the emulation prevention byte\n                outputOffset -= 1;\n                break;\n            default:\n                // `0x000004` or larger are as-is\n                break;\n        }\n    }\n\n    return output.subarray(0, outputOffset);\n}\n\n// 7.3.2.1.1 Sequence parameter set data syntax\n// Variable names in this method uses the snake_case convention as in the spec for easier referencing.\nexport function parseSequenceParameterSet(buffer: Uint8Array) {\n    const reader = new BitReader(buffer);\n    if (reader.next() !== 0) {\n        throw new Error(\"Invalid data\");\n    }\n\n    const nal_ref_idc = reader.read(2);\n    const nal_unit_type = reader.read(5);\n\n    if (nal_unit_type !== 7) {\n        throw new Error(\"Invalid data\");\n    }\n\n    if (nal_ref_idc === 0) {\n        throw new Error(\"Invalid data\");\n    }\n\n    const profile_idc = reader.read(8);\n    const constraint_set = reader.read(8);\n\n    const constraint_set_reader = new BitReader(\n        new Uint8Array([constraint_set])\n    );\n    const constraint_set0_flag = !!constraint_set_reader.next();\n    const constraint_set1_flag = !!constraint_set_reader.next();\n    const constraint_set2_flag = !!constraint_set_reader.next();\n    const constraint_set3_flag = !!constraint_set_reader.next();\n    const constraint_set4_flag = !!constraint_set_reader.next();\n    const constraint_set5_flag = !!constraint_set_reader.next();\n\n    // reserved_zero_2bits\n    if (constraint_set_reader.read(2) !== 0) {\n        throw new Error(\"Invalid data\");\n    }\n\n    const level_idc = reader.read(8);\n    const seq_parameter_set_id = reader.decodeExponentialGolombNumber();\n\n    if (\n        profile_idc === 100 ||\n        profile_idc === 110 ||\n        profile_idc === 122 ||\n        profile_idc === 244 ||\n        profile_idc === 44 ||\n        profile_idc === 83 ||\n        profile_idc === 86 ||\n        profile_idc === 118 ||\n        profile_idc === 128 ||\n        profile_idc === 138 ||\n        profile_idc === 139 ||\n        profile_idc === 134\n    ) {\n        const chroma_format_idc = reader.decodeExponentialGolombNumber();\n        if (chroma_format_idc === 3) {\n            // separate_colour_plane_flag\n            reader.next();\n        }\n\n        // bit_depth_luma_minus8\n        reader.decodeExponentialGolombNumber();\n        // bit_depth_chroma_minus8\n        reader.decodeExponentialGolombNumber();\n\n        // qpprime_y_zero_transform_bypass_flag\n        reader.next();\n\n        const seq_scaling_matrix_present_flag = !!reader.next();\n        if (seq_scaling_matrix_present_flag) {\n            const seq_scaling_list_present_flag: boolean[] = [];\n            for (let i = 0; i < (chroma_format_idc !== 3 ? 8 : 12); i += 1) {\n                seq_scaling_list_present_flag[i] = !!reader.next();\n                if (seq_scaling_list_present_flag[i])\n                    if (i < 6) {\n                        // TODO\n                        // scaling_list( ScalingList4x4[ i ], 16,\n                        //               UseDefaultScalingMatrix4x4Flag[ i ])\n                    } else {\n                        // TODO\n                        // scaling_list( ScalingList8x8[ i − 6 ], 64,\n                        //               UseDefaultScalingMatrix8x8Flag[ i − 6 ] )\n                    }\n            }\n        }\n    }\n\n    // log2_max_frame_num_minus4\n    reader.decodeExponentialGolombNumber();\n    const pic_order_cnt_type = reader.decodeExponentialGolombNumber();\n    if (pic_order_cnt_type === 0) {\n        // log2_max_pic_order_cnt_lsb_minus4\n        reader.decodeExponentialGolombNumber();\n    } else if (pic_order_cnt_type === 1) {\n        // delta_pic_order_always_zero_flag\n        reader.next();\n        // offset_for_non_ref_pic\n        reader.decodeExponentialGolombNumber();\n        // offset_for_top_to_bottom_field\n        reader.decodeExponentialGolombNumber();\n        const num_ref_frames_in_pic_order_cnt_cycle =\n            reader.decodeExponentialGolombNumber();\n        const offset_for_ref_frame: number[] = [];\n        for (let i = 0; i < num_ref_frames_in_pic_order_cnt_cycle; i += 1) {\n            offset_for_ref_frame[i] = reader.decodeExponentialGolombNumber();\n        }\n    }\n\n    // max_num_ref_frames\n    reader.decodeExponentialGolombNumber();\n    // gaps_in_frame_num_value_allowed_flag\n    reader.next();\n    const pic_width_in_mbs_minus1 = reader.decodeExponentialGolombNumber();\n    const pic_height_in_map_units_minus1 =\n        reader.decodeExponentialGolombNumber();\n\n    const frame_mbs_only_flag = reader.next();\n    if (!frame_mbs_only_flag) {\n        // mb_adaptive_frame_field_flag\n        reader.next();\n    }\n\n    // direct_8x8_inference_flag\n    reader.next();\n\n    const frame_cropping_flag = !!reader.next();\n    let frame_crop_left_offset: number;\n    let frame_crop_right_offset: number;\n    let frame_crop_top_offset: number;\n    let frame_crop_bottom_offset: number;\n    if (frame_cropping_flag) {\n        frame_crop_left_offset = reader.decodeExponentialGolombNumber();\n        frame_crop_right_offset = reader.decodeExponentialGolombNumber();\n        frame_crop_top_offset = reader.decodeExponentialGolombNumber();\n        frame_crop_bottom_offset = reader.decodeExponentialGolombNumber();\n    } else {\n        frame_crop_left_offset = 0;\n        frame_crop_right_offset = 0;\n        frame_crop_top_offset = 0;\n        frame_crop_bottom_offset = 0;\n    }\n\n    const vui_parameters_present_flag = !!reader.next();\n    if (vui_parameters_present_flag) {\n        // TODO\n        // vui_parameters( )\n    }\n\n    return {\n        profile_idc,\n        constraint_set,\n        constraint_set0_flag,\n        constraint_set1_flag,\n        constraint_set2_flag,\n        constraint_set3_flag,\n        constraint_set4_flag,\n        constraint_set5_flag,\n        level_idc,\n        seq_parameter_set_id,\n        pic_width_in_mbs_minus1,\n        pic_height_in_map_units_minus1,\n        frame_mbs_only_flag,\n        frame_cropping_flag,\n        frame_crop_left_offset,\n        frame_crop_right_offset,\n        frame_crop_top_offset,\n        frame_crop_bottom_offset,\n    };\n}\n\n/**\n * Find Sequence Parameter Set (SPS) and Picture Parameter Set (PPS)\n * from H.264 Annex B formatted data.\n */\nexport function parseH264Configuration(buffer: Uint8Array) {\n    let sequenceParameterSet: Uint8Array | undefined;\n    let pictureParameterSet: Uint8Array | undefined;\n\n    for (const nalu of splitH264Stream(buffer)) {\n        const naluType = nalu[0]! & 0x1f;\n        switch (naluType) {\n            case 7: // Sequence parameter set\n                sequenceParameterSet = nalu;\n                if (pictureParameterSet) {\n                    return {\n                        sequenceParameterSet,\n                        pictureParameterSet,\n                    };\n                }\n                break;\n            case 8: // Picture parameter set\n                pictureParameterSet = nalu;\n                if (sequenceParameterSet) {\n                    return {\n                        sequenceParameterSet,\n                        pictureParameterSet,\n                    };\n                }\n                break;\n            default:\n                // ignore\n                break;\n        }\n    }\n\n    throw new Error(\"Invalid data\");\n}\n","import { type TransformStream } from \"@yume-chan/stream-extra\";\n\nimport {\n    type ScrcpyBackOrScreenOnControlMessage,\n    type ScrcpyControlMessageType,\n    type ScrcpySetClipboardControlMessage,\n} from \"../control/index.js\";\n\nimport { type ScrcpyScrollController } from \"./1_16/scroll.js\";\n\nexport const DEFAULT_SERVER_PATH = \"/data/local/tmp/scrcpy-server.jar\";\n\nexport interface ScrcpyOptionValue {\n    toOptionValue(): string | undefined;\n}\n\nexport function isScrcpyOptionValue(\n    value: unknown\n): value is ScrcpyOptionValue {\n    return (\n        typeof value === \"object\" &&\n        value !== null &&\n        \"toOptionValue\" in value &&\n        typeof value.toOptionValue === \"function\"\n    );\n}\n\nexport function toScrcpyOptionValue<T>(value: unknown, empty: T): string | T {\n    if (isScrcpyOptionValue(value)) {\n        value = value.toOptionValue();\n    }\n\n    // `value` may become `undefined` after `toOptionValue`\n    if (value === undefined) {\n        return empty;\n    }\n\n    return String(value);\n}\n\nexport interface H264Configuration {\n    profileIndex: number;\n    constraintSet: number;\n    levelIndex: number;\n\n    encodedWidth: number;\n    encodedHeight: number;\n\n    cropLeft: number;\n    cropRight: number;\n\n    cropTop: number;\n    cropBottom: number;\n\n    croppedWidth: number;\n    croppedHeight: number;\n}\n\nexport interface ScrcpyVideoStreamConfigurationPacket {\n    type: \"configuration\";\n    sequenceParameterSet: Uint8Array;\n    pictureParameterSet: Uint8Array;\n    data: H264Configuration;\n}\n\nexport interface ScrcpyVideoStreamFramePacket {\n    type: \"frame\";\n    keyframe?: boolean | undefined;\n    pts?: bigint | undefined;\n    data: Uint8Array;\n}\n\nexport type ScrcpyVideoStreamPacket =\n    | ScrcpyVideoStreamConfigurationPacket\n    | ScrcpyVideoStreamFramePacket;\n\nexport interface ScrcpyOptions<T extends object> {\n    value: Partial<T>;\n\n    getDefaultValue(): T;\n\n    formatServerArguments(): string[];\n\n    getOutputEncoderNameRegex(): RegExp;\n\n    createVideoStreamTransformer(): TransformStream<\n        Uint8Array,\n        ScrcpyVideoStreamPacket\n    >;\n\n    getControlMessageTypes(): ScrcpyControlMessageType[];\n\n    serializeBackOrScreenOnControlMessage(\n        message: ScrcpyBackOrScreenOnControlMessage\n    ): Uint8Array | undefined;\n\n    serializeSetClipboardControlMessage(\n        message: ScrcpySetClipboardControlMessage\n    ): Uint8Array;\n\n    getScrollController(): ScrcpyScrollController;\n}\n","import Struct from \"@yume-chan/struct\";\n\nimport {\n    ScrcpyControlMessageType,\n    type ScrcpyInjectScrollControlMessage,\n} from \"../../control/index.js\";\n\nexport interface ScrcpyScrollController {\n    serializeScrollMessage(\n        message: ScrcpyInjectScrollControlMessage\n    ): Uint8Array | undefined;\n}\n\nexport const ScrcpyInjectScrollControlMessage1_16 = new Struct()\n    .uint8(\"type\", ScrcpyControlMessageType.InjectScroll as const)\n    .uint32(\"pointerX\")\n    .uint32(\"pointerY\")\n    .uint16(\"screenWidth\")\n    .uint16(\"screenHeight\")\n    .int32(\"scrollX\")\n    .int32(\"scrollY\");\n\n/**\n * Old version of Scrcpy server only supports integer values for scroll.\n *\n * Accumulate scroll values and send scroll message when accumulated value\n * reaches 1 or -1.\n */\nexport class ScrcpyScrollController1_16 implements ScrcpyScrollController {\n    private accumulatedX = 0;\n    private accumulatedY = 0;\n\n    protected processMessage(\n        message: ScrcpyInjectScrollControlMessage\n    ): ScrcpyInjectScrollControlMessage | undefined {\n        this.accumulatedX += message.scrollX;\n        this.accumulatedY += message.scrollY;\n\n        let scrollX = 0;\n        let scrollY = 0;\n        if (this.accumulatedX >= 1) {\n            scrollX = 1;\n            this.accumulatedX = 0;\n        } else if (this.accumulatedX <= -1) {\n            scrollX = -1;\n            this.accumulatedX = 0;\n        }\n\n        if (this.accumulatedY >= 1) {\n            scrollY = 1;\n            this.accumulatedY = 0;\n        } else if (this.accumulatedY <= -1) {\n            scrollY = -1;\n            this.accumulatedY = 0;\n        }\n\n        if (scrollX === 0 && scrollY === 0) {\n            return undefined;\n        }\n\n        message.scrollX = scrollX;\n        message.scrollY = scrollY;\n        return message;\n    }\n\n    public serializeScrollMessage(\n        message: ScrcpyInjectScrollControlMessage\n    ): Uint8Array | undefined {\n        const processed = this.processMessage(message);\n        if (!processed) {\n            return undefined;\n        }\n\n        return ScrcpyInjectScrollControlMessage1_16.serialize(processed);\n    }\n}\n","import {\n    StructDeserializeStream,\n    TransformStream,\n} from \"@yume-chan/stream-extra\";\nimport Struct from \"@yume-chan/struct\";\n\nimport {\n    AndroidKeyEventAction,\n    ScrcpyControlMessageType,\n    type ScrcpyBackOrScreenOnControlMessage,\n    type ScrcpySetClipboardControlMessage,\n} from \"../../control/index.js\";\nimport {\n    toScrcpyOptionValue,\n    type ScrcpyOptions,\n    type ScrcpyVideoStreamPacket,\n} from \"../types.js\";\n\nimport { CodecOptions } from \"./codec-options.js\";\nimport {\n    parseH264Configuration,\n    parseSequenceParameterSet,\n    removeH264Emulation,\n} from \"./h264-configuration.js\";\nimport {\n    ScrcpyScrollController1_16,\n    type ScrcpyScrollController,\n} from \"./scroll.js\";\n\nexport enum ScrcpyLogLevel {\n    Verbose = \"verbose\",\n    Debug = \"debug\",\n    Info = \"info\",\n    Warn = \"warn\",\n    Error = \"error\",\n}\n\nexport enum ScrcpyVideoOrientation {\n    Initial = -2,\n    Unlocked = -1,\n    Portrait = 0,\n    Landscape = 1,\n    PortraitFlipped = 2,\n    LandscapeFlipped = 3,\n}\n\nexport interface ScrcpyOptionsInit1_16 {\n    logLevel: ScrcpyLogLevel;\n\n    /**\n     * The maximum value of both width and height.\n     */\n    maxSize: number;\n\n    bitRate: number;\n\n    /**\n     * 0 for unlimited.\n     *\n     * @default 0\n     */\n    maxFps: number;\n\n    /**\n     * The orientation of the video stream.\n     *\n     * It will not keep the device screen in specific orientation,\n     * only the captured video will in this orientation.\n     */\n    lockVideoOrientation: ScrcpyVideoOrientation;\n\n    /**\n     * Use ADB forward tunnel instead of reverse tunnel.\n     *\n     * This option is mainly used for working around the bug that on Android <9,\n     * ADB daemon can't create reverse tunnels if connected wirelessly (ADB over WiFi).\n     *\n     * When using `AdbScrcpyClient`, it can detect this situation and enable this option automatically.\n     */\n    tunnelForward: boolean;\n\n    crop: string;\n\n    /**\n     * Send PTS so that the client may record properly\n     *\n     * Note: When `sendFrameMeta: false` is specified,\n     * `onChangeEncoding` event won't fire and `onVideoData` event doesn't\n     * merge sps/pps frame and first video frame. Which means you can't use\n     * the shipped decoders to render the video\n     * (You can still record the stream into a file).\n     *\n     * @default true\n     */\n    sendFrameMeta: boolean;\n\n    /**\n     * @default true\n     */\n    control: boolean;\n\n    displayId: number;\n\n    showTouches: boolean;\n\n    stayAwake: boolean;\n\n    codecOptions: CodecOptions;\n\n    encoderName: string;\n}\n\nexport const VideoPacket = new Struct()\n    .uint64(\"pts\")\n    .uint32(\"size\")\n    .uint8Array(\"data\", { lengthField: \"size\" });\n\nexport const NO_PTS = BigInt(1) << BigInt(63);\n\nexport const ScrcpyBackOrScreenOnControlMessage1_16 = new Struct().uint8(\n    \"type\",\n    ScrcpyControlMessageType.BackOrScreenOn as const\n);\n\nexport const ScrcpySetClipboardControlMessage1_15 = new Struct()\n    .uint8(\"type\", ScrcpyControlMessageType.SetClipboard as const)\n    .uint32(\"length\")\n    .string(\"content\", { lengthField: \"length\" });\n\nexport type ScrcpySetClipboardControlMessage1_15 =\n    typeof ScrcpySetClipboardControlMessage1_15[\"TInit\"];\n\nexport class ScrcpyOptions1_16<\n    T extends ScrcpyOptionsInit1_16 = ScrcpyOptionsInit1_16\n> implements ScrcpyOptions<T>\n{\n    public value: Partial<T>;\n\n    public constructor(value: Partial<ScrcpyOptionsInit1_16>) {\n        if (\n            new.target === ScrcpyOptions1_16 &&\n            value.logLevel === ScrcpyLogLevel.Verbose\n        ) {\n            value.logLevel = ScrcpyLogLevel.Debug;\n        }\n\n        if (\n            new.target === ScrcpyOptions1_16 &&\n            value.lockVideoOrientation === ScrcpyVideoOrientation.Initial\n        ) {\n            value.lockVideoOrientation = ScrcpyVideoOrientation.Unlocked;\n        }\n\n        this.value = value as Partial<T>;\n    }\n\n    protected getArgumentOrder(): (keyof T)[] {\n        return [\n            \"logLevel\",\n            \"maxSize\",\n            \"bitRate\",\n            \"maxFps\",\n            \"lockVideoOrientation\",\n            \"tunnelForward\",\n            \"crop\",\n            \"sendFrameMeta\",\n            \"control\",\n            \"displayId\",\n            \"showTouches\",\n            \"stayAwake\",\n            \"codecOptions\",\n            \"encoderName\",\n        ];\n    }\n\n    public getDefaultValue(): T {\n        return {\n            logLevel: ScrcpyLogLevel.Debug,\n            maxSize: 0,\n            bitRate: 8_000_000,\n            maxFps: 0,\n            lockVideoOrientation: ScrcpyVideoOrientation.Unlocked,\n            tunnelForward: false,\n            crop: \"-\",\n            sendFrameMeta: true,\n            control: true,\n            displayId: 0,\n            showTouches: false,\n            stayAwake: false,\n            codecOptions: new CodecOptions({}),\n            encoderName: \"-\",\n        } as T;\n    }\n\n    public formatServerArguments(): string[] {\n        const defaults = this.getDefaultValue();\n        return this.getArgumentOrder().map((key) =>\n            toScrcpyOptionValue(this.value[key] || defaults[key], \"-\")\n        );\n    }\n\n    public getOutputEncoderNameRegex(): RegExp {\n        return /\\s+scrcpy --encoder-name '(.*?)'/;\n    }\n\n    public createVideoStreamTransformer(): TransformStream<\n        Uint8Array,\n        ScrcpyVideoStreamPacket\n    > {\n        // Optimized path for video frames only\n        if (this.value.sendFrameMeta === false) {\n            return new TransformStream({\n                transform(chunk, controller) {\n                    controller.enqueue({\n                        type: \"frame\",\n                        data: chunk,\n                    });\n                },\n            });\n        }\n\n        let header: Uint8Array | undefined;\n\n        const deserializeStream = new StructDeserializeStream(VideoPacket);\n        return {\n            writable: deserializeStream.writable,\n            readable: deserializeStream.readable.pipeThrough(\n                new TransformStream({\n                    transform(packet, controller) {\n                        if (packet.pts === NO_PTS) {\n                            const {\n                                sequenceParameterSet,\n                                pictureParameterSet,\n                            } = parseH264Configuration(packet.data);\n\n                            const {\n                                profile_idc: profileIndex,\n                                constraint_set: constraintSet,\n                                level_idc: levelIndex,\n                                pic_width_in_mbs_minus1,\n                                pic_height_in_map_units_minus1,\n                                frame_mbs_only_flag,\n                                frame_crop_left_offset,\n                                frame_crop_right_offset,\n                                frame_crop_top_offset,\n                                frame_crop_bottom_offset,\n                            } = parseSequenceParameterSet(\n                                removeH264Emulation(sequenceParameterSet)\n                            );\n\n                            const encodedWidth =\n                                (pic_width_in_mbs_minus1 + 1) * 16;\n                            const encodedHeight =\n                                (pic_height_in_map_units_minus1 + 1) *\n                                (2 - frame_mbs_only_flag) *\n                                16;\n                            const cropLeft = frame_crop_left_offset * 2;\n                            const cropRight = frame_crop_right_offset * 2;\n                            const cropTop = frame_crop_top_offset * 2;\n                            const cropBottom = frame_crop_bottom_offset * 2;\n\n                            const croppedWidth =\n                                encodedWidth - cropLeft - cropRight;\n                            const croppedHeight =\n                                encodedHeight - cropTop - cropBottom;\n\n                            header = packet.data;\n                            controller.enqueue({\n                                type: \"configuration\",\n                                pictureParameterSet,\n                                sequenceParameterSet,\n                                data: {\n                                    profileIndex,\n                                    constraintSet,\n                                    levelIndex,\n                                    encodedWidth,\n                                    encodedHeight,\n                                    cropLeft,\n                                    cropRight,\n                                    cropTop,\n                                    cropBottom,\n                                    croppedWidth,\n                                    croppedHeight,\n                                },\n                            });\n                            return;\n                        }\n\n                        let frameData: Uint8Array;\n                        if (header) {\n                            frameData = new Uint8Array(\n                                header.byteLength + packet.data.byteLength\n                            );\n                            frameData.set(header);\n                            frameData.set(packet.data, header.byteLength);\n                            header = undefined;\n                        } else {\n                            frameData = packet.data;\n                        }\n\n                        controller.enqueue({\n                            type: \"frame\",\n                            pts: packet.pts,\n                            data: frameData,\n                        });\n                    },\n                })\n            ),\n        };\n    }\n\n    public getControlMessageTypes(): ScrcpyControlMessageType[] {\n        return [\n            /*  0 */ ScrcpyControlMessageType.InjectKeyCode,\n            /*  1 */ ScrcpyControlMessageType.InjectText,\n            /*  2 */ ScrcpyControlMessageType.InjectTouch,\n            /*  3 */ ScrcpyControlMessageType.InjectScroll,\n            /*  4 */ ScrcpyControlMessageType.BackOrScreenOn,\n            /*  5 */ ScrcpyControlMessageType.ExpandNotificationPanel,\n            /*  6 */ ScrcpyControlMessageType.CollapseNotificationPanel,\n            /*  7 */ ScrcpyControlMessageType.GetClipboard,\n            /*  8 */ ScrcpyControlMessageType.SetClipboard,\n            /*  9 */ ScrcpyControlMessageType.SetScreenPowerMode,\n            /* 10 */ ScrcpyControlMessageType.RotateDevice,\n        ];\n    }\n\n    public serializeBackOrScreenOnControlMessage(\n        message: ScrcpyBackOrScreenOnControlMessage\n    ) {\n        if (message.action === AndroidKeyEventAction.Down) {\n            return ScrcpyBackOrScreenOnControlMessage1_16.serialize(message);\n        }\n\n        return undefined;\n    }\n\n    public serializeSetClipboardControlMessage(\n        message: ScrcpySetClipboardControlMessage\n    ): Uint8Array {\n        return ScrcpySetClipboardControlMessage1_15.serialize(message);\n    }\n\n    public getScrollController(): ScrcpyScrollController {\n        return new ScrcpyScrollController1_16();\n    }\n}\n","export * from \"./codec-options.js\";\nexport * from \"./h264-configuration.js\";\nexport * from \"./options.js\";\nexport * from \"./scroll.js\";\n","import Struct, { placeholder } from \"@yume-chan/struct\";\n\nimport {\n    ScrcpyControlMessageType,\n    type AndroidKeyEventAction,\n    type ScrcpyBackOrScreenOnControlMessage,\n} from \"../control/index.js\";\n\nimport {\n    ScrcpyBackOrScreenOnControlMessage1_16,\n    ScrcpyOptions1_16,\n    type ScrcpyOptionsInit1_16,\n} from \"./1_16/options.js\";\n\nexport interface ScrcpyOptionsInit1_18 extends ScrcpyOptionsInit1_16 {\n    powerOffOnClose: boolean;\n}\n\nexport const ScrcpyBackOrScreenOnControlMessage1_18 = new Struct()\n    .fields(ScrcpyBackOrScreenOnControlMessage1_16)\n    .uint8(\"action\", placeholder<AndroidKeyEventAction>());\n\nexport type ScrcpyBackOrScreenOnControlMessage1_18 =\n    typeof ScrcpyBackOrScreenOnControlMessage1_18[\"TInit\"];\n\nexport class ScrcpyOptions1_18<\n    T extends ScrcpyOptionsInit1_18 = ScrcpyOptionsInit1_18\n> extends ScrcpyOptions1_16<T> {\n    constructor(value: Partial<ScrcpyOptionsInit1_18>) {\n        super(value);\n    }\n\n    protected override getArgumentOrder(): (keyof T)[] {\n        return super.getArgumentOrder().concat([\"powerOffOnClose\"]);\n    }\n\n    public override getDefaultValue(): T {\n        return {\n            ...super.getDefaultValue(),\n            powerOffOnClose: false,\n        };\n    }\n\n    public override getOutputEncoderNameRegex(): RegExp {\n        return /\\s+scrcpy --encoder '(.*?)'/;\n    }\n\n    public override getControlMessageTypes(): ScrcpyControlMessageType[] {\n        /**\n         *  0 InjectKeycode\n         *  1 InjectText\n         *  2 InjectTouch\n         *  3 InjectScroll\n         *  4 BackOrScreenOn\n         *  5 ExpandNotificationPanel\n         *  6 ExpandSettingsPanel\n         *  7 CollapseNotificationPanel\n         *  8 GetClipboard\n         *  9 SetClipboard\n         * 10 SetScreenPowerMode\n         * 11 RotateDevice\n         */\n        const types = super.getControlMessageTypes();\n        types.splice(6, 0, ScrcpyControlMessageType.ExpandSettingPanel);\n        return types;\n    }\n\n    public override serializeBackOrScreenOnControlMessage(\n        message: ScrcpyBackOrScreenOnControlMessage\n    ) {\n        return ScrcpyBackOrScreenOnControlMessage1_18.serialize(message);\n    }\n}\n","// cspell: ignore autosync\n\nimport Struct from \"@yume-chan/struct\";\n\nimport {\n    ScrcpyControlMessageType,\n    type ScrcpySetClipboardControlMessage,\n} from \"../control/index.js\";\n\nimport { ScrcpyOptions1_18, type ScrcpyOptionsInit1_18 } from \"./1_18.js\";\nimport { toScrcpyOptionValue } from \"./types.js\";\n\nexport interface ScrcpyOptionsInit1_21 extends ScrcpyOptionsInit1_18 {\n    clipboardAutosync?: boolean;\n}\n\nfunction toSnakeCase(input: string): string {\n    return input.replace(/([A-Z])/g, \"_$1\").toLowerCase();\n}\n\nexport const ScrcpySetClipboardControlMessage1_21 = new Struct()\n    .uint8(\"type\", ScrcpyControlMessageType.SetClipboard as const)\n    .uint64(\"sequence\")\n    .int8(\"paste\")\n    .uint32(\"length\")\n    .string(\"content\", { lengthField: \"length\" });\n\nexport type ScrcpySetClipboardControlMessage1_21 =\n    typeof ScrcpySetClipboardControlMessage1_21[\"TInit\"];\n\nexport class ScrcpyOptions1_21<\n    T extends ScrcpyOptionsInit1_21 = ScrcpyOptionsInit1_21\n> extends ScrcpyOptions1_18<T> {\n    public constructor(init: Partial<ScrcpyOptionsInit1_21>) {\n        super(init);\n    }\n\n    public override getDefaultValue(): T {\n        return {\n            ...super.getDefaultValue(),\n            clipboardAutosync: true,\n        };\n    }\n\n    public override formatServerArguments(): string[] {\n        // 1.21 changed the format of arguments\n        // So `getArgumentOrder()` is no longer needed\n        return Object.entries(this.value)\n            .map(\n                ([key, value]) =>\n                    [key, toScrcpyOptionValue(value, undefined)] as const\n            )\n            .filter((pair): pair is [string, string] => pair[1] !== undefined)\n            .map(([key, value]) => `${toSnakeCase(key)}=${value}`);\n    }\n\n    public override serializeSetClipboardControlMessage(\n        message: ScrcpySetClipboardControlMessage\n    ): Uint8Array {\n        return ScrcpySetClipboardControlMessage1_21.serialize(message);\n    }\n}\n","import Struct from \"@yume-chan/struct\";\n\nimport {\n    ScrcpyInjectScrollControlMessage1_16,\n    ScrcpyScrollController1_16,\n} from \"../1_16/index.js\";\n\nexport const ScrcpyInjectScrollControlMessage1_22 = new Struct()\n    .fields(ScrcpyInjectScrollControlMessage1_16)\n    .int32(\"buttons\");\n\nexport type ScrcpyInjectScrollControlMessage1_22 =\n    typeof ScrcpyInjectScrollControlMessage1_22[\"TInit\"];\n\nexport class ScrcpyScrollController1_22 extends ScrcpyScrollController1_16 {\n    public override serializeScrollMessage(\n        message: ScrcpyInjectScrollControlMessage1_22\n    ): Uint8Array | undefined {\n        const processed = this.processMessage(message);\n        if (!processed) {\n            return undefined;\n        }\n\n        return ScrcpyInjectScrollControlMessage1_22.serialize(processed);\n    }\n}\n","import { type ScrcpyScrollController } from \"../1_16/index.js\";\nimport { ScrcpyOptions1_21, type ScrcpyOptionsInit1_21 } from \"../1_21.js\";\n\nimport { ScrcpyScrollController1_22 } from \"./scroll.js\";\n\nexport interface ScrcpyOptionsInit1_22 extends ScrcpyOptionsInit1_21 {\n    downsizeOnError: boolean;\n\n    /**\n     * Send device name and size at start of video stream.\n     *\n     * @default true\n     */\n    sendDeviceMeta: boolean;\n\n    /**\n     * Send a `0` byte on start of video stream to detect connection issues\n     *\n     * @default true\n     */\n    sendDummyByte: boolean;\n\n    /**\n     * Implies `sendDeviceMeta: false`, `sendFrameMeta: false` and `sendDummyByte: false`\n     *\n     * @default false\n     */\n    rawVideoStream: boolean;\n}\n\nexport class ScrcpyOptions1_22<\n    T extends ScrcpyOptionsInit1_22 = ScrcpyOptionsInit1_22\n> extends ScrcpyOptions1_21<T> {\n    public constructor(init: Partial<ScrcpyOptionsInit1_22>) {\n        if (init.rawVideoStream) {\n            // Set implied options for client-side processing\n            init.sendDeviceMeta = false;\n            init.sendFrameMeta = false;\n            init.sendDummyByte = false;\n        }\n\n        super(init);\n    }\n\n    public override getDefaultValue(): T {\n        return {\n            ...super.getDefaultValue(),\n            downsizeOnError: true,\n            sendDeviceMeta: true,\n            sendDummyByte: true,\n            rawVideoStream: false,\n        };\n    }\n\n    public override getScrollController(): ScrcpyScrollController {\n        return new ScrcpyScrollController1_22();\n    }\n}\n","export * from \"./options.js\";\nexport * from \"./scroll.js\";\n","import { TransformStream } from \"@yume-chan/stream-extra\";\n\nimport {\n    ScrcpyOptions1_22,\n    type ScrcpyOptionsInit1_22,\n} from \"./1_22/options.js\";\nimport { type ScrcpyVideoStreamPacket } from \"./types.js\";\n\nexport interface ScrcpyOptionsInit1_23 extends ScrcpyOptionsInit1_22 {\n    cleanup: boolean;\n}\n\nconst KEYFRAME_PTS = BigInt(1) << BigInt(62);\n\nexport class ScrcpyOptions1_23<\n    T extends ScrcpyOptionsInit1_23 = ScrcpyOptionsInit1_23\n> extends ScrcpyOptions1_22<T> {\n    public constructor(init: Partial<ScrcpyOptionsInit1_23>) {\n        super(init);\n    }\n\n    public override getDefaultValue(): T {\n        return {\n            ...super.getDefaultValue(),\n            cleanup: true,\n        };\n    }\n\n    public override createVideoStreamTransformer(): TransformStream<\n        Uint8Array,\n        ScrcpyVideoStreamPacket\n    > {\n        const superStream = super.createVideoStreamTransformer();\n        return {\n            writable: superStream.writable,\n            readable: superStream.readable.pipeThrough(\n                new TransformStream({\n                    transform(packet, controller): void {\n                        if (packet.type !== \"frame\") {\n                            controller.enqueue(packet);\n                            return;\n                        }\n\n                        if (\n                            packet.pts !== undefined &&\n                            packet.pts & KEYFRAME_PTS\n                        ) {\n                            packet.keyframe = true;\n                            packet.pts &= ~KEYFRAME_PTS;\n                        }\n\n                        controller.enqueue(packet);\n                    },\n                })\n            ),\n        };\n    }\n}\n","import { ScrcpyOptions1_23, type ScrcpyOptionsInit1_23 } from './1_23.js';\n\nexport interface ScrcpyOptionsInit1_24 extends ScrcpyOptionsInit1_23 {\n    powerOn: boolean;\n}\n\nexport class ScrcpyOptions1_24<T extends ScrcpyOptionsInit1_24 = ScrcpyOptionsInit1_24>\n    extends ScrcpyOptions1_23<T> {\n    public constructor(init: Partial<ScrcpyOptionsInit1_24>) {\n        super(init);\n    }\n\n    public override getDefaultValue(): T {\n        return {\n            ...super.getDefaultValue(),\n            powerOn: true,\n        };\n    }\n}\n","import Struct, {\n    NumberFieldDefinition,\n    NumberFieldType,\n} from \"@yume-chan/struct\";\n\nimport {\n    clamp,\n    ScrcpyControlMessageType,\n    type ScrcpyInjectScrollControlMessage,\n} from \"../../control/index.js\";\nimport { type ScrcpyScrollController } from \"../1_16/index.js\";\n\nexport const ScrcpyFloatToInt16NumberType: NumberFieldType = {\n    size: 2,\n    signed: true,\n    deserialize(array, littleEndian) {\n        const value = NumberFieldType.Int16.deserialize(array, littleEndian);\n        // https://github.com/Genymobile/scrcpy/blob/1f138aef41de651668043b32c4effc2d4adbfc44/server/src/main/java/com/genymobile/scrcpy/Binary.java#L34\n        return value === 0x7fff ? 1 : value / 0x8000;\n    },\n    serialize(dataView, offset, value, littleEndian) {\n        // https://github.com/Genymobile/scrcpy/blob/1f138aef41de651668043b32c4effc2d4adbfc44/app/src/util/binary.h#L65\n        value = clamp(value, -1, 1);\n        value = value === 1 ? 0x7fff : value * 0x8000;\n        NumberFieldType.Int16.serialize(dataView, offset, value, littleEndian);\n    },\n};\n\nconst ScrcpyFloatToInt16FieldDefinition = new NumberFieldDefinition(\n    ScrcpyFloatToInt16NumberType\n);\n\nexport const ScrcpyInjectScrollControlMessage1_25 = new Struct()\n    .uint8(\"type\", ScrcpyControlMessageType.InjectScroll as const)\n    .uint32(\"pointerX\")\n    .uint32(\"pointerY\")\n    .uint16(\"screenWidth\")\n    .uint16(\"screenHeight\")\n    .field(\"scrollX\", ScrcpyFloatToInt16FieldDefinition)\n    .field(\"scrollY\", ScrcpyFloatToInt16FieldDefinition)\n    .int32(\"buttons\");\n\nexport type ScrcpyInjectScrollControlMessage1_25 =\n    typeof ScrcpyInjectScrollControlMessage1_25[\"TInit\"];\n\nexport class ScrcpyScrollController1_25 implements ScrcpyScrollController {\n    serializeScrollMessage(\n        message: ScrcpyInjectScrollControlMessage\n    ): Uint8Array | undefined {\n        return ScrcpyInjectScrollControlMessage1_25.serialize(message);\n    }\n}\n","import { type ScrcpyScrollController } from \"../1_16/index.js\";\nimport { ScrcpyOptions1_24, type ScrcpyOptionsInit1_24 } from \"../1_24.js\";\n\nimport { ScrcpyScrollController1_25 } from \"./scroll.js\";\n\nexport class ScrcpyOptions1_25<\n    T extends ScrcpyOptionsInit1_24 = ScrcpyOptionsInit1_24\n> extends ScrcpyOptions1_24<T> {\n    public override getScrollController(): ScrcpyScrollController {\n        return new ScrcpyScrollController1_25();\n    }\n}\n","export * from \"./options.js\";\nexport * from \"./scroll.js\";\n","export * from './1_16/index.js';\nexport * from './1_18.js';\nexport * from './1_21.js';\nexport * from \"./1_22/index.js\";\nexport * from \"./1_23.js\";\nexport * from \"./1_24.js\";\nexport * from \"./1_25/index.js\";\nexport * from \"./types.js\";\n","import {\n    AdbReverseNotSupportedError,\n    AdbSubprocessNoneProtocol,\n    type Adb,\n    type AdbSubprocessProtocol,\n    type AdbSync,\n} from \"@yume-chan/adb\";\nimport {\n    AbortController,\n    DecodeUtf8Stream,\n    InspectStream,\n    ReadableStream,\n    SplitStringStream,\n    WrapWritableStream,\n    WritableStream,\n    type ReadableStreamDefaultController,\n    type ReadableStreamDefaultReader,\n    type ReadableWritablePair,\n} from \"@yume-chan/stream-extra\";\n\nimport { ScrcpyControlMessageSerializer } from \"../control/index.js\";\nimport {\n    ScrcpyDeviceMessageDeserializeStream,\n    type ScrcpyDeviceMessage,\n} from \"../device-message/index.js\";\nimport {\n    DEFAULT_SERVER_PATH,\n    type ScrcpyOptionsInit1_16,\n    type ScrcpyVideoStreamPacket,\n} from \"../options/index.js\";\n\nimport { type AdbScrcpyConnection } from \"./connection.js\";\nimport { type AdbScrcpyOptions } from \"./options/index.js\";\n\nclass ArrayToStream<T> extends ReadableStream<T> {\n    private array!: T[];\n    private index = 0;\n\n    constructor(array: T[]) {\n        super({\n            start: async () => {\n                await Promise.resolve();\n                this.array = array;\n            },\n            pull: (controller) => {\n                if (this.index < this.array.length) {\n                    controller.enqueue(this.array[this.index]!);\n                    this.index += 1;\n                } else {\n                    controller.close();\n                }\n            },\n        });\n    }\n}\n\nclass ConcatStream<T> extends ReadableStream<T> {\n    private streams!: ReadableStream<T>[];\n    private index = 0;\n    private reader!: ReadableStreamDefaultReader<T>;\n\n    constructor(...streams: ReadableStream<T>[]) {\n        super({\n            start: async (controller) => {\n                await Promise.resolve();\n\n                this.streams = streams;\n                this.advance(controller);\n            },\n            pull: async (controller) => {\n                const result = await this.reader.read();\n                if (!result.done) {\n                    controller.enqueue(result.value);\n                    return;\n                }\n                this.advance(controller);\n            },\n        });\n    }\n\n    private advance(controller: ReadableStreamDefaultController<T>) {\n        if (this.index < this.streams.length) {\n            this.reader = this.streams[this.index]!.getReader();\n            this.index += 1;\n        } else {\n            controller.close();\n        }\n    }\n}\n\nexport class ScrcpyExitedError extends Error {\n    public output: string[];\n\n    public constructor(output: string[]) {\n        super(\"scrcpy server exited prematurely\");\n        this.output = output;\n    }\n}\n\nexport class AdbScrcpyClient {\n    public static pushServer(adb: Adb, path = DEFAULT_SERVER_PATH) {\n        let sync!: AdbSync;\n        return new WrapWritableStream<Uint8Array>({\n            async start() {\n                sync = await adb.sync();\n                return sync.write(path);\n            },\n            async close() {\n                await sync.dispose();\n            },\n        });\n    }\n\n    public static async start(\n        adb: Adb,\n        path: string,\n        version: string,\n        options: AdbScrcpyOptions<ScrcpyOptionsInit1_16>\n    ) {\n        let connection: AdbScrcpyConnection | undefined;\n        let process: AdbSubprocessProtocol | undefined;\n\n        try {\n            try {\n                connection = options.createConnection(adb);\n                await connection.initialize();\n            } catch (e) {\n                if (e instanceof AdbReverseNotSupportedError) {\n                    // When reverse tunnel is not supported, try forward tunnel.\n                    options.value.tunnelForward = true;\n                    connection = options.createConnection(adb);\n                    await connection.initialize();\n                } else {\n                    connection = undefined;\n                    throw e;\n                }\n            }\n\n            process = await adb.subprocess.spawn(\n                [\n                    // cspell: disable-next-line\n                    `CLASSPATH=${path}`,\n                    \"app_process\",\n                    /* unused */ \"/\",\n                    \"com.genymobile.scrcpy.Server\",\n                    version,\n                    ...options.formatServerArguments(),\n                ],\n                {\n                    // Scrcpy server doesn't use stderr,\n                    // so disable Shell Protocol to simplify processing\n                    protocols: [AdbSubprocessNoneProtocol],\n                }\n            );\n\n            const stdout = process.stdout\n                .pipeThrough(new DecodeUtf8Stream())\n                .pipeThrough(new SplitStringStream(\"\\n\"));\n\n            // Read stdout, otherwise `process.exit` won't resolve.\n            const output: string[] = [];\n            const abortController = new AbortController();\n            const pipe = stdout\n                .pipeTo(\n                    new WritableStream({\n                        write(chunk) {\n                            output.push(chunk);\n                        },\n                    }),\n                    {\n                        signal: abortController.signal,\n                        preventCancel: true,\n                    }\n                )\n                .catch((e) => {\n                    void e;\n                });\n\n            const result = await Promise.race([\n                process.exit,\n                connection.getStreams(),\n            ]);\n\n            if (typeof result === \"number\") {\n                throw new ScrcpyExitedError(output);\n            }\n\n            abortController.abort();\n            await pipe;\n\n            const [videoStream, controlStream] = result;\n            return new AdbScrcpyClient(\n                options,\n                process,\n                new ConcatStream(new ArrayToStream(output), stdout),\n                videoStream,\n                controlStream\n            );\n        } catch (e) {\n            await process?.kill();\n            throw e;\n        } finally {\n            connection?.dispose();\n        }\n    }\n\n    /**\n     * This method will modify the given `options`,\n     * so don't reuse it elsewhere.\n     */\n    public static async getEncoders(\n        adb: Adb,\n        path: string,\n        version: string,\n        options: AdbScrcpyOptions<ScrcpyOptionsInit1_16>\n    ): Promise<string[]> {\n        Object.assign(options.value, {\n            // Provide an invalid encoder name\n            // So the server will return all available encoders\n            encoderName: \"_\",\n            // Disable control for faster connection in 1.22+\n            control: false,\n            sendDeviceMeta: false,\n            sendDummyByte: false,\n        });\n\n        // Scrcpy server will open connections, before initializing encoder\n        // Thus although an invalid encoder name is given, the start process will success\n        const client = await AdbScrcpyClient.start(adb, path, version, options);\n\n        const encoderNameRegex = options.getOutputEncoderNameRegex();\n        const encoders: string[] = [];\n        await client.stdout.pipeTo(\n            new WritableStream({\n                write(line) {\n                    const match = line.match(encoderNameRegex);\n                    if (match) {\n                        encoders.push(match[1]!);\n                    }\n                },\n            })\n        );\n\n        return encoders;\n    }\n\n    /**\n     * This method will modify the given `options`,\n     * so don't reuse it elsewhere.\n     */\n    public static async getDisplays(\n        adb: Adb,\n        path: string,\n        version: string,\n        options: AdbScrcpyOptions<ScrcpyOptionsInit1_16>\n    ): Promise<number[]> {\n        Object.assign(options.value, {\n            // Similar to `getEncoders`, pass an invalid option and parse the output\n            displayId: -1,\n            // Disable control for faster connection in 1.22+\n            control: false,\n            sendDeviceMeta: false,\n            sendDummyByte: false,\n        });\n\n        try {\n            // Server will exit before opening connections when an invalid display id was given.\n            await AdbScrcpyClient.start(adb, path, version, options);\n        } catch (e) {\n            if (e instanceof ScrcpyExitedError) {\n                const displayIdRegex = /\\s+scrcpy --display (\\d+)/;\n                const displays: number[] = [];\n                for (const line of e.output) {\n                    const match = line.match(displayIdRegex);\n                    if (match) {\n                        displays.push(Number.parseInt(match[1]!, 10));\n                    }\n                }\n                return displays;\n            }\n        }\n\n        throw new Error(\"failed to get displays\");\n    }\n\n    private process: AdbSubprocessProtocol;\n\n    private _stdout: ReadableStream<string>;\n    public get stdout() {\n        return this._stdout;\n    }\n\n    public get exit() {\n        return this.process.exit;\n    }\n\n    private _screenWidth: number | undefined;\n    public get screenWidth() {\n        return this._screenWidth;\n    }\n\n    private _screenHeight: number | undefined;\n    public get screenHeight() {\n        return this._screenHeight;\n    }\n\n    private _videoStream: ReadableStream<ScrcpyVideoStreamPacket>;\n    public get videoStream() {\n        return this._videoStream;\n    }\n\n    private _controlMessageSerializer:\n        | ScrcpyControlMessageSerializer\n        | undefined;\n    public get controlMessageSerializer() {\n        return this._controlMessageSerializer;\n    }\n\n    private _deviceMessageStream:\n        | ReadableStream<ScrcpyDeviceMessage>\n        | undefined;\n    public get deviceMessageStream() {\n        return this._deviceMessageStream;\n    }\n\n    public constructor(\n        options: AdbScrcpyOptions<ScrcpyOptionsInit1_16>,\n        process: AdbSubprocessProtocol,\n        stdout: ReadableStream<string>,\n        videoStream: ReadableStream<Uint8Array>,\n        controlStream: ReadableWritablePair<Uint8Array, Uint8Array> | undefined\n    ) {\n        this.process = process;\n        this._stdout = stdout;\n\n        this._videoStream = videoStream\n            .pipeThrough(options.createVideoStreamTransformer())\n            .pipeThrough(\n                new InspectStream((packet) => {\n                    if (packet.type === \"configuration\") {\n                        this._screenWidth = packet.data.croppedWidth;\n                        this._screenHeight = packet.data.croppedHeight;\n                    }\n                })\n            );\n\n        if (controlStream) {\n            this._controlMessageSerializer = new ScrcpyControlMessageSerializer(\n                controlStream.writable,\n                options\n            );\n            this._deviceMessageStream = controlStream.readable.pipeThrough(\n                new ScrcpyDeviceMessageDeserializeStream()\n            );\n        }\n    }\n\n    public async close() {\n        await this.process.kill();\n    }\n}\n","export * from './options/index.js';\nexport * from './client.js';\nexport * from './connection.js';\n","// From https://developer.android.com/reference/android/media/MediaCodecInfo.CodecProfileLevel\nexport enum AndroidCodecProfile {\n    Baseline = 0x01,\n    Main = 0x02,\n    Extended = 0x04,\n    High = 0x08,\n    High10 = 0x10,\n    High422 = 0x20,\n    High444 = 0x40,\n    ConstrainedBaseline = 0x10000,\n    ConstrainedHigh = 0x80000,\n}\n\nexport enum AndroidCodecLevel {\n    Level1 = 0x01,\n    Level1b = 0x02,\n    Level11 = 0x04,\n    Level12 = 0x08,\n    Level13 = 0x10,\n    Level2 = 0x20,\n    Level21 = 0x40,\n    Level22 = 0x80,\n    Level3 = 0x100,\n    Level31 = 0x200,\n    Level32 = 0x400,\n    Level4 = 0x800,\n    Level41 = 0x1000,\n    Level42 = 0x2000,\n    Level5 = 0x4000,\n    Level51 = 0x8000,\n    Level52 = 0x10000,\n    Level6 = 0x20000,\n    Level61 = 0x40000,\n    Level62 = 0x80000,\n}\n","export * from './adb/index.js';\nexport * from './codec.js';\nexport * from './control/index.js';\nexport * from './device-message/index.js';\nexport * from './options/index.js';\n","import { useEffect, useState } from \"react\";\n\nexport function CommandBarSpacerItem() {\n    const [container, setContainer] = useState<HTMLDivElement | null>(null);\n\n    useEffect(() => {\n        if (!container) {\n            return;\n        }\n\n        const parent = container.parentElement!;\n        const originalFlexGrow = parent.style.flexGrow;\n        parent.style.flexGrow = \"1\";\n        return () => {\n            parent.style.flexGrow = originalFlexGrow;\n        };\n    }, [container]);\n\n    return <div ref={setContainer} />;\n}\n","import {\n    ScrcpyVideoStreamFramePacket,\n    ScrcpyVideoStreamPacket,\n    splitH264Stream,\n} from \"@yume-chan/scrcpy\";\nimport { InspectStream } from \"@yume-chan/stream-extra\";\nimport { action, makeAutoObservable, reaction } from \"mobx\";\nimport WebMMuxer from \"webm-muxer\";\nimport { saveFile } from \"../../utils\";\n\n// https://ffmpeg.org/doxygen/0.11/avc_8c-source.html#l00106\nfunction h264ConfigurationToAvcDecoderConfigurationRecord(\n    sequenceParameterSet: Uint8Array,\n    pictureParameterSet: Uint8Array\n) {\n    const buffer = new Uint8Array(\n        11 + sequenceParameterSet.byteLength + pictureParameterSet.byteLength\n    );\n    buffer[0] = 1;\n    buffer[1] = sequenceParameterSet[1];\n    buffer[2] = sequenceParameterSet[2];\n    buffer[3] = sequenceParameterSet[3];\n    buffer[4] = 0xff;\n    buffer[5] = 0xe1;\n    buffer[6] = sequenceParameterSet.byteLength >> 8;\n    buffer[7] = sequenceParameterSet.byteLength & 0xff;\n    buffer.set(sequenceParameterSet, 8);\n    buffer[8 + sequenceParameterSet.byteLength] = 1;\n    buffer[9 + sequenceParameterSet.byteLength] =\n        pictureParameterSet.byteLength >> 8;\n    buffer[10 + sequenceParameterSet.byteLength] =\n        pictureParameterSet.byteLength & 0xff;\n    buffer.set(pictureParameterSet, 11 + sequenceParameterSet.byteLength);\n    return buffer;\n}\n\nfunction h264StreamToAvcSample(buffer: Uint8Array) {\n    const nalUnits: Uint8Array[] = [];\n    let totalLength = 0;\n\n    for (const unit of splitH264Stream(buffer)) {\n        nalUnits.push(unit);\n        totalLength += unit.byteLength + 4;\n    }\n\n    const sample = new Uint8Array(totalLength);\n    let offset = 0;\n    for (const nalu of nalUnits) {\n        sample[offset] = nalu.byteLength >> 24;\n        sample[offset + 1] = nalu.byteLength >> 16;\n        sample[offset + 2] = nalu.byteLength >> 8;\n        sample[offset + 3] = nalu.byteLength & 0xff;\n        sample.set(nalu, offset + 4);\n        offset += 4 + nalu.byteLength;\n    }\n    return sample;\n}\n\nexport class MuxerStream extends InspectStream<ScrcpyVideoStreamPacket> {\n    public running = false;\n\n    private muxer: WebMMuxer | undefined;\n    private width = 0;\n    private height = 0;\n    private firstTimestamp = -1;\n    private avcConfiguration: Uint8Array | undefined;\n    private configurationWritten = false;\n    private framesFromKeyframe: ScrcpyVideoStreamFramePacket[] = [];\n\n    private appendFrame(frame: ScrcpyVideoStreamFramePacket) {\n        let timestamp = Number(frame.pts);\n        if (this.firstTimestamp === -1) {\n            this.firstTimestamp = timestamp;\n            timestamp = 0;\n        } else {\n            timestamp -= this.firstTimestamp;\n        }\n\n        const sample = h264StreamToAvcSample(frame.data);\n        this.muxer!.addVideoChunkRaw(\n            sample,\n            frame.keyframe ? \"key\" : \"delta\",\n            timestamp,\n            this.configurationWritten\n                ? undefined\n                : {\n                      decoderConfig: {\n                          // Not used\n                          codec: \"\",\n                          description: this.avcConfiguration,\n                      },\n                  }\n        );\n        this.configurationWritten = true;\n    }\n\n    constructor() {\n        super((packet) => {\n            try {\n                if (packet.type === \"configuration\") {\n                    this.width = packet.data.croppedWidth;\n                    this.height = packet.data.croppedHeight;\n                    this.avcConfiguration =\n                        h264ConfigurationToAvcDecoderConfigurationRecord(\n                            packet.sequenceParameterSet,\n                            packet.pictureParameterSet\n                        );\n                    this.configurationWritten = false;\n                    return;\n                }\n\n                // To ensure the first frame is a keyframe\n                // save the last keyframe and the following frames\n                if (packet.keyframe === true) {\n                    this.framesFromKeyframe.length = 0;\n                }\n                this.framesFromKeyframe.push(packet);\n\n                if (!this.muxer) {\n                    return;\n                }\n\n                this.appendFrame(packet);\n            } catch (e) {\n                console.error(e);\n            }\n        });\n    }\n\n    start() {\n        this.running = true;\n        this.muxer = new WebMMuxer({\n            target: \"buffer\",\n            video: {\n                // https://www.matroska.org/technical/codec_specs.html\n                codec: \"V_MPEG4/ISO/AVC\",\n                width: this.width,\n                height: this.height,\n            },\n        });\n\n        if (this.framesFromKeyframe.length > 0) {\n            for (const frame of this.framesFromKeyframe) {\n                this.appendFrame(frame);\n            }\n        }\n    }\n\n    stop() {\n        if (!this.muxer) {\n            return;\n        }\n\n        const buffer = this.muxer.finalize()!;\n        const now = new Date();\n        const stream = saveFile(\n            // prettier-ignore\n            `Recording ${\n                now.getFullYear()\n            }-${\n                (now.getMonth() + 1).toString().padStart(2, '0')\n            }-${\n                now.getDate().toString().padStart(2, '0')\n            } ${\n                now.getHours().toString().padStart(2, '0')\n            }-${\n                now.getMinutes().toString().padStart(2, '0')\n            }-${\n                now.getSeconds().toString().padStart(2, '0')\n            }.webm`\n        );\n        const writer = stream.getWriter();\n        writer.write(new Uint8Array(buffer));\n        writer.close();\n\n        this.muxer = undefined;\n        this.configurationWritten = false;\n        this.running = false;\n        this.firstTimestamp = -1;\n    }\n}\n\nexport const RECORD_STATE = makeAutoObservable({\n    recorder: new MuxerStream(),\n    recording: false,\n    intervalId: -1,\n    hours: 0,\n    minutes: 0,\n    seconds: 0,\n});\n\nreaction(\n    () => RECORD_STATE.recording,\n    (recording) => {\n        if (recording) {\n            RECORD_STATE.intervalId = window.setInterval(\n                action(() => {\n                    RECORD_STATE.seconds += 1;\n                    if (RECORD_STATE.seconds >= 60) {\n                        RECORD_STATE.seconds = 0;\n                        RECORD_STATE.minutes += 1;\n                    }\n                    if (RECORD_STATE.minutes >= 60) {\n                        RECORD_STATE.minutes = 0;\n                        RECORD_STATE.hours += 1;\n                    }\n                }),\n                1000\n            );\n        } else {\n            window.clearInterval(RECORD_STATE.intervalId);\n            RECORD_STATE.intervalId = -1;\n            RECORD_STATE.hours = 0;\n            RECORD_STATE.minutes = 0;\n            RECORD_STATE.seconds = 0;\n        }\n    }\n);\n","import { PromiseResolver } from \"@yume-chan/async\";\nimport {\n    AutoDisposable,\n    EventEmitter,\n    type Disposable,\n} from \"@yume-chan/event\";\n\nlet worker: Worker | undefined;\nlet workerReady = false;\nconst pendingResolvers: PromiseResolver<TinyH264Wrapper>[] = [];\nlet streamId = 0;\n\nexport interface PictureReadyEventArgs {\n    renderStateId: number;\n\n    width: number;\n\n    height: number;\n\n    data: ArrayBuffer;\n}\n\nconst PICTURE_READY_SUBSCRIPTIONS = new Map<\n    number,\n    (e: PictureReadyEventArgs) => void\n>();\n\nfunction subscribePictureReady(\n    streamId: number,\n    handler: (e: PictureReadyEventArgs) => void\n): Disposable {\n    PICTURE_READY_SUBSCRIPTIONS.set(streamId, handler);\n\n    return {\n        dispose() {\n            PICTURE_READY_SUBSCRIPTIONS.delete(streamId);\n        },\n    };\n}\n\nexport class TinyH264Wrapper extends AutoDisposable {\n    public readonly streamId: number;\n\n    private readonly pictureReadyEvent =\n        new EventEmitter<PictureReadyEventArgs>();\n    public get onPictureReady() {\n        return this.pictureReadyEvent.event;\n    }\n\n    public constructor(streamId: number) {\n        super();\n\n        this.streamId = streamId;\n        this.addDisposable(\n            subscribePictureReady(streamId, this.handlePictureReady)\n        );\n    }\n\n    private handlePictureReady = (e: PictureReadyEventArgs) => {\n        this.pictureReadyEvent.fire(e);\n    };\n\n    public feed(data: ArrayBuffer) {\n        worker!.postMessage(\n            {\n                type: \"decode\",\n                data: data,\n                offset: 0,\n                length: data.byteLength,\n                renderStateId: this.streamId,\n            },\n            [data]\n        );\n    }\n\n    public override dispose() {\n        super.dispose();\n        worker!.postMessage({\n            type: \"release\",\n            renderStateId: this.streamId,\n        });\n    }\n}\n\ninterface TinyH264MessageBase {\n    type: string;\n}\n\ninterface TinyH264DecoderReadyMessage extends TinyH264MessageBase {\n    type: \"decoderReady\";\n}\n\ninterface TinyH264PictureReadyMessage\n    extends TinyH264MessageBase,\n        PictureReadyEventArgs {\n    type: \"pictureReady\";\n}\n\ntype TinyH264Message =\n    | TinyH264DecoderReadyMessage\n    | TinyH264PictureReadyMessage;\n\nexport function createTinyH264Wrapper(): Promise<TinyH264Wrapper> {\n    if (!worker) {\n        worker = new Worker(new URL(\"./worker.js\", import.meta.url));\n        worker.addEventListener(\n            \"message\",\n            ({ data }: MessageEvent<TinyH264Message>) => {\n                switch (data.type) {\n                    case \"decoderReady\":\n                        workerReady = true;\n                        for (const resolver of pendingResolvers) {\n                            resolver.resolve(new TinyH264Wrapper(streamId));\n                            streamId += 1;\n                        }\n                        pendingResolvers.length = 0;\n                        break;\n                    case \"pictureReady\":\n                        PICTURE_READY_SUBSCRIPTIONS.get(data.renderStateId)?.(\n                            data\n                        );\n                        break;\n                }\n            }\n        );\n    }\n\n    if (!workerReady) {\n        const resolver = new PromiseResolver<TinyH264Wrapper>();\n        pendingResolvers.push(resolver);\n        return resolver.promise;\n    }\n\n    const decoder = new TinyH264Wrapper(streamId);\n    streamId += 1;\n    return Promise.resolve(decoder);\n}\n","import { PromiseResolver } from \"@yume-chan/async\";\nimport {\n    AndroidCodecLevel,\n    AndroidCodecProfile,\n    type H264Configuration,\n    type ScrcpyVideoStreamPacket,\n} from \"@yume-chan/scrcpy\";\nimport { WritableStream } from \"@yume-chan/stream-extra\";\nimport { type default as YuvBuffer } from \"yuv-buffer\";\nimport { type default as YuvCanvas } from \"yuv-canvas\";\n\nimport { createTinyH264Wrapper, type TinyH264Wrapper } from \"./wrapper.js\";\n\nlet cachedInitializePromise:\n    | Promise<{ YuvBuffer: typeof YuvBuffer; YuvCanvas: typeof YuvCanvas }>\n    | undefined;\nfunction initialize() {\n    if (!cachedInitializePromise) {\n        cachedInitializePromise = Promise.all([\n            import(\"yuv-buffer\"),\n            import(\"yuv-canvas\"),\n        ]).then(([YuvBuffer, { default: YuvCanvas }]) => ({\n            YuvBuffer,\n            YuvCanvas,\n        }));\n    }\n\n    return cachedInitializePromise;\n}\n\nexport class TinyH264Decoder {\n    public readonly maxProfile = AndroidCodecProfile.Baseline;\n\n    public readonly maxLevel = AndroidCodecLevel.Level4;\n\n    private _renderer: HTMLCanvasElement;\n    public get renderer() {\n        return this._renderer;\n    }\n\n    private _frameRendered = 0;\n    public get frameRendered() {\n        return this._frameRendered;\n    }\n\n    private _frameSkipped = 0;\n    public get frameSkipped() {\n        return this._frameSkipped;\n    }\n\n    private _writable: WritableStream<ScrcpyVideoStreamPacket>;\n    public get writable() {\n        return this._writable;\n    }\n\n    private _yuvCanvas: YuvCanvas | undefined;\n    private _initializer: PromiseResolver<TinyH264Wrapper> | undefined;\n\n    public constructor() {\n        void initialize();\n\n        this._renderer = document.createElement(\"canvas\");\n\n        this._writable = new WritableStream<ScrcpyVideoStreamPacket>({\n            write: async (packet) => {\n                switch (packet.type) {\n                    case \"configuration\":\n                        void this.configure(packet.data);\n                        break;\n                    case \"frame\": {\n                        if (!this._initializer) {\n                            throw new Error(\"Decoder not configured\");\n                        }\n\n                        const wrapper = await this._initializer.promise;\n                        wrapper.feed(packet.data.slice().buffer);\n                        break;\n                    }\n                }\n            },\n        });\n    }\n\n    private async configure(config: H264Configuration) {\n        this.dispose();\n\n        this._initializer = new PromiseResolver<TinyH264Wrapper>();\n        const { YuvBuffer, YuvCanvas } = await initialize();\n\n        if (!this._yuvCanvas) {\n            this._yuvCanvas = YuvCanvas.attach(this._renderer);\n        }\n\n        const { encodedWidth, encodedHeight } = config;\n        const chromaWidth = encodedWidth / 2;\n        const chromaHeight = encodedHeight / 2;\n\n        this._renderer.width = config.croppedWidth;\n        this._renderer.height = config.croppedHeight;\n        const format = YuvBuffer.format({\n            width: encodedWidth,\n            height: encodedHeight,\n            chromaWidth,\n            chromaHeight,\n            cropLeft: config.cropLeft,\n            cropTop: config.cropTop,\n            cropWidth: config.croppedWidth,\n            cropHeight: config.croppedHeight,\n            displayWidth: config.croppedWidth,\n            displayHeight: config.croppedHeight,\n        });\n\n        const wrapper = await createTinyH264Wrapper();\n        this._initializer.resolve(wrapper);\n\n        const uPlaneOffset = encodedWidth * encodedHeight;\n        const vPlaneOffset = uPlaneOffset + chromaWidth * chromaHeight;\n        wrapper.onPictureReady(({ data }) => {\n            this._frameRendered += 1;\n            const array = new Uint8Array(data);\n            const frame = YuvBuffer.frame(\n                format,\n                YuvBuffer.lumaPlane(format, array, encodedWidth, 0),\n                YuvBuffer.chromaPlane(format, array, chromaWidth, uPlaneOffset),\n                YuvBuffer.chromaPlane(format, array, chromaWidth, vPlaneOffset)\n            );\n            this._yuvCanvas!.drawFrame(frame);\n        });\n    }\n\n    public dispose(): void {\n        this._initializer?.promise\n            .then((wrapper) => wrapper.dispose())\n            .catch((e) => {\n                void e;\n            });\n        this._initializer = undefined;\n    }\n}\n","export default '1.25';","import { EventEmitter } from \"@yume-chan/event\";\n\nconst SERVER_URL = new URL(\n    \"@yume-chan/scrcpy/bin/scrcpy-server?url\",\n    import.meta.url\n);\n\nclass FetchWithProgress {\n    public readonly promise: Promise<Uint8Array>;\n\n    private _downloaded = 0;\n    public get downloaded() {\n        return this._downloaded;\n    }\n\n    private _total = 0;\n    public get total() {\n        return this._total;\n    }\n\n    private progressEvent = new EventEmitter<\n        [download: number, total: number]\n    >();\n    public get onProgress() {\n        return this.progressEvent.event;\n    }\n\n    public constructor(url: string | URL) {\n        this.promise = this.fetch(url);\n    }\n\n    private async fetch(url: string | URL) {\n        const response = await window.fetch(url);\n        this._total = Number.parseInt(\n            response.headers.get(\"Content-Length\") ?? \"0\",\n            10\n        );\n        this.progressEvent.fire([this._downloaded, this._total]);\n\n        const reader = response.body!.getReader();\n        const chunks: Uint8Array[] = [];\n        while (true) {\n            const result = await reader.read();\n            if (result.done) {\n                break;\n            }\n            chunks.push(result.value);\n            this._downloaded += result.value.byteLength;\n            this.progressEvent.fire([this._downloaded, this._total]);\n        }\n\n        this._total = chunks.reduce(\n            (result, item) => result + item.byteLength,\n            0\n        );\n        const result = new Uint8Array(this._total);\n        let position = 0;\n        for (const chunk of chunks) {\n            result.set(chunk, position);\n            position += chunk.byteLength;\n        }\n        return result;\n    }\n}\n\nlet cachedValue: FetchWithProgress | undefined;\nexport function fetchServer(\n    onProgress?: (e: [downloaded: number, total: number]) => void\n) {\n    if (!cachedValue) {\n        cachedValue = new FetchWithProgress(SERVER_URL);\n        cachedValue.promise.catch((e) => {\n            cachedValue = undefined;\n        });\n    }\n\n    if (onProgress) {\n        cachedValue.onProgress(onProgress);\n        onProgress([cachedValue.downloaded, cachedValue.total]);\n    }\n\n    return cachedValue.promise;\n}\n","import { ADB_SYNC_MAX_PACKET_SIZE } from \"@yume-chan/adb\";\nimport {\n    AdbScrcpyClient,\n    AdbScrcpyOptions1_22,\n    AndroidScreenPowerMode,\n    CodecOptions,\n    DEFAULT_SERVER_PATH,\n    ScrcpyDeviceMessageType,\n    ScrcpyHoverHelper,\n    ScrcpyLogLevel,\n    ScrcpyOptions1_25,\n    ScrcpyVideoStreamConfigurationPacket,\n    ScrcpyVideoStreamPacket,\n    clamp,\n} from \"@yume-chan/scrcpy\";\nimport SCRCPY_SERVER_VERSION from \"@yume-chan/scrcpy/bin/version\";\nimport {\n    ChunkStream,\n    InspectStream,\n    ReadableStream,\n    WritableStream,\n} from \"@yume-chan/stream-extra\";\nimport { action, autorun, makeAutoObservable, runInAction } from \"mobx\";\nimport { GLOBAL_STATE } from \"../../state\";\nimport { ProgressStream } from \"../../utils\";\nimport { DeviceViewRef } from \"../device-view\";\nimport { fetchServer } from \"./fetch-server\";\nimport { MuxerStream, RECORD_STATE } from \"./recorder\";\nimport { H264Decoder, SETTING_STATE } from \"./settings\";\n\nconst NOOP = () => {\n    /* empty */\n};\n\nexport class ScrcpyPageState {\n    running = false;\n\n    deviceView: DeviceViewRef | null = null;\n    rendererContainer: HTMLDivElement | null = null;\n\n    logVisible = false;\n    log: string[] = [];\n    demoModeVisible = false;\n    navigationBarVisible = true;\n\n    width = 0;\n    height = 0;\n    rotation = 0;\n\n    get rotatedWidth() {\n        return STATE.rotation & 1 ? STATE.height : STATE.width;\n    }\n    get rotatedHeight() {\n        return STATE.rotation & 1 ? STATE.width : STATE.height;\n    }\n\n    client: AdbScrcpyClient | undefined = undefined;\n    hoverHelper: ScrcpyHoverHelper | undefined = undefined;\n\n    async pushServer() {\n        const serverBuffer = await fetchServer();\n\n        await new ReadableStream<Uint8Array>({\n            start(controller) {\n                controller.enqueue(serverBuffer);\n                controller.close();\n            },\n        }).pipeTo(AdbScrcpyClient.pushServer(GLOBAL_STATE.device!));\n    }\n\n    decoder: H264Decoder | undefined = undefined;\n    configuration: ScrcpyVideoStreamConfigurationPacket | undefined = undefined;\n    fpsCounterIntervalId: any = undefined;\n    fps = \"0\";\n\n    connecting = false;\n    serverTotalSize = 0;\n    serverDownloadedSize = 0;\n    debouncedServerDownloadedSize = 0;\n    serverDownloadSpeed = 0;\n    serverUploadedSize = 0;\n    debouncedServerUploadedSize = 0;\n    serverUploadSpeed = 0;\n\n    constructor() {\n        makeAutoObservable(this, {\n            start: false,\n            stop: action.bound,\n            dispose: action.bound,\n            handleDeviceViewRef: action.bound,\n            handleRendererContainerRef: action.bound,\n            clientPositionToDevicePosition: false,\n        });\n\n        autorun(() => {\n            if (!GLOBAL_STATE.device) {\n                this.dispose();\n            }\n        });\n\n        autorun(() => {\n            if (this.rendererContainer && this.decoder) {\n                while (this.rendererContainer.firstChild) {\n                    this.rendererContainer.firstChild.remove();\n                }\n                this.rendererContainer.appendChild(this.decoder.renderer);\n            }\n        });\n    }\n\n    start = async () => {\n        if (!GLOBAL_STATE.device) {\n            return;\n        }\n\n        try {\n            if (!SETTING_STATE.clientSettings.decoder) {\n                throw new Error(\"No available decoder\");\n            }\n\n            runInAction(() => {\n                this.serverTotalSize = 0;\n                this.serverDownloadedSize = 0;\n                this.debouncedServerDownloadedSize = 0;\n                this.serverUploadedSize = 0;\n                this.debouncedServerUploadedSize = 0;\n                this.connecting = true;\n            });\n\n            let intervalId = setInterval(\n                action(() => {\n                    this.serverDownloadSpeed =\n                        this.serverDownloadedSize -\n                        this.debouncedServerDownloadedSize;\n                    this.debouncedServerDownloadedSize =\n                        this.serverDownloadedSize;\n                }),\n                1000\n            );\n\n            let serverBuffer: Uint8Array;\n            try {\n                serverBuffer = await fetchServer(\n                    action(([downloaded, total]) => {\n                        this.serverDownloadedSize = downloaded;\n                        this.serverTotalSize = total;\n                    })\n                );\n                runInAction(() => {\n                    this.serverDownloadSpeed =\n                        this.serverDownloadedSize -\n                        this.debouncedServerDownloadedSize;\n                    this.debouncedServerDownloadedSize =\n                        this.serverDownloadedSize;\n                });\n            } finally {\n                clearInterval(intervalId);\n            }\n\n            intervalId = setInterval(\n                action(() => {\n                    this.serverUploadSpeed =\n                        this.serverUploadedSize -\n                        this.debouncedServerUploadedSize;\n                    this.debouncedServerUploadedSize = this.serverUploadedSize;\n                }),\n                1000\n            );\n\n            try {\n                await new ReadableStream<Uint8Array>({\n                    start(controller) {\n                        controller.enqueue(serverBuffer);\n                        controller.close();\n                    },\n                })\n                    .pipeThrough(new ChunkStream(ADB_SYNC_MAX_PACKET_SIZE))\n                    .pipeThrough(\n                        new ProgressStream(\n                            action((progress) => {\n                                this.serverUploadedSize = progress;\n                            })\n                        )\n                    )\n                    .pipeTo(AdbScrcpyClient.pushServer(GLOBAL_STATE.device!));\n\n                runInAction(() => {\n                    this.serverUploadSpeed =\n                        this.serverUploadedSize -\n                        this.debouncedServerUploadedSize;\n                    this.debouncedServerUploadedSize = this.serverUploadedSize;\n                });\n            } finally {\n                clearInterval(intervalId);\n            }\n\n            const decoderDefinition =\n                SETTING_STATE.decoders.find(\n                    (x) => x.key === SETTING_STATE.clientSettings.decoder\n                ) ?? SETTING_STATE.decoders[0];\n            const decoder = new decoderDefinition.Constructor();\n\n            runInAction(() => {\n                this.decoder = decoder;\n\n                let lastFrameRendered = 0;\n                let lastFrameSkipped = 0;\n                this.fpsCounterIntervalId = setInterval(\n                    action(() => {\n                        const deltaRendered =\n                            decoder.frameRendered - lastFrameRendered;\n                        const deltaSkipped =\n                            decoder.frameSkipped - lastFrameSkipped;\n                        // prettier-ignore\n                        this.fps = `${\n                            deltaRendered\n                        }${\n                            deltaSkipped ? `+${deltaSkipped} skipped` : \"\"\n                        }`;\n                        lastFrameRendered = decoder.frameRendered;\n                        lastFrameSkipped = decoder.frameSkipped;\n                    }),\n                    1000\n                );\n            });\n\n            const codecOptions = new CodecOptions();\n            if (!SETTING_STATE.clientSettings.ignoreDecoderCodecArgs) {\n                codecOptions.value.profile = decoder.maxProfile;\n                codecOptions.value.level = decoder.maxLevel;\n            }\n\n            // Disabled due to https://github.com/Genymobile/scrcpy/issues/2841\n            // Less recording delay\n            // codecOptions.value.iFrameInterval = 1;\n            // Less latency\n            // codecOptions.value.intraRefreshPeriod = 10000;\n\n            const options = new AdbScrcpyOptions1_22(\n                new ScrcpyOptions1_25({\n                    logLevel: ScrcpyLogLevel.Debug,\n                    ...SETTING_STATE.settings,\n                    sendDeviceMeta: false,\n                    sendDummyByte: false,\n                    codecOptions,\n                })\n            );\n\n            runInAction(() => {\n                this.log = [];\n                this.log.push(\n                    `[client] Server version: ${SCRCPY_SERVER_VERSION}`\n                );\n                this.log.push(\n                    `[client] Server arguments: ${options\n                        .formatServerArguments()\n                        .join(\" \")}`\n                );\n            });\n\n            const client = await AdbScrcpyClient.start(\n                GLOBAL_STATE.device!,\n                DEFAULT_SERVER_PATH,\n                SCRCPY_SERVER_VERSION,\n                options\n            );\n\n            client.stdout.pipeTo(\n                new WritableStream<string>({\n                    write: action((line) => {\n                        this.log.push(line);\n                    }),\n                })\n            );\n\n            RECORD_STATE.recorder = new MuxerStream();\n            let lastKeyframe = 0;\n            client.videoStream\n                .pipeThrough(\n                    new InspectStream(\n                        action((packet: ScrcpyVideoStreamPacket) => {\n                            if (packet.type === \"configuration\") {\n                                const { croppedWidth, croppedHeight } =\n                                    packet.data;\n                                this.log.push(\n                                    `[client] Video size changed: ${croppedWidth}x${croppedHeight}`\n                                );\n\n                                this.configuration = packet;\n                                this.width = croppedWidth;\n                                this.height = croppedHeight;\n                            } else if (packet.keyframe) {\n                                if (lastKeyframe) {\n                                    this.log.push(\n                                        `[client] Keyframe interval: ${\n                                            ((Number(packet.pts) -\n                                                lastKeyframe) /\n                                                1000) |\n                                            0\n                                        }ms`\n                                    );\n                                }\n                                lastKeyframe = Number(packet.pts);\n                            }\n                        })\n                    )\n                )\n                .pipeThrough(RECORD_STATE.recorder)\n                .pipeTo(decoder.writable)\n                .catch(() => {});\n\n            client.exit.then(this.dispose);\n\n            client\n                .deviceMessageStream!.pipeTo(\n                    new WritableStream({\n                        write(message) {\n                            switch (message.type) {\n                                case ScrcpyDeviceMessageType.Clipboard:\n                                    window.navigator.clipboard.writeText(\n                                        message.content\n                                    );\n                                    break;\n                            }\n                        },\n                    })\n                )\n                .catch(() => {});\n\n            if (SETTING_STATE.clientSettings.turnScreenOff) {\n                await client.controlMessageSerializer!.setScreenPowerMode(\n                    AndroidScreenPowerMode.Off\n                );\n            }\n\n\n            runInAction(() => {\n                this.client = client;\n                this.hoverHelper = new ScrcpyHoverHelper();\n                this.running = true;\n            });\n        } catch (e: any) {\n            GLOBAL_STATE.showErrorDialog(e);\n        } finally {\n            runInAction(() => {\n                this.connecting = false;\n            });\n        }\n    };\n\n    async stop() {\n        // Request to close client first\n        await this.client?.close();\n        this.dispose();\n    }\n\n    dispose() {\n        // Otherwise some packets may still arrive at decoder\n        this.decoder?.dispose();\n        this.decoder = undefined;\n\n        if (RECORD_STATE.recording) {\n            RECORD_STATE.recorder.stop();\n            RECORD_STATE.recording = false;\n        }\n\n        this.fps = \"0\";\n        clearTimeout(this.fpsCounterIntervalId);\n\n        document.exitFullscreen().catch(NOOP);\n\n        this.client = undefined;\n        this.running = false;\n    }\n\n    handleDeviceViewRef(element: DeviceViewRef | null) {\n        this.deviceView = element;\n    }\n\n    handleRendererContainerRef(element: HTMLDivElement | null) {\n        this.rendererContainer = element;\n    }\n\n    clientPositionToDevicePosition(clientX: number, clientY: number) {\n        const viewRect = this.rendererContainer!.getBoundingClientRect();\n        let pointerViewX = clamp((clientX - viewRect.x) / viewRect.width, 0, 1);\n        let pointerViewY = clamp(\n            (clientY - viewRect.y) / viewRect.height,\n            0,\n            1\n        );\n\n        if (this.rotation & 1) {\n            [pointerViewX, pointerViewY] = [pointerViewY, pointerViewX];\n        }\n        switch (this.rotation) {\n            case 1:\n                pointerViewY = 1 - pointerViewY;\n                break;\n            case 2:\n                pointerViewX = 1 - pointerViewX;\n                pointerViewY = 1 - pointerViewY;\n                break;\n            case 3:\n                pointerViewX = 1 - pointerViewX;\n                break;\n        }\n\n        return {\n            x: pointerViewX * this.width,\n            y: pointerViewY * this.height,\n        };\n    }\n}\n\nexport const STATE = new ScrcpyPageState();\n","import {\n    Dropdown,\n    IDropdownOption,\n    Icon,\n    IconButton,\n    Position,\n    SpinButton,\n    Stack,\n    TextField,\n    Toggle,\n    TooltipHost,\n} from \"@fluentui/react\";\nimport { makeStyles } from \"@griffel/react\";\nimport { Disposable } from \"@yume-chan/event\";\nimport {\n    AdbScrcpyClient,\n    AdbScrcpyOptions1_22,\n    AndroidCodecLevel,\n    AndroidCodecProfile,\n    DEFAULT_SERVER_PATH,\n    ScrcpyLogLevel,\n    ScrcpyOptions1_25,\n    ScrcpyOptionsInit1_24,\n    ScrcpyVideoOrientation,\n    ScrcpyVideoStreamPacket,\n} from \"@yume-chan/scrcpy\";\nimport { TinyH264Decoder } from \"@yume-chan/scrcpy-decoder-tinyh264\";\nimport SCRCPY_SERVER_VERSION from \"@yume-chan/scrcpy/bin/version\";\nimport { WritableStream } from \"@yume-chan/stream-extra\";\nimport {\n    autorun,\n    computed,\n    makeAutoObservable,\n    observable,\n    runInAction,\n} from \"mobx\";\nimport { observer } from \"mobx-react-lite\";\nimport { GLOBAL_STATE } from \"../../state\";\nimport { Icons } from \"../../utils\";\nimport { STATE } from \"./state\";\n\nexport type Settings = Partial<ScrcpyOptionsInit1_24>;\n\nexport interface ClientSettings {\n    turnScreenOff?: boolean;\n    decoder?: string;\n    ignoreDecoderCodecArgs?: boolean;\n}\n\nexport type SettingKeys = keyof (Settings & ClientSettings);\n\nexport interface SettingDefinitionBase {\n    group: \"settings\" | \"clientSettings\";\n    key: SettingKeys;\n    type: string;\n    label: string;\n    labelExtra?: JSX.Element;\n    description?: string;\n}\n\nexport interface TextSettingDefinition extends SettingDefinitionBase {\n    type: \"text\";\n    placeholder?: string;\n}\n\nexport interface DropdownSettingDefinition extends SettingDefinitionBase {\n    type: \"dropdown\";\n    placeholder?: string;\n    options: IDropdownOption[];\n}\n\nexport interface ToggleSettingDefinition extends SettingDefinitionBase {\n    type: \"toggle\";\n    disabled?: boolean;\n}\n\nexport interface NumberSettingDefinition extends SettingDefinitionBase {\n    type: \"number\";\n    min?: number;\n    max?: number;\n    step?: number;\n}\n\nexport type SettingDefinition =\n    | TextSettingDefinition\n    | DropdownSettingDefinition\n    | ToggleSettingDefinition\n    | NumberSettingDefinition;\n\ninterface SettingItemProps {\n    definition: SettingDefinition;\n    value: any;\n    onChange: (definition: SettingDefinition, value: any) => void;\n}\n\nconst useClasses = makeStyles({\n    labelRight: {\n        marginLeft: \"4px\",\n    },\n});\n\nexport const SettingItem = observer(function SettingItem({\n    definition,\n    value,\n    onChange,\n}: SettingItemProps) {\n    const classes = useClasses();\n\n    let label: JSX.Element = (\n        <Stack horizontal verticalAlign=\"center\">\n            <span>{definition.label}</span>\n            {!!definition.description && (\n                <TooltipHost content={definition.description}>\n                    <Icon\n                        className={classes.labelRight}\n                        iconName={Icons.Info}\n                    />\n                </TooltipHost>\n            )}\n            {definition.labelExtra}\n        </Stack>\n    );\n\n    switch (definition.type) {\n        case \"text\":\n            return (\n                <TextField\n                    label={label as any}\n                    placeholder={definition.placeholder}\n                    value={value}\n                    onChange={(e, value) => onChange(definition, value)}\n                />\n            );\n        case \"dropdown\":\n            return (\n                <Dropdown\n                    label={label as any}\n                    options={definition.options}\n                    placeholder={definition.placeholder}\n                    selectedKey={value}\n                    onChange={(e, option) => onChange(definition, option!.key)}\n                />\n            );\n        case \"toggle\":\n            return (\n                <Toggle\n                    label={label}\n                    checked={value}\n                    disabled={definition.disabled}\n                    onChange={(e, checked) => onChange(definition, checked)}\n                />\n            );\n        case \"number\":\n            return (\n                <SpinButton\n                    label={definition.label}\n                    labelPosition={Position.top}\n                    min={definition.min}\n                    max={definition.max}\n                    step={definition.step}\n                    value={value.toString()}\n                    onChange={(e, value) =>\n                        onChange(definition, Number.parseInt(value!, 10))\n                    }\n                />\n            );\n    }\n});\n\nexport interface H264Decoder extends Disposable {\n    readonly maxProfile: AndroidCodecProfile | undefined;\n    readonly maxLevel: AndroidCodecLevel | undefined;\n\n    readonly renderer: HTMLElement;\n    readonly frameRendered: number;\n    readonly frameSkipped: number;\n    readonly writable: WritableStream<ScrcpyVideoStreamPacket>;\n}\n\nexport interface H264DecoderConstructor {\n    new (): H264Decoder;\n}\n\nexport interface DecoderDefinition {\n    key: string;\n    name: string;\n    Constructor: H264DecoderConstructor;\n}\n\nexport const SETTING_STATE = makeAutoObservable(\n    {\n        settingsVisible: false,\n\n        displays: [] as number[],\n        encoders: [] as string[],\n        decoders: [\n            {\n                key: \"tinyh264\",\n                name: \"TinyH264 (Software)\",\n                Constructor: TinyH264Decoder,\n            },\n        ] as DecoderDefinition[],\n\n        settings: {\n            maxSize: 1080,\n            bitRate: 4_000_000,\n            lockVideoOrientation: ScrcpyVideoOrientation.Unlocked,\n            displayId: 0,\n            crop: \"\",\n            powerOn: true,\n        } as Settings,\n\n        clientSettings: {} as ClientSettings,\n    },\n    {\n        decoders: observable.shallow,\n        settings: observable.deep,\n        clientSettings: observable.deep,\n    }\n);\n\nautorun(() => {\n    if (GLOBAL_STATE.device) {\n        runInAction(() => {\n            SETTING_STATE.encoders = [];\n            SETTING_STATE.settings.encoderName = undefined;\n\n            SETTING_STATE.displays = [];\n            SETTING_STATE.settings.displayId = undefined;\n        });\n    }\n});\n\nautorun(() => {\n    SETTING_STATE.clientSettings.decoder = SETTING_STATE.decoders[0].key;\n});\n\nexport const SETTING_DEFINITIONS = computed(() => {\n    const result: SettingDefinition[] = [];\n\n    result.push(\n        {\n            group: \"settings\",\n            key: \"powerOn\",\n            type: \"toggle\",\n            label: \"Turn device on when starting\",\n        },\n        {\n            group: \"clientSettings\",\n            key: \"turnScreenOff\",\n            type: \"toggle\",\n            label: \"Turn screen off when starting\",\n        },\n        {\n            group: \"settings\",\n            key: \"stayAwake\",\n            type: \"toggle\",\n            label: \"Stay awake (if plugged in)\",\n        },\n        {\n            group: \"settings\",\n            key: \"powerOffOnClose\",\n            type: \"toggle\",\n            label: \"Turn device off when exiting\",\n        }\n    );\n\n    result.push({\n        group: \"settings\",\n        key: \"displayId\",\n        type: \"dropdown\",\n        label: \"Display\",\n        placeholder: \"Press refresh to update available displays\",\n        labelExtra: (\n            <IconButton\n                iconProps={{ iconName: Icons.ArrowClockwise }}\n                disabled={!GLOBAL_STATE.device}\n                text=\"Refresh\"\n                onClick={async () => {\n                    try {\n                        await STATE.pushServer();\n\n                        const displays = await AdbScrcpyClient.getDisplays(\n                            GLOBAL_STATE.device!,\n                            DEFAULT_SERVER_PATH,\n                            SCRCPY_SERVER_VERSION,\n                            new AdbScrcpyOptions1_22(\n                                new ScrcpyOptions1_25({\n                                    logLevel: ScrcpyLogLevel.Debug,\n                                })\n                            )\n                        );\n\n                        runInAction(() => {\n                            SETTING_STATE.displays = displays;\n                            if (\n                                !SETTING_STATE.settings.displayId ||\n                                !SETTING_STATE.displays.includes(\n                                    SETTING_STATE.settings.displayId\n                                )\n                            ) {\n                                SETTING_STATE.settings.displayId =\n                                    SETTING_STATE.displays[0];\n                            }\n                        });\n                    } catch (e: any) {\n                        GLOBAL_STATE.showErrorDialog(e);\n                    }\n                }}\n            />\n        ),\n        options: SETTING_STATE.displays.map((item) => ({\n            key: item,\n            text: item.toString(),\n        })),\n    });\n\n    result.push({\n        group: \"settings\",\n        key: \"crop\",\n        type: \"text\",\n        label: \"Crop\",\n        placeholder: \"W:H:X:Y\",\n    });\n\n    result.push({\n        group: \"settings\",\n        key: \"maxSize\",\n        type: \"number\",\n        label: \"Max Resolution (longer side, 0 = unlimited)\",\n        min: 0,\n        max: 2560,\n        step: 50,\n    });\n\n    result.push({\n        group: \"settings\",\n        key: \"bitRate\",\n        type: \"number\",\n        label: \"Max Bit Rate\",\n        min: 100,\n        max: 100_000_000,\n        step: 100,\n    });\n\n    result.push({\n        group: \"settings\",\n        key: \"lockVideoOrientation\",\n        type: \"dropdown\",\n        label: \"Lock Video Orientation\",\n        options: [\n            {\n                key: ScrcpyVideoOrientation.Unlocked,\n                text: \"Unlocked\",\n            },\n            {\n                key: ScrcpyVideoOrientation.Initial,\n                text: \"Current\",\n            },\n            {\n                key: ScrcpyVideoOrientation.Portrait,\n                text: \"Portrait\",\n            },\n            {\n                key: ScrcpyVideoOrientation.Landscape,\n                text: \"Landscape\",\n            },\n            {\n                key: ScrcpyVideoOrientation.PortraitFlipped,\n                text: \"Portrait (Flipped)\",\n            },\n            {\n                key: ScrcpyVideoOrientation.LandscapeFlipped,\n                text: \"Landscape (Flipped)\",\n            },\n        ],\n    });\n\n    result.push({\n        group: \"settings\",\n        key: \"encoderName\",\n        type: \"dropdown\",\n        label: \"Encoder\",\n        placeholder: \"Press refresh to update available encoders\",\n        labelExtra: (\n            <IconButton\n                iconProps={{ iconName: Icons.ArrowClockwise }}\n                disabled={!GLOBAL_STATE.device}\n                text=\"Refresh\"\n                onClick={async () => {\n                    try {\n                        await STATE.pushServer();\n\n                        const encoders = await AdbScrcpyClient.getEncoders(\n                            GLOBAL_STATE.device!,\n                            DEFAULT_SERVER_PATH,\n                            SCRCPY_SERVER_VERSION,\n                            new AdbScrcpyOptions1_22(\n                                new ScrcpyOptions1_25({\n                                    logLevel: ScrcpyLogLevel.Debug,\n                                })\n                            )\n                        );\n\n                        runInAction(() => {\n                            SETTING_STATE.encoders = encoders;\n                            if (\n                                !SETTING_STATE.settings.encoderName ||\n                                !SETTING_STATE.encoders.includes(\n                                    SETTING_STATE.settings.encoderName\n                                )\n                            ) {\n                                SETTING_STATE.settings.encoderName =\n                                    SETTING_STATE.encoders[0];\n                            }\n                        });\n                    } catch (e: any) {\n                        GLOBAL_STATE.showErrorDialog(e);\n                    }\n                }}\n            />\n        ),\n        options: SETTING_STATE.encoders.map((item) => ({\n            key: item,\n            text: item,\n        })),\n    });\n\n    if (SETTING_STATE.decoders.length > 1) {\n        result.push({\n            group: \"clientSettings\",\n            key: \"decoder\",\n            type: \"dropdown\",\n            label: \"Decoder\",\n            options: SETTING_STATE.decoders.map((item) => ({\n                key: item.key,\n                text: item.name,\n                data: item,\n            })),\n        });\n    }\n\n    result.push({\n        group: \"clientSettings\",\n        key: \"ignoreDecoderCodecArgs\",\n        type: \"toggle\",\n        label: `Ignore decoder's codec arguments`,\n        description: `Some decoders don't support all H.264 profile/levels, so they request the device to encode at their highest-supported codec. However, some super old devices may not support that codec so their encoders will fail to start. Use this option to let device choose the codec to be used.`,\n    });\n\n    return result;\n});\n","import {\n    CommandBar,\n    ContextualMenuItemType,\n    ICommandBarItemProps,\n} from \"@fluentui/react\";\nimport {\n    AndroidKeyCode,\n    AndroidKeyEventAction,\n    AndroidScreenPowerMode,\n} from \"@yume-chan/scrcpy\";\nimport { action, computed } from \"mobx\";\nimport { observer } from \"mobx-react-lite\";\nimport { GLOBAL_STATE } from \"../../state\";\nimport { Icons } from \"../../utils\";\nimport { ExternalLink } from \"../external-link\";\nimport { CommandBarSpacerItem } from \"./command-bar-spacer-item\";\nimport { RECORD_STATE } from \"./recorder\";\nimport { SETTING_STATE } from \"./settings\";\nimport { STATE } from \"./state\";\n\nconst ITEMS = computed(() => {\n    const result: ICommandBarItemProps[] = [];\n\n    if (!STATE.running) {\n        result.push({\n            key: \"start\",\n            disabled: !GLOBAL_STATE.device,\n            iconProps: { iconName: Icons.Play },\n            text: \"Start\",\n            onClick: STATE.start as VoidFunction,\n        });\n    } else {\n        result.push({\n            key: \"stop\",\n            iconProps: { iconName: Icons.Stop },\n            text: \"Stop\",\n            onClick: STATE.stop as VoidFunction,\n        });\n    }\n\n    result.push(\n        RECORD_STATE.recording\n            ? {\n                  key: \"Record\",\n                  iconProps: {\n                      iconName: Icons.Record,\n                      style: { color: \"red\" },\n                  },\n                  // prettier-ignore\n                  text: `${\n                      RECORD_STATE.hours ? `${RECORD_STATE.hours}:` : \"\"\n                  }${\n                      RECORD_STATE.minutes.toString().padStart(2, \"0\")\n                  }:${\n                      RECORD_STATE.seconds.toString().padStart(2, \"0\")\n                  }`,\n                  onClick: action(() => {\n                      RECORD_STATE.recorder.stop();\n                      RECORD_STATE.recording = false;\n                  }),\n              }\n            : {\n                  key: \"Record\",\n                  disabled: !STATE.running,\n                  iconProps: { iconName: Icons.Record },\n                  text: \"Record\",\n                  onClick: action(() => {\n                      RECORD_STATE.recorder.start();\n                      RECORD_STATE.recording = true;\n                  }),\n              }\n    );\n\n    result.push({\n        key: \"fullscreen\",\n        disabled: !STATE.running,\n        iconProps: { iconName: Icons.FullScreenMaximize },\n        iconOnly: true,\n        text: \"Fullscreen\",\n        onClick: () => {\n            STATE.deviceView?.enterFullscreen();\n        },\n    });\n\n    result.push(\n        {\n            key: \"volumeUp\",\n            disabled: !STATE.running,\n            iconProps: { iconName: Icons.Speaker2 },\n            iconOnly: true,\n            text: \"Volume Up\",\n            onClick: (async () => {\n                // TODO: Auto repeat when holding\n                await STATE.client?.controlMessageSerializer!.injectKeyCode({\n                    action: AndroidKeyEventAction.Down,\n                    keyCode: AndroidKeyCode.VolumeUp,\n                    repeat: 0,\n                    metaState: 0,\n                });\n                await STATE.client?.controlMessageSerializer!.injectKeyCode({\n                    action: AndroidKeyEventAction.Up,\n                    keyCode: AndroidKeyCode.VolumeUp,\n                    repeat: 0,\n                    metaState: 0,\n                });\n            }) as () => void,\n        },\n        {\n            key: \"volumeDown\",\n            disabled: !STATE.running,\n            iconProps: { iconName: Icons.Speaker1 },\n            iconOnly: true,\n            text: \"Volume Down\",\n            onClick: (async () => {\n                await STATE.client?.controlMessageSerializer!.injectKeyCode({\n                    action: AndroidKeyEventAction.Down,\n                    keyCode: AndroidKeyCode.VolumeDown,\n                    repeat: 0,\n                    metaState: 0,\n                });\n                await STATE.client?.controlMessageSerializer!.injectKeyCode({\n                    action: AndroidKeyEventAction.Up,\n                    keyCode: AndroidKeyCode.VolumeDown,\n                    repeat: 0,\n                    metaState: 0,\n                });\n            }) as () => void,\n        },\n        {\n            key: \"volumeMute\",\n            disabled: !STATE.running,\n            iconProps: { iconName: Icons.SpeakerOff },\n            iconOnly: true,\n            text: \"Toggle Mute\",\n            onClick: (async () => {\n                await STATE.client?.controlMessageSerializer!.injectKeyCode({\n                    action: AndroidKeyEventAction.Down,\n                    keyCode: AndroidKeyCode.VolumeMute,\n                    repeat: 0,\n                    metaState: 0,\n                });\n                await STATE.client?.controlMessageSerializer!.injectKeyCode({\n                    action: AndroidKeyEventAction.Up,\n                    keyCode: AndroidKeyCode.VolumeMute,\n                    repeat: 0,\n                    metaState: 0,\n                });\n            }) as () => void,\n        }\n    );\n\n    result.push(\n        {\n            key: \"rotateDevice\",\n            disabled: !STATE.running,\n            iconProps: { iconName: Icons.Orientation },\n            iconOnly: true,\n            text: \"Rotate Device\",\n            onClick: () => {\n                STATE.client!.controlMessageSerializer!.rotateDevice();\n            },\n        },\n        {\n            key: \"rotateVideoLeft\",\n            disabled: !STATE.running,\n            iconProps: { iconName: Icons.RotateLeft },\n            iconOnly: true,\n            text: \"Rotate Video Left\",\n            onClick: action(() => {\n                STATE.rotation -= 1;\n                if (STATE.rotation < 0) {\n                    STATE.rotation = 3;\n                }\n            }),\n        },\n        {\n            key: \"rotateVideoRight\",\n            disabled: !STATE.running,\n            iconProps: { iconName: Icons.RotateRight },\n            iconOnly: true,\n            text: \"Rotate Video Right\",\n            onClick: action(() => {\n                STATE.rotation = (STATE.rotation + 1) & 3;\n            }),\n        }\n    );\n\n    result.push(\n        {\n            key: \"turnScreenOff\",\n            disabled: !STATE.running,\n            iconProps: { iconName: Icons.Lightbulb },\n            iconOnly: true,\n            text: \"Turn Screen Off\",\n            onClick: () => {\n                STATE.client!.controlMessageSerializer!.setScreenPowerMode(\n                    AndroidScreenPowerMode.Off\n                );\n            },\n        },\n        {\n            key: \"turnScreenOn\",\n            disabled: !STATE.running,\n            iconProps: { iconName: Icons.LightbulbFilament },\n            iconOnly: true,\n            text: \"Turn Screen On\",\n            onClick: () => {\n                STATE.client!.controlMessageSerializer!.setScreenPowerMode(\n                    AndroidScreenPowerMode.Normal\n                );\n            },\n        }\n    );\n\n    if (STATE.running) {\n        result.push({\n            key: \"fps\",\n            text: `FPS: ${STATE.fps}`,\n            disabled: true,\n        });\n    }\n\n    result.push(\n        {\n            // HACK: make CommandBar overflow on far items\n            // https://github.com/microsoft/fluentui/issues/11842\n            key: \"spacer\",\n            onRender: () => <CommandBarSpacerItem />,\n        },\n        {\n            // HACK: add a separator in CommandBar\n            // https://github.com/microsoft/fluentui/issues/10035\n            key: \"separator\",\n            disabled: true,\n            itemType: ContextualMenuItemType.Divider,\n        }\n    );\n\n    result.push(\n        {\n            key: \"NavigationBar\",\n            iconProps: { iconName: Icons.PanelBottom },\n            canCheck: true,\n            checked: STATE.navigationBarVisible,\n            text: \"Navigation Bar\",\n            iconOnly: true,\n            onClick: action(() => {\n                STATE.navigationBarVisible = !STATE.navigationBarVisible;\n            }),\n        },\n        {\n            key: \"Log\",\n            iconProps: { iconName: Icons.TextGrammarError },\n            canCheck: true,\n            checked: STATE.logVisible,\n            text: \"Log\",\n            iconOnly: true,\n            onClick: action(() => {\n                STATE.logVisible = !STATE.logVisible;\n            }),\n        },\n        {\n            key: \"Settings\",\n            iconProps: { iconName: Icons.Settings },\n            canCheck: true,\n            checked: SETTING_STATE.settingsVisible,\n            text: \"Settings\",\n            iconOnly: true,\n            onClick: action(() => {\n                SETTING_STATE.settingsVisible = !SETTING_STATE.settingsVisible;\n            }),\n        },\n        {\n            key: \"DemoMode\",\n            iconProps: { iconName: Icons.Wand },\n            canCheck: true,\n            checked: STATE.demoModeVisible,\n            text: \"Demo Mode\",\n            iconOnly: true,\n            onClick: action(() => {\n                STATE.demoModeVisible = !STATE.demoModeVisible;\n            }),\n        },\n        {\n            key: \"info\",\n            iconProps: { iconName: Icons.Info },\n            iconOnly: true,\n            text: \"About\",\n            tooltipHostProps: {\n                content: (\n                    <>\n                        <p>\n                            <ExternalLink\n                                href=\"https://github.com/Genymobile/scrcpy\"\n                                spaceAfter\n                            >\n                                Scrcpy\n                            </ExternalLink>\n                            developed by Genymobile can display the screen with\n                            low latency (1~2 frames) and control the device, all\n                            without root access.\n                        </p>\n                        <p>\n                            This is a TypeScript implementation of the client\n                            part. Paired with official pre-built server binary.\n                        </p>\n                    </>\n                ),\n                calloutProps: {\n                    calloutMaxWidth: 300,\n                },\n            },\n        }\n    );\n\n    return result;\n});\n\nexport const ScrcpyCommandBar = observer(function ScrcpyCommandBar() {\n    return <CommandBar items={ITEMS.get()} />;\n});\n","import { IconButton, Stack } from \"@fluentui/react\";\nimport { makeStyles, mergeClasses } from \"@griffel/react\";\nimport { AndroidKeyCode, AndroidKeyEventAction } from \"@yume-chan/scrcpy\";\nimport { observer } from \"mobx-react-lite\";\nimport { CSSProperties, PointerEvent, ReactNode } from \"react\";\nimport { Icons } from \"../../utils\";\nimport { STATE } from \"./state\";\n\nconst useClasses = makeStyles({\n    container: {\n        height: \"40px\",\n        backgroundColor: \"#999\",\n    },\n    bar: {\n        width: \"100%\",\n        maxWidth: \"300px\",\n    },\n    icon: {\n        color: \"white\",\n    },\n    back: {\n        transform: \"rotate(180deg)\",\n    },\n});\n\nfunction handlePointerDown(e: PointerEvent<HTMLDivElement>) {\n    if (!STATE.client) {\n        return false;\n    }\n\n    if (e.button !== 0) {\n        return false;\n    }\n\n    e.currentTarget.setPointerCapture(e.pointerId);\n    return true;\n}\n\nfunction handlePointerUp(e: PointerEvent<HTMLDivElement>) {\n    if (!STATE.client) {\n        return false;\n    }\n\n    if (e.button !== 0) {\n        return false;\n    }\n\n    return true;\n}\n\nfunction handleBackPointerDown(e: PointerEvent<HTMLDivElement>) {\n    if (!handlePointerDown(e)) {\n        return;\n    }\n\n    STATE.client!.controlMessageSerializer!.backOrScreenOn(\n        AndroidKeyEventAction.Down\n    );\n}\n\nfunction handleBackPointerUp(e: PointerEvent<HTMLDivElement>) {\n    if (!handlePointerUp(e)) {\n        return;\n    }\n\n    STATE.client!.controlMessageSerializer!.backOrScreenOn(\n        AndroidKeyEventAction.Up\n    );\n}\n\nfunction handleHomePointerDown(e: PointerEvent<HTMLDivElement>) {\n    if (!handlePointerDown(e)) {\n        return;\n    }\n\n    STATE.client!.controlMessageSerializer!.injectKeyCode({\n        action: AndroidKeyEventAction.Down,\n        keyCode: AndroidKeyCode.AndroidHome,\n        repeat: 0,\n        metaState: 0,\n    });\n}\n\nfunction handleHomePointerUp(e: PointerEvent<HTMLDivElement>) {\n    if (!handlePointerUp(e)) {\n        return;\n    }\n\n    STATE.client!.controlMessageSerializer!.injectKeyCode({\n        action: AndroidKeyEventAction.Up,\n        keyCode: AndroidKeyCode.AndroidHome,\n        repeat: 0,\n        metaState: 0,\n    });\n}\n\nfunction handleAppSwitchPointerDown(e: PointerEvent<HTMLDivElement>) {\n    if (!handlePointerDown(e)) {\n        return;\n    }\n\n    STATE.client!.controlMessageSerializer!.injectKeyCode({\n        action: AndroidKeyEventAction.Down,\n        keyCode: AndroidKeyCode.AndroidAppSwitch,\n        repeat: 0,\n        metaState: 0,\n    });\n}\n\nfunction handleAppSwitchPointerUp(e: PointerEvent<HTMLDivElement>) {\n    if (!handlePointerUp(e)) {\n        return;\n    }\n\n    STATE.client!.controlMessageSerializer!.injectKeyCode({\n        action: AndroidKeyEventAction.Up,\n        keyCode: AndroidKeyCode.AndroidAppSwitch,\n        repeat: 0,\n        metaState: 0,\n    });\n}\n\nexport const NavigationBar = observer(function NavigationBar({\n    className,\n    style,\n    children,\n}: {\n    className: string;\n    style: CSSProperties;\n    children: ReactNode;\n}) {\n    const classes = useClasses();\n\n    if (!STATE.navigationBarVisible) {\n        return (\n            <div className={className} style={style}>\n                {children}\n            </div>\n        );\n    }\n\n    return (\n        <Stack\n            className={mergeClasses(classes.container, className)}\n            verticalFill\n            horizontalAlign=\"center\"\n            style={style}\n        >\n            {children}\n\n            <Stack\n                className={classes.bar}\n                verticalFill\n                horizontal\n                horizontalAlign=\"space-evenly\"\n                verticalAlign=\"center\"\n            >\n                <IconButton\n                    className={mergeClasses(classes.back, classes.icon)}\n                    iconProps={{ iconName: Icons.Play }}\n                    onPointerDown={handleBackPointerDown}\n                    onPointerUp={handleBackPointerUp}\n                />\n                <IconButton\n                    className={classes.icon}\n                    iconProps={{ iconName: Icons.Circle }}\n                    onPointerDown={handleHomePointerDown}\n                    onPointerUp={handleHomePointerUp}\n                />\n                <IconButton\n                    className={classes.icon}\n                    iconProps={{ iconName: Icons.Stop }}\n                    onPointerDown={handleAppSwitchPointerDown}\n                    onPointerUp={handleAppSwitchPointerUp}\n                />\n            </Stack>\n        </Stack>\n    );\n});\n","import { makeStyles } from \"@griffel/react\";\nimport {\n    AndroidKeyCode,\n    AndroidKeyEventAction,\n    AndroidKeyEventMeta,\n    AndroidMotionEventAction,\n    ScrcpyPointerId,\n} from \"@yume-chan/scrcpy\";\nimport {\n    KeyboardEvent,\n    MouseEvent,\n    PointerEvent,\n    useEffect,\n    useState,\n} from \"react\";\nimport { STATE } from \"./state\";\n\nconst useClasses = makeStyles({\n    video: {\n        transformOrigin: \"center center\",\n        touchAction: \"none\",\n    },\n});\n\nfunction handleWheel(e: WheelEvent) {\n    if (!STATE.client) {\n        return;\n    }\n\n    e.preventDefault();\n    e.stopPropagation();\n\n    const { x, y } = STATE.clientPositionToDevicePosition(e.clientX, e.clientY);\n    STATE.client!.controlMessageSerializer!.injectScroll({\n        screenWidth: STATE.client!.screenWidth!,\n        screenHeight: STATE.client!.screenHeight!,\n        pointerX: x,\n        pointerY: y,\n        scrollX: -e.deltaX / 100,\n        scrollY: -e.deltaY / 100,\n        buttons: 0,\n    });\n}\n\nfunction injectTouch(\n    action: AndroidMotionEventAction,\n    e: PointerEvent<HTMLDivElement>\n) {\n    if (!STATE.client) {\n        return;\n    }\n\n    const { pointerType } = e;\n    let pointerId: bigint;\n    if (pointerType === \"mouse\") {\n        // ScrcpyPointerId.Mouse doesn't work with Chrome browser\n        // https://github.com/Genymobile/scrcpy/issues/3635\n        pointerId = ScrcpyPointerId.Finger;\n    } else {\n        pointerId = BigInt(e.pointerId);\n    }\n\n    const { x, y } = STATE.clientPositionToDevicePosition(e.clientX, e.clientY);\n\n    const messages = STATE.hoverHelper!.process({\n        action,\n        pointerId,\n        screenWidth: STATE.client.screenWidth!,\n        screenHeight: STATE.client.screenHeight!,\n        pointerX: x,\n        pointerY: y,\n        pressure: e.pressure,\n        buttons: e.buttons,\n    });\n    for (const message of messages) {\n        STATE.client.controlMessageSerializer!.injectTouch(message);\n    }\n}\n\nfunction handlePointerDown(e: PointerEvent<HTMLDivElement>) {\n    STATE.rendererContainer!.focus();\n    e.preventDefault();\n    e.stopPropagation();\n    e.currentTarget.setPointerCapture(e.pointerId);\n    injectTouch(AndroidMotionEventAction.Down, e);\n}\n\nfunction handlePointerMove(e: PointerEvent<HTMLDivElement>) {\n    if (!STATE.client) {\n        return;\n    }\n\n    e.preventDefault();\n    e.stopPropagation();\n    injectTouch(\n        e.buttons === 0\n            ? AndroidMotionEventAction.HoverMove\n            : AndroidMotionEventAction.Move,\n        e\n    );\n}\n\nfunction handlePointerUp(e: PointerEvent<HTMLDivElement>) {\n    e.preventDefault();\n    e.stopPropagation();\n    injectTouch(AndroidMotionEventAction.Up, e);\n}\n\nfunction handlePointerLeave(e: PointerEvent<HTMLDivElement>) {\n    e.preventDefault();\n    e.stopPropagation();\n    // Prevent hover state on device from \"stuck\" at the last position\n    injectTouch(AndroidMotionEventAction.HoverExit, e);\n    injectTouch(AndroidMotionEventAction.Up, e);\n}\n\nfunction handleContextMenu(e: MouseEvent<HTMLDivElement>) {\n    e.preventDefault();\n}\n\nasync function handleKeyEvent(e: KeyboardEvent<HTMLDivElement>) {\n    if (!STATE.client) {\n        return;\n    }\n\n    const { type, key, code } = e;\n\n    const keyCode = AndroidKeyCode[code as keyof typeof AndroidKeyCode];\n    if (keyCode) {\n        // Intercept keys like \"Tab\"\n        e.preventDefault();\n        e.stopPropagation();\n\n        STATE.client!.controlMessageSerializer!.injectKeyCode({\n            action:\n                type === \"keydown\"\n                    ? AndroidKeyEventAction.Down\n                    : AndroidKeyEventAction.Up,\n            keyCode,\n            metaState:\n                (e.ctrlKey ? AndroidKeyEventMeta.CtrlOn : 0) |\n                (e.shiftKey ? AndroidKeyEventMeta.ShiftOn : 0) |\n                (e.altKey ? AndroidKeyEventMeta.AltOn : 0) |\n                (e.metaKey ? AndroidKeyEventMeta.MetaOn : 0),\n            repeat: 0,\n        });\n    }\n}\n\nexport function VideoContainer() {\n    const classes = useClasses();\n\n    const [container, setContainer] = useState<HTMLDivElement | null>(null);\n\n    useEffect(() => {\n        STATE.handleRendererContainerRef(container);\n\n        if (!container) {\n            return;\n        }\n\n        container.addEventListener(\"wheel\", handleWheel, {\n            passive: false,\n        });\n\n        return () => {\n            container.removeEventListener(\"wheel\", handleWheel);\n        };\n    }, [container]);\n\n    return (\n        <div\n            ref={setContainer}\n            tabIndex={-1}\n            className={classes.video}\n            style={{\n                width: STATE.width,\n                height: STATE.height,\n                transform: `translate(${\n                    (STATE.rotatedWidth - STATE.width) / 2\n                }px, ${(STATE.rotatedHeight - STATE.height) / 2}px) rotate(${\n                    STATE.rotation * 90\n                }deg)`,\n            }}\n            onPointerDown={handlePointerDown}\n            onPointerMove={handlePointerMove}\n            onPointerUp={handlePointerUp}\n            onPointerCancel={handlePointerUp}\n            onPointerLeave={handlePointerLeave}\n            onKeyDown={handleKeyEvent}\n            onKeyUp={handleKeyEvent}\n            onContextMenu={handleContextMenu}\n        />\n    );\n}\n","export * from \"./command-bar\";\nexport * from \"./fetch-server\";\nexport * from \"./navigation-bar\";\nexport * from \"./settings\";\nexport * from \"./state\";\nexport * from \"./video-container\";\n","import { Dialog, LayerHost, ProgressIndicator, Stack } from \"@fluentui/react\";\nimport { useId } from \"@fluentui/react-hooks\";\nimport { WebCodecsDecoder } from \"@yume-chan/scrcpy-decoder-webcodecs\";\nimport { action, runInAction } from \"mobx\";\nimport { observer } from \"mobx-react-lite\";\nimport { NextPage } from \"next\";\nimport Head from \"next/head\";\nimport { useEffect, useState } from \"react\";\nimport { DemoModePanel, DeviceView } from \"../components\";\nimport {\n    NavigationBar,\n    SETTING_DEFINITIONS,\n    SETTING_STATE,\n    STATE,\n    ScrcpyCommandBar,\n    SettingItem,\n    VideoContainer,\n} from \"../components/scrcpy\";\nimport { CommonStackTokens, RouteStackProps, formatSpeed } from \"../utils\";\n\nconst ConnectionDialog = observer(() => {\n    const layerHostId = useId(\"layerHost\");\n\n    const [isClient, setIsClient] = useState(false);\n\n    useEffect(() => {\n        setIsClient(true);\n    }, []);\n\n    if (!isClient) {\n        return null;\n    }\n\n    return (\n        <>\n            <LayerHost\n                id={layerHostId}\n                style={{\n                    position: \"absolute\",\n                    top: 0,\n                    bottom: 0,\n                    left: 0,\n                    right: 0,\n                    margin: 0,\n                    pointerEvents: \"none\",\n                }}\n            />\n\n            <Dialog\n                hidden={!STATE.connecting}\n                modalProps={{ layerProps: { hostId: layerHostId } }}\n                dialogContentProps={{ title: \"Connecting...\" }}\n            >\n                <Stack tokens={CommonStackTokens}>\n                    <ProgressIndicator\n                        label=\"1. Downloading scrcpy server...\"\n                        percentComplete={\n                            STATE.serverTotalSize\n                                ? STATE.serverDownloadedSize /\n                                  STATE.serverTotalSize\n                                : undefined\n                        }\n                        description={formatSpeed(\n                            STATE.debouncedServerDownloadedSize,\n                            STATE.serverTotalSize,\n                            STATE.serverDownloadSpeed\n                        )}\n                    />\n\n                    <ProgressIndicator\n                        label=\"2. Pushing scrcpy server to device...\"\n                        progressHidden={\n                            STATE.serverTotalSize === 0 ||\n                            STATE.serverDownloadedSize !== STATE.serverTotalSize\n                        }\n                        percentComplete={\n                            STATE.serverUploadedSize / STATE.serverTotalSize\n                        }\n                        description={formatSpeed(\n                            STATE.debouncedServerUploadedSize,\n                            STATE.serverTotalSize,\n                            STATE.serverUploadSpeed\n                        )}\n                    />\n\n                    <ProgressIndicator\n                        label=\"3. Starting scrcpy server on device...\"\n                        progressHidden={\n                            STATE.serverTotalSize === 0 ||\n                            STATE.serverUploadedSize !== STATE.serverTotalSize\n                        }\n                    />\n                </Stack>\n            </Dialog>\n        </>\n    );\n});\n\nconst Scrcpy: NextPage = () => {\n    useEffect(() => {\n        // Detect WebCodecs support at client side\n        if (\n            SETTING_STATE.decoders.length === 1 &&\n            typeof window.VideoDecoder === \"function\"\n        ) {\n            runInAction(() => {\n                SETTING_STATE.decoders.unshift({\n                    key: \"webcodecs\",\n                    name: \"WebCodecs\",\n                    Constructor: WebCodecsDecoder,\n                });\n            });\n        }\n    }, []);\n\n    return (\n        <Stack {...RouteStackProps}>\n            <Head>\n                <title>Scrcpy - Android Web Toolbox</title>\n            </Head>\n\n            <ScrcpyCommandBar />\n\n            <Stack horizontal grow styles={{ root: { height: 0 } }}>\n                <DeviceView\n                    ref={STATE.handleDeviceViewRef}\n                    width={STATE.rotatedWidth}\n                    height={STATE.rotatedHeight}\n                    BottomElement={NavigationBar}\n                >\n                    <VideoContainer />\n                </DeviceView>\n\n                <div\n                    style={{\n                        padding: 12,\n                        overflow: \"hidden auto\",\n                        display: STATE.logVisible ? \"block\" : \"none\",\n                        width: 500,\n                        fontFamily: \"monospace\",\n                        overflowY: \"auto\",\n                        whiteSpace: \"pre-wrap\",\n                        wordWrap: \"break-word\",\n                    }}\n                >\n                    {STATE.log.map((line, index) => (\n                        <div key={index}>{line}</div>\n                    ))}\n                </div>\n\n                <div\n                    style={{\n                        padding: 12,\n                        overflow: \"hidden auto\",\n                        display: SETTING_STATE.settingsVisible\n                            ? \"block\"\n                            : \"none\",\n                        width: 300,\n                    }}\n                >\n                    <div>Changes will take effect on next connection</div>\n\n                    {SETTING_DEFINITIONS.get().map((definition) => (\n                        <SettingItem\n                            key={definition.key}\n                            definition={definition}\n                            value={\n                                (SETTING_STATE[definition.group] as any)[\n                                    definition.key\n                                ]\n                            }\n                            onChange={action(\n                                (definition, value) =>\n                                    ((SETTING_STATE[definition.group] as any)[\n                                        definition.key\n                                    ] = value)\n                            )}\n                        />\n                    ))}\n                </div>\n\n                <DemoModePanel\n                    style={{\n                        display: STATE.demoModeVisible ? \"block\" : \"none\",\n                    }}\n                />\n\n                <ConnectionDialog />\n            </Stack>\n        </Stack>\n    );\n};\n\nexport default observer(Scrcpy);\n"],"names":["window","__NEXT_P","push","__webpack_require__","worker","cachedInitializePromise","cachedValue","ScrcpyControlMessageType","AndroidMotionEventAction","ScrcpyPointerId","AndroidKeyEventAction","AndroidKeyEventMeta","AndroidKeyCode","AndroidScreenPowerMode","ScrcpyDeviceMessageType","ScrcpyLogLevel","ScrcpyVideoOrientation","AndroidCodecProfile","AndroidCodecLevel","toHex","value","toString","padStart","toUpperCase","WebCodecsDecoder","maxProfile","undefined","maxLevel","_writable","writable","_renderer","renderer","_frameRendered","frameRendered","_frameSkipped","frameSkipped","context","decoder","currentFrameRendered","animationFrameId","document","createElement","getContext","VideoDecoder","output","drawImage","frame","close","error","e","esm","Vj","write","packet","type","configure","data","decode","EncodedVideoChunk","keyframe","timestamp","onFramePresented","requestAnimationFrame","config","profileIndex","constraintSet","levelIndex","width","croppedWidth","height","croppedHeight","codec","map","join","optimizeForLatency","dispose","cancelAnimationFrame","AdbScrcpyConnection","adb","options","initialize","AdbScrcpyForwardConnection","_disposed","connect","createSocket","connectAndRetry","i","async_esm","gw","connectVideoStream","readable","videoStream","sendDummyByte","reader","getReader","done","read","byteLength","releaseLock","getStreams","controlStream","control","sendDeviceMeta","AdbScrcpyReverseConnection","streams","address","reverse","remove","adb_esm","Pg","queue","GJ","writer","getWriter","add","socket","accept","catch","AdbScrcpyOptionsBase","raw","constructor","getDefaultValue","formatServerArguments","getOutputEncoderNameRegex","createVideoStreamTransformer","getControlMessageTypes","serializeBackOrScreenOnControlMessage","message","serializeSetClipboardControlMessage","getScrollController","AdbScrcpyOptions1_16","createConnection","tunnelForward","AdbScrcpyOptions1_22","clamp","min","max","Mouse","BigInt","Finger","VirtualMouse","VirtualFinger","ScrcpyFloatToUint16FieldDefinition","struct_esm","Pl","size","signed","deserialize","array","littleEndian","ek","Uint16","serialize","dataView","offset","ScrcpyInjectTouchControlMessage","ZP","uint8","InjectTouch","W$","uint64","uint32","uint16","field","ScrcpyHoverHelper","lastHoverMessage","process","result","pointerId","action","Up","HoverMove","ScrcpyInjectKeyCodeControlMessage","InjectKeyCode","ScrcpyInjectTextControlMessage","InjectText","string","lengthField","ScrcpyRotateDeviceControlMessage","RotateDevice","ScrcpySetScreenPowerModeControlMessage","SetScreenPowerMode","ScrcpyControlMessageSerializer","types","scrollController","stream","getActualMessageType","indexOf","addMessageType","injectKeyCode","injectText","text","injectTouch","injectScroll","serializeScrollMessage","InjectScroll","backOrScreenOn","buffer","BackOrScreenOn","setScreenPowerMode","mode","rotateDevice","ScrcpyAckClipboardDeviceMessage","extra","AckClipboard","ScrcpyClipboardDeviceMessage","Clipboard","ScrcpyDeviceMessageDeserializeStream","pC","CODEC_OPTION_TYPES","repeatPreviousFrameAfter","maxPtsGapToEncoder","CodecOptions","toOptionValue","entries","Object","filter","length","key","input","replace","toLowerCase","BitReader","bytePosition","bitPosition","next","decodeExponentialGolombNumber","splitH264Stream","start","zeroCount","inEmulation","byte","prevZeroCount","subarray","DEFAULT_SERVER_PATH","toScrcpyOptionValue","empty","String","ScrcpyInjectScrollControlMessage1_16","int32","ScrcpyScrollController1_16","accumulatedX","accumulatedY","processMessage","scrollX","scrollY","processed","VideoPacket","uint8Array","NO_PTS","ScrcpyBackOrScreenOnControlMessage1_16","ScrcpySetClipboardControlMessage1_15","SetClipboard","ScrcpyOptions1_16","logLevel","Verbose","Debug","lockVideoOrientation","Initial","Unlocked","getArgumentOrder","maxSize","bitRate","maxFps","crop","sendFrameMeta","displayId","showTouches","stayAwake","codecOptions","encoderName","defaults","header","transform","chunk","controller","enqueue","deserializeStream","gL","pipeThrough","frameData","pts","sequenceParameterSet","pictureParameterSet","parseH264Configuration","nalu","naluType","profile_idc","constraint_set","level_idc","pic_width_in_mbs_minus1","pic_height_in_map_units_minus1","frame_mbs_only_flag","frame_crop_left_offset","frame_crop_right_offset","frame_crop_top_offset","frame_crop_bottom_offset","parseSequenceParameterSet","nal_ref_idc","nal_unit_type","constraint_set_reader","Uint8Array","constraint_set0_flag","constraint_set1_flag","constraint_set2_flag","constraint_set3_flag","constraint_set4_flag","constraint_set5_flag","seq_parameter_set_id","chroma_format_idc","seq_scaling_matrix_present_flag","seq_scaling_list_present_flag","pic_order_cnt_type","num_ref_frames_in_pic_order_cnt_cycle","offset_for_ref_frame","frame_cropping_flag","removeH264Emulation","outputOffset","scan","set","encodedWidth","encodedHeight","cropLeft","cropRight","cropTop","cropBottom","ExpandNotificationPanel","CollapseNotificationPanel","GetClipboard","Down","ScrcpyBackOrScreenOnControlMessage1_18","fields","ScrcpyOptions1_18","concat","powerOffOnClose","splice","ExpandSettingPanel","ScrcpySetClipboardControlMessage1_21","int8","ScrcpyOptions1_21","init","clipboardAutosync","pair","ScrcpyInjectScrollControlMessage1_22","ScrcpyScrollController1_22","ScrcpyOptions1_22","rawVideoStream","downsizeOnError","KEYFRAME_PTS","ScrcpyOptions1_23","cleanup","superStream","ScrcpyOptions1_24","powerOn","ScrcpyFloatToInt16FieldDefinition","Int16","ScrcpyInjectScrollControlMessage1_25","ScrcpyScrollController1_25","ScrcpyOptions1_25","ArrayToStream","Pz","index","Promise","resolve","pull","ConcatStream","advance","ScrcpyExitedError","Error","AdbScrcpyClient","pushServer","path","sync","BF","version","connection","subprocess","spawn","protocols","vf","stdout","xU","Jb","abortController","HS","pipe","pipeTo","signal","preventCancel","race","exit","abort","kill","getEncoders","assign","client","encoderNameRegex","encoders","line","match","getDisplays","displayIdRegex","displays","Number","parseInt","_stdout","_screenWidth","screenWidth","_screenHeight","screenHeight","_videoStream","_controlMessageSerializer","controlMessageSerializer","_deviceMessageStream","deviceMessageStream","N7","CommandBarSpacerItem","container","setContainer","useState","useEffect","parent","parentElement","originalFlexGrow","style","flexGrow","jsx_runtime","jsx","div","ref","MuxerStream","InspectStream","appendFrame","firstTimestamp","sample","h264StreamToAvcSample","nalUnits","totalLength","unit","muxer","addVideoChunkRaw","configurationWritten","decoderConfig","description","avcConfiguration","running","WebMMuxer","target","video","framesFromKeyframe","stop","finalize","now","Date","saveFile","getFullYear","getMonth","getDate","getHours","getMinutes","getSeconds","h264ConfigurationToAvcDecoderConfigurationRecord","console","RECORD_STATE","makeAutoObservable","recorder","recording","intervalId","hours","minutes","seconds","reaction","setInterval","clearInterval","workerReady","pendingResolvers","streamId","PICTURE_READY_SUBSCRIPTIONS","Map","TinyH264Wrapper","event_esm","Xn","pictureReadyEvent","vp","onPictureReady","event","handler","addDisposable","handlePictureReady","delete","fire","feed","postMessage","renderStateId","all","then","t","bind","YuvBuffer","default","YuvCanvas","TinyH264Decoder","Baseline","Level4","_yuvCanvas","_initializer","wrapper","promise","slice","hP","attach","chromaWidth","chromaHeight","format","cropWidth","cropHeight","displayWidth","displayHeight","createTinyH264Wrapper","Worker","tu","URL","p","u","b","addEventListener","resolver","get","uPlaneOffset","vPlaneOffset","lumaPlane","chromaPlane","drawFrame","SERVER_URL","U","FetchWithProgress","downloaded","_downloaded","total","_total","onProgress","progressEvent","fetch","url","response","headers","body","chunks","reduce","item","position","EventEmitter","fetchServer","NOOP","STATE","rotatedWidth","rotation","rotatedHeight","serverBuffer","ReadableStream","GLOBAL_STATE","_this_client","_this_decoder","fps","clearTimeout","fpsCounterIntervalId","exitFullscreen","handleDeviceViewRef","element","deviceView","handleRendererContainerRef","rendererContainer","clientPositionToDevicePosition","clientX","clientY","viewRect","getBoundingClientRect","pointerViewX","x","pointerViewY","y","logVisible","log","demoModeVisible","navigationBarVisible","hoverHelper","configuration","connecting","serverTotalSize","serverDownloadedSize","debouncedServerDownloadedSize","serverDownloadSpeed","serverUploadedSize","debouncedServerUploadedSize","serverUploadSpeed","SETTING_STATE","runInAction","param","ChunkStream","ADB_SYNC_MAX_PACKET_SIZE","ProgressStream","progress","decoderDefinition","Constructor","lastFrameRendered","lastFrameSkipped","deltaRendered","deltaSkipped","profile","level","SCRCPY_SERVER_VERSION","WritableStream","lastKeyframe","navigator","clipboard","writeText","content","autorun","firstChild","appendChild","useClasses","makeStyles","labelRight","marginLeft","SettingItem","observer","definition","onChange","classes","label","jsxs","Stack","horizontal","verticalAlign","span","TooltipHost","Icon","className","iconName","Icons","labelExtra","TextField","placeholder","Dropdown","selectedKey","option","Toggle","checked","disabled","SpinButton","labelPosition","Position","step","settingsVisible","decoders","name","settings","clientSettings","observable","SETTING_DEFINITIONS","computed","group","IconButton","iconProps","onClick","includes","ITEMS","color","iconOnly","enterFullscreen","keyCode","repeat","metaState","onRender","itemType","ContextualMenuItemType","canCheck","tooltipHostProps","Fragment","ExternalLink","href","spaceAfter","calloutProps","calloutMaxWidth","ScrcpyCommandBar","CommandBar","items","backgroundColor","bar","maxWidth","icon","back","handlePointerDown","button","currentTarget","setPointerCapture","handlePointerUp","handleBackPointerDown","handleBackPointerUp","handleHomePointerDown","handleHomePointerUp","handleAppSwitchPointerDown","handleAppSwitchPointerUp","NavigationBar","children","mergeClasses","verticalFill","horizontalAlign","onPointerDown","onPointerUp","transformOrigin","touchAction","handleWheel","preventDefault","stopPropagation","pointerX","pointerY","deltaX","deltaY","buttons","pointerType","messages","pressure","handlePointerMove","handlePointerLeave","handleContextMenu","handleKeyEvent","code","ctrlKey","shiftKey","altKey","metaKey","VideoContainer","passive","removeEventListener","tabIndex","onPointerMove","onPointerCancel","onPointerLeave","onKeyDown","onKeyUp","onContextMenu","ConnectionDialog","layerHostId","useId","isClient","setIsClient","LayerHost","id","top","bottom","left","right","margin","pointerEvents","Dialog","hidden","modalProps","layerProps","hostId","dialogContentProps","title","tokens","CommonStackTokens","ProgressIndicator","percentComplete","formatSpeed","progressHidden","Scrcpy","RouteStackProps","Head","grow","styles","root","DeviceView","BottomElement","padding","overflow","display","fontFamily","overflowY","whiteSpace","wordWrap","DemoModePanel","scrcpy"],"sourceRoot":""}