!function(e){function t(t){for(var a,s,o=t[0],c=t[1],l=t[2],u=0,h=[];u<o.length;u++)s=o[u],Object.prototype.hasOwnProperty.call(r,s)&&r[s]&&h.push(r[s][0]),r[s]=0;for(a in c)Object.prototype.hasOwnProperty.call(c,a)&&(e[a]=c[a]);for(d&&d(t);h.length;)h.shift()();return i.push.apply(i,l||[]),n()}function n(){for(var e,t=0;t<i.length;t++){for(var n=i[t],a=!0,o=1;o<n.length;o++){var c=n[o];0!==r[c]&&(a=!1)}a&&(i.splice(t--,1),e=s(s.s=n[0]))}return e}var a={},r={0:0},i=[];function s(t){if(a[t])return a[t].exports;var n=a[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,s),n.l=!0,n.exports}s.m=e,s.c=a,s.d=function(e,t,n){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},s.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(s.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)s.d(n,a,function(t){return e[t]}.bind(null,a));return n},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="";var o=window.webpackJsonp=window.webpackJsonp||[],c=o.push.bind(o);o.push=t,o=o.slice();for(var l=0;l<o.length;l++)t(o[l]);var d=c;i.push(["2YZa",1]),n()}({"2YZa":function(e,t,n){"use strict";n.r(t);var a=n("D2wA"),r=n("bBLm"),i=n("hR4L"),s=n("78K9"),o=n("LDcz"),c=n("gTkT"),l=n("q1tI"),d=n.n(l),u=n("i8i4"),h=n.n(u),f=n("Ty5D"),m=n("55Ip"),p=n("uNUV"),b=n("uqg9"),w=n("wcX2"),g=n("sByA"),y=n("Ypxj"),v=n("ypaI"),E=n("+glh"),k=n.n(E);class O{constructor(){this.listeners=[],this.event=this.event.bind(this)}event(e,t,...n){const a={listener:e,thisArg:t,args:n};this.listeners.push(a);const r=()=>{const e=this.listeners.indexOf(a);e>0&&this.listeners.splice(e,1)};return r.dispose=r,r}fire(e){for(const t of this.listeners.slice())t.listener.apply(t.thisArg,[e,...t.args])}dispose(){this.listeners.length=0}}class S extends O{async fire(e){for(const t of this.listeners)await t.listener.apply(t.thisArg,[e,...t.args])}}class j{constructor(){this.disposables=[]}addDisposable(e){return this.disposables.push(e),e}dispose(){for(const e of this.disposables)e.dispose();this.disposables=[]}}class C extends j{add(e){return this.addDisposable(e)}}const D=BigInt(0),x=BigInt(1),A=BigInt(2),L=A**BigInt(64);function z(e,t=0,n=e.byteLength-t){const a=new DataView(e);let r=D;for(let e=t;e<t+n;e+=8){r*=L;r+=a.getBigUint64(e,!1)}return r}function P(e,t,n=0){const a=new DataView(e);for(;t>D;)a.setBigUint64(n,t,!0),n+=8,t/=L}function I(e){return[z(e,38,256),z(e,303,256)]}function _(e,t,n=0){const[a]=I(e);let r;if(t){if(t.byteLength-n<524)throw new Error("output buffer is too small");r="number"}else t=new ArrayBuffer(524),r="ArrayBuffer";const i=new DataView(t);i.setUint32(n,64,!0),n+=4;const s=function(e,t){if([e,t]=[Number(e),Number(t)],Number.isNaN(e)||Number.isNaN(t))return NaN;if(!(e=(e%t+t)%t)||t<2)return NaN;const n=[];let a=t;for(;a;)[e,a]=[a,e%a],n.push({a:e,b:a});if(1!==e)return NaN;let r=1,i=0;for(let e=n.length-2;e>=0;--e)[r,i]=[i,r-i*Math.floor(n[e].a/n[e].b)];return(i%t+t)%t}(Number(BigInt.asUintN(32,a)*BigInt(-1)),2**32);return i.setUint32(n,s,!0),P(t,a,n+=4),n+=256,P(t,BigInt(2)**BigInt(4096)%a,n),n+=256,i.setUint32(n,65537,!0),n+=4,"ArrayBuffer"===r?t:524}const T=[48,33,48,9,6,5,43,14,3,2,26,5,0,4,20];function U(e,t){const[n,a]=I(e),r=new Uint8Array(256);let i=0;r[i]=0,i+=1,r[i]=1,i+=1;const s=r.length-T.length-t.byteLength-1;for(;i<s;)r[i]=255,i++;r[i]=0,i+=1,r.set(new Uint8Array(T),i),i+=T.length,r.set(new Uint8Array(t),i);let o=function(e,t,n){if(n===x)return D;let a=x;for(e%=n;t>D;)BigInt.asUintN(1,t)===x&&(a=a*e%n),t>>=x,e=e**A%n;return a}(z(r.buffer),a,n);const c=new ArrayBuffer(256);return function(e,t,n=0){const a=[];for(;t>D;)a.push(BigInt.asUintN(64,t)),t/=L;const r=new DataView(e);for(let e=a.length-1;e>=0;e-=1)r.setBigUint64(n,a[e],!1),n+=8}(c,o),c}const N=Symbol("BackingField");function F(e,t){return e[N][t]}function M(e,t,n){e[N][t]=n}var B;(B||(B={})).initialize=function(e,t,n){switch(t.subType){case 0:Object.defineProperty(e,t.name,{configurable:!0,enumerable:!0,get:()=>F(e,t.name).buffer,set(n){M(e,t.name,{buffer:n})}});break;case 1:Object.defineProperty(e,t.name,{configurable:!0,enumerable:!0,get:()=>F(e,t.name).string,set(n){M(e,t.name,{string:n})}});break;default:throw new Error("Unknown type")}M(e,t.name,n)};const R={};function W(e){return R[e]}function K(e,t,n){R[n.type]=n}var V,H;K(0,0,{type:1,async deserialize({context:e,field:t}){const n=await e.read(t.options.length);switch(t.subType){case 0:return{value:n};case 1:return{value:e.decodeUtf8(n),extra:n};default:throw new Error("Unknown type")}},getSize:({field:e})=>e.options.length,initialize({extra:e,field:t,object:n,value:a}){const r={};"string"==typeof a?(r.string=a,e&&(r.buffer=e)):r.buffer=a,B.initialize(n,t,r)},serialize({context:e,dataView:t,field:n,object:a,offset:r}){var i;const s=F(a,n.name);null!==(i=s.buffer)&&void 0!==i||(s.buffer=e.encodeUtf8(s.string)),new Uint8Array(t.buffer).set(new Uint8Array(s.buffer),r)}}),function(e){e.SizeMap={0:4,1:4,2:8},e.DataViewGetterMap={0:"getInt32",1:"getUint32",2:"getBigUint64"},e.DataViewSetterMap={0:"setInt32",1:"setUint32",2:"setBigUint64"}}(V||(V={})),K(0,0,{type:0,getSize:({field:e})=>V.SizeMap[e.subType],async deserialize({context:e,field:t,options:n}){const a=await e.read(V.SizeMap[t.subType]);return{value:new DataView(a)[V.DataViewGetterMap[t.subType]](0,n.littleEndian)}},serialize({dataView:e,field:t,object:n,offset:a,options:r}){e[V.DataViewSetterMap[t.subType]](a,n[t.name],r.littleEndian)}}),function(e){function t(e,t){return F(e,t.options.lengthField)}function n(e,t,n){M(e,t.options.lengthField,n)}e.getLengthBackingField=t,e.setLengthBackingField=n,e.initialize=function(e,a,r,i){B.initialize(e,a,r);const s=Object.getOwnPropertyDescriptor(e,a.name);switch(delete e[a.name],a.subType){case 0:Object.defineProperty(e,a.name,{...s,set(t){var r;s.set.call(e,t),n(e,a,null!==(r=null==t?void 0:t.byteLength)&&void 0!==r?r:0)}}),delete e[a.options.lengthField],Object.defineProperty(e,a.options.lengthField,{configurable:!0,enumerable:!0,get:()=>t(e,a)});break;case 1:Object.defineProperty(e,a.name,{...s,set(t){s.set.call(e,t),n(e,a,t?void 0:0)}}),delete e[a.options.lengthField],Object.defineProperty(e,a.options.lengthField,{configurable:!0,enumerable:!0,get(){let r=t(e,a);if(void 0===r){const t=F(e,a.name),s=i.encodeUtf8(t.string);t.buffer=s,r=s.byteLength,n(e,a,r)}return r}});break;default:throw new Error("Unknown type")}M(e,a.name,r),r.buffer&&n(e,a,r.buffer.byteLength)}}(H||(H={})),K(0,0,{type:2,async deserialize({context:e,field:t,object:n}){let a=n[t.options.lengthField];if("string"==typeof a&&(a=Number.parseInt(a,10)),0===a){if(1!==t.options.emptyBehavior)return{value:void 0};switch(t.subType){case 0:return{value:new ArrayBuffer(0)};case 1:return{value:"",extra:new ArrayBuffer(0)};default:throw new Error("Unknown type")}}const r=await e.read(a);switch(t.subType){case 0:return{value:r};case 1:return{value:e.decodeUtf8(r),extra:r};default:throw new Error("Unknown type")}},getSize:()=>0,getDynamicSize:({field:e,object:t})=>t[e.options.lengthField],initialize({context:e,extra:t,field:n,object:a,value:r}){const i={};"string"==typeof r?(i.string=r,t&&(i.buffer=t)):i.buffer=r,B.initialize(a,n,i),H.initialize(a,n,i,e)},serialize({dataView:e,field:t,object:n,offset:a}){const r=F(n,t.name);new Uint8Array(e.buffer).set(new Uint8Array(r.buffer),a)}});const G={littleEndian:!1};class ${constructor(e=G){this._size=0,this.fields=[],this._extra={},this.array=(e,t,n)=>"length"in n?this.field({type:1,name:e,subType:t,options:n}):this.field({type:2,name:e,subType:t,options:n}),this.arrayBuffer=(e,t)=>this.array(e,0,t),this.string=(e,t)=>this.array(e,1,t),this.options={...G,...e}}get size(){return this._size}clone(){const e=new $(this.options);return e.fields=this.fields.slice(),e._size=this._size,e._extra=this._extra,e._afterParsed=this._afterParsed,e}field(e){const t=this.clone();t.fields.push(e);const n=W(e.type).getSize({field:e,options:this.options});return t._size+=n,t}number(e,t,n={},a){return this.field({type:0,name:e,subType:t,options:n})}int32(e,t={},n){return this.number(e,0,t,n)}uint32(e,t={},n){return this.number(e,1,t,n)}uint64(e,t={},n){return this.number(e,2,t,n)}extra(e){const t=this.clone();return t._extra={...t._extra,...Object.getOwnPropertyDescriptors(e)},t}afterParsed(e){const t=this.clone();return t._afterParsed=e,t}initializeField(e,t,n,a,r,i){n.initialize?n.initialize({context:e,extra:i,field:t,object:a,options:this.options,value:r}):(M(a,t.name,r),function(e,t){Object.defineProperty(e,t,{configurable:!0,enumerable:!0,get:()=>F(e,t),set(n){M(e,t,n)}})}(a,t.name))}create(e,t){const n={[N]:{}};Object.defineProperties(n,this._extra);for(const a of this.fields){const r=W(a.type);this.initializeField(t,a,r,n,e[a.name])}return n}async deserialize(e){const t={[N]:{}};Object.defineProperties(t,this._extra);for(const n of this.fields){const a=W(n.type),{value:r,extra:i}=await a.deserialize({context:e,field:n,object:t,options:this.options});this.initializeField(e,n,a,t,r,i)}if(this._afterParsed){const e=this._afterParsed.call(t,t);if(e)return e}return t}serialize(e,t){const n=this.create(e,t);let a=this._size,r=[];for(let e=0;e<this.fields.length;e++){const i=this.fields[e],s=W(i.type);s.getDynamicSize?(r[e]=s.getDynamicSize({context:t,field:i,object:n,options:this.options}),a+=r[e]):r[e]=s.getSize({field:i,options:this.options})}const i=new ArrayBuffer(a),s=new DataView(i);let o=0;for(let e=0;e<this.fields.length;e++){const a=this.fields[e];W(a.type).serialize({context:t,dataView:s,field:a,object:n,offset:o,options:this.options}),o+=r[e]}return i}}class q{constructor(e=!1){this.list=[],this.blocking=e}wait(){if(!this.blocking&&(this.blocking=!0,0===this.list.length))return Promise.resolve();const e=new E.PromiseResolver;return this.list.push(e),e.promise}notify(){0!==this.list.length?this.list.pop().resolve():this.blocking=!1}dispose(){for(const e of this.list)e.reject(new Error("The AutoResetEvent has been disposed"));this.list.length=0}}let Q=[];const Y=[],X="=".charCodeAt(0);let Z=0;function J(e,t){const n=e.charCodeAt(0),a=t.charCodeAt(0),r=a-n+1;for(let e=n;e<=a;e++)Y.push(e);Q.push({start:n,length:r,end:a,offset:n-Z}),Z+=r}function ee(e){const t=e.charCodeAt(0);let n=0,a=Q.length-1,r=a>>1;for(;;){const e=Q[r];if(t<e.start)a=r-1;else{if(!(t>e.end))return t-e.offset;n=r+1}r=n+a>>1}}function te(e,t,n,a,r){var i;if(e instanceof ArrayBuffer&&(e=new Uint8Array(e)),e instanceof ArrayBuffer)return e;let s,o,c,l,d;"number"!=typeof t?(s=0,o=e.byteLength,d=1):(s=t,"number"!=typeof n?(o=e.byteLength-s,d=2):(o=n,d=3));const u=o%3,h=(o+3-u)/3*4;let f,m=arguments[d];if(m){if(l=null!==(i=arguments[d+1])&&void 0!==i?i:0,m.byteLength-l<h)throw new Error("output buffer is too small");c=m instanceof ArrayBuffer?new Uint8Array(m):m,f="number"}else{const e=new ArrayBuffer(h);c=new Uint8Array(e),l=0,f="ArrayBuffer"}if(c instanceof ArrayBuffer)return c;if(e.buffer===c.buffer){const t=e.byteOffset+s,n=c.byteOffset+l;if(n<t-1){if(n+h>=t)throw new Error("input and output buffer can not be overlapping")}}let p=s+o-1,b=l+h-1;if(1===u){const t=e[p];p-=1,c[b]=X,b-=1,c[b]=X,b-=1,c[b]=Y[(3&t)<<4],b-=1,c[b]=Y[t>>2],b-=1}else if(2===u){const t=e[p];p-=1;const n=e[p];p-=1,c[b]=X,b-=1,c[b]=Y[(15&t)<<2],b-=1,c[b]=Y[(3&n)<<4|t>>4],b-=1,c[b]=Y[n>>2],b-=1}for(;p>=s;){const t=e[p];p-=1;const n=e[p];p-=1;const a=e[p];p-=1,c[b]=Y[63&t],b-=1,c[b]=Y[(15&n)<<2|t>>6],b-=1,c[b]=Y[(3&a)<<4|n>>4],b-=1,c[b]=Y[a>>2],b-=1}return"ArrayBuffer"===f?c.buffer:h}J("A","Z"),J("a","z"),J("0","9"),J("+","+"),J("/","/"),Q=Q.sort((e,t)=>e.end-t.end);const ne={done:!0,value:void 0};Object.freeze(ne);class ae{constructor(){this.pullQueue=[],this.pushQueue=[],this.ended=!1,this.waterMark=0,this.pendingLowWaterEvent=!1,this.lowWaterEvent=new O}get onLowWater(){return this.lowWaterEvent.event}}class re{constructor(e){this.highWaterMark=10,this.lowWaterMark=0,this.state=e}get waterMark(){return this.state.waterMark}get onLowWater(){return this.state.lowWaterEvent.event}push(e,t=1){return this.state.pullQueue.length?(this.state.pullQueue.shift().resolve({done:!1,value:e}),!0):(this.state.pushQueue.push([e,t]),this.state.waterMark+=t,this.state.waterMark<this.highWaterMark||(this.state.pendingLowWaterEvent=!0,!1))}end(){var e,t;let n;for(this.state.ended=!0;n=this.state.pullQueue.shift();)n.resolve(ne);null===(t=(e=this.state).cleanup)||void 0===t||t.call(e)}}const ie={maxConsumerCount:1/0,autoCleanup:!0,autoStart:!0};class se{constructor(e,t){this.consumerCount=0,this.started=!1,this.next=()=>{const{state:e,controller:t}=this;if(e.pushQueue.length){const[n,a]=e.pushQueue.shift();return e.waterMark-=a,e.pendingLowWaterEvent&&e.waterMark<=t.lowWaterMark&&e.lowWaterEvent.fire(),Promise.resolve({done:!1,value:n})}if(e.ended)return Promise.resolve(ne);const n=new E.PromiseResolver;return e.pullQueue.push(n),n.promise},this.initializer=e,this.options={...ie,...t},this.state=new ae,this.controller=new re(this.state),this.options.autoStart&&(this.state.cleanup=this.initializer(this.controller))}[Symbol.asyncIterator](){if(this.consumerCount===this.options.maxConsumerCount)throw new Error("Max consumer count exceeded");return this.consumerCount+=1,this.options.autoStart||this.started||(this.state.cleanup=this.initializer(this.controller),this.started=!0),{next:this.next,return:()=>(this.consumerCount-=1,0===this.consumerCount&&this.options.autoCleanup&&this.controller.end(),Promise.resolve(ne))}}}class oe{constructor(e){this.readLock=new q,this.stream=e,this.iterable=new se(e=>{e.highWaterMark=16384;const t=new C,n=new q(!0);return t.add(this.stream.onData(t=>{if(!e.push(t,t.byteLength))return n.wait()})),t.add(this.stream.onClose(()=>{e.end()})),t.add(e.onLowWater(()=>{n.notify()})),()=>{t.dispose()}},{maxConsumerCount:1,autoCleanup:!1})}get backend(){return this.stream.backend}get localId(){return this.stream.localId}get remoteId(){return this.stream.remoteId}async read(){await this.readLock.wait();try{for await(const e of this.iterable)return e;throw new Error("The stream has been closed")}finally{this.readLock.notify()}}async readAll(){await this.readLock.wait();try{let e="";for await(const t of this.iterable)e+=this.stream.backend.decodeUtf8(t);return e}finally{this.readLock.notify()}}write(e){return this.stream.write(e)}close(){this.stream.close()}}class ce{constructor(e){this.stream=e}async read(e){let t,n;if(this.buffer){const a=this.buffer;if(a.byteLength>e)return this.buffer=a.subarray(e),a.slice(0,e).buffer;t=new Uint8Array(e),t.set(a),n=a.byteLength,this.buffer=void 0}else t=new Uint8Array(e),n=0;for(;n<e;){const a=await this.stream.read(e-n);if(a.byteLength>e-n)return t.set(new Uint8Array(a,0,e),n),this.buffer=new Uint8Array(a,e),t.buffer;t.set(new Uint8Array(a),n),n+=a.byteLength}return t.buffer}close(){var e,t;null===(t=(e=this.stream).close)||void 0===t||t.call(e)}}class le extends ce{get backend(){return this.stream.backend}get localId(){return this.stream.localId}get remoteId(){return this.stream.remoteId}constructor(e){super(new oe(e))}write(e){return this.stream.write(e)}decodeUtf8(e){return this.backend.decodeUtf8(e)}encodeUtf8(e){return this.backend.encodeUtf8(e)}}class de extends j{constructor(e,t,n){super(),this.writeLock=this.addDisposable(new q),this.dataEvent=this.addDisposable(new S),this.closeEvent=this.addDisposable(new O),this.localId=e,this.remoteId=t,this.dispatcher=n}get backend(){return this.dispatcher.backend}get onClose(){return this.closeEvent.event}async write(e){await this.writeLock.wait(),await this.dispatcher.sendPacket(fe.Write,this.localId,this.remoteId,e)}ack(){this.writeLock.notify()}close(){return this.dispatcher.sendPacket(fe.Close,this.localId,this.remoteId)}dispose(){this.closeEvent.fire(),super.dispose()}}class ue{constructor(e){this.controller=e}get backend(){return this.controller.backend}get localId(){return this.controller.localId}get remoteId(){return this.controller.remoteId}get onData(){return this.controller.dataEvent.event}get onClose(){return this.controller.onClose}write(e){return this.controller.write(e)}close(){return this.controller.close()}}class he extends j{constructor(e){super(),this.initializers=new k.a(1),this.streams=new Map,this.packetEvent=this.addDisposable(new O),this.streamEvent=this.addDisposable(new O),this.errorEvent=this.addDisposable(new O),this._running=!1,this.backend=e}get onPacket(){return this.packetEvent.event}get onStream(){return this.streamEvent.event}get onError(){return this.errorEvent.event}get running(){return this._running}async receiveLoop(){try{for(;this._running;){const e=await be.read(this.backend);switch(e.command){case fe.OK:this.handleOk(e);continue;case fe.Close:if(0===e.arg0){this.initializers.reject(e.arg1,new Error("open failed"));continue}if(this.streams.has(e.arg1)){this.streams.get(e.arg1).dispose(),this.streams.delete(e.arg1);continue}continue;case fe.Write:this.streams.has(e.arg1)&&(await this.streams.get(e.arg1).dataEvent.fire(e.payload),await this.sendPacket(fe.OK,e.arg1,e.arg0));continue;case fe.Open:await this.handleOpen(e);continue}const t={handled:!1,packet:e};if(this.packetEvent.fire(t),!t.handled)return void this.dispose()}}catch(e){if(!this._running)return;this.errorEvent.fire(e)}}handleOk(e){this.initializers.resolve(e.arg1,e.arg0)||(this.streams.has(e.arg1)?this.streams.get(e.arg1).ack():this.sendPacket(fe.Close,e.arg1,e.arg0))}async handleOpen(e){const[t]=this.initializers.add();this.initializers.resolve(t,void 0);const n=e.arg0,a=new de(t,n,this),r={handled:!1,packet:e,stream:new ue(a)};this.streamEvent.fire(r),r.handled?(this.streams.set(t,a),await this.sendPacket(fe.OK,t,n)):await this.sendPacket(fe.Close,0,n)}start(){this._running=!0,this.receiveLoop()}async createStream(e){const[t,n]=this.initializers.add();await this.sendPacket(fe.Open,t,0,e);const a=await n,r=new de(t,a,this);return this.streams.set(r.localId,r),new ue(r)}sendPacket(e,t,n,a){let r;return 1===arguments.length?r=e:("string"==typeof a&&(a=this.backend.encodeUtf8(a)),r=be.create({command:e,arg0:t,arg1:n,payload:a},this.backend)),be.write(r,this.backend)}dispose(){this._running=!1;for(const e of this.streams.values())e.dispose();this.streams.clear(),super.dispose()}}var fe;!function(e){e[e.Auth=1213486401]="Auth",e[e.Close=1163086915]="Close",e[e.Connect=1314410051]="Connect",e[e.OK=1497451343]="OK",e[e.Open=1313165391]="Open",e[e.Write=1163154007]="Write"}(fe||(fe={}));const me=new $({littleEndian:!0}).uint32("command",void 0).uint32("arg0").uint32("arg1").uint32("payloadLength").uint32("checksum").int32("magic"),pe=me.arrayBuffer("payload",{lengthField:"payloadLength"}).afterParsed(e=>{if(e[N].magic!==e.magic)throw new Error("Invalid command")});var be,we,ge;(we=be||(be={})).create=function(e,t){return pe.create({...e,checksum:0,magic:4294967295^e.command},t)},we.read=async function(e){let t=await e.read(24);24!==t.byteLength&&(t=await e.read(24));let n=!1;const a=new ce({read:a=>n?e.read(a):(n=!0,t)});return pe.deserialize({read:a.read.bind(a),decodeUtf8:e.decodeUtf8.bind(e),encodeUtf8:e.encodeUtf8.bind(e)})},we.write=async function(e,t){await t.write(me.serialize(e,t)),e.payload&&await t.write(e.payload)},function(e){e[e.Token=1]="Token",e[e.Signature=2]="Signature",e[e.PublicKey=3]="PublicKey"}(ge||(ge={}));const ye=[class{constructor(e){this.iteratorDone=!1,this.backend=e,this.iterator=e.iterateKeys()}async tryAuth(e){if(e.arg0!==ge.Token)return;const t=await this.iterator.next();if(t.done)return void(this.iteratorDone=!0);const n=U(t.value,e.payload);return be.create({command:fe.Auth,arg0:ge.Signature,arg1:0,payload:n},this.backend)}dispose(){var e,t;this.iteratorDone||null===(t=(e=this.iterator).return)||void 0===t||t.call(e)}},class{constructor(e){this.backend=e}async tryAuth(){var e;let t;const n=this.backend.iterateKeys(),a=await n.next();a.done?t=await this.backend.generateKey():(t=a.value,await(null===(e=n.return)||void 0===e?void 0:e.call(n)));const r=((i=524)+3-i%3)/3*4;var i;const s=new ArrayBuffer(r+1);return _(t,s),te(s,0,524,s),be.create({command:fe.Auth,arg0:ge.PublicKey,arg1:0,payload:s},this.backend)}dispose(){}}];class ve extends j{constructor(e,t){super(),this.index=0,this.authenticators=e.map(e=>this.addDisposable(new e(t)))}async tryNextAuth(e){for(;this.index<this.authenticators.length;){const t=await this.authenticators[this.index].tryAuth(e);if(t)return t;this.index+=1}throw new Error("Cannot authenticate with device")}}class Ee extends j{constructor(e){super(),this.adb=e}}class ke extends Ee{async getProp(e){return(await this.adb.shell("getprop",e)).trim()}async getAddresses(){const e=await this.getProp("service.adb.listen_addrs");if(e)return e.split(",");let t=await this.getProp("service.adb.tcp.port");return t?["0.0.0.0:"+t]:(t=await this.getProp("persist.adb.tcp.port"),t?["0.0.0.0:"+t]:[])}async setPort(e){if(e<=0)throw new Error("Invalid port "+e);if(await this.adb.createStreamAndReadAll("tcpip:"+e)!==`restarting in TCP mode port: ${e}\n`)throw new Error("Invalid response")}async disable(){if("restarting in USB mode\n"!==await this.adb.createStreamAndReadAll("usb:"))throw new Error("Invalid response")}}const Oe=new $({littleEndian:!0}).string("length",{length:4}).string("content",{lengthField:"length"}),Se=Oe.afterParsed(e=>{throw new Error(e.content)});class je extends j{constructor(e){super(),this.portToHandlerMap=new Map,this.devicePortToPortMap=new Map,this.listening=!1,this.dispatcher=e}async list(){const e=await this.dispatcher.createStream("reverse:list-forward"),t=new le(e);return(await Oe.deserialize(t)).content.split("\n").map(e=>{const[t,n,a]=e.split(" ");return{deviceSerial:t,localName:n,remoteName:a}})}async add(e,t,n=0){this.listening||this.addDisposable(this.dispatcher.onStream(e=>{if(e.handled)return;const t=this.dispatcher.backend.decodeUtf8(e.packet.payload),n=Number.parseInt(t.substring(4));this.portToHandlerMap.has(n)&&(this.portToHandlerMap.get(n).onStream(e.packet,e.stream),e.handled=!0)}));const a=await this.dispatcher.createStream(`reverse:forward:tcp:${n};tcp:${e}`),r=new le(a);if("OKAY"===this.dispatcher.backend.decodeUtf8(await r.read(4))){const a=await Oe.deserialize(r);return n=Number.parseInt(a.content,10),this.portToHandlerMap.set(e,t),this.devicePortToPortMap.set(n,e),n}return await Se.deserialize(r)}async remove(e){const t=await this.dispatcher.createStream("reverse:killforward:tcp:"+e),n=new le(t);"OKAY"===this.dispatcher.backend.decodeUtf8(await n.read(4))?this.devicePortToPortMap.has(e)&&(this.portToHandlerMap.delete(this.devicePortToPortMap.get(e)),this.devicePortToPortMap.delete(e)):await Se.deserialize(n)}async removeAll(){const e=await this.dispatcher.createStream("reverse:killforward-all"),t=new le(e);"OKAY"===this.dispatcher.backend.decodeUtf8(await t.read(4))?(this.devicePortToPortMap.clear(),this.portToHandlerMap.clear()):await Se.deserialize(t)}}var Ce;!function(e){e.StatV2="stat_v2"}(Ce||(Ce={}));const De=new $({littleEndian:!0}).uint32("version",void 0,2).uint32("bpp").uint32("colorSpace").uint32("size").uint32("width").uint32("height").uint32("red_offset").uint32("red_length").uint32("blue_offset").uint32("blue_length").uint32("green_offset").uint32("green_length").uint32("alpha_offset").uint32("alpha_length").arrayBuffer("data",{lengthField:"size"});var xe,Ae;!function(e){e.List="LIST",e.Send="SEND",e.Lstat="STAT",e.Stat="STA2",e.Lstat2="LST2",e.Data="DATA",e.Done="DONE",e.Receive="RECV"}(xe||(xe={})),function(e){e.Entry="DENT",e.Lstat="STAT",e.Stat="STA2",e.Lstat2="LST2",e.Done="DONE",e.Data="DATA",e.Ok="OKAY",e.Fail="FAIL"}(Ae||(Ae={}));const Le=new $({littleEndian:!0}).string("id",{length:4}).uint32("valueLength").string("value",{lengthField:"valueLength"});var ze;!function(e){e[e.Directory=4]="Directory",e[e.File=8]="File",e[e.Link=10]="Link"}(ze||(ze={}));const Pe=new $({littleEndian:!0}).int32("mode").int32("size").int32("mtime").extra({id:Ae.Lstat,get type(){return this.mode>>12},get permission(){return 4095&this.mode}}).afterParsed(e=>{if(0===e.mode&&0===e.size&&0===e.mtime)throw new Error("lstat failed")});var Ie;!function(e){e[e.EACCES=13]="EACCES",e[e.EEXIST=17]="EEXIST",e[e.EFAULT=14]="EFAULT",e[e.EFBIG=27]="EFBIG",e[e.EINTR=4]="EINTR",e[e.EINVAL=22]="EINVAL",e[e.EIO=5]="EIO",e[e.EISDIR=21]="EISDIR",e[e.ELOOP=40]="ELOOP",e[e.EMFILE=24]="EMFILE",e[e.ENAMETOOLONG=36]="ENAMETOOLONG",e[e.ENFILE=23]="ENFILE",e[e.ENOENT=2]="ENOENT",e[e.ENOMEM=12]="ENOMEM",e[e.ENOSPC=28]="ENOSPC",e[e.ENOTDIR=20]="ENOTDIR",e[e.EOVERFLOW=75]="EOVERFLOW",e[e.EPERM=1]="EPERM",e[e.EROFS=30]="EROFS",e[e.ETXTBSY=26]="ETXTBSY"}(Ie||(Ie={}));const _e=new $({littleEndian:!0}).uint32("error",void 0,void 0).uint64("dev").uint64("ino").uint32("mode").uint32("nlink").uint32("uid").uint32("gid").uint64("size").uint64("atime").uint64("mtime").uint64("ctime").extra({id:Ae.Stat,get type(){return this.mode>>12},get permission(){return 4095&this.mode}}).afterParsed(e=>{if(e.error)throw new Error(Ie[e.error])}),Te=Pe.afterParsed().uint32("nameLength").string("name",{lengthField:"nameLength"}).extra({id:Ae.Entry}),Ue=new $({littleEndian:!0}).uint32("dataLength").arrayBuffer("data",{lengthField:"dataLength"}).extra({id:Ae.Data});class Ne{constructor(){this.id=Ae.Done}static async deserialize(e){return await e.read(e.size),Ne.instance}}Ne.instance=new Ne;const Fe=new $({littleEndian:!0}).uint32("messageLength").string("message",{lengthField:"messageLength"}).afterParsed(e=>{throw new Error(e.message)}),Me={[Ae.Entry]:Te,[Ae.Lstat]:Pe,[Ae.Stat]:_e,[Ae.Lstat2]:_e,[Ae.Data]:Ue,[Ae.Fail]:Fe,[Ae.Done]:Ne};async function Be(e,t){const n=e.backend.decodeUtf8(await e.read(4));if(Me[n])return Me[n].deserialize({size:t,read:e.read.bind(e),decodeUtf8:e.backend.decodeUtf8.bind(e.backend),encodeUtf8:e.backend.encodeUtf8.bind(e.backend)});throw await e.read(t),new Error("Unexpected response id")}class Re extends j{constructor(e,t){super(),this.sendLock=this.addDisposable(new q),this.stream=new le(e),this.adb=t}get supportStat(){return this.adb.features.includes(Ce.StatV2)}async lstat(e){await this.sendLock.wait();try{let t,n,a;this.supportStat?(t=xe.Lstat2,n=_e,a=Ae.Stat):(t=xe.Lstat,n=Pe,a=Ae.Lstat),await this.write(Le,{id:t,value:e});const r=await Be(this.stream,n.size);if(r.id!==a)throw new Error("Unexpected response id");return r}finally{this.sendLock.notify()}}async stat(e){if(!this.supportStat)throw new Error("Not supported");await this.sendLock.wait();try{await this.write(Le,{id:xe.Stat,value:e});const t=await Be(this.stream,_e.size);if(t.id!==Ae.Stat)throw new Error("Unexpected response id");return t}finally{this.sendLock.notify()}}async*opendir(e){await this.sendLock.wait();try{for(await this.write(Le,{id:xe.List,value:e});;){const e=await Be(this.stream,Te.size);switch(e.id){case Ae.Entry:yield e;break;case Ae.Done:return;default:throw new Error("Unexpected response id")}}}finally{this.sendLock.notify()}}async readdir(e){const t=[];for await(const n of this.opendir(e))t.push(n);return t}async*receive(e){await this.sendLock.wait();try{for(await this.write(Le,{id:xe.Receive,value:e});;){const e=await Be(this.stream,Ue.size);switch(e.id){case Ae.Data:yield e.data;break;case Ae.Done:return;default:throw new Error("Unexpected response id")}}}finally{this.sendLock.notify()}}dispose(){super.dispose(),this.stream.close()}write(e,t){return this.stream.write(e.serialize(t,this.stream.backend))}}var We;!function(e){e.Product="ro.product.name",e.Model="ro.product.model",e.Device="ro.product.device",e.Features="features"}(We||(We={}));class Ke{constructor(e){this._connected=!1,this.backend=e,this.packetDispatcher=new he(e),this.tcpip=new ke(this),this.reverse=new je(this.packetDispatcher),e.onDisconnected(this.dispose,this)}get onDisconnected(){return this.backend.onDisconnected}get connected(){return this._connected}get name(){return this.backend.name}get product(){return this._product}get model(){return this._model}get device(){return this._device}get features(){return this._features}async connect(e=ye){var t,n;await(null===(n=(t=this.backend).connect)||void 0===n?void 0:n.call(t)),this.packetDispatcher.start();const a=["shell_v2","cmd",Ce.StatV2,"ls_v2","fixed_push_mkdir","apex","abb","fixed_push_symlink_timestamp","abb_exec","remount_shell","track_app","sendrecv_v2","sendrecv_v2_brotli","sendrecv_v2_lz4","sendrecv_v2_zstd","sendrecv_v2_dry_run_send"].join(","),r=new E.PromiseResolver,i=new ve(e,this.backend),s=new C;s.add(this.packetDispatcher.onPacket(async e=>{e.handled=!0;const{packet:t}=e;try{switch(t.command){case fe.Connect:if(16777217!==t.arg0)throw new Error("Version mismatch");this.parseBanner(this.backend.decodeUtf8(t.payload)),r.resolve();break;case fe.Auth:const n=await i.tryNextAuth(e.packet);await this.packetDispatcher.sendPacket(n);break;case fe.Close:break;default:throw new Error("Device not in correct state. Reconnect your device and try again")}}catch(e){r.reject(e)}})),s.add(this.packetDispatcher.onError(e=>{r.reject(e)})),await this.packetDispatcher.sendPacket(fe.Connect,16777217,1048576,"host::features="+a);try{await r.promise,this._connected=!0}finally{s.dispose()}}parseBanner(e){const t=e.split("::");if(t.length>1){const e=t[1];for(const t of e.split(";")){if(!t)continue;const e=t.split("=");if(2!==e.length)continue;const[n,a]=e;switch(n){case We.Product:this._product=a;break;case We.Model:this._model=a;break;case We.Device:this._device=a;break;case We.Features:this._features=a.split(",")}}}}shell(e,...t){return e?this.createStreamAndReadAll(`shell:${e} ${t.join(" ")}`):this.createStream("shell:")}async sync(){const e=await this.createStream("sync:");return new Re(e,this)}async framebuffer(){const e=await this.createStream("framebuffer:"),t=new le(e);return De.deserialize(t)}async createStream(e){return this.packetDispatcher.createStream(e)}async createStreamAndReadAll(e){const t=await this.createStream(e);return new oe(t).readAll()}async dispose(){this.packetDispatcher.dispose(),await this.backend.dispose()}}class Ve{constructor(e){this.callback=e,window.navigator.usb.addEventListener("connect",e),window.navigator.usb.addEventListener("disconnect",e)}dispose(){window.navigator.usb.removeEventListener("connect",this.callback),window.navigator.usb.removeEventListener("disconnect",this.callback)}}const He={classCode:255,subclassCode:66,protocolCode:1},Ge=new TextEncoder,$e=new TextDecoder;function qe(e){return Ge.encode(e)}function Qe(e){return $e.decode(e)}class Ye{constructor(e){this.disconnectEvent=new O,this.onDisconnected=this.disconnectEvent.event,this.handleDisconnect=e=>{e.device===this._device&&this.disconnectEvent.fire()},this._device=e,window.navigator.usb.addEventListener("disconnect",this.handleDisconnect)}static async getDevices(){return(await window.navigator.usb.getDevices()).map(e=>new Ye(e))}static async requestDevice(){try{const e=await navigator.usb.requestDevice({filters:[He]});return new Ye(e)}catch(e){switch(e.name){case"NotFoundError":return;default:throw e}}}get serial(){return this._device.serialNumber}get name(){return this._device.productName}async connect(){var e;this._device.opened||await this._device.open();for(const t of this._device.configurations)for(const n of t.interfaces)for(const a of n.alternates)if(a.interfaceSubclass===He.subclassCode&&a.interfaceClass===He.classCode&&a.interfaceSubclass===He.subclassCode){(null===(e=this._device.configuration)||void 0===e?void 0:e.configurationValue)!==t.configurationValue&&await this._device.selectConfiguration(t.configurationValue),n.claimed||await this._device.claimInterface(n.interfaceNumber),n.alternate.alternateSetting!==a.alternateSetting&&await this._device.selectAlternateInterface(n.interfaceNumber,a.alternateSetting);for(const e of a.endpoints)switch(e.direction){case"in":if(this._inEndpointNumber=e.endpointNumber,void 0!==this._outEndpointNumber)return;break;case"out":if(this._outEndpointNumber=e.endpointNumber,void 0!==this._inEndpointNumber)return}}throw new Error("Unknown error")}*iterateKeys(){const e=window.localStorage.getItem("private-key");e&&(yield function(e){let t;t="="===e[e.length-2]?2:"="===e[e.length-1]?1:0;const n=new Uint8Array(e.length/4*3-t);let a=0,r=0;for(;a<e.length-(0!==t?4:0);){const t=ee(e[a]);a+=1;const i=ee(e[a]);a+=1;const s=ee(e[a]);a+=1;const o=ee(e[a]);a+=1,n[r]=t<<2|(48&i)>>4,r+=1,n[r]=(15&i)<<4|(60&s)>>2,r+=1,n[r]=(3&s)<<6|o,r+=1}if(1===t){const t=ee(e[a]);a+=1;const i=ee(e[a]);a+=1;const s=ee(e[a]);n[r]=t<<2|(48&i)>>4,r+=1,n[r]=(15&i)<<4|(60&s)>>2}else if(2===t){const t=ee(e[a]);a+=1;const i=ee(e[a]);n[r]=t<<2|(48&i)>>4}return n.buffer}(e))}async generateKey(){const{privateKey:e}=await crypto.subtle.generateKey({name:"RSASSA-PKCS1-v1_5",modulusLength:2048,publicExponent:new Uint8Array([1,0,1]),hash:"SHA-1"},!0,["sign","verify"]),t=await crypto.subtle.exportKey("pkcs8",e);return window.localStorage.setItem("private-key",Qe(te(t))),t}encodeUtf8(e){return qe(e)}decodeUtf8(e){return Qe(e)}async write(e){await this._device.transferOut(this._outEndpointNumber,e)}async read(e){const t=await this._device.transferIn(this._inEndpointNumber,e);"stall"===t.status&&await this._device.clearHalt("in",this._inEndpointNumber);const{buffer:n}=t.data;return n}async dispose(){window.navigator.usb.removeEventListener("disconnect",this.handleDisconnect),this.disconnectEvent.dispose(),await this._device.close()}}var Xe=n("ZZCj"),Ze=n("sGVl"),Je=n("jEFs");function et(e,t){return t.displayName=e,Object(l.memo)(t)}const tt={position:"absolute",top:0,left:0,width:"100%",height:"100%",visibility:"hidden"},nt=et("ResizeObserver",({onResize:e,style:t,children:n,...a})=>{const r=Object(l.useRef)(e);r.current=e;const i=Object(l.useCallback)(()=>{r.current()},[]),s=Object(l.useCallback)(e=>{e&&e.contentWindow.addEventListener("resize",i)},[]),o=d.a.useMemo(()=>t?t.position?t:{...t,position:"relative"}:{position:"relative"},[t]);return d.a.createElement("div",Object.assign({style:o},a),d.a.createElement("iframe",{ref:s,style:tt}),n)}),at=d.a.createContext({show(){}});var rt=et("ErrorDialogProvider",e=>{const[t,{setTrue:n,setFalse:a}]=Object(Je.a)(!1),[r,i]=Object(l.useState)(),s=Object(l.useMemo)(()=>({show(e){i(e),n()}}),[]);return d.a.createElement(at.Provider,{value:s},e.children,d.a.createElement(y.a,{hidden:!t,dialogContentProps:{type:Xe.a.normal,title:"Error",subText:r}},d.a.createElement(Ze.a,null,d.a.createElement(b.a,{text:"OK",onClick:a}))))});const it={dropdown:{width:300}};var st=et("Connect",({device:e,onDeviceChange:t})=>{const{show:n}=Object(l.useContext)(at),[a,i]=Object(l.useState)([]),[s,o]=Object(l.useState)();Object(l.useEffect)(()=>{async function e(){const e=await Ye.getDevices(),t=e.map(e=>({key:e.serial,text:`${e.serial} ${e.name?`(${e.name})`:""}`,data:e}));i(t),o(t=>t&&e.some(e=>e.serial===t.serial)?t:e[0])}e();const t=new Ve(e);return()=>t.dispose()},[]);const c=Object(l.useCallback)(async()=>{const e=await Ye.requestDevice();e&&i(t=>{for(const n of t)if(n.key===e.serial)return o(n.data),t;return o(e),[...t,{key:e.serial,text:`${e.serial} ${e.name?`(${e.name})`:""}`,data:e}]})},[]),[u,h]=Object(l.useState)(!1),f=Object(l.useCallback)(async()=>{try{if(s){const e=new Ke(s);try{h(!0),await e.connect(),t(e)}catch(t){throw e.dispose(),t}}}catch(e){n(e.message)}finally{h(!1)}},[s,t]),m=Object(l.useCallback)(async()=>{try{await e.dispose(),t(void 0)}catch(e){n(e.message)}},[e]);return Object(l.useEffect)(()=>null==e?void 0:e.onDisconnected(()=>{t(void 0)}),[e,t]),d.a.createElement(r.a,{horizontal:!0,verticalAlign:"end",tokens:{childrenGap:8,padding:8}},d.a.createElement(p.a,{disabled:!!e||0===a.length,label:"Available devices",placeholder:"No available devices",options:a,styles:it,selectedKey:null==s?void 0:s.serial,onChange:(e,t)=>{o(null==t?void 0:t.data)}}),e?d.a.createElement(g.a,{text:"Disconnect",onClick:m}):d.a.createElement(d.a.Fragment,null,d.a.createElement(b.a,{text:"Connect",disabled:!s,primary:!!s,onClick:f}),d.a.createElement(w.a,{content:"WebADB can't connect to anything without your explicit permission."},d.a.createElement(g.a,{text:"Add new device",primary:!s,onClick:c}))),d.a.createElement(y.a,{hidden:!u,dialogContentProps:{title:"Connecting",subText:"Please authorize the connection on your device"}},d.a.createElement(v.a,null)))}),ot=(n("p2bk"),n("SWC3"));const ct={tokens:{childrenGap:8,padding:8},verticalFill:!0,className:ot.a.slideUpIn10,styles:{root:{overflow:"auto"}}},lt=et("CacheRoute",e=>{const t=Object(f.f)(e),n=Object(l.useRef)(!!t);!n.current&&t&&(n.current=!0);const a=Object(l.useMemo)(()=>({...ct,styles:Object(ot.q)(ct.styles,{root:{display:t?"flex":"none"}})}),[!!t]);return e.noCache&&!t?null:n.current?d.a.createElement(r.a,Object.assign({},a),e.children):null}),dt=et("CacheSwitch",e=>{const t=Object(f.e)();let n,a,r=Object(f.f)(),i=[];return d.a.Children.forEach(e.children,e=>{var s;if(d.a.isValidElement(e)){const o=e.type===lt;if(o&&i.push(e),a)return;const c=null!==(s=e.props.path)&&void 0!==s?s:e.props.from,l=c?Object(f.d)(t.pathname,{...e.props,path:c}):r;l&&(a=l,n=o?void 0:e)}}),d.a.createElement(d.a.Fragment,null,i,n?d.a.cloneElement(n,{location:t,computedMatch:a}):null)});var ut=n("DeEv"),ht=n("IDeG"),ft=n("9BiO"),mt=n("JwHi"),pt=n("zv84"),bt=n("t/Ec"),wt=n("XIMn"),gt=n("TkDl"),yt=n("9z8q"),vt=n("aupw"),Et=n("KWRb"),kt=n("X0IQ"),Ot=n("8weS"),St=n("6SDC"),jt=n("33yf"),Ct=n.n(jt),Dt=n("Nxe8"),xt=n.n(Dt);function At(e){return{...e,key:e.name}}Object(Et.a)(),xt.a.mitm="streamsaver/mitm.html";const Lt=Object(ot.D)({name:{cursor:"pointer","&:hover":{textDecoration:"underline"}}}),zt=[" B"," KB"," MB"," GB"];function Pt(e){const t=e.lastIndexOf(".");return-1===t?"":e.slice(t)}const It=(e,t)=>e&&t?t({...e,styles:Object(ot.q)(e.styles,{root:{paddingTop:0}})}):null;function _t(e){return new Promise(t=>{setTimeout(t,e)})}function Tt(e){return new ReadableStream({async pull(t){const{desiredSize:n}=t;if(!n||n<0)return;let a=0;for(;a<n;){const n=await e.next();if(n.done)return void t.close();t.enqueue(new Uint8Array(n.value)),a+=n.value.byteLength}}})}var Ut=et("FileManager",({device:e})=>{const{show:t}=Object(l.useContext)(at),[n,r]=Object(l.useState)("/"),i=Object(l.useRef)(n);i.current=n;const s=Object(l.useMemo)(()=>{let e="";const t=n.split("/").filter(Boolean).map(t=>(e+="/"+t,{key:e,text:t,onClick:(e,t)=>{t&&r(t.key)}}));return t.unshift({key:"/",text:"/",onClick:()=>r("/")}),t[t.length-1].isCurrentItem=!0,t[t.length-1].onClick=void 0,t},[n]),[o,c]=Object(l.useState)([]),[u,h]=Object(l.useState)(!1),f=Object(l.useRef)(null),m=Object(l.useCallback)(async()=>{var t;if(c([]),!e)return void r("/");h(!0);const a=await e.sync(),s=[],o=[],l=setInterval(()=>{c(s.slice())},1e3);try{let e=Date.now();for await(const t of a.opendir(n)){if(n!==i.current)break;if("."===t.name||".."===t.name)continue;t.type===ze.Link?o.push(t):s.push(At(t));const a=Date.now();a-e>16&&(await _t(0),e=a)}for(const e of o)try{const t=Ct.a.resolve(n,e.name)+"/";await a.lstat(t),s.push(At(e))}catch(t){s.push(At(Te.create({mode:ze.File<<12|e.permission,size:0,mtime:e.mtime,name:e.name},{encodeUtf8:qe})))}c(s),null===(t=f.current)||void 0===t||t.scrollToIndex(0)}finally{n===i.current&&h(!1),clearInterval(l),a.dispose()}},[e,n]);Object(l.useEffect)(()=>{m()},[m]);const[p,b]=Object(l.useState)([]),[w,g]=Object(l.useState)("name"),[y,v]=Object(l.useState)(!1);Object(l.useEffect)(()=>{const e=o.slice();e.sort((e,t)=>{const n=e.type===ze.File?1:0,a=t.type===ze.File?1:0;let r;if(n!==a)r=n-a;else{const n=e[w],a=t[w];r=n===a?e.name<t.name?-1:1:n<a?-1:1}return y&&(r*=-1),r}),b(e)},[o,w,y]);const E=Object(l.useMemo)(()=>{const e=[{key:"type",name:"File Type",iconName:"Page",isIconOnly:!0,minWidth:20,maxWidth:20,isCollapsible:!0,onRender(e){switch(e.type){case ze.Link:return d.a.createElement(ut.a,Object.assign({},Object(kt.a)({size:20,type:Ot.a.linkedFolder})));case ze.Directory:return d.a.createElement(ut.a,Object.assign({},Object(kt.a)({size:20,type:Ot.a.folder})));case ze.File:return d.a.createElement(ut.a,Object.assign({},Object(kt.a)({size:20,extension:Pt(e.name)})));default:return d.a.createElement(ut.a,Object.assign({},Object(kt.a)({size:20,extension:"txt"})))}}},{key:"name",name:"Name",minWidth:0,isRowHeader:!0,onRender:e=>d.a.createElement("span",{className:Lt.name,"data-selection-invoke":!0},e.name)},{key:"mode",name:"Mode",minWidth:0,onRender:e=>`0${(e.mode>>6&4).toString(8)}${(e.mode>>3&4).toString(8)}${(4&e.mode).toString(8)}`},{key:"logicalSize",name:"Size",minWidth:0,onRender:e=>e.type===ze.File?function(e){let t=0;for(;t<zt.length&&e>1024;)t+=1,e/=1024;return e.toLocaleString(void 0,{maximumFractionDigits:2})+zt[t]}(e.size):""},{key:"mtime",name:"Last Modified Time",minWidth:150,onRender:e=>new Date(1e3*e.mtime).toLocaleString()}];for(const t of e)t.onColumnClick=(e,t)=>{w===t.key?v(!y):(g(t.key),v(!1))},t.key===w&&(t.isSorted=!0,t.isSortedDescending=y);return e},[w,y]),[k,O]=Object(l.useState)(),S=Object(l.useCallback)(async t=>{const n=await e.sync();try{const e=Tt(n.receive(t)),a=new Response(e),r=await a.blob(),i=window.URL.createObjectURL(r);O(i)}finally{n.dispose()}},[e]),j=Object(l.useCallback)(()=>{O(void 0)},[]),C=Object(l.useCallback)(e=>{switch(e.type){case ze.Link:case ze.Directory:r(Ct.a.resolve(n,e.name));break;case ze.File:switch(Pt(e.name)){case".jpg":case".png":case".svg":case".gif":S(Ct.a.resolve(n,e.name))}}},[n,S]),D=Object(St.a)(()=>new ht.a),[x,A]=Object(l.useState)([]),[L,z]=Object(l.useState)(),P=Object(l.useCallback)((a,r,i)=>{if(!i)return!1;const s=D.getSelection();let o=[];return 1===s.length&&s[0].type===ze.File&&o.push({key:"download",text:"Download",onClick:()=>((async()=>{const a=await e.sync();try{const e=Ct.a.resolve(n,s[0].name),t=Tt(a.receive(e)),r=xt.a.createWriteStream(s[0].name,{size:s[0].size});await t.pipeTo(r)}catch(e){t(e.message)}finally{a.dispose()}})(),!1)}),o.push({key:"delete",text:"Delete",onClick:()=>((async()=>{try{for(const a of s){const r=await e.shell("rm","-rf",`"${Ct.a.resolve(n,a.name)}"`);if(r)return void t(r)}}catch(e){t(e.message)}finally{m()}})(),!1)}),!!o.length&&(A(o),z(i),!1)},[n,e]),I=d.a.useCallback(()=>{z(void 0)},[]);return d.a.createElement(ft.a,{selection:D},e&&d.a.createElement(a.a,null,d.a.createElement(mt.a,{items:s})),d.a.createElement(a.a,{grow:!0,styles:{root:{minHeight:0}}},d.a.createElement(pt.a,{componentRef:f,items:p,columns:E,setKey:n,selection:D,layoutMode:bt.e.justified,enableShimmer:u&&0===o.length,onItemInvoked:C,onItemContextMenu:P,onRenderDetailsHeader:It,usePageCache:!0})),k&&d.a.createElement(wt.a,null,d.a.createElement(gt.a,{onClick:j},d.a.createElement("div",{style:{width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center"}},d.a.createElement("img",{src:k,style:{maxWidth:"100%",maxHeight:"100%"}})))),d.a.createElement(yt.a,{items:x,hidden:!L,directionalHint:vt.a.bottomLeftEdge,target:L,onDismiss:I}))}),Nt=et("FrameBuffer",({device:e})=>{const t=Object(l.useRef)(null);return Object(l.useEffect)(()=>{if(!e)return;let n,a=!0;return async function r(){const i=window.performance.now(),s=await e.framebuffer(),o=window.performance.now();console.log("time",o-i);const{width:c,height:l}=s,d=t.current;if(!d)return;d.width=c,d.height=l;const u=d.getContext("2d"),h=new ImageData(new Uint8ClampedArray(s.data),c,l);u.putImageData(h,0,0),a&&(n=setTimeout(r,16))}(),()=>{a=!1,clearTimeout(n)}},[e]),d.a.createElement(d.a.Fragment,null,d.a.createElement("canvas",{ref:t,style:{maxWidth:"100%"}}))}),Ft=n("3mns"),Mt=n("RyIQ");const Bt=Object(ot.D)({callout:{padding:"8px 12px"}}),Rt={root:{fontWeight:"600"}},Wt=et("CopyLink",({href:e})=>{const t=Object(l.useRef)(null),[n,{setTrue:a,setFalse:r}]=Object(Je.a)(!1),i=Object(l.useCallback)(n=>{navigator.clipboard.writeText(e),t.current=n.target,a(),setTimeout(r,3e3)},[e]);return d.a.createElement(d.a.Fragment,null,d.a.createElement(Ft.a,{onClick:i},e),d.a.createElement(Mt.a,{directionalHint:vt.a.topCenter,hidden:!n,target:t,onDismiss:r},d.a.createElement("div",{className:Bt.callout},"Link copied. Open a new tab and paste into address bar.")))});var Kt=et("Intro",()=>d.a.createElement(d.a.Fragment,null,d.a.createElement(i.a,{block:!0},"This page is a demo of my "," ",d.a.createElement(Ft.a,{href:"https://github.com/yume-chan/ya-webadb/",target:"_blank"},"WebADB")," ","library, which can connect to your Android devices with the "," ",d.a.createElement(Ft.a,{href:"https://developer.mozilla.org/en-US/docs/Web/API/USB",target:"_blank"},"WebUSB")," ","API."),d.a.createElement(i.a,{block:!0},"The latest version of Google Chrome (or Microsoft Edge) is recommended for best compatibility."),d.a.createElement(i.a,{block:!0,styles:Rt},"Windows user?"),d.a.createElement(i.a,{block:!0},"The experimental new backend is required. Enable from  "," ",d.a.createElement(Wt,{href:"chrome://flags/#new-usb-backend"}),"."),d.a.createElement(i.a,{block:!0,styles:Rt},'Got "Unable to claim interface" error?'),d.a.createElement(i.a,{block:!0},"Only one software can connect to your device at a time.",d.a.createElement("br",null),"1. Make sure ADB server is not running (run `adb kill-server` to stop it).",d.a.createElement("br",null),"2. Make sure no other Android management tools are running"),d.a.createElement(i.a,{block:!0,styles:Rt},'Got "Access denied" error?'),d.a.createElement(i.a,{block:!0},"If you have a Samsung device, it's caused by the custom driver. See "," ",d.a.createElement(Ft.a,{href:"https://bugs.chromium.org/p/chromium/issues/detail?id=1127206"},"https://bugs.chromium.org/p/chromium/issues/detail?id=1127206")),d.a.createElement(i.a,{block:!0,styles:Rt},"Can I connect my device wirelessly (ADB over WiFi)?"),d.a.createElement(i.a,{block:!0},"No. Web browsers doesn't support TCP connections.",d.a.createElement("br",null),"Or maybe, with "," ",d.a.createElement(Ft.a,{href:"https://github.com/novnc/websockify"},"websockify")," ","running on your device and a WebSocket backend for WebADB."))),Vt=n("WDP9"),Ht=n("2WvF"),Gt=n("/POA"),$t=n("R9As"),qt=n("0fl0");n("q7KB");const Qt={width:"100%",height:"100%"},Yt={iconName:"ChevronUp"},Xt={iconName:"ChevronDown"};var Zt=et("Shell",({device:e})=>{const[t,n]=Object(l.useState)(""),i=Object(l.useRef)(),s=Object(l.useCallback)((e,t)=>{n(null!=t?t:""),t&&i.current.findNext(t,{incremental:!0})},[]),o=Object(l.useCallback)(()=>{i.current.findPrevious(t)},[t]),c=Object(l.useCallback)(()=>{i.current.findNext(t)},[t]),[u,h]=Object(l.useState)(),f=Object(l.useRef)(),m=Object(l.useCallback)(e=>{if(!e)return;const t=new Gt.Terminal({scrollback:9001}),n=new qt.SearchAddon;i.current=n,t.loadAddon(n);const a=new $t.FitAddon;f.current=a,t.loadAddon(a),h(t),t.open(e),a.fit()},[]);Object(l.useEffect)(()=>()=>null==u?void 0:u.dispose(),[]),Object(l.useEffect)(()=>{if(e&&u)return(async()=>{const t=await e.shell();u.onData(e=>{const n=qe(e);t.write(n)}),t.onData(e=>{u.write(new Uint8Array(e))})})(),()=>{u.reset(),u.clear()}},[e,u]);const p=Object(l.useCallback)(()=>{var e;null===(e=f.current)||void 0===e||e.fit()},[]);return d.a.createElement(d.a.Fragment,null,d.a.createElement(a.a,null,d.a.createElement(r.a,{horizontal:!0},d.a.createElement(a.a,{grow:!0},d.a.createElement(Vt.a,{placeholder:"Find",value:t,onChange:s,onSearch:c})),d.a.createElement(a.a,null,d.a.createElement(Ht.a,{disabled:!t,iconProps:Yt,onClick:o})),d.a.createElement(a.a,null,d.a.createElement(Ht.a,{disabled:!t,iconProps:Xt,onClick:c})))),d.a.createElement(a.a,{grow:!0,styles:{root:{minHeight:0}}},d.a.createElement(nt,{style:Qt,onResize:p},d.a.createElement("div",{ref:m,style:{height:"100%"}}))))}),Jt=n("GIx+"),en=n("iMux"),tn=n("CcL7"),nn=n("fGTi");const an={childrenGap:8};var rn=et("TcpIp",({device:e})=>{const[t,n]=Object(l.useState)();Object(l.useEffect)(()=>{e||n(void 0)},[e]);const s=Object(l.useCallback)(async()=>{if(!e)return;const t=await e.tcpip.getAddresses();n(t)},[e]),[o,c]=Object(l.useState)("5555"),u=Object(nn.a)("tcpPort"),h=Object(l.useCallback)(async()=>{e&&await e.tcpip.setPort(Number.parseInt(o,10))},[e,o]),f=Object(l.useCallback)(async()=>{e&&await e.tcpip.disable()},[e]);return d.a.createElement(d.a.Fragment,null,d.a.createElement(a.a,null,d.a.createElement(Jt.a,null,d.a.createElement(i.a,null,"Although WebADB can enable ADB over WiFi for you, it can't connect to your device wirelessly."))),d.a.createElement(a.a,null,d.a.createElement(Jt.a,null,d.a.createElement(i.a,null,"Your device will disconnect after changing ADB over WiFi config."))),d.a.createElement(r.a,{horizontal:!0,verticalAlign:"center",tokens:an},d.a.createElement(a.a,null,d.a.createElement(b.a,{text:"Update Status",disabled:!e,onClick:s})),d.a.createElement(a.a,null,void 0!==t&&(0!==t.length?"Enabled at "+t.join(", "):"Disabled"))),d.a.createElement(r.a,{horizontal:!0,verticalAlign:"center",tokens:an},d.a.createElement(a.a,null,d.a.createElement(en.a,{htmlFor:u},"Port: ")),d.a.createElement(a.a,null,d.a.createElement(tn.a,{id:u,width:300,disabled:!e,value:o,onChange:(e,t)=>c(t)})),d.a.createElement(a.a,null,d.a.createElement(b.a,{text:"Enable",disabled:!e,onClick:h}))),d.a.createElement(a.a,null,d.a.createElement(b.a,{text:"Disable",disabled:!e||void 0===t||0===t.length,onClick:f})))});Object(c.a)(),h.a.render(d.a.createElement(m.a,null,d.a.createElement(rt,null,d.a.createElement((function(){const e=Object(f.e)(),[t,n]=Object(l.useState)(),c=Object(l.useMemo)(()=>{var e;return[{path:"/",exact:!0,name:"Introduction",children:d.a.createElement(Kt,null)},{path:"/device-info",name:"Device Info",children:d.a.createElement(d.a.Fragment,null,d.a.createElement(a.a,null,"Product: ",null==t?void 0:t.product),d.a.createElement(a.a,null,"Model: ",null==t?void 0:t.model),d.a.createElement(a.a,null,"Device: ",null==t?void 0:t.device),d.a.createElement(a.a,null,"Features: ",null===(e=null==t?void 0:t.features)||void 0===e?void 0:e.join(",")))},{path:"/adb-over-wifi",name:"ADB over WiFi",children:d.a.createElement(rn,{device:t})},{path:"/shell",name:"Interactive Shell",children:d.a.createElement(Zt,{device:t})},{path:"/file-manager",name:"File Manager",children:d.a.createElement(Ut,{device:t})},{path:"/framebuffer",name:"Screen Capture",noCache:!0,children:d.a.createElement(Nt,{device:t})}]},[t]);return d.a.createElement(r.a,{verticalFill:!0},d.a.createElement(a.a,{tokens:{padding:8}},d.a.createElement(i.a,{variant:"xxLarge"},"WebADB Demo")),d.a.createElement(a.a,null,d.a.createElement(st,{device:t,onDeviceChange:n})),d.a.createElement(a.a,null,d.a.createElement(s.a,null)),d.a.createElement(a.a,{grow:!0,styles:{root:{minHeight:0}}},d.a.createElement(r.a,{horizontal:!0,verticalFill:!0,tokens:an},d.a.createElement(a.a,null,d.a.createElement(o.a,{styles:{root:{width:250}},groups:[{links:c.map(e=>({key:e.path,name:e.name,url:"#"+e.path}))}],selectedKey:e.pathname})),d.a.createElement(a.a,{grow:!0,styles:{root:{minHeight:0,overflow:"hidden"}}},d.a.createElement(dt,null,c.map(e=>d.a.createElement(lt,{exact:e.exact,path:e.path,noCache:e.noCache},e.children)),d.a.createElement(f.a,{to:"/"}))))))}),null))),document.getElementById("container"))},p2bk:function(e,t,n){}});
//# sourceMappingURL=index.23e08024c9de693abaae.js.map